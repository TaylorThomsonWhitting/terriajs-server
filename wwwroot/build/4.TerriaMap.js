((self || window)["webpackJsonp"] = (self || window)["webpackJsonp"] || []).push([[4],{

/***/ "./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts":
/*!******************************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.reduce.js */ \"./node_modules/core-js/modules/es.array.reduce.js\");\n__webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"./node_modules/core-js/modules/es.array.slice.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.isImageryProviderGridLayer = exports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.array.join.js */ \"./node_modules/core-js/modules/es.array.join.js\");\n__webpack_require__(/*! core-js/modules/es.object.assign.js */ \"./node_modules/core-js/modules/es.object.assign.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _mobx = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\nvar _Cartographic = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\"));\nvar _Event = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Event */ \"./node_modules/terriajs-cesium/Source/Core/Event.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _SplitDirection = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Scene/SplitDirection */ \"./node_modules/terriajs-cesium/Source/Scene/SplitDirection.js\"));\nvar _class, _descriptor, _descriptor2;\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }\nfunction _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'transform-class-properties is enabled and runs after the decorators transform.'); }\nvar isImageryProviderGridLayer = exports.isImageryProviderGridLayer = function isImageryProviderGridLayer(obj) {\n  return typeof obj.requestImageForCanvas === \"function\";\n};\nvar ImageryProviderLeafletGridLayer = exports[\"default\"] = (_class = /*#__PURE__*/function (_L$GridLayer) {\n  _inherits(ImageryProviderLeafletGridLayer, _L$GridLayer);\n  function ImageryProviderLeafletGridLayer(leaflet, imageryProvider, options) {\n    var _this;\n    _classCallCheck(this, ImageryProviderLeafletGridLayer);\n    _this = _callSuper(this, ImageryProviderLeafletGridLayer, [Object.assign(options, {\n      async: true,\n      tileSize: 256\n    })]);\n    _this.leaflet = leaflet;\n    _this.imageryProvider = imageryProvider;\n    _defineProperty(_assertThisInitialized(_this), \"errorEvent\", new _Event[\"default\"]());\n    _defineProperty(_assertThisInitialized(_this), \"initialized\", false);\n    _defineProperty(_assertThisInitialized(_this), \"_usable\", false);\n    _defineProperty(_assertThisInitialized(_this), \"_delayedUpdate\", undefined);\n    _defineProperty(_assertThisInitialized(_this), \"_zSubtract\", 0);\n    _defineProperty(_assertThisInitialized(_this), \"_previousCredits\", []);\n    _initializerDefineProperty(_assertThisInitialized(_this), \"splitDirection\", _descriptor, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"splitPosition\", _descriptor2, _assertThisInitialized(_this));\n    (0, _mobx.makeObservable)(_assertThisInitialized(_this));\n\n    // Handle splitter rection (and disposing reaction)\n    var disposeSplitterReaction;\n    _this.on(\"add\", function () {\n      if (!disposeSplitterReaction) {\n        disposeSplitterReaction = _this._reactToSplitterChange();\n      }\n    });\n    _this.on(\"remove\", function () {\n      if (disposeSplitterReaction) {\n        disposeSplitterReaction();\n        disposeSplitterReaction = undefined;\n      }\n    });\n    return _this;\n  }\n  _createClass(ImageryProviderLeafletGridLayer, [{\n    key: \"_reactToSplitterChange\",\n    value: function _reactToSplitterChange() {\n      var _this2 = this;\n      return (0, _mobx.autorun)(function () {\n        var container = _this2.getContainer();\n        if (container === null) {\n          return;\n        }\n        if (_this2.splitDirection === _SplitDirection[\"default\"].LEFT) {\n          var clipLeft = _this2._clipsForSplitter.left;\n          container.style.clip = clipLeft;\n        } else if (_this2.splitDirection === _SplitDirection[\"default\"].RIGHT) {\n          var clipRight = _this2._clipsForSplitter.right;\n          container.style.clip = clipRight;\n        } else {\n          container.style.clip = \"auto\";\n        }\n      });\n    }\n  }, {\n    key: \"_clipsForSplitter\",\n    get: function get() {\n      var clipLeft = \"\";\n      var clipRight = \"\";\n      var clipPositionWithinMap;\n      var clipX;\n      if (this.leaflet.size && this.leaflet.nw && this.leaflet.se) {\n        clipPositionWithinMap = this.leaflet.size.x * this.splitPosition;\n        clipX = Math.round(this.leaflet.nw.x + clipPositionWithinMap);\n        clipLeft = \"rect(\" + [this.leaflet.nw.y, clipX, this.leaflet.se.y, this.leaflet.nw.x].join(\"px,\") + \"px)\";\n        clipRight = \"rect(\" + [this.leaflet.nw.y, this.leaflet.se.x, this.leaflet.se.y, clipX].join(\"px,\") + \"px)\";\n      }\n      return {\n        left: clipLeft,\n        right: clipRight,\n        clipPositionWithinMap: clipPositionWithinMap,\n        clipX: clipX\n      };\n    }\n  }, {\n    key: \"createTile\",\n    value: function createTile(tilePoint, done) {\n      var _this3 = this;\n      var canvas = _leaflet[\"default\"].DomUtil.create(\"canvas\", \"leaflet-tile\");\n      var size = this.getTileSize();\n      canvas.width = size.x;\n      canvas.height = size.y;\n      this.imageryProvider.readyPromise.then(function () {\n        var n = _this3.imageryProvider.tilingScheme.getNumberOfXTilesAtLevel(tilePoint.z);\n        return _this3.imageryProvider.requestImageForCanvas(_Math[\"default\"].mod(tilePoint.x, n), tilePoint.y, tilePoint.z, canvas);\n      }).then(function (canvas) {\n        done(undefined, canvas);\n      });\n      return canvas; // Not yet drawn on, but Leaflet requires the tile\n    }\n  }, {\n    key: \"getFeaturePickingCoords\",\n    value: function getFeaturePickingCoords(map, longitudeRadians, latitudeRadians) {\n      var _this4 = this;\n      var ll = new _Cartographic[\"default\"](_Math[\"default\"].negativePiToPi(longitudeRadians), latitudeRadians, 0.0);\n      var level = Math.round(map.getZoom());\n      return this.imageryProvider.readyPromise.then(function () {\n        var tilingScheme = _this4.imageryProvider.tilingScheme;\n        var coords = tilingScheme.positionToTileXY(ll, level);\n        return {\n          x: coords.x,\n          y: coords.y,\n          level: level\n        };\n      });\n    }\n  }, {\n    key: \"pickFeatures\",\n    value: function pickFeatures(x, y, level, longitudeRadians, latitudeRadians) {\n      var _this5 = this;\n      return this.imageryProvider.readyPromise.then(function () {\n        return _this5.imageryProvider.pickFeatures(x, y, level, longitudeRadians, latitudeRadians);\n      });\n    }\n  }]);\n  return ImageryProviderLeafletGridLayer;\n}(_leaflet[\"default\"].GridLayer), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"splitDirection\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return _SplitDirection[\"default\"].NONE;\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"splitPosition\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return 0.5;\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"_clipsForSplitter\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"_clipsForSplitter\"), _class.prototype)), _class);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvSW1hZ2VyeVByb3ZpZGVyTGVhZmxldEdyaWRMYXllci50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvTGVhZmxldC9JbWFnZXJ5UHJvdmlkZXJMZWFmbGV0R3JpZExheWVyLnRzPzJjM2QiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEwsIHsgVGlsZUV2ZW50IH0gZnJvbSBcImxlYWZsZXRcIjtcclxuaW1wb3J0IHtcclxuICBhdXRvcnVuLFxyXG4gIGNvbXB1dGVkLFxyXG4gIElSZWFjdGlvbkRpc3Bvc2VyLFxyXG4gIG9ic2VydmFibGUsXHJcbiAgbWFrZU9ic2VydmFibGVcclxufSBmcm9tIFwibW9ieFwiO1xyXG5pbXBvcnQgQ2FydG9ncmFwaGljIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2FydG9ncmFwaGljXCI7XHJcbmltcG9ydCBDZXNpdW1FdmVudCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0V2ZW50XCI7XHJcbmltcG9ydCBDZXNpdW1NYXRoIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvTWF0aFwiO1xyXG5pbXBvcnQgU3BsaXREaXJlY3Rpb24gZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvU3BsaXREaXJlY3Rpb25cIjtcclxuaW1wb3J0IExlYWZsZXQgZnJvbSBcIi4uLy4uL01vZGVscy9MZWFmbGV0XCI7XHJcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvSW1hZ2VyeVByb3ZpZGVyXCI7XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIEltYWdlcnlQcm92aWRlcldpdGhHcmlkTGF5ZXJTdXBwb3J0IGV4dGVuZHMgSW1hZ2VyeVByb3ZpZGVyIHtcclxuICByZXF1ZXN0SW1hZ2VGb3JDYW52YXM6IChcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIGxldmVsOiBudW1iZXIsXHJcbiAgICBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50XHJcbiAgKSA9PiBQcm9taXNlPEhUTUxDYW52YXNFbGVtZW50PjtcclxufVxyXG5cclxuZXhwb3J0IGNvbnN0IGlzSW1hZ2VyeVByb3ZpZGVyR3JpZExheWVyID0gKFxyXG4gIG9iajogYW55XHJcbik6IG9iaiBpcyBJbWFnZXJ5UHJvdmlkZXJXaXRoR3JpZExheWVyU3VwcG9ydCA9PiB7XHJcbiAgcmV0dXJuIHR5cGVvZiBvYmoucmVxdWVzdEltYWdlRm9yQ2FudmFzID09PSBcImZ1bmN0aW9uXCI7XHJcbn07XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0R3JpZExheWVyIGV4dGVuZHMgTC5HcmlkTGF5ZXIge1xyXG4gIHJlYWRvbmx5IGVycm9yRXZlbnQ6IENlc2l1bUV2ZW50ID0gbmV3IENlc2l1bUV2ZW50KCk7XHJcbiAgcmVhZG9ubHkgaW5pdGlhbGl6ZWQ6IGJvb2xlYW4gPSBmYWxzZTtcclxuICByZWFkb25seSBfdXNhYmxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgcmVhZG9ubHkgX2RlbGF5ZWRVcGRhdGU6IHVua25vd24gPSB1bmRlZmluZWQ7XHJcbiAgcmVhZG9ubHkgX3pTdWJ0cmFjdDogbnVtYmVyID0gMDtcclxuICByZWFkb25seSBfcHJldmlvdXNDcmVkaXRzOiB1bmtub3duW10gPSBbXTtcclxuXHJcbiAgQG9ic2VydmFibGUgc3BsaXREaXJlY3Rpb24gPSBTcGxpdERpcmVjdGlvbi5OT05FO1xyXG4gIEBvYnNlcnZhYmxlIHNwbGl0UG9zaXRpb246IG51bWJlciA9IDAuNTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGxlYWZsZXQ6IExlYWZsZXQsXHJcbiAgICByZWFkb25seSBpbWFnZXJ5UHJvdmlkZXI6IEltYWdlcnlQcm92aWRlcldpdGhHcmlkTGF5ZXJTdXBwb3J0LFxyXG4gICAgb3B0aW9uczogTC5HcmlkTGF5ZXJPcHRpb25zXHJcbiAgKSB7XHJcbiAgICBzdXBlcihPYmplY3QuYXNzaWduKG9wdGlvbnMsIHsgYXN5bmM6IHRydWUsIHRpbGVTaXplOiAyNTYgfSkpO1xyXG5cclxuICAgIG1ha2VPYnNlcnZhYmxlKHRoaXMpO1xyXG5cclxuICAgIC8vIEhhbmRsZSBzcGxpdHRlciByZWN0aW9uIChhbmQgZGlzcG9zaW5nIHJlYWN0aW9uKVxyXG4gICAgbGV0IGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uOiBJUmVhY3Rpb25EaXNwb3NlciB8IHVuZGVmaW5lZDtcclxuICAgIHRoaXMub24oXCJhZGRcIiwgKCkgPT4ge1xyXG4gICAgICBpZiAoIWRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uKSB7XHJcbiAgICAgICAgZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24gPSB0aGlzLl9yZWFjdFRvU3BsaXR0ZXJDaGFuZ2UoKTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICB0aGlzLm9uKFwicmVtb3ZlXCIsICgpID0+IHtcclxuICAgICAgaWYgKGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uKSB7XHJcbiAgICAgICAgZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24oKTtcclxuICAgICAgICBkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbiA9IHVuZGVmaW5lZDtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBfcmVhY3RUb1NwbGl0dGVyQ2hhbmdlKCkge1xyXG4gICAgcmV0dXJuIGF1dG9ydW4oKCkgPT4ge1xyXG4gICAgICBjb25zdCBjb250YWluZXIgPSB0aGlzLmdldENvbnRhaW5lcigpO1xyXG4gICAgICBpZiAoY29udGFpbmVyID09PSBudWxsKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBpZiAodGhpcy5zcGxpdERpcmVjdGlvbiA9PT0gU3BsaXREaXJlY3Rpb24uTEVGVCkge1xyXG4gICAgICAgIGNvbnN0IHsgbGVmdDogY2xpcExlZnQgfSA9IHRoaXMuX2NsaXBzRm9yU3BsaXR0ZXI7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmNsaXAgPSBjbGlwTGVmdDtcclxuICAgICAgfSBlbHNlIGlmICh0aGlzLnNwbGl0RGlyZWN0aW9uID09PSBTcGxpdERpcmVjdGlvbi5SSUdIVCkge1xyXG4gICAgICAgIGNvbnN0IHsgcmlnaHQ6IGNsaXBSaWdodCB9ID0gdGhpcy5fY2xpcHNGb3JTcGxpdHRlcjtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUuY2xpcCA9IGNsaXBSaWdodDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjb250YWluZXIuc3R5bGUuY2xpcCA9IFwiYXV0b1wiO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIEBjb21wdXRlZFxyXG4gIGdldCBfY2xpcHNGb3JTcGxpdHRlcigpIHtcclxuICAgIGxldCBjbGlwTGVmdCA9IFwiXCI7XHJcbiAgICBsZXQgY2xpcFJpZ2h0ID0gXCJcIjtcclxuICAgIGxldCBjbGlwUG9zaXRpb25XaXRoaW5NYXA7XHJcbiAgICBsZXQgY2xpcFg7XHJcblxyXG4gICAgaWYgKHRoaXMubGVhZmxldC5zaXplICYmIHRoaXMubGVhZmxldC5udyAmJiB0aGlzLmxlYWZsZXQuc2UpIHtcclxuICAgICAgY2xpcFBvc2l0aW9uV2l0aGluTWFwID0gdGhpcy5sZWFmbGV0LnNpemUueCAqIHRoaXMuc3BsaXRQb3NpdGlvbjtcclxuICAgICAgY2xpcFggPSBNYXRoLnJvdW5kKHRoaXMubGVhZmxldC5udy54ICsgY2xpcFBvc2l0aW9uV2l0aGluTWFwKTtcclxuICAgICAgY2xpcExlZnQgPVxyXG4gICAgICAgIFwicmVjdChcIiArXHJcbiAgICAgICAgW3RoaXMubGVhZmxldC5udy55LCBjbGlwWCwgdGhpcy5sZWFmbGV0LnNlLnksIHRoaXMubGVhZmxldC5udy54XS5qb2luKFxyXG4gICAgICAgICAgXCJweCxcIlxyXG4gICAgICAgICkgK1xyXG4gICAgICAgIFwicHgpXCI7XHJcbiAgICAgIGNsaXBSaWdodCA9XHJcbiAgICAgICAgXCJyZWN0KFwiICtcclxuICAgICAgICBbdGhpcy5sZWFmbGV0Lm53LnksIHRoaXMubGVhZmxldC5zZS54LCB0aGlzLmxlYWZsZXQuc2UueSwgY2xpcFhdLmpvaW4oXHJcbiAgICAgICAgICBcInB4LFwiXHJcbiAgICAgICAgKSArXHJcbiAgICAgICAgXCJweClcIjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsZWZ0OiBjbGlwTGVmdCxcclxuICAgICAgcmlnaHQ6IGNsaXBSaWdodCxcclxuICAgICAgY2xpcFBvc2l0aW9uV2l0aGluTWFwOiBjbGlwUG9zaXRpb25XaXRoaW5NYXAsXHJcbiAgICAgIGNsaXBYOiBjbGlwWFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGNyZWF0ZVRpbGUodGlsZVBvaW50OiBMLkNvb3JkcywgZG9uZTogTC5Eb25lQ2FsbGJhY2spIHtcclxuICAgIGNvbnN0IGNhbnZhcyA9IDxIVE1MQ2FudmFzRWxlbWVudD4oXHJcbiAgICAgIEwuRG9tVXRpbC5jcmVhdGUoXCJjYW52YXNcIiwgXCJsZWFmbGV0LXRpbGVcIilcclxuICAgICk7XHJcbiAgICBjb25zdCBzaXplID0gdGhpcy5nZXRUaWxlU2l6ZSgpO1xyXG4gICAgY2FudmFzLndpZHRoID0gc2l6ZS54O1xyXG4gICAgY2FudmFzLmhlaWdodCA9IHNpemUueTtcclxuXHJcbiAgICB0aGlzLmltYWdlcnlQcm92aWRlci5yZWFkeVByb21pc2VcclxuICAgICAgLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG4gPSB0aGlzLmltYWdlcnlQcm92aWRlci50aWxpbmdTY2hlbWUuZ2V0TnVtYmVyT2ZYVGlsZXNBdExldmVsKFxyXG4gICAgICAgICAgdGlsZVBvaW50LnpcclxuICAgICAgICApO1xyXG4gICAgICAgIHJldHVybiB0aGlzLmltYWdlcnlQcm92aWRlci5yZXF1ZXN0SW1hZ2VGb3JDYW52YXMoXHJcbiAgICAgICAgICBDZXNpdW1NYXRoLm1vZCh0aWxlUG9pbnQueCwgbiksXHJcbiAgICAgICAgICB0aWxlUG9pbnQueSxcclxuICAgICAgICAgIHRpbGVQb2ludC56LFxyXG4gICAgICAgICAgY2FudmFzXHJcbiAgICAgICAgKTtcclxuICAgICAgfSlcclxuICAgICAgLnRoZW4oZnVuY3Rpb24gKGNhbnZhcykge1xyXG4gICAgICAgIGRvbmUodW5kZWZpbmVkLCBjYW52YXMpO1xyXG4gICAgICB9KTtcclxuICAgIHJldHVybiBjYW52YXM7IC8vIE5vdCB5ZXQgZHJhd24gb24sIGJ1dCBMZWFmbGV0IHJlcXVpcmVzIHRoZSB0aWxlXHJcbiAgfVxyXG5cclxuICBnZXRGZWF0dXJlUGlja2luZ0Nvb3JkcyhcclxuICAgIG1hcDogTC5NYXAsXHJcbiAgICBsb25naXR1ZGVSYWRpYW5zOiBudW1iZXIsXHJcbiAgICBsYXRpdHVkZVJhZGlhbnM6IG51bWJlclxyXG4gICkge1xyXG4gICAgY29uc3QgbGwgPSBuZXcgQ2FydG9ncmFwaGljKFxyXG4gICAgICBDZXNpdW1NYXRoLm5lZ2F0aXZlUGlUb1BpKGxvbmdpdHVkZVJhZGlhbnMpLFxyXG4gICAgICBsYXRpdHVkZVJhZGlhbnMsXHJcbiAgICAgIDAuMFxyXG4gICAgKTtcclxuICAgIGNvbnN0IGxldmVsID0gTWF0aC5yb3VuZChtYXAuZ2V0Wm9vbSgpKTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5pbWFnZXJ5UHJvdmlkZXIucmVhZHlQcm9taXNlLnRoZW4oKCkgPT4ge1xyXG4gICAgICBjb25zdCB0aWxpbmdTY2hlbWUgPSB0aGlzLmltYWdlcnlQcm92aWRlci50aWxpbmdTY2hlbWU7XHJcbiAgICAgIGNvbnN0IGNvb3JkcyA9IHRpbGluZ1NjaGVtZS5wb3NpdGlvblRvVGlsZVhZKGxsLCBsZXZlbCk7XHJcbiAgICAgIHJldHVybiB7XHJcbiAgICAgICAgeDogY29vcmRzLngsXHJcbiAgICAgICAgeTogY29vcmRzLnksXHJcbiAgICAgICAgbGV2ZWw6IGxldmVsXHJcbiAgICAgIH07XHJcbiAgICB9KTtcclxuICB9XHJcblxyXG4gIHBpY2tGZWF0dXJlcyhcclxuICAgIHg6IG51bWJlcixcclxuICAgIHk6IG51bWJlcixcclxuICAgIGxldmVsOiBudW1iZXIsXHJcbiAgICBsb25naXR1ZGVSYWRpYW5zOiBudW1iZXIsXHJcbiAgICBsYXRpdHVkZVJhZGlhbnM6IG51bWJlclxyXG4gICkge1xyXG4gICAgcmV0dXJuIHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnJlYWR5UHJvbWlzZS50aGVuKCgpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnBpY2tGZWF0dXJlcyhcclxuICAgICAgICB4LFxyXG4gICAgICAgIHksXHJcbiAgICAgICAgbGV2ZWwsXHJcbiAgICAgICAgbG9uZ2l0dWRlUmFkaWFucyxcclxuICAgICAgICBsYXRpdHVkZVJhZGlhbnNcclxuICAgICAgKTtcclxuICAgIH0pO1xyXG4gIH1cclxufVxyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBYUE7QUFHQTtBQUNBO0FBQUE7QUFFQTtBQVdBO0FBSUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFKQTtBQUNBO0FBWkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQU1BO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUdBO0FBTUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQU1BO0FBQ0E7QUFLQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBUUE7QUFDQTtBQUNBO0FBT0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQS9JQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts":
/*!******************************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts ***!
  \******************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.async-iterator.js */ \"./node_modules/core-js/modules/es.symbol.async-iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-string-tag.js */ \"./node_modules/core-js/modules/es.symbol.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.array.filter.js */ \"./node_modules/core-js/modules/es.array.filter.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.reduce.js */ \"./node_modules/core-js/modules/es.array.reduce.js\");\n__webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"./node_modules/core-js/modules/es.array.slice.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.function.name.js */ \"./node_modules/core-js/modules/es.function.name.js\");\n__webpack_require__(/*! core-js/modules/es.json.to-string-tag.js */ \"./node_modules/core-js/modules/es.json.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.math.to-string-tag.js */ \"./node_modules/core-js/modules/es.math.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-properties.js */ \"./node_modules/core-js/modules/es.object.define-properties.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptors.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptors.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.promise.js */ \"./node_modules/core-js/modules/es.promise.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.get.js */ \"./node_modules/core-js/modules/es.reflect.get.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"./node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.join.js */ \"./node_modules/core-js/modules/es.array.join.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/web.timers.js */ \"./node_modules/core-js/modules/web.timers.js\");\nvar _i18next = _interopRequireDefault(__webpack_require__(/*! i18next */ \"./node_modules/i18next/dist/esm/i18next.js\"));\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _mobx = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\nvar _Cartesian = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian2 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian2.js\"));\nvar _Cartographic = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\"));\nvar _Credit2 = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Credit */ \"./node_modules/terriajs-cesium/Source/Core/Credit.js\"));\nvar _defined = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/defined */ \"./node_modules/terriajs-cesium/Source/Core/defined.js\"));\nvar _Event = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Event */ \"./node_modules/terriajs-cesium/Source/Core/Event.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _TileProviderError = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/TileProviderError */ \"./node_modules/terriajs-cesium/Source/Core/TileProviderError.js\"));\nvar _WebMercatorTilingScheme = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/WebMercatorTilingScheme */ \"./node_modules/terriajs-cesium/Source/Core/WebMercatorTilingScheme.js\"));\nvar _SplitDirection = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Scene/SplitDirection */ \"./node_modules/terriajs-cesium/Source/Scene/SplitDirection.js\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nvar _pollToPromise = _interopRequireDefault(__webpack_require__(/*! ../../Core/pollToPromise */ \"./packages/terriajs/lib/Core/pollToPromise.js\"));\nvar _TerriaError = _interopRequireDefault(__webpack_require__(/*! ../../Core/TerriaError */ \"./packages/terriajs/lib/Core/TerriaError.ts\"));\nvar _getUrlForImageryTile = _interopRequireDefault(__webpack_require__(/*! ../ImageryProvider/getUrlForImageryTile */ \"./packages/terriajs/lib/Map/ImageryProvider/getUrlForImageryTile.ts\"));\nvar _class, _descriptor, _descriptor2;\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = \"function\" == typeof Symbol ? Symbol : {}, a = i.iterator || \"@@iterator\", c = i.asyncIterator || \"@@asyncIterator\", u = i.toStringTag || \"@@toStringTag\"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, \"\"); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, \"_invoke\", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: \"normal\", arg: t.call(e, r) }; } catch (t) { return { type: \"throw\", arg: t }; } } e.wrap = wrap; var h = \"suspendedStart\", l = \"suspendedYield\", f = \"executing\", s = \"completed\", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { [\"next\", \"throw\", \"return\"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if (\"throw\" !== c.type) { var u = c.arg, h = u.value; return h && \"object\" == _typeof(h) && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) { invoke(\"next\", t, i, a); }, function (t) { invoke(\"throw\", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke(\"throw\", t, i, a); }); } a(c.arg); } var r; o(this, \"_invoke\", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw new Error(\"Generator is already running\"); if (o === s) { if (\"throw\" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else \"return\" === n.method && n.abrupt(\"return\", n.arg); o = f; var p = tryCatch(e, r, n); if (\"normal\" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, \"throw\" === n && e.iterator[\"return\"] && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y; var i = tryCatch(o, e.iterator, r.arg); if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = \"normal\", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: \"root\" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || \"\" === e) { var r = e[a]; if (r) return r.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + \" is not iterable\"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, \"constructor\", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) { var e = \"function\" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () { return this; }), define(g, \"toString\", function () { return \"[object Generator]\"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if (\"throw\" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if (\"root\" === i.tryLoc) return handle(\"end\"); if (i.tryLoc <= this.prev) { var c = n.call(i, \"catchLoc\"), u = n.call(i, \"finallyLoc\"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw new Error(\"try statement without catch or finally\"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) { var i = o; break; } } i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if (\"throw\" === t.type) throw t.arg; return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, \"catch\": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if (\"throw\" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw new Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, \"next\" === this.method && (this.arg = t), y; } }, e; }\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\nfunction _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _get() { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get.bind(); } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(arguments.length < 3 ? target : receiver); } return desc.value; }; } return _get.apply(this, arguments); }\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }\nfunction _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'transform-class-properties is enabled and runs after the decorators transform.'); }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\n// We want TS to look at the type declared in lib/ThirdParty/terriajs-cesium-extra/index.d.ts\n// and import doesn't allows us to do that, so instead we use require + type casting to ensure\n// we still maintain the type checking, without TS screaming with errors\nvar FeatureDetection = __webpack_require__(/*! terriajs-cesium/Source/Core/FeatureDetection */ \"./node_modules/terriajs-cesium/Source/Core/FeatureDetection.js\")[\"default\"];\nvar swScratch = new _Cartographic[\"default\"]();\nvar neScratch = new _Cartographic[\"default\"]();\nvar swTileCoordinatesScratch = new _Cartesian[\"default\"]();\nvar neTileCoordinatesScratch = new _Cartesian[\"default\"]();\nvar Credit = /*#__PURE__*/function (_CesiumCredit) {\n  _inherits(Credit, _CesiumCredit);\n  function Credit() {\n    var _this;\n    _classCallCheck(this, Credit);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, Credit, [].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"_shownInLeaflet\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_shownInLeafletLastUpdate\", void 0);\n    return _this;\n  }\n  return _createClass(Credit);\n}(_Credit2[\"default\"]);\nvar ImageryProviderLeafletTileLayer = exports[\"default\"] = (_class = /*#__PURE__*/function (_L$TileLayer) {\n  _inherits(ImageryProviderLeafletTileLayer, _L$TileLayer);\n  function ImageryProviderLeafletTileLayer(leaflet, imageryProvider) {\n    var _this2;\n    var options = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n    _classCallCheck(this, ImageryProviderLeafletTileLayer);\n    _this2 = _callSuper(this, ImageryProviderLeafletTileLayer, [undefined, _objectSpread(_objectSpread({}, options), {}, {\n      updateInterval: (0, _defined[\"default\"])(imageryProvider._leafletUpdateInterval) ? imageryProvider._leafletUpdateInterval : 100\n    })]);\n    _this2.leaflet = leaflet;\n    _this2.imageryProvider = imageryProvider;\n    _defineProperty(_assertThisInitialized(_this2), \"tileSize\", 256);\n    _defineProperty(_assertThisInitialized(_this2), \"errorEvent\", new _Event[\"default\"]());\n    _defineProperty(_assertThisInitialized(_this2), \"initialized\", false);\n    _defineProperty(_assertThisInitialized(_this2), \"_usable\", false);\n    _defineProperty(_assertThisInitialized(_this2), \"_delayedUpdate\", void 0);\n    _defineProperty(_assertThisInitialized(_this2), \"_zSubtract\", 0);\n    _defineProperty(_assertThisInitialized(_this2), \"_requestImageError\", void 0);\n    _defineProperty(_assertThisInitialized(_this2), \"_previousCredits\", []);\n    _defineProperty(_assertThisInitialized(_this2), \"_leafletUpdateInterval\", void 0);\n    _initializerDefineProperty(_assertThisInitialized(_this2), \"splitDirection\", _descriptor, _assertThisInitialized(_this2));\n    _initializerDefineProperty(_assertThisInitialized(_this2), \"splitPosition\", _descriptor2, _assertThisInitialized(_this2));\n    (0, _mobx.makeObservable)(_assertThisInitialized(_this2));\n    _this2.imageryProvider = imageryProvider;\n\n    // Handle splitter rection (and disposing reaction)\n    var disposeSplitterReaction;\n    _this2.on(\"add\", function () {\n      if (!disposeSplitterReaction) {\n        disposeSplitterReaction = _this2._reactToSplitterChange();\n      }\n    });\n    _this2.on(\"remove\", function () {\n      if (disposeSplitterReaction) {\n        disposeSplitterReaction();\n        disposeSplitterReaction = undefined;\n      }\n    });\n    _this2._leafletUpdateInterval = (0, _defined[\"default\"])(imageryProvider._leafletUpdateInterval) ? imageryProvider._leafletUpdateInterval : 100;\n\n    // Hack to fix \"Space between tiles on fractional zoom levels in Webkit browsers\" (https://github.com/Leaflet/Leaflet/issues/3575#issuecomment-688644225)\n    _this2.on(\"tileloadstart\", function (event) {\n      event.tile.style.width = _this2.getTileSize().x + 0.5 + \"px\";\n      event.tile.style.height = _this2.getTileSize().y + 0.5 + \"px\";\n    });\n    return _this2;\n  }\n  _createClass(ImageryProviderLeafletTileLayer, [{\n    key: \"_reactToSplitterChange\",\n    value: function _reactToSplitterChange() {\n      var _this3 = this;\n      return (0, _mobx.autorun)(function () {\n        var container = _this3.getContainer();\n        if (container === null) {\n          return;\n        }\n        if (_this3.splitDirection === _SplitDirection[\"default\"].LEFT) {\n          var clipLeft = _this3._clipsForSplitter.left;\n          container.style.clip = clipLeft;\n        } else if (_this3.splitDirection === _SplitDirection[\"default\"].RIGHT) {\n          var clipRight = _this3._clipsForSplitter.right;\n          container.style.clip = clipRight;\n        } else {\n          container.style.clip = \"auto\";\n        }\n      });\n    }\n  }, {\n    key: \"_clipsForSplitter\",\n    get: function get() {\n      var clipLeft = \"\";\n      var clipRight = \"\";\n      var clipPositionWithinMap;\n      var clipX;\n      if (this.leaflet.size && this.leaflet.nw && this.leaflet.se) {\n        clipPositionWithinMap = this.leaflet.size.x * this.splitPosition;\n        clipX = Math.round(this.leaflet.nw.x + clipPositionWithinMap);\n        clipLeft = \"rect(\" + [this.leaflet.nw.y, clipX, this.leaflet.se.y, this.leaflet.nw.x].join(\"px,\") + \"px)\";\n        clipRight = \"rect(\" + [this.leaflet.nw.y, this.leaflet.se.x, this.leaflet.se.y, clipX].join(\"px,\") + \"px)\";\n      }\n      return {\n        left: clipLeft,\n        right: clipRight,\n        clipPositionWithinMap: clipPositionWithinMap,\n        clipX: clipX\n      };\n    }\n  }, {\n    key: \"_tileOnError\",\n    value: function _tileOnError(_done, _tile, _e) {\n      // Do nothing, we'll handle tile errors separately.\n    }\n  }, {\n    key: \"createTile\",\n    value: function createTile(coords, done) {\n      var _this4 = this;\n      // Create a tile (Image) as normal.\n      var tile = _get(_getPrototypeOf(ImageryProviderLeafletTileLayer.prototype), \"createTile\", this).call(this, coords, done);\n\n      // By default, Leaflet handles tile load errors by setting the Image to the error URL and raising\n      // an error event.  We want to first raise an error event that optionally returns a promise and\n      // retries after the promise resolves.\n\n      var doRequest = function doRequest(waitPromise) {\n        if (waitPromise) {\n          waitPromise.then(function () {\n            doRequest();\n          })[\"catch\"](function (e) {\n            // The tile has failed irrecoverably, so invoke Leaflet's standard\n            // tile error handler.\n            _leaflet[\"default\"].TileLayer.prototype._tileOnError.call(_this4, done, tile, e);\n          });\n          return;\n        }\n\n        // Setting src will trigger a new load or error event, even if the\n        // new src is the same as the old one.\n        var tileUrl = _this4.getTileUrl(coords);\n        if ((0, _isDefined[\"default\"])(tileUrl)) {\n          tile.src = tileUrl;\n        }\n      };\n      _leaflet[\"default\"].DomEvent.on(tile, \"error\", function (e) {\n        var level = _this4._getLevelFromZ(coords);\n        var message = _i18next[\"default\"].t(\"map.cesium.failedToObtain\", {\n          x: coords.x,\n          y: coords.y,\n          level: level\n        });\n        _this4._requestImageError = _TileProviderError[\"default\"].handleError(_this4._requestImageError, _this4.imageryProvider, _this4.imageryProvider.errorEvent, message, coords.x, coords.y, level, doRequest, e);\n      });\n      return tile;\n    }\n  }, {\n    key: \"getTileUrl\",\n    value: function getTileUrl(tilePoint) {\n      var level = this._getLevelFromZ(tilePoint);\n      var errorTileUrl = this.options.errorTileUrl || \"\";\n      if (level < 0) {\n        return errorTileUrl;\n      }\n      return (0, _getUrlForImageryTile[\"default\"])(this.imageryProvider, tilePoint.x, tilePoint.y, level) || errorTileUrl;\n    }\n  }, {\n    key: \"_getLevelFromZ\",\n    value: function _getLevelFromZ(tilePoint) {\n      return tilePoint.z - this._zSubtract;\n    }\n  }, {\n    key: \"_update\",\n    value: function _update() {\n      var _this5 = this;\n      if (!this.imageryProvider.ready) {\n        if (!this._delayedUpdate) {\n          this._delayedUpdate = setTimeout(function () {\n            _this5._delayedUpdate = undefined;\n            _this5._update();\n          }, this._leafletUpdateInterval);\n        }\n        return;\n      }\n      if (!this.initialized) {\n        this.initialized = true;\n\n        // Cancel the existing delayed update, if any.\n        if (this._delayedUpdate) {\n          clearTimeout(this._delayedUpdate);\n          this._delayedUpdate = undefined;\n        }\n        this._delayedUpdate = setTimeout(function () {\n          _this5._delayedUpdate = undefined;\n\n          // If we're no longer attached to a map, do nothing.\n          if (!_this5._map) {\n            return;\n          }\n          var tilingScheme = _this5.imageryProvider.tilingScheme;\n          if (!(tilingScheme instanceof _WebMercatorTilingScheme[\"default\"])) {\n            _this5.errorEvent.raiseEvent(_this5, _i18next[\"default\"].t(\"map.cesium.notWebMercatorTilingScheme\"));\n            return;\n          }\n          if (tilingScheme.getNumberOfXTilesAtLevel(0) === 2 && tilingScheme.getNumberOfYTilesAtLevel(0) === 2) {\n            _this5._zSubtract = 1;\n          } else if (tilingScheme.getNumberOfXTilesAtLevel(0) !== 1 || tilingScheme.getNumberOfYTilesAtLevel(0) !== 1) {\n            _this5.errorEvent.raiseEvent(_this5, _i18next[\"default\"].t(\"map.cesium.unusalTilingScheme\"));\n            return;\n          }\n          if ((0, _isDefined[\"default\"])(_this5.imageryProvider.maximumLevel)) {\n            _this5.options.maxNativeZoom = _this5.imageryProvider.maximumLevel;\n          }\n          if ((0, _defined[\"default\"])(_this5.imageryProvider.minimumLevel)) {\n            _this5.options.minNativeZoom = _this5.imageryProvider.minimumLevel;\n          }\n          if ((0, _isDefined[\"default\"])(_this5.imageryProvider.credit)) {\n            _this5._map.attributionControl.addAttribution(getCreditHtml(_this5.imageryProvider.credit));\n          }\n          _this5._usable = true;\n          _this5._update();\n        }, this._leafletUpdateInterval);\n      }\n      if (this._usable) {\n        _leaflet[\"default\"].TileLayer.prototype._update.apply(this, arguments);\n        this._updateAttribution();\n      }\n    }\n  }, {\n    key: \"_updateAttribution\",\n    value: function _updateAttribution() {\n      if (!this._usable || !(0, _isDefined[\"default\"])(this.imageryProvider.getTileCredits)) {\n        return;\n      }\n      for (var i = 0; i < this._previousCredits.length; ++i) {\n        this._previousCredits[i]._shownInLeafletLastUpdate = this._previousCredits[i]._shownInLeaflet;\n        this._previousCredits[i]._shownInLeaflet = false;\n      }\n      var bounds = this._map.getBounds();\n      var zoom = this._map.getZoom() - this._zSubtract;\n      var tilingScheme = this.imageryProvider.tilingScheme;\n      swScratch.longitude = Math.max(_Math[\"default\"].negativePiToPi(_Math[\"default\"].toRadians(bounds.getWest())), tilingScheme.rectangle.west);\n      swScratch.latitude = Math.max(_Math[\"default\"].toRadians(bounds.getSouth()), tilingScheme.rectangle.south);\n      var sw = tilingScheme.positionToTileXY(swScratch, zoom, swTileCoordinatesScratch);\n      if (!(0, _isDefined[\"default\"])(sw)) {\n        sw = swTileCoordinatesScratch;\n        sw.x = 0;\n        sw.y = tilingScheme.getNumberOfYTilesAtLevel(zoom) - 1;\n      }\n      neScratch.longitude = Math.min(_Math[\"default\"].negativePiToPi(_Math[\"default\"].toRadians(bounds.getEast())), tilingScheme.rectangle.east);\n      neScratch.latitude = Math.min(_Math[\"default\"].toRadians(bounds.getNorth()), tilingScheme.rectangle.north);\n      var ne = tilingScheme.positionToTileXY(neScratch, zoom, neTileCoordinatesScratch);\n      if (!(0, _isDefined[\"default\"])(ne)) {\n        ne = neTileCoordinatesScratch;\n        ne.x = tilingScheme.getNumberOfXTilesAtLevel(zoom) - 1;\n        ne.y = 0;\n      }\n      var nextCredits = [];\n      for (var j = ne.y; j < sw.y; ++j) {\n        for (var _i = sw.x; _i < ne.x; ++_i) {\n          var credits = this.imageryProvider.getTileCredits(_i, j, zoom);\n          if (!(0, _defined[\"default\"])(credits)) {\n            continue;\n          }\n          for (var k = 0; k < credits.length; ++k) {\n            var credit = credits[k];\n            if (credit._shownInLeaflet) {\n              continue;\n            }\n            credit._shownInLeaflet = true;\n            nextCredits.push(credit);\n            if (!credit._shownInLeafletLastUpdate) {\n              this._map.attributionControl.addAttribution(getCreditHtml(credit));\n            }\n          }\n        }\n      }\n\n      // Remove attributions that applied last update but not this one.\n      for (var _i2 = 0; _i2 < this._previousCredits.length; ++_i2) {\n        if (!this._previousCredits[_i2]._shownInLeaflet) {\n          this._map.attributionControl.removeAttribution(getCreditHtml(this._previousCredits[_i2]));\n          this._previousCredits[_i2]._shownInLeafletLastUpdate = false;\n        }\n      }\n      this._previousCredits = nextCredits;\n    }\n  }, {\n    key: \"getFeaturePickingCoords\",\n    value: function getFeaturePickingCoords(map, longitudeRadians, latitudeRadians) {\n      var _this6 = this;\n      var ll = new _Cartographic[\"default\"](_Math[\"default\"].negativePiToPi(longitudeRadians), latitudeRadians, 0.0);\n      var level = Math.round(map.getZoom());\n      return (0, _pollToPromise[\"default\"])(function () {\n        return _this6.imageryProvider.ready;\n      }).then(function () {\n        var tilingScheme = _this6.imageryProvider.tilingScheme;\n        var coords = tilingScheme.positionToTileXY(ll, level);\n        return {\n          x: coords.x,\n          y: coords.y,\n          level: level\n        };\n      });\n    }\n  }, {\n    key: \"pickFeatures\",\n    value: function () {\n      var _pickFeatures = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(x, y, level, longitudeRadians, latitudeRadians) {\n        var _this7 = this;\n        return _regeneratorRuntime().wrap(function _callee$(_context) {\n          while (1) switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return (0, _pollToPromise[\"default\"])(function () {\n                return _this7.imageryProvider.ready;\n              });\n            case 2:\n              _context.prev = 2;\n              _context.next = 5;\n              return this.imageryProvider.pickFeatures(x, y, level, longitudeRadians, latitudeRadians);\n            case 5:\n              return _context.abrupt(\"return\", _context.sent);\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](2);\n              _TerriaError[\"default\"].from(_context.t0, \"An error ocurred while calling `ImageryProvider#.pickFeatures`. `ImageryProvider.url = \".concat(this.imageryProvider.url, \"`\")).log();\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }, _callee, this, [[2, 8]]);\n      }));\n      function pickFeatures(_x, _x2, _x3, _x4, _x5) {\n        return _pickFeatures.apply(this, arguments);\n      }\n      return pickFeatures;\n    }()\n  }, {\n    key: \"onRemove\",\n    value: function onRemove(map) {\n      if (this._delayedUpdate) {\n        clearTimeout(this._delayedUpdate);\n        this._delayedUpdate = undefined;\n      }\n      for (var i = 0; i < this._previousCredits.length; ++i) {\n        this._previousCredits[i]._shownInLeafletLastUpdate = false;\n        this._previousCredits[i]._shownInLeaflet = false;\n        map.attributionControl.removeAttribution(getCreditHtml(this._previousCredits[i]));\n      }\n      if (this._usable && (0, _defined[\"default\"])(this.imageryProvider.credit)) {\n        map.attributionControl.removeAttribution(getCreditHtml(this.imageryProvider.credit));\n      }\n      _leaflet[\"default\"].TileLayer.prototype.onRemove.apply(this, [map]);\n\n      // Check that this cancels tile requests when dragging the time slider and rapidly creating\n      // and destroying layers.  If the image requests for previous times/layers are allowed to hang\n      // around, they clog up the pipeline and it takes approximately forever for the browser\n      // to get around to downloading the tiles that are actually needed.\n      this._abortLoading();\n      return this;\n    }\n  }]);\n  return ImageryProviderLeafletTileLayer;\n}(_leaflet[\"default\"].TileLayer), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"splitDirection\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return _SplitDirection[\"default\"].NONE;\n  }\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"splitPosition\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: function initializer() {\n    return 0.5;\n  }\n}), _applyDecoratedDescriptor(_class.prototype, \"_clipsForSplitter\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"_clipsForSplitter\"), _class.prototype)), _class);\nfunction getCreditHtml(credit) {\n  return credit.element.outerHTML;\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllci50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvTGVhZmxldC9JbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyLnRzP2UwYTUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGkxOG5leHQgZnJvbSBcImkxOG5leHRcIjtcclxuaW1wb3J0IEwsIHsgVGlsZUV2ZW50IH0gZnJvbSBcImxlYWZsZXRcIjtcclxuaW1wb3J0IHtcclxuICBhdXRvcnVuLFxyXG4gIGNvbXB1dGVkLFxyXG4gIElSZWFjdGlvbkRpc3Bvc2VyLFxyXG4gIG9ic2VydmFibGUsXHJcbiAgbWFrZU9ic2VydmFibGVcclxufSBmcm9tIFwibW9ieFwiO1xyXG5pbXBvcnQgQ2FydGVzaWFuMiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRlc2lhbjJcIjtcclxuaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRvZ3JhcGhpY1wiO1xyXG5pbXBvcnQgQ2VzaXVtQ3JlZGl0IGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ3JlZGl0XCI7XHJcbmltcG9ydCBkZWZpbmVkIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvZGVmaW5lZFwiO1xyXG5pbXBvcnQgQ2VzaXVtRXZlbnQgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9FdmVudFwiO1xyXG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL01hdGhcIjtcclxuaW1wb3J0IFRpbGVQcm92aWRlckVycm9yIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvVGlsZVByb3ZpZGVyRXJyb3JcIjtcclxuaW1wb3J0IFdlYk1lcmNhdG9yVGlsaW5nU2NoZW1lIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvV2ViTWVyY2F0b3JUaWxpbmdTY2hlbWVcIjtcclxuaW1wb3J0IEltYWdlcnlMYXllckZlYXR1cmVJbmZvIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL1NjZW5lL0ltYWdlcnlMYXllckZlYXR1cmVJbmZvXCI7XHJcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvSW1hZ2VyeVByb3ZpZGVyXCI7XHJcbmltcG9ydCBTcGxpdERpcmVjdGlvbiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9TY2VuZS9TcGxpdERpcmVjdGlvblwiO1xyXG5pbXBvcnQgaXNEZWZpbmVkIGZyb20gXCIuLi8uLi9Db3JlL2lzRGVmaW5lZFwiO1xyXG5pbXBvcnQgcG9sbFRvUHJvbWlzZSBmcm9tIFwiLi4vLi4vQ29yZS9wb2xsVG9Qcm9taXNlXCI7XHJcbmltcG9ydCBUZXJyaWFFcnJvciBmcm9tIFwiLi4vLi4vQ29yZS9UZXJyaWFFcnJvclwiO1xyXG5pbXBvcnQgTGVhZmxldCBmcm9tIFwiLi4vLi4vTW9kZWxzL0xlYWZsZXRcIjtcclxuaW1wb3J0IGdldFVybEZvckltYWdlcnlUaWxlIGZyb20gXCIuLi9JbWFnZXJ5UHJvdmlkZXIvZ2V0VXJsRm9ySW1hZ2VyeVRpbGVcIjtcclxuaW1wb3J0IHsgUHJvdmlkZXJDb29yZHMgfSBmcm9tIFwiLi4vUGlja2VkRmVhdHVyZXMvUGlja2VkRmVhdHVyZXNcIjtcclxuXHJcbi8vIFdlIHdhbnQgVFMgdG8gbG9vayBhdCB0aGUgdHlwZSBkZWNsYXJlZCBpbiBsaWIvVGhpcmRQYXJ0eS90ZXJyaWFqcy1jZXNpdW0tZXh0cmEvaW5kZXguZC50c1xyXG4vLyBhbmQgaW1wb3J0IGRvZXNuJ3QgYWxsb3dzIHVzIHRvIGRvIHRoYXQsIHNvIGluc3RlYWQgd2UgdXNlIHJlcXVpcmUgKyB0eXBlIGNhc3RpbmcgdG8gZW5zdXJlXHJcbi8vIHdlIHN0aWxsIG1haW50YWluIHRoZSB0eXBlIGNoZWNraW5nLCB3aXRob3V0IFRTIHNjcmVhbWluZyB3aXRoIGVycm9yc1xyXG5jb25zdCBGZWF0dXJlRGV0ZWN0aW9uOiBGZWF0dXJlRGV0ZWN0aW9uID1cclxuICByZXF1aXJlKFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0ZlYXR1cmVEZXRlY3Rpb25cIikuZGVmYXVsdDtcclxuXHJcbmNvbnN0IHN3U2NyYXRjaCA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcclxuY29uc3QgbmVTY3JhdGNoID0gbmV3IENhcnRvZ3JhcGhpYygpO1xyXG5jb25zdCBzd1RpbGVDb29yZGluYXRlc1NjcmF0Y2ggPSBuZXcgQ2FydGVzaWFuMigpO1xyXG5jb25zdCBuZVRpbGVDb29yZGluYXRlc1NjcmF0Y2ggPSBuZXcgQ2FydGVzaWFuMigpO1xyXG5cclxuY2xhc3MgQ3JlZGl0IGV4dGVuZHMgQ2VzaXVtQ3JlZGl0IHtcclxuICBfc2hvd25JbkxlYWZsZXQ/OiBib29sZWFuO1xyXG4gIF9zaG93bkluTGVhZmxldExhc3RVcGRhdGU/OiBib29sZWFuO1xyXG59XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyIGV4dGVuZHMgTC5UaWxlTGF5ZXIge1xyXG4gIHJlYWRvbmx5IHRpbGVTaXplID0gMjU2O1xyXG4gIHJlYWRvbmx5IGVycm9yRXZlbnQgPSBuZXcgQ2VzaXVtRXZlbnQoKTtcclxuXHJcbiAgcHJpdmF0ZSBpbml0aWFsaXplZCA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX3VzYWJsZSA9IGZhbHNlO1xyXG4gIHByaXZhdGUgX2RlbGF5ZWRVcGRhdGU/OiBudW1iZXI7XHJcbiAgcHJpdmF0ZSBfelN1YnRyYWN0ID0gMDtcclxuICBwcml2YXRlIF9yZXF1ZXN0SW1hZ2VFcnJvcj86IFRpbGVQcm92aWRlckVycm9yO1xyXG4gIHByaXZhdGUgX3ByZXZpb3VzQ3JlZGl0czogQ3JlZGl0W10gPSBbXTtcclxuICBwcml2YXRlIF9sZWFmbGV0VXBkYXRlSW50ZXJ2YWw6IG51bWJlcjtcclxuXHJcbiAgQG9ic2VydmFibGUgc3BsaXREaXJlY3Rpb24gPSBTcGxpdERpcmVjdGlvbi5OT05FO1xyXG4gIEBvYnNlcnZhYmxlIHNwbGl0UG9zaXRpb246IG51bWJlciA9IDAuNTtcclxuXHJcbiAgY29uc3RydWN0b3IoXHJcbiAgICBwcml2YXRlIGxlYWZsZXQ6IExlYWZsZXQsXHJcbiAgICByZWFkb25seSBpbWFnZXJ5UHJvdmlkZXI6IEltYWdlcnlQcm92aWRlcixcclxuICAgIG9wdGlvbnM6IEwuVGlsZUxheWVyT3B0aW9ucyA9IHt9XHJcbiAgKSB7XHJcbiAgICBzdXBlcig8YW55PnVuZGVmaW5lZCwge1xyXG4gICAgICAuLi5vcHRpb25zLFxyXG4gICAgICB1cGRhdGVJbnRlcnZhbDogZGVmaW5lZCgoaW1hZ2VyeVByb3ZpZGVyIGFzIGFueSkuX2xlYWZsZXRVcGRhdGVJbnRlcnZhbClcclxuICAgICAgICA/IChpbWFnZXJ5UHJvdmlkZXIgYXMgYW55KS5fbGVhZmxldFVwZGF0ZUludGVydmFsXHJcbiAgICAgICAgOiAxMDBcclxuICAgIH0pO1xyXG4gICAgbWFrZU9ic2VydmFibGUodGhpcyk7XHJcbiAgICB0aGlzLmltYWdlcnlQcm92aWRlciA9IGltYWdlcnlQcm92aWRlcjtcclxuXHJcbiAgICAvLyBIYW5kbGUgc3BsaXR0ZXIgcmVjdGlvbiAoYW5kIGRpc3Bvc2luZyByZWFjdGlvbilcclxuICAgIGxldCBkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbjogSVJlYWN0aW9uRGlzcG9zZXIgfCB1bmRlZmluZWQ7XHJcbiAgICB0aGlzLm9uKFwiYWRkXCIsICgpID0+IHtcclxuICAgICAgaWYgKCFkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbikge1xyXG4gICAgICAgIGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uID0gdGhpcy5fcmVhY3RUb1NwbGl0dGVyQ2hhbmdlKCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdGhpcy5vbihcInJlbW92ZVwiLCAoKSA9PiB7XHJcbiAgICAgIGlmIChkaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbikge1xyXG4gICAgICAgIGRpc3Bvc2VTcGxpdHRlclJlYWN0aW9uKCk7XHJcbiAgICAgICAgZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24gPSB1bmRlZmluZWQ7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX2xlYWZsZXRVcGRhdGVJbnRlcnZhbCA9IGRlZmluZWQoXHJcbiAgICAgIChpbWFnZXJ5UHJvdmlkZXIgYXMgYW55KS5fbGVhZmxldFVwZGF0ZUludGVydmFsXHJcbiAgICApXHJcbiAgICAgID8gKGltYWdlcnlQcm92aWRlciBhcyBhbnkpLl9sZWFmbGV0VXBkYXRlSW50ZXJ2YWxcclxuICAgICAgOiAxMDA7XHJcblxyXG4gICAgLy8gSGFjayB0byBmaXggXCJTcGFjZSBiZXR3ZWVuIHRpbGVzIG9uIGZyYWN0aW9uYWwgem9vbSBsZXZlbHMgaW4gV2Via2l0IGJyb3dzZXJzXCIgKGh0dHBzOi8vZ2l0aHViLmNvbS9MZWFmbGV0L0xlYWZsZXQvaXNzdWVzLzM1NzUjaXNzdWVjb21tZW50LTY4ODY0NDIyNSlcclxuICAgIHRoaXMub24oXCJ0aWxlbG9hZHN0YXJ0XCIsIChldmVudDogVGlsZUV2ZW50KSA9PiB7XHJcbiAgICAgIGV2ZW50LnRpbGUuc3R5bGUud2lkdGggPSB0aGlzLmdldFRpbGVTaXplKCkueCArIDAuNSArIFwicHhcIjtcclxuICAgICAgZXZlbnQudGlsZS5zdHlsZS5oZWlnaHQgPSB0aGlzLmdldFRpbGVTaXplKCkueSArIDAuNSArIFwicHhcIjtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3JlYWN0VG9TcGxpdHRlckNoYW5nZSgpIHtcclxuICAgIHJldHVybiBhdXRvcnVuKCgpID0+IHtcclxuICAgICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5nZXRDb250YWluZXIoKTtcclxuICAgICAgaWYgKGNvbnRhaW5lciA9PT0gbnVsbCkge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgaWYgKHRoaXMuc3BsaXREaXJlY3Rpb24gPT09IFNwbGl0RGlyZWN0aW9uLkxFRlQpIHtcclxuICAgICAgICBjb25zdCB7IGxlZnQ6IGNsaXBMZWZ0IH0gPSB0aGlzLl9jbGlwc0ZvclNwbGl0dGVyO1xyXG4gICAgICAgIGNvbnRhaW5lci5zdHlsZS5jbGlwID0gY2xpcExlZnQ7XHJcbiAgICAgIH0gZWxzZSBpZiAodGhpcy5zcGxpdERpcmVjdGlvbiA9PT0gU3BsaXREaXJlY3Rpb24uUklHSFQpIHtcclxuICAgICAgICBjb25zdCB7IHJpZ2h0OiBjbGlwUmlnaHQgfSA9IHRoaXMuX2NsaXBzRm9yU3BsaXR0ZXI7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmNsaXAgPSBjbGlwUmlnaHQ7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29udGFpbmVyLnN0eWxlLmNsaXAgPSBcImF1dG9cIjtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBAY29tcHV0ZWRcclxuICBnZXQgX2NsaXBzRm9yU3BsaXR0ZXIoKSB7XHJcbiAgICBsZXQgY2xpcExlZnQgPSBcIlwiO1xyXG4gICAgbGV0IGNsaXBSaWdodCA9IFwiXCI7XHJcbiAgICBsZXQgY2xpcFBvc2l0aW9uV2l0aGluTWFwO1xyXG4gICAgbGV0IGNsaXBYO1xyXG5cclxuICAgIGlmICh0aGlzLmxlYWZsZXQuc2l6ZSAmJiB0aGlzLmxlYWZsZXQubncgJiYgdGhpcy5sZWFmbGV0LnNlKSB7XHJcbiAgICAgIGNsaXBQb3NpdGlvbldpdGhpbk1hcCA9IHRoaXMubGVhZmxldC5zaXplLnggKiB0aGlzLnNwbGl0UG9zaXRpb247XHJcbiAgICAgIGNsaXBYID0gTWF0aC5yb3VuZCh0aGlzLmxlYWZsZXQubncueCArIGNsaXBQb3NpdGlvbldpdGhpbk1hcCk7XHJcbiAgICAgIGNsaXBMZWZ0ID1cclxuICAgICAgICBcInJlY3QoXCIgK1xyXG4gICAgICAgIFt0aGlzLmxlYWZsZXQubncueSwgY2xpcFgsIHRoaXMubGVhZmxldC5zZS55LCB0aGlzLmxlYWZsZXQubncueF0uam9pbihcclxuICAgICAgICAgIFwicHgsXCJcclxuICAgICAgICApICtcclxuICAgICAgICBcInB4KVwiO1xyXG4gICAgICBjbGlwUmlnaHQgPVxyXG4gICAgICAgIFwicmVjdChcIiArXHJcbiAgICAgICAgW3RoaXMubGVhZmxldC5udy55LCB0aGlzLmxlYWZsZXQuc2UueCwgdGhpcy5sZWFmbGV0LnNlLnksIGNsaXBYXS5qb2luKFxyXG4gICAgICAgICAgXCJweCxcIlxyXG4gICAgICAgICkgK1xyXG4gICAgICAgIFwicHgpXCI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsZWZ0OiBjbGlwTGVmdCxcclxuICAgICAgcmlnaHQ6IGNsaXBSaWdodCxcclxuICAgICAgY2xpcFBvc2l0aW9uV2l0aGluTWFwOiBjbGlwUG9zaXRpb25XaXRoaW5NYXAsXHJcbiAgICAgIGNsaXBYOiBjbGlwWFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIF90aWxlT25FcnJvcihfZG9uZTogdW5rbm93biwgX3RpbGU6IHVua25vd24sIF9lOiB1bmtub3duKSB7XHJcbiAgICAvLyBEbyBub3RoaW5nLCB3ZSdsbCBoYW5kbGUgdGlsZSBlcnJvcnMgc2VwYXJhdGVseS5cclxuICB9XHJcblxyXG4gIGNyZWF0ZVRpbGUoY29vcmRzOiBMLkNvb3JkcywgZG9uZTogTC5Eb25lQ2FsbGJhY2spIHtcclxuICAgIC8vIENyZWF0ZSBhIHRpbGUgKEltYWdlKSBhcyBub3JtYWwuXHJcbiAgICBjb25zdCB0aWxlID0gPEhUTUxJbWFnZUVsZW1lbnQ+c3VwZXIuY3JlYXRlVGlsZShjb29yZHMsIGRvbmUpO1xyXG5cclxuICAgIC8vIEJ5IGRlZmF1bHQsIExlYWZsZXQgaGFuZGxlcyB0aWxlIGxvYWQgZXJyb3JzIGJ5IHNldHRpbmcgdGhlIEltYWdlIHRvIHRoZSBlcnJvciBVUkwgYW5kIHJhaXNpbmdcclxuICAgIC8vIGFuIGVycm9yIGV2ZW50LiAgV2Ugd2FudCB0byBmaXJzdCByYWlzZSBhbiBlcnJvciBldmVudCB0aGF0IG9wdGlvbmFsbHkgcmV0dXJucyBhIHByb21pc2UgYW5kXHJcbiAgICAvLyByZXRyaWVzIGFmdGVyIHRoZSBwcm9taXNlIHJlc29sdmVzLlxyXG5cclxuICAgIGNvbnN0IGRvUmVxdWVzdCA9ICh3YWl0UHJvbWlzZT86IGFueSkgPT4ge1xyXG4gICAgICBpZiAod2FpdFByb21pc2UpIHtcclxuICAgICAgICB3YWl0UHJvbWlzZVxyXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBkb1JlcXVlc3QoKTtcclxuICAgICAgICAgIH0pXHJcbiAgICAgICAgICAuY2F0Y2goKGU6IHVua25vd24pID0+IHtcclxuICAgICAgICAgICAgLy8gVGhlIHRpbGUgaGFzIGZhaWxlZCBpcnJlY292ZXJhYmx5LCBzbyBpbnZva2UgTGVhZmxldCdzIHN0YW5kYXJkXHJcbiAgICAgICAgICAgIC8vIHRpbGUgZXJyb3IgaGFuZGxlci5cclxuICAgICAgICAgICAgKDxhbnk+TC5UaWxlTGF5ZXIpLnByb3RvdHlwZS5fdGlsZU9uRXJyb3IuY2FsbCh0aGlzLCBkb25lLCB0aWxlLCBlKTtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgICAgfVxyXG5cclxuICAgICAgLy8gU2V0dGluZyBzcmMgd2lsbCB0cmlnZ2VyIGEgbmV3IGxvYWQgb3IgZXJyb3IgZXZlbnQsIGV2ZW4gaWYgdGhlXHJcbiAgICAgIC8vIG5ldyBzcmMgaXMgdGhlIHNhbWUgYXMgdGhlIG9sZCBvbmUuXHJcbiAgICAgIGNvbnN0IHRpbGVVcmwgPSB0aGlzLmdldFRpbGVVcmwoY29vcmRzKTtcclxuICAgICAgaWYgKGlzRGVmaW5lZCh0aWxlVXJsKSkge1xyXG4gICAgICAgIHRpbGUuc3JjID0gdGlsZVVybDtcclxuICAgICAgfVxyXG4gICAgfTtcclxuXHJcbiAgICBMLkRvbUV2ZW50Lm9uKHRpbGUsIFwiZXJyb3JcIiwgKGUpID0+IHtcclxuICAgICAgY29uc3QgbGV2ZWwgPSAoPGFueT50aGlzKS5fZ2V0TGV2ZWxGcm9tWihjb29yZHMpO1xyXG4gICAgICBjb25zdCBtZXNzYWdlID0gaTE4bmV4dC50KFwibWFwLmNlc2l1bS5mYWlsZWRUb09idGFpblwiLCB7XHJcbiAgICAgICAgeDogY29vcmRzLngsXHJcbiAgICAgICAgeTogY29vcmRzLnksXHJcbiAgICAgICAgbGV2ZWw6IGxldmVsXHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLl9yZXF1ZXN0SW1hZ2VFcnJvciA9IFRpbGVQcm92aWRlckVycm9yLmhhbmRsZUVycm9yKFxyXG4gICAgICAgIDxhbnk+dGhpcy5fcmVxdWVzdEltYWdlRXJyb3IsXHJcbiAgICAgICAgdGhpcy5pbWFnZXJ5UHJvdmlkZXIsXHJcbiAgICAgICAgPGFueT50aGlzLmltYWdlcnlQcm92aWRlci5lcnJvckV2ZW50LFxyXG4gICAgICAgIG1lc3NhZ2UsXHJcbiAgICAgICAgY29vcmRzLngsXHJcbiAgICAgICAgY29vcmRzLnksXHJcbiAgICAgICAgbGV2ZWwsXHJcbiAgICAgICAgZG9SZXF1ZXN0LFxyXG4gICAgICAgIDxhbnk+ZVxyXG4gICAgICApO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHRpbGU7XHJcbiAgfVxyXG5cclxuICBnZXRUaWxlVXJsKHRpbGVQb2ludDogTC5Db29yZHMpOiBzdHJpbmcge1xyXG4gICAgY29uc3QgbGV2ZWwgPSB0aGlzLl9nZXRMZXZlbEZyb21aKHRpbGVQb2ludCk7XHJcbiAgICBjb25zdCBlcnJvclRpbGVVcmwgPSB0aGlzLm9wdGlvbnMuZXJyb3JUaWxlVXJsIHx8IFwiXCI7XHJcbiAgICBpZiAobGV2ZWwgPCAwKSB7XHJcbiAgICAgIHJldHVybiBlcnJvclRpbGVVcmw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIChcclxuICAgICAgZ2V0VXJsRm9ySW1hZ2VyeVRpbGUoXHJcbiAgICAgICAgdGhpcy5pbWFnZXJ5UHJvdmlkZXIsXHJcbiAgICAgICAgdGlsZVBvaW50LngsXHJcbiAgICAgICAgdGlsZVBvaW50LnksXHJcbiAgICAgICAgbGV2ZWxcclxuICAgICAgKSB8fCBlcnJvclRpbGVVcmxcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBfZ2V0TGV2ZWxGcm9tWih0aWxlUG9pbnQ6IEwuQ29vcmRzKSB7XHJcbiAgICByZXR1cm4gdGlsZVBvaW50LnogLSB0aGlzLl96U3VidHJhY3Q7XHJcbiAgfVxyXG5cclxuICBfdXBkYXRlKCkge1xyXG4gICAgaWYgKCF0aGlzLmltYWdlcnlQcm92aWRlci5yZWFkeSkge1xyXG4gICAgICBpZiAoIXRoaXMuX2RlbGF5ZWRVcGRhdGUpIHtcclxuICAgICAgICB0aGlzLl9kZWxheWVkVXBkYXRlID0gPGFueT5zZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuX2RlbGF5ZWRVcGRhdGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgICAgICB0aGlzLl91cGRhdGUoKTtcclxuICAgICAgICB9LCB0aGlzLl9sZWFmbGV0VXBkYXRlSW50ZXJ2YWwpO1xyXG4gICAgICB9XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIXRoaXMuaW5pdGlhbGl6ZWQpIHtcclxuICAgICAgdGhpcy5pbml0aWFsaXplZCA9IHRydWU7XHJcblxyXG4gICAgICAvLyBDYW5jZWwgdGhlIGV4aXN0aW5nIGRlbGF5ZWQgdXBkYXRlLCBpZiBhbnkuXHJcbiAgICAgIGlmICh0aGlzLl9kZWxheWVkVXBkYXRlKSB7XHJcbiAgICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2RlbGF5ZWRVcGRhdGUpO1xyXG4gICAgICAgIHRoaXMuX2RlbGF5ZWRVcGRhdGUgPSB1bmRlZmluZWQ7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIHRoaXMuX2RlbGF5ZWRVcGRhdGUgPSA8YW55PnNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuX2RlbGF5ZWRVcGRhdGUgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICAgIC8vIElmIHdlJ3JlIG5vIGxvbmdlciBhdHRhY2hlZCB0byBhIG1hcCwgZG8gbm90aGluZy5cclxuICAgICAgICBpZiAoIXRoaXMuX21hcCkge1xyXG4gICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgY29uc3QgdGlsaW5nU2NoZW1lID0gdGhpcy5pbWFnZXJ5UHJvdmlkZXIudGlsaW5nU2NoZW1lO1xyXG4gICAgICAgIGlmICghKHRpbGluZ1NjaGVtZSBpbnN0YW5jZW9mIFdlYk1lcmNhdG9yVGlsaW5nU2NoZW1lKSkge1xyXG4gICAgICAgICAgdGhpcy5lcnJvckV2ZW50LnJhaXNlRXZlbnQoXHJcbiAgICAgICAgICAgIHRoaXMsXHJcbiAgICAgICAgICAgIGkxOG5leHQudChcIm1hcC5jZXNpdW0ubm90V2ViTWVyY2F0b3JUaWxpbmdTY2hlbWVcIilcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICB0aWxpbmdTY2hlbWUuZ2V0TnVtYmVyT2ZYVGlsZXNBdExldmVsKDApID09PSAyICYmXHJcbiAgICAgICAgICB0aWxpbmdTY2hlbWUuZ2V0TnVtYmVyT2ZZVGlsZXNBdExldmVsKDApID09PSAyXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLl96U3VidHJhY3QgPSAxO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoXHJcbiAgICAgICAgICB0aWxpbmdTY2hlbWUuZ2V0TnVtYmVyT2ZYVGlsZXNBdExldmVsKDApICE9PSAxIHx8XHJcbiAgICAgICAgICB0aWxpbmdTY2hlbWUuZ2V0TnVtYmVyT2ZZVGlsZXNBdExldmVsKDApICE9PSAxXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICB0aGlzLmVycm9yRXZlbnQucmFpc2VFdmVudChcclxuICAgICAgICAgICAgdGhpcyxcclxuICAgICAgICAgICAgaTE4bmV4dC50KFwibWFwLmNlc2l1bS51bnVzYWxUaWxpbmdTY2hlbWVcIilcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaXNEZWZpbmVkKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLm1heGltdW1MZXZlbCkpIHtcclxuICAgICAgICAgIHRoaXMub3B0aW9ucy5tYXhOYXRpdmVab29tID0gdGhpcy5pbWFnZXJ5UHJvdmlkZXIubWF4aW11bUxldmVsO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGRlZmluZWQodGhpcy5pbWFnZXJ5UHJvdmlkZXIubWluaW11bUxldmVsKSkge1xyXG4gICAgICAgICAgdGhpcy5vcHRpb25zLm1pbk5hdGl2ZVpvb20gPSB0aGlzLmltYWdlcnlQcm92aWRlci5taW5pbXVtTGV2ZWw7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoaXNEZWZpbmVkKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLmNyZWRpdCkpIHtcclxuICAgICAgICAgICg8YW55PnRoaXMuX21hcCkuYXR0cmlidXRpb25Db250cm9sLmFkZEF0dHJpYnV0aW9uKFxyXG4gICAgICAgICAgICBnZXRDcmVkaXRIdG1sKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLmNyZWRpdClcclxuICAgICAgICAgICk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl91c2FibGUgPSB0cnVlO1xyXG5cclxuICAgICAgICB0aGlzLl91cGRhdGUoKTtcclxuICAgICAgfSwgdGhpcy5fbGVhZmxldFVwZGF0ZUludGVydmFsKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAodGhpcy5fdXNhYmxlKSB7XHJcbiAgICAgICg8YW55PkwuVGlsZUxheWVyKS5wcm90b3R5cGUuX3VwZGF0ZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xyXG5cclxuICAgICAgdGhpcy5fdXBkYXRlQXR0cmlidXRpb24oKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF91cGRhdGVBdHRyaWJ1dGlvbigpIHtcclxuICAgIGlmICghdGhpcy5fdXNhYmxlIHx8ICFpc0RlZmluZWQodGhpcy5pbWFnZXJ5UHJvdmlkZXIuZ2V0VGlsZUNyZWRpdHMpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3ByZXZpb3VzQ3JlZGl0cy5sZW5ndGg7ICsraSkge1xyXG4gICAgICB0aGlzLl9wcmV2aW91c0NyZWRpdHNbaV0uX3Nob3duSW5MZWFmbGV0TGFzdFVwZGF0ZSA9XHJcbiAgICAgICAgdGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldLl9zaG93bkluTGVhZmxldDtcclxuICAgICAgdGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldLl9zaG93bkluTGVhZmxldCA9IGZhbHNlO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuX21hcC5nZXRCb3VuZHMoKTtcclxuICAgIGNvbnN0IHpvb20gPSB0aGlzLl9tYXAuZ2V0Wm9vbSgpIC0gdGhpcy5felN1YnRyYWN0O1xyXG5cclxuICAgIGNvbnN0IHRpbGluZ1NjaGVtZSA9IHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnRpbGluZ1NjaGVtZTtcclxuXHJcbiAgICBzd1NjcmF0Y2gubG9uZ2l0dWRlID0gTWF0aC5tYXgoXHJcbiAgICAgIENlc2l1bU1hdGgubmVnYXRpdmVQaVRvUGkoQ2VzaXVtTWF0aC50b1JhZGlhbnMoYm91bmRzLmdldFdlc3QoKSkpLFxyXG4gICAgICB0aWxpbmdTY2hlbWUucmVjdGFuZ2xlLndlc3RcclxuICAgICk7XHJcbiAgICBzd1NjcmF0Y2gubGF0aXR1ZGUgPSBNYXRoLm1heChcclxuICAgICAgQ2VzaXVtTWF0aC50b1JhZGlhbnMoYm91bmRzLmdldFNvdXRoKCkpLFxyXG4gICAgICB0aWxpbmdTY2hlbWUucmVjdGFuZ2xlLnNvdXRoXHJcbiAgICApO1xyXG4gICAgbGV0IHN3ID0gdGlsaW5nU2NoZW1lLnBvc2l0aW9uVG9UaWxlWFkoXHJcbiAgICAgIHN3U2NyYXRjaCxcclxuICAgICAgem9vbSxcclxuICAgICAgc3dUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoXHJcbiAgICApO1xyXG4gICAgaWYgKCFpc0RlZmluZWQoc3cpKSB7XHJcbiAgICAgIHN3ID0gc3dUaWxlQ29vcmRpbmF0ZXNTY3JhdGNoO1xyXG4gICAgICBzdy54ID0gMDtcclxuICAgICAgc3cueSA9IHRpbGluZ1NjaGVtZS5nZXROdW1iZXJPZllUaWxlc0F0TGV2ZWwoem9vbSkgLSAxO1xyXG4gICAgfVxyXG5cclxuICAgIG5lU2NyYXRjaC5sb25naXR1ZGUgPSBNYXRoLm1pbihcclxuICAgICAgQ2VzaXVtTWF0aC5uZWdhdGl2ZVBpVG9QaShDZXNpdW1NYXRoLnRvUmFkaWFucyhib3VuZHMuZ2V0RWFzdCgpKSksXHJcbiAgICAgIHRpbGluZ1NjaGVtZS5yZWN0YW5nbGUuZWFzdFxyXG4gICAgKTtcclxuICAgIG5lU2NyYXRjaC5sYXRpdHVkZSA9IE1hdGgubWluKFxyXG4gICAgICBDZXNpdW1NYXRoLnRvUmFkaWFucyhib3VuZHMuZ2V0Tm9ydGgoKSksXHJcbiAgICAgIHRpbGluZ1NjaGVtZS5yZWN0YW5nbGUubm9ydGhcclxuICAgICk7XHJcbiAgICBsZXQgbmUgPSB0aWxpbmdTY2hlbWUucG9zaXRpb25Ub1RpbGVYWShcclxuICAgICAgbmVTY3JhdGNoLFxyXG4gICAgICB6b29tLFxyXG4gICAgICBuZVRpbGVDb29yZGluYXRlc1NjcmF0Y2hcclxuICAgICk7XHJcbiAgICBpZiAoIWlzRGVmaW5lZChuZSkpIHtcclxuICAgICAgbmUgPSBuZVRpbGVDb29yZGluYXRlc1NjcmF0Y2g7XHJcbiAgICAgIG5lLnggPSB0aWxpbmdTY2hlbWUuZ2V0TnVtYmVyT2ZYVGlsZXNBdExldmVsKHpvb20pIC0gMTtcclxuICAgICAgbmUueSA9IDA7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbmV4dENyZWRpdHMgPSBbXTtcclxuXHJcbiAgICBmb3IgKGxldCBqID0gbmUueTsgaiA8IHN3Lnk7ICsraikge1xyXG4gICAgICBmb3IgKGxldCBpID0gc3cueDsgaSA8IG5lLng7ICsraSkge1xyXG4gICAgICAgIGNvbnN0IGNyZWRpdHMgPSA8Q3JlZGl0W10+KFxyXG4gICAgICAgICAgdGhpcy5pbWFnZXJ5UHJvdmlkZXIuZ2V0VGlsZUNyZWRpdHMoaSwgaiwgem9vbSlcclxuICAgICAgICApO1xyXG4gICAgICAgIGlmICghZGVmaW5lZChjcmVkaXRzKSkge1xyXG4gICAgICAgICAgY29udGludWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGNyZWRpdHMubGVuZ3RoOyArK2spIHtcclxuICAgICAgICAgIGNvbnN0IGNyZWRpdCA9IGNyZWRpdHNba107XHJcbiAgICAgICAgICBpZiAoY3JlZGl0Ll9zaG93bkluTGVhZmxldCkge1xyXG4gICAgICAgICAgICBjb250aW51ZTtcclxuICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICBjcmVkaXQuX3Nob3duSW5MZWFmbGV0ID0gdHJ1ZTtcclxuICAgICAgICAgIG5leHRDcmVkaXRzLnB1c2goY3JlZGl0KTtcclxuXHJcbiAgICAgICAgICBpZiAoIWNyZWRpdC5fc2hvd25JbkxlYWZsZXRMYXN0VXBkYXRlKSB7XHJcbiAgICAgICAgICAgICg8YW55PnRoaXMuX21hcCkuYXR0cmlidXRpb25Db250cm9sLmFkZEF0dHJpYnV0aW9uKFxyXG4gICAgICAgICAgICAgIGdldENyZWRpdEh0bWwoY3JlZGl0KVxyXG4gICAgICAgICAgICApO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIC8vIFJlbW92ZSBhdHRyaWJ1dGlvbnMgdGhhdCBhcHBsaWVkIGxhc3QgdXBkYXRlIGJ1dCBub3QgdGhpcyBvbmUuXHJcbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuX3ByZXZpb3VzQ3JlZGl0cy5sZW5ndGg7ICsraSkge1xyXG4gICAgICBpZiAoIXRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXS5fc2hvd25JbkxlYWZsZXQpIHtcclxuICAgICAgICAoPGFueT50aGlzLl9tYXApLmF0dHJpYnV0aW9uQ29udHJvbC5yZW1vdmVBdHRyaWJ1dGlvbihcclxuICAgICAgICAgIGdldENyZWRpdEh0bWwodGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldKVxyXG4gICAgICAgICk7XHJcbiAgICAgICAgdGhpcy5fcHJldmlvdXNDcmVkaXRzW2ldLl9zaG93bkluTGVhZmxldExhc3RVcGRhdGUgPSBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHRoaXMuX3ByZXZpb3VzQ3JlZGl0cyA9IG5leHRDcmVkaXRzO1xyXG4gIH1cclxuXHJcbiAgZ2V0RmVhdHVyZVBpY2tpbmdDb29yZHMoXHJcbiAgICBtYXA6IEwuTWFwLFxyXG4gICAgbG9uZ2l0dWRlUmFkaWFuczogbnVtYmVyLFxyXG4gICAgbGF0aXR1ZGVSYWRpYW5zOiBudW1iZXJcclxuICApOiBQcm9taXNlPFByb3ZpZGVyQ29vcmRzPiB7XHJcbiAgICBjb25zdCBsbCA9IG5ldyBDYXJ0b2dyYXBoaWMoXHJcbiAgICAgIENlc2l1bU1hdGgubmVnYXRpdmVQaVRvUGkobG9uZ2l0dWRlUmFkaWFucyksXHJcbiAgICAgIGxhdGl0dWRlUmFkaWFucyxcclxuICAgICAgMC4wXHJcbiAgICApO1xyXG4gICAgY29uc3QgbGV2ZWwgPSBNYXRoLnJvdW5kKG1hcC5nZXRab29tKCkpO1xyXG5cclxuICAgIHJldHVybiBwb2xsVG9Qcm9taXNlKCgpID0+IHtcclxuICAgICAgcmV0dXJuIHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnJlYWR5O1xyXG4gICAgfSkudGhlbigoKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRpbGluZ1NjaGVtZSA9IHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnRpbGluZ1NjaGVtZTtcclxuICAgICAgY29uc3QgY29vcmRzID0gdGlsaW5nU2NoZW1lLnBvc2l0aW9uVG9UaWxlWFkobGwsIGxldmVsKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICB4OiBjb29yZHMueCxcclxuICAgICAgICB5OiBjb29yZHMueSxcclxuICAgICAgICBsZXZlbDogbGV2ZWxcclxuICAgICAgfTtcclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgYXN5bmMgcGlja0ZlYXR1cmVzKFxyXG4gICAgeDogbnVtYmVyLFxyXG4gICAgeTogbnVtYmVyLFxyXG4gICAgbGV2ZWw6IG51bWJlcixcclxuICAgIGxvbmdpdHVkZVJhZGlhbnM6IG51bWJlcixcclxuICAgIGxhdGl0dWRlUmFkaWFuczogbnVtYmVyXHJcbiAgKTogUHJvbWlzZTxJbWFnZXJ5TGF5ZXJGZWF0dXJlSW5mb1tdIHwgdW5kZWZpbmVkPiB7XHJcbiAgICBhd2FpdCBwb2xsVG9Qcm9taXNlKCgpID0+IHRoaXMuaW1hZ2VyeVByb3ZpZGVyLnJlYWR5KTtcclxuICAgIHRyeSB7XHJcbiAgICAgIHJldHVybiBhd2FpdCB0aGlzLmltYWdlcnlQcm92aWRlci5waWNrRmVhdHVyZXMoXHJcbiAgICAgICAgeCxcclxuICAgICAgICB5LFxyXG4gICAgICAgIGxldmVsLFxyXG4gICAgICAgIGxvbmdpdHVkZVJhZGlhbnMsXHJcbiAgICAgICAgbGF0aXR1ZGVSYWRpYW5zXHJcbiAgICAgICk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIFRlcnJpYUVycm9yLmZyb20oXHJcbiAgICAgICAgZSxcclxuICAgICAgICBgQW4gZXJyb3Igb2N1cnJlZCB3aGlsZSBjYWxsaW5nIFxcYEltYWdlcnlQcm92aWRlciMucGlja0ZlYXR1cmVzXFxgLiBcXGBJbWFnZXJ5UHJvdmlkZXIudXJsID0gJHtcclxuICAgICAgICAgICg8YW55PnRoaXMuaW1hZ2VyeVByb3ZpZGVyKS51cmxcclxuICAgICAgICB9XFxgYFxyXG4gICAgICApLmxvZygpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgb25SZW1vdmUobWFwOiBMLk1hcCkge1xyXG4gICAgaWYgKHRoaXMuX2RlbGF5ZWRVcGRhdGUpIHtcclxuICAgICAgY2xlYXJUaW1lb3V0KHRoaXMuX2RlbGF5ZWRVcGRhdGUpO1xyXG4gICAgICB0aGlzLl9kZWxheWVkVXBkYXRlID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5fcHJldmlvdXNDcmVkaXRzLmxlbmd0aDsgKytpKSB7XHJcbiAgICAgIHRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXS5fc2hvd25JbkxlYWZsZXRMYXN0VXBkYXRlID0gZmFsc2U7XHJcbiAgICAgIHRoaXMuX3ByZXZpb3VzQ3JlZGl0c1tpXS5fc2hvd25JbkxlYWZsZXQgPSBmYWxzZTtcclxuICAgICAgKDxhbnk+bWFwKS5hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlQXR0cmlidXRpb24oXHJcbiAgICAgICAgZ2V0Q3JlZGl0SHRtbCh0aGlzLl9wcmV2aW91c0NyZWRpdHNbaV0pXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX3VzYWJsZSAmJiBkZWZpbmVkKHRoaXMuaW1hZ2VyeVByb3ZpZGVyLmNyZWRpdCkpIHtcclxuICAgICAgKDxhbnk+bWFwKS5hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlQXR0cmlidXRpb24oXHJcbiAgICAgICAgZ2V0Q3JlZGl0SHRtbCh0aGlzLmltYWdlcnlQcm92aWRlci5jcmVkaXQpXHJcbiAgICAgICk7XHJcbiAgICB9XHJcblxyXG4gICAgTC5UaWxlTGF5ZXIucHJvdG90eXBlLm9uUmVtb3ZlLmFwcGx5KHRoaXMsIFttYXBdKTtcclxuXHJcbiAgICAvLyBDaGVjayB0aGF0IHRoaXMgY2FuY2VscyB0aWxlIHJlcXVlc3RzIHdoZW4gZHJhZ2dpbmcgdGhlIHRpbWUgc2xpZGVyIGFuZCByYXBpZGx5IGNyZWF0aW5nXHJcbiAgICAvLyBhbmQgZGVzdHJveWluZyBsYXllcnMuICBJZiB0aGUgaW1hZ2UgcmVxdWVzdHMgZm9yIHByZXZpb3VzIHRpbWVzL2xheWVycyBhcmUgYWxsb3dlZCB0byBoYW5nXHJcbiAgICAvLyBhcm91bmQsIHRoZXkgY2xvZyB1cCB0aGUgcGlwZWxpbmUgYW5kIGl0IHRha2VzIGFwcHJveGltYXRlbHkgZm9yZXZlciBmb3IgdGhlIGJyb3dzZXJcclxuICAgIC8vIHRvIGdldCBhcm91bmQgdG8gZG93bmxvYWRpbmcgdGhlIHRpbGVzIHRoYXQgYXJlIGFjdHVhbGx5IG5lZWRlZC5cclxuICAgIHRoaXMuX2Fib3J0TG9hZGluZygpO1xyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRDcmVkaXRIdG1sKGNyZWRpdDogQ3JlZGl0KSB7XHJcbiAgcmV0dXJuIGNyZWRpdC5lbGVtZW50Lm91dGVySFRNTDtcclxufVxyXG4iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBdkJBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUEwQkE7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFlQTtBQUlBO0FBQUE7QUFEQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBVEE7QUFDQTtBQWhCQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBRUE7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQWlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBTUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFXQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFRQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7QUFJQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUVBO0FBSUE7QUFJQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBSUE7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFDQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFRQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBM2FBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUE2YUE7QUFDQTtBQUNBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts":
/*!***********************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"./node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.index-of.js */ \"./node_modules/core-js/modules/es.array.index-of.js\");\n__webpack_require__(/*! core-js/modules/es.array.splice.js */ \"./node_modules/core-js/modules/es.array.splice.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\nvar _BoundingSphere = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/BoundingSphere */ \"./node_modules/terriajs-cesium/Source/Core/BoundingSphere.js\"));\nvar _BoundingSphereState = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/BoundingSphereState */ \"./node_modules/terriajs-cesium/Source/DataSources/BoundingSphereState.js\"));\nvar _CustomDataSource = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/CustomDataSource */ \"./node_modules/terriajs-cesium/Source/DataSources/CustomDataSource.js\"));\nvar _DataSource2 = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/DataSource */ \"./node_modules/terriajs-cesium/Source/DataSources/DataSource.js\"));\nvar _defaultValue = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/defaultValue */ \"./node_modules/terriajs-cesium/Source/Core/defaultValue.js\"));\nvar _EventHelper = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/EventHelper */ \"./node_modules/terriajs-cesium/Source/Core/EventHelper.js\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nvar _JulianDate = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/JulianDate */ \"./node_modules/terriajs-cesium/Source/Core/JulianDate.js\"));\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar createGuid = __webpack_require__(/*! terriajs-cesium/Source/Core/createGuid */ \"./node_modules/terriajs-cesium/Source/Core/createGuid.js\")[\"default\"];\nvar destroyObject = __webpack_require__(/*! terriajs-cesium/Source/Core/destroyObject */ \"./node_modules/terriajs-cesium/Source/Core/destroyObject.js\")[\"default\"];\nvar LeafletDataSource = /*#__PURE__*/function (_DataSource) {\n  _inherits(LeafletDataSource, _DataSource);\n  function LeafletDataSource() {\n    var _this;\n    _classCallCheck(this, LeafletDataSource);\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n    _this = _callSuper(this, LeafletDataSource, [].concat(args));\n    _defineProperty(_assertThisInitialized(_this), \"visualizersByDisplayID\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"visualizers\", void 0);\n    return _this;\n  }\n  return _createClass(LeafletDataSource);\n}(_DataSource2[\"default\"]);\n/**\r\n * Visualizes a collection of {@link DataSource} instances in Leaflet.\r\n */\nvar LeafletDataSourceDisplay = exports[\"default\"] = /*#__PURE__*/function () {\n  function LeafletDataSourceDisplay(options) {\n    _classCallCheck(this, LeafletDataSourceDisplay);\n    _defineProperty(this, \"_displayID\", void 0);\n    // Gets the scene associated with this display.\n    _defineProperty(this, \"_scene\", void 0);\n    /**\r\n     * Gets the default data source instance which can be used to\r\n     * manually create and visualize entities not tied to\r\n     * a specific data source. This instance is always available\r\n     * and does not appear in the list dataSources collection.\r\n     */\n    _defineProperty(this, \"_defaultDataSource\", void 0);\n    // Gets the collection of data sources to display.\n    _defineProperty(this, \"_dataSourceCollection\", void 0);\n    _defineProperty(this, \"_visualizersCallback\", void 0);\n    _defineProperty(this, \"_eventHelper\", void 0);\n    // Gets a value indicating whether or not all entities in the data source are ready\n    _defineProperty(this, \"_ready\", void 0);\n    _defineProperty(this, \"_lastTime\", void 0);\n    this._displayID = createGuid();\n    this._scene = options.scene;\n    this._dataSourceCollection = options.dataSourceCollection;\n    this._visualizersCallback = (0, _defaultValue[\"default\"])(options.visualizersCallback, LeafletDataSourceDisplay.defaultVisualizersCallback);\n    this._eventHelper = new _EventHelper[\"default\"]();\n    this._eventHelper.add(this._dataSourceCollection.dataSourceAdded, this._onDataSourceAdded, this);\n    this._eventHelper.add(this._dataSourceCollection.dataSourceRemoved, this._onDataSourceRemoved, this);\n    for (var i = 0, len = this._dataSourceCollection.length; i < len; i++) {\n      this._onDataSourceAdded(this._dataSourceCollection, this._dataSourceCollection.get(i));\n    }\n    var defaultDataSource = new _CustomDataSource[\"default\"]();\n    this._onDataSourceAdded(undefined, defaultDataSource);\n    this._defaultDataSource = defaultDataSource;\n    this._ready = false;\n    this._lastTime = _JulianDate[\"default\"].now();\n  }\n\n  /**\r\n   * Gets or sets the default function which creates an array of visualizers used for visualization.\r\n   * By default, this function uses all standard visualizers.\r\n   *\r\n   */\n  _createClass(LeafletDataSourceDisplay, [{\n    key: \"update\",\n    value:\n    /**\r\n     * Updates the display to the provided time.\r\n     *\r\n     */\n    function update(time) {\n      var result = true;\n      var x;\n      var visualizers;\n      var vLength;\n      var dataSources = this._dataSourceCollection;\n      var length = dataSources.length;\n      for (var i = 0; i < length; i++) {\n        var _dataSource2 = dataSources.get(i);\n        if ((0, _isDefined[\"default\"])(_dataSource2.update)) {\n          result = _dataSource2.update(time) && result;\n        }\n        visualizers = this._getVisualizersForDataSource(_dataSource2);\n        if ((0, _isDefined[\"default\"])(visualizers)) {\n          vLength = visualizers.length;\n          for (x = 0; x < vLength; x++) {\n            result = visualizers[x].update(time) && result;\n          }\n        }\n      }\n      visualizers = this._getVisualizersForDataSource(this._defaultDataSource);\n      if ((0, _isDefined[\"default\"])(visualizers)) {\n        vLength = visualizers.length;\n        for (x = 0; x < vLength; x++) {\n          result = visualizers[x].update(time) && result;\n        }\n      }\n      this._ready = result;\n      this._lastTime = _JulianDate[\"default\"].clone(time, this._lastTime);\n      return result;\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this._eventHelper.removeAll();\n      var dataSourceCollection = this._dataSourceCollection;\n      for (var i = 0, length = dataSourceCollection.length; i < length; ++i) {\n        this._onDataSourceRemoved(this._dataSourceCollection, dataSourceCollection.get(i));\n      }\n      this._onDataSourceRemoved(undefined, this._defaultDataSource);\n      return destroyObject(this);\n    }\n  }, {\n    key: \"_onDataSourceAdded\",\n    value: function _onDataSourceAdded(_dataSourceCollection, dataSource) {\n      var visualizers = this._visualizersCallback(this._scene, undefined, dataSource);\n      dataSource.visualizersByDisplayID = dataSource.visualizersByDisplayID || {};\n      dataSource.visualizersByDisplayID[this._displayID] = visualizers;\n      dataSource.visualizers = dataSource.visualizers || [];\n      dataSource.visualizers = dataSource.visualizers.concat(visualizers);\n    }\n  }, {\n    key: \"_onDataSourceRemoved\",\n    value: function _onDataSourceRemoved(_dataSourceCollection, dataSource) {\n      var visualizers = this._getVisualizersForDataSource(dataSource);\n      if (!(0, _isDefined[\"default\"])(visualizers)) {\n        return;\n      }\n      var length = visualizers.length;\n      for (var i = 0; i < length; i++) {\n        var visualizer = visualizers[i];\n        visualizer.destroy();\n        if ((0, _isDefined[\"default\"])(dataSource.visualizers)) {\n          var _index = dataSource.visualizers.indexOf(visualizer);\n          dataSource.visualizers.splice(_index, 1);\n        }\n      }\n      if ((0, _isDefined[\"default\"])(dataSource.visualizersByDisplayID)) {\n        delete dataSource.visualizersByDisplayID[this._displayID];\n      }\n    }\n  }, {\n    key: \"_getVisualizersForDataSource\",\n    value: function _getVisualizersForDataSource(dataSource) {\n      var visualizersByDisplayID = dataSource.visualizersByDisplayID;\n      if ((0, _isDefined[\"default\"])(visualizersByDisplayID) && (0, _isDefined[\"default\"])(visualizersByDisplayID[this._displayID])) {\n        return visualizersByDisplayID[this._displayID];\n      }\n    }\n\n    /**\r\n     * Computes the rectangular bounds which encloses the visualization\r\n     * produced for the given entities.\r\n     */\n  }, {\n    key: \"getLatLngBounds\",\n    value: function getLatLngBounds(dataSource) {\n      this.update(this._lastTime);\n      var visualizers = this._getVisualizersForDataSource(dataSource);\n      if (!(0, _isDefined[\"default\"])(visualizers)) {\n        return;\n      }\n      var result;\n      for (var j = 0, vLength = visualizers.length; j < vLength; j++) {\n        var visualizer = visualizers[j];\n        var bounds = visualizer.getLatLngBounds();\n        if (bounds === undefined) {\n          continue;\n        }\n        result = result === undefined ? _leaflet[\"default\"].latLngBounds(bounds.getSouthWest(), bounds.getNorthEast()) : result.extend(bounds);\n      }\n      return result;\n    }\n\n    /**\r\n     * Computes a bounding sphere which encloses the visualization produced for the specified entity.\r\n     * The bounding sphere is in the fixed frame of the scene's globe.\r\n     */\n  }, {\n    key: \"getBoundingSphere\",\n    value: function getBoundingSphere(entity, allowPartial, result) {\n      if (!this._ready) {\n        return _BoundingSphereState[\"default\"].PENDING;\n      }\n      var length;\n      var dataSource = this._defaultDataSource;\n      if (!dataSource.entities.contains(entity)) {\n        dataSource = undefined;\n        var dataSources = this._dataSourceCollection;\n        length = dataSources.length;\n        for (var i = 0; i < length; i++) {\n          var d = dataSources.get(i);\n          if (d.entities.contains(entity)) {\n            dataSource = d;\n            break;\n          }\n        }\n      }\n      if (!(0, _isDefined[\"default\"])(dataSource) || !(0, _isDefined[\"default\"])(dataSource.visualizers)) {\n        return _BoundingSphereState[\"default\"].FAILED;\n      }\n      var boundingSpheres = [];\n      var tmp = new _BoundingSphere[\"default\"]();\n      var count = 0;\n      var state = _BoundingSphereState[\"default\"].DONE;\n      var visualizers = dataSource.visualizers;\n      var visualizersLength = visualizers.length;\n      for (var _i = 0; _i < visualizersLength; _i++) {\n        var visualizer = visualizers[_i];\n        if ((0, _isDefined[\"default\"])(visualizer.getBoundingSphere)) {\n          state = visualizer.getBoundingSphere(entity, tmp);\n          if (!allowPartial && state === _BoundingSphereState[\"default\"].PENDING) {\n            return _BoundingSphereState[\"default\"].PENDING;\n          } else if (state === _BoundingSphereState[\"default\"].DONE) {\n            boundingSpheres[count] = _BoundingSphere[\"default\"].clone(tmp, boundingSpheres[count]);\n            count++;\n          }\n        }\n      }\n      if (count === 0) {\n        return _BoundingSphereState[\"default\"].FAILED;\n      }\n      boundingSpheres.length = count;\n      _BoundingSphere[\"default\"].fromBoundingSpheres(boundingSpheres, result);\n      return _BoundingSphereState[\"default\"].DONE;\n    }\n  }], [{\n    key: \"defaultVisualizersCallback\",\n    value: function defaultVisualizersCallback(_leafletScene, _entityCluster, _dataSource) {\n      return [];\n    }\n  }]);\n  return LeafletDataSourceDisplay;\n}();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5LnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0L0xlYWZsZXREYXRhU291cmNlRGlzcGxheS50cz81M2I2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCb3VuZGluZ1NwaGVyZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0JvdW5kaW5nU3BoZXJlXCI7XHJcbmltcG9ydCBCb3VuZGluZ1NwaGVyZVN0YXRlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0JvdW5kaW5nU3BoZXJlU3RhdGVcIjtcclxuaW1wb3J0IEN1c3RvbURhdGFTb3VyY2UgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvQ3VzdG9tRGF0YVNvdXJjZVwiO1xyXG5pbXBvcnQgRGF0YVNvdXJjZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9EYXRhU291cmNlXCI7XHJcbmltcG9ydCBEYXRhU291cmNlQ29sbGVjdGlvbiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9EYXRhU291cmNlQ29sbGVjdGlvblwiO1xyXG5pbXBvcnQgZGVmYXVsdFZhbHVlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvZGVmYXVsdFZhbHVlXCI7XHJcbmltcG9ydCBFbnRpdHkgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvRW50aXR5XCI7XHJcbmltcG9ydCBFbnRpdHlDbHVzdGVyIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0VudGl0eUNsdXN0ZXJcIjtcclxuaW1wb3J0IEV2ZW50SGVscGVyIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRXZlbnRIZWxwZXJcIjtcclxuaW1wb3J0IGlzRGVmaW5lZCBmcm9tIFwiLi4vLi4vQ29yZS9pc0RlZmluZWRcIjtcclxuaW1wb3J0IEp1bGlhbkRhdGUgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9KdWxpYW5EYXRlXCI7XHJcbmltcG9ydCBMIGZyb20gXCJsZWFmbGV0XCI7XHJcbmltcG9ydCBMZWFmbGV0U2NlbmUgZnJvbSBcIi4vTGVhZmxldFNjZW5lXCI7XHJcblxyXG5jb25zdCBjcmVhdGVHdWlkID0gcmVxdWlyZShcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9jcmVhdGVHdWlkXCIpLmRlZmF1bHQ7XHJcbmNvbnN0IGRlc3Ryb3lPYmplY3QgPVxyXG4gIHJlcXVpcmUoXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvZGVzdHJveU9iamVjdFwiKS5kZWZhdWx0O1xyXG5cclxuaW50ZXJmYWNlIFZpc3VhbGl6ZXIge1xyXG4gIHVwZGF0ZSh0aW1lOiBKdWxpYW5EYXRlKTogYm9vbGVhbjtcclxuICBkZXN0cm95KCk6IHZvaWQ7XHJcbiAgZ2V0TGF0TG5nQm91bmRzKCk6IEwuTGF0TG5nQm91bmRzIHwgdW5kZWZpbmVkO1xyXG4gIGdldEJvdW5kaW5nU3BoZXJlPzogKFxyXG4gICAgZW50aXR5OiBFbnRpdHksXHJcbiAgICB0bXA6IEJvdW5kaW5nU3BoZXJlXHJcbiAgKSA9PiBCb3VuZGluZ1NwaGVyZVN0YXRlO1xyXG59XHJcblxyXG5jbGFzcyBMZWFmbGV0RGF0YVNvdXJjZSBleHRlbmRzIERhdGFTb3VyY2Uge1xyXG4gIHZpc3VhbGl6ZXJzQnlEaXNwbGF5SUQ/OiB7IFtpbmRleDogc3RyaW5nXTogVmlzdWFsaXplcltdIH07XHJcbiAgdmlzdWFsaXplcnM/OiBWaXN1YWxpemVyW107XHJcbn1cclxuXHJcbnR5cGUgVmlzdWFsaXplcnNDYWxsYmFjayA9IChcclxuICBzY2VuZTogTGVhZmxldFNjZW5lLFxyXG4gIGVudGl0eUNsdXN0ZXI6IEVudGl0eUNsdXN0ZXIgfCB1bmRlZmluZWQsXHJcbiAgZGF0YVNvdXJjZTogRGF0YVNvdXJjZVxyXG4pID0+IFZpc3VhbGl6ZXJbXTtcclxuXHJcbmludGVyZmFjZSBMZWFmbGV0RGF0YVNvdXJjZURpc3BsYXlPcHRpb25zIHtcclxuICBzY2VuZTogTGVhZmxldFNjZW5lO1xyXG4gIGRhdGFTb3VyY2VDb2xsZWN0aW9uOiBEYXRhU291cmNlQ29sbGVjdGlvbjtcclxuICB2aXN1YWxpemVyc0NhbGxiYWNrOiBWaXN1YWxpemVyc0NhbGxiYWNrO1xyXG59XHJcblxyXG4vKipcclxuICogVmlzdWFsaXplcyBhIGNvbGxlY3Rpb24gb2Yge0BsaW5rIERhdGFTb3VyY2V9IGluc3RhbmNlcyBpbiBMZWFmbGV0LlxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5IHtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9kaXNwbGF5SUQ6IHN0cmluZztcclxuXHJcbiAgLy8gR2V0cyB0aGUgc2NlbmUgYXNzb2NpYXRlZCB3aXRoIHRoaXMgZGlzcGxheS5cclxuICBwcml2YXRlIHJlYWRvbmx5IF9zY2VuZTogTGVhZmxldFNjZW5lO1xyXG5cclxuICAvKipcclxuICAgKiBHZXRzIHRoZSBkZWZhdWx0IGRhdGEgc291cmNlIGluc3RhbmNlIHdoaWNoIGNhbiBiZSB1c2VkIHRvXHJcbiAgICogbWFudWFsbHkgY3JlYXRlIGFuZCB2aXN1YWxpemUgZW50aXRpZXMgbm90IHRpZWQgdG9cclxuICAgKiBhIHNwZWNpZmljIGRhdGEgc291cmNlLiBUaGlzIGluc3RhbmNlIGlzIGFsd2F5cyBhdmFpbGFibGVcclxuICAgKiBhbmQgZG9lcyBub3QgYXBwZWFyIGluIHRoZSBsaXN0IGRhdGFTb3VyY2VzIGNvbGxlY3Rpb24uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSByZWFkb25seSBfZGVmYXVsdERhdGFTb3VyY2U6IExlYWZsZXREYXRhU291cmNlO1xyXG5cclxuICAvLyBHZXRzIHRoZSBjb2xsZWN0aW9uIG9mIGRhdGEgc291cmNlcyB0byBkaXNwbGF5LlxyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2RhdGFTb3VyY2VDb2xsZWN0aW9uOiBEYXRhU291cmNlQ29sbGVjdGlvbjtcclxuXHJcbiAgcHJpdmF0ZSByZWFkb25seSBfdmlzdWFsaXplcnNDYWxsYmFjazogVmlzdWFsaXplcnNDYWxsYmFjaztcclxuICBwcml2YXRlIHJlYWRvbmx5IF9ldmVudEhlbHBlcjogRXZlbnRIZWxwZXI7XHJcblxyXG4gIC8vIEdldHMgYSB2YWx1ZSBpbmRpY2F0aW5nIHdoZXRoZXIgb3Igbm90IGFsbCBlbnRpdGllcyBpbiB0aGUgZGF0YSBzb3VyY2UgYXJlIHJlYWR5XHJcbiAgcHJpdmF0ZSBfcmVhZHk6IGJvb2xlYW47XHJcblxyXG4gIHByaXZhdGUgX2xhc3RUaW1lOiBKdWxpYW5EYXRlO1xyXG5cclxuICBjb25zdHJ1Y3RvcihvcHRpb25zOiBMZWFmbGV0RGF0YVNvdXJjZURpc3BsYXlPcHRpb25zKSB7XHJcbiAgICB0aGlzLl9kaXNwbGF5SUQgPSBjcmVhdGVHdWlkKCk7XHJcbiAgICB0aGlzLl9zY2VuZSA9IG9wdGlvbnMuc2NlbmU7XHJcbiAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbiA9IG9wdGlvbnMuZGF0YVNvdXJjZUNvbGxlY3Rpb247XHJcbiAgICB0aGlzLl92aXN1YWxpemVyc0NhbGxiYWNrID0gZGVmYXVsdFZhbHVlKFxyXG4gICAgICBvcHRpb25zLnZpc3VhbGl6ZXJzQ2FsbGJhY2ssXHJcbiAgICAgIExlYWZsZXREYXRhU291cmNlRGlzcGxheS5kZWZhdWx0VmlzdWFsaXplcnNDYWxsYmFja1xyXG4gICAgKTtcclxuXHJcbiAgICB0aGlzLl9ldmVudEhlbHBlciA9IG5ldyBFdmVudEhlbHBlcigpO1xyXG4gICAgdGhpcy5fZXZlbnRIZWxwZXIuYWRkKFxyXG4gICAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbi5kYXRhU291cmNlQWRkZWQsXHJcbiAgICAgIHRoaXMuX29uRGF0YVNvdXJjZUFkZGVkIGFzICgpID0+IHZvaWQsXHJcbiAgICAgIHRoaXNcclxuICAgICk7XHJcbiAgICB0aGlzLl9ldmVudEhlbHBlci5hZGQoXHJcbiAgICAgIHRoaXMuX2RhdGFTb3VyY2VDb2xsZWN0aW9uLmRhdGFTb3VyY2VSZW1vdmVkLFxyXG4gICAgICB0aGlzLl9vbkRhdGFTb3VyY2VSZW1vdmVkIGFzICgpID0+IHZvaWQsXHJcbiAgICAgIHRoaXNcclxuICAgICk7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDAsIGxlbiA9IHRoaXMuX2RhdGFTb3VyY2VDb2xsZWN0aW9uLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XHJcbiAgICAgIHRoaXMuX29uRGF0YVNvdXJjZUFkZGVkKFxyXG4gICAgICAgIHRoaXMuX2RhdGFTb3VyY2VDb2xsZWN0aW9uLFxyXG4gICAgICAgIHRoaXMuX2RhdGFTb3VyY2VDb2xsZWN0aW9uLmdldChpKVxyXG4gICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGRlZmF1bHREYXRhU291cmNlID0gbmV3IEN1c3RvbURhdGFTb3VyY2UoKTtcclxuICAgIHRoaXMuX29uRGF0YVNvdXJjZUFkZGVkKHVuZGVmaW5lZCwgZGVmYXVsdERhdGFTb3VyY2UpO1xyXG4gICAgdGhpcy5fZGVmYXVsdERhdGFTb3VyY2UgPSBkZWZhdWx0RGF0YVNvdXJjZTtcclxuXHJcbiAgICB0aGlzLl9yZWFkeSA9IGZhbHNlO1xyXG4gICAgdGhpcy5fbGFzdFRpbWUgPSBKdWxpYW5EYXRlLm5vdygpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogR2V0cyBvciBzZXRzIHRoZSBkZWZhdWx0IGZ1bmN0aW9uIHdoaWNoIGNyZWF0ZXMgYW4gYXJyYXkgb2YgdmlzdWFsaXplcnMgdXNlZCBmb3IgdmlzdWFsaXphdGlvbi5cclxuICAgKiBCeSBkZWZhdWx0LCB0aGlzIGZ1bmN0aW9uIHVzZXMgYWxsIHN0YW5kYXJkIHZpc3VhbGl6ZXJzLlxyXG4gICAqXHJcbiAgICovXHJcbiAgc3RhdGljIGRlZmF1bHRWaXN1YWxpemVyc0NhbGxiYWNrKFxyXG4gICAgX2xlYWZsZXRTY2VuZTogTGVhZmxldFNjZW5lLFxyXG4gICAgX2VudGl0eUNsdXN0ZXI6IEVudGl0eUNsdXN0ZXIsXHJcbiAgICBfZGF0YVNvdXJjZTogRGF0YVNvdXJjZVxyXG4gICkge1xyXG4gICAgcmV0dXJuIFtdO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlcyB0aGUgZGlzcGxheSB0byB0aGUgcHJvdmlkZWQgdGltZS5cclxuICAgKlxyXG4gICAqL1xyXG4gIHVwZGF0ZSh0aW1lOiBKdWxpYW5EYXRlKSB7XHJcbiAgICBsZXQgcmVzdWx0ID0gdHJ1ZTtcclxuXHJcbiAgICBsZXQgeDtcclxuICAgIGxldCB2aXN1YWxpemVycztcclxuICAgIGxldCB2TGVuZ3RoO1xyXG4gICAgY29uc3QgZGF0YVNvdXJjZXMgPSB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbjtcclxuICAgIGNvbnN0IGxlbmd0aCA9IGRhdGFTb3VyY2VzLmxlbmd0aDtcclxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgY29uc3QgZGF0YVNvdXJjZSA9IDxMZWFmbGV0RGF0YVNvdXJjZT5kYXRhU291cmNlcy5nZXQoaSk7XHJcbiAgICAgIGlmIChpc0RlZmluZWQoZGF0YVNvdXJjZS51cGRhdGUpKSB7XHJcbiAgICAgICAgcmVzdWx0ID0gZGF0YVNvdXJjZS51cGRhdGUodGltZSkgJiYgcmVzdWx0O1xyXG4gICAgICB9XHJcblxyXG4gICAgICB2aXN1YWxpemVycyA9IHRoaXMuX2dldFZpc3VhbGl6ZXJzRm9yRGF0YVNvdXJjZShkYXRhU291cmNlKTtcclxuICAgICAgaWYgKGlzRGVmaW5lZCh2aXN1YWxpemVycykpIHtcclxuICAgICAgICB2TGVuZ3RoID0gdmlzdWFsaXplcnMubGVuZ3RoO1xyXG4gICAgICAgIGZvciAoeCA9IDA7IHggPCB2TGVuZ3RoOyB4KyspIHtcclxuICAgICAgICAgIHJlc3VsdCA9IHZpc3VhbGl6ZXJzW3hdLnVwZGF0ZSh0aW1lKSAmJiByZXN1bHQ7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgdmlzdWFsaXplcnMgPSB0aGlzLl9nZXRWaXN1YWxpemVyc0ZvckRhdGFTb3VyY2UodGhpcy5fZGVmYXVsdERhdGFTb3VyY2UpO1xyXG4gICAgaWYgKGlzRGVmaW5lZCh2aXN1YWxpemVycykpIHtcclxuICAgICAgdkxlbmd0aCA9IHZpc3VhbGl6ZXJzLmxlbmd0aDtcclxuICAgICAgZm9yICh4ID0gMDsgeCA8IHZMZW5ndGg7IHgrKykge1xyXG4gICAgICAgIHJlc3VsdCA9IHZpc3VhbGl6ZXJzW3hdLnVwZGF0ZSh0aW1lKSAmJiByZXN1bHQ7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICB0aGlzLl9yZWFkeSA9IHJlc3VsdDtcclxuICAgIHRoaXMuX2xhc3RUaW1lID0gSnVsaWFuRGF0ZS5jbG9uZSh0aW1lLCB0aGlzLl9sYXN0VGltZSk7XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIHRoaXMuX2V2ZW50SGVscGVyLnJlbW92ZUFsbCgpO1xyXG5cclxuICAgIGNvbnN0IGRhdGFTb3VyY2VDb2xsZWN0aW9uID0gdGhpcy5fZGF0YVNvdXJjZUNvbGxlY3Rpb247XHJcbiAgICBmb3IgKGxldCBpID0gMCwgbGVuZ3RoID0gZGF0YVNvdXJjZUNvbGxlY3Rpb24ubGVuZ3RoOyBpIDwgbGVuZ3RoOyArK2kpIHtcclxuICAgICAgdGhpcy5fb25EYXRhU291cmNlUmVtb3ZlZChcclxuICAgICAgICB0aGlzLl9kYXRhU291cmNlQ29sbGVjdGlvbixcclxuICAgICAgICBkYXRhU291cmNlQ29sbGVjdGlvbi5nZXQoaSlcclxuICAgICAgKTtcclxuICAgIH1cclxuICAgIHRoaXMuX29uRGF0YVNvdXJjZVJlbW92ZWQodW5kZWZpbmVkLCB0aGlzLl9kZWZhdWx0RGF0YVNvdXJjZSk7XHJcbiAgICByZXR1cm4gZGVzdHJveU9iamVjdCh0aGlzKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX29uRGF0YVNvdXJjZUFkZGVkKFxyXG4gICAgX2RhdGFTb3VyY2VDb2xsZWN0aW9uOiBEYXRhU291cmNlQ29sbGVjdGlvbiB8IHVuZGVmaW5lZCxcclxuICAgIGRhdGFTb3VyY2U6IExlYWZsZXREYXRhU291cmNlXHJcbiAgKSB7XHJcbiAgICBjb25zdCB2aXN1YWxpemVycyA9IHRoaXMuX3Zpc3VhbGl6ZXJzQ2FsbGJhY2soXHJcbiAgICAgIHRoaXMuX3NjZW5lLFxyXG4gICAgICB1bmRlZmluZWQsXHJcbiAgICAgIGRhdGFTb3VyY2VcclxuICAgICk7XHJcblxyXG4gICAgZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEID0gZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEIHx8IHt9O1xyXG4gICAgZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEW3RoaXMuX2Rpc3BsYXlJRF0gPSB2aXN1YWxpemVycztcclxuXHJcbiAgICBkYXRhU291cmNlLnZpc3VhbGl6ZXJzID0gZGF0YVNvdXJjZS52aXN1YWxpemVycyB8fCBbXTtcclxuICAgIGRhdGFTb3VyY2UudmlzdWFsaXplcnMgPSBkYXRhU291cmNlLnZpc3VhbGl6ZXJzLmNvbmNhdCh2aXN1YWxpemVycyk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9vbkRhdGFTb3VyY2VSZW1vdmVkKFxyXG4gICAgX2RhdGFTb3VyY2VDb2xsZWN0aW9uOiBEYXRhU291cmNlQ29sbGVjdGlvbiB8IHVuZGVmaW5lZCxcclxuICAgIGRhdGFTb3VyY2U6IExlYWZsZXREYXRhU291cmNlXHJcbiAgKSB7XHJcbiAgICBjb25zdCB2aXN1YWxpemVycyA9IHRoaXMuX2dldFZpc3VhbGl6ZXJzRm9yRGF0YVNvdXJjZShkYXRhU291cmNlKTtcclxuICAgIGlmICghaXNEZWZpbmVkKHZpc3VhbGl6ZXJzKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbGVuZ3RoID0gdmlzdWFsaXplcnMubGVuZ3RoO1xyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsZW5ndGg7IGkrKykge1xyXG4gICAgICBjb25zdCB2aXN1YWxpemVyID0gdmlzdWFsaXplcnNbaV07XHJcbiAgICAgIHZpc3VhbGl6ZXIuZGVzdHJveSgpO1xyXG5cclxuICAgICAgaWYgKGlzRGVmaW5lZChkYXRhU291cmNlLnZpc3VhbGl6ZXJzKSkge1xyXG4gICAgICAgIGNvbnN0IGluZGV4ID0gZGF0YVNvdXJjZS52aXN1YWxpemVycy5pbmRleE9mKHZpc3VhbGl6ZXIpO1xyXG4gICAgICAgIGRhdGFTb3VyY2UudmlzdWFsaXplcnMuc3BsaWNlKGluZGV4LCAxKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGlmIChpc0RlZmluZWQoZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEKSkge1xyXG4gICAgICBkZWxldGUgZGF0YVNvdXJjZS52aXN1YWxpemVyc0J5RGlzcGxheUlEW3RoaXMuX2Rpc3BsYXlJRF07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9nZXRWaXN1YWxpemVyc0ZvckRhdGFTb3VyY2UoZGF0YVNvdXJjZTogTGVhZmxldERhdGFTb3VyY2UpIHtcclxuICAgIGNvbnN0IHZpc3VhbGl6ZXJzQnlEaXNwbGF5SUQgPSBkYXRhU291cmNlLnZpc3VhbGl6ZXJzQnlEaXNwbGF5SUQ7XHJcbiAgICBpZiAoXHJcbiAgICAgIGlzRGVmaW5lZCh2aXN1YWxpemVyc0J5RGlzcGxheUlEKSAmJlxyXG4gICAgICBpc0RlZmluZWQodmlzdWFsaXplcnNCeURpc3BsYXlJRFt0aGlzLl9kaXNwbGF5SURdKVxyXG4gICAgKSB7XHJcbiAgICAgIHJldHVybiB2aXN1YWxpemVyc0J5RGlzcGxheUlEW3RoaXMuX2Rpc3BsYXlJRF07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21wdXRlcyB0aGUgcmVjdGFuZ3VsYXIgYm91bmRzIHdoaWNoIGVuY2xvc2VzIHRoZSB2aXN1YWxpemF0aW9uXHJcbiAgICogcHJvZHVjZWQgZm9yIHRoZSBnaXZlbiBlbnRpdGllcy5cclxuICAgKi9cclxuICBnZXRMYXRMbmdCb3VuZHMoZGF0YVNvdXJjZTogTGVhZmxldERhdGFTb3VyY2UpIHtcclxuICAgIHRoaXMudXBkYXRlKHRoaXMuX2xhc3RUaW1lKTtcclxuXHJcbiAgICBjb25zdCB2aXN1YWxpemVycyA9IHRoaXMuX2dldFZpc3VhbGl6ZXJzRm9yRGF0YVNvdXJjZShkYXRhU291cmNlKTtcclxuICAgIGlmICghaXNEZWZpbmVkKHZpc3VhbGl6ZXJzKSkge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdDtcclxuXHJcbiAgICBmb3IgKGxldCBqID0gMCwgdkxlbmd0aCA9IHZpc3VhbGl6ZXJzLmxlbmd0aDsgaiA8IHZMZW5ndGg7IGorKykge1xyXG4gICAgICBjb25zdCB2aXN1YWxpemVyID0gdmlzdWFsaXplcnNbal07XHJcbiAgICAgIGNvbnN0IGJvdW5kcyA9IHZpc3VhbGl6ZXIuZ2V0TGF0TG5nQm91bmRzKCk7XHJcbiAgICAgIGlmIChib3VuZHMgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgIGNvbnRpbnVlO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXN1bHQgPVxyXG4gICAgICAgIHJlc3VsdCA9PT0gdW5kZWZpbmVkXHJcbiAgICAgICAgICA/IEwubGF0TG5nQm91bmRzKGJvdW5kcy5nZXRTb3V0aFdlc3QoKSwgYm91bmRzLmdldE5vcnRoRWFzdCgpKVxyXG4gICAgICAgICAgOiByZXN1bHQuZXh0ZW5kKGJvdW5kcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIENvbXB1dGVzIGEgYm91bmRpbmcgc3BoZXJlIHdoaWNoIGVuY2xvc2VzIHRoZSB2aXN1YWxpemF0aW9uIHByb2R1Y2VkIGZvciB0aGUgc3BlY2lmaWVkIGVudGl0eS5cclxuICAgKiBUaGUgYm91bmRpbmcgc3BoZXJlIGlzIGluIHRoZSBmaXhlZCBmcmFtZSBvZiB0aGUgc2NlbmUncyBnbG9iZS5cclxuICAgKi9cclxuICBnZXRCb3VuZGluZ1NwaGVyZShcclxuICAgIGVudGl0eTogRW50aXR5LFxyXG4gICAgYWxsb3dQYXJ0aWFsOiBib29sZWFuLFxyXG4gICAgcmVzdWx0OiBCb3VuZGluZ1NwaGVyZVxyXG4gICkge1xyXG4gICAgaWYgKCF0aGlzLl9yZWFkeSkge1xyXG4gICAgICByZXR1cm4gQm91bmRpbmdTcGhlcmVTdGF0ZS5QRU5ESU5HO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBsZW5ndGg7XHJcbiAgICBsZXQgZGF0YVNvdXJjZTogTGVhZmxldERhdGFTb3VyY2UgfCB1bmRlZmluZWQgPSB0aGlzLl9kZWZhdWx0RGF0YVNvdXJjZTtcclxuICAgIGlmICghZGF0YVNvdXJjZS5lbnRpdGllcy5jb250YWlucyhlbnRpdHkpKSB7XHJcbiAgICAgIGRhdGFTb3VyY2UgPSB1bmRlZmluZWQ7XHJcblxyXG4gICAgICBjb25zdCBkYXRhU291cmNlcyA9IHRoaXMuX2RhdGFTb3VyY2VDb2xsZWN0aW9uO1xyXG4gICAgICBsZW5ndGggPSBkYXRhU291cmNlcy5sZW5ndGg7XHJcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcclxuICAgICAgICBjb25zdCBkID0gZGF0YVNvdXJjZXMuZ2V0KGkpO1xyXG4gICAgICAgIGlmIChkLmVudGl0aWVzLmNvbnRhaW5zKGVudGl0eSkpIHtcclxuICAgICAgICAgIGRhdGFTb3VyY2UgPSBkO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKCFpc0RlZmluZWQoZGF0YVNvdXJjZSkgfHwgIWlzRGVmaW5lZChkYXRhU291cmNlLnZpc3VhbGl6ZXJzKSkge1xyXG4gICAgICByZXR1cm4gQm91bmRpbmdTcGhlcmVTdGF0ZS5GQUlMRUQ7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgYm91bmRpbmdTcGhlcmVzOiBCb3VuZGluZ1NwaGVyZVtdID0gW107XHJcbiAgICBjb25zdCB0bXAgPSBuZXcgQm91bmRpbmdTcGhlcmUoKTtcclxuXHJcbiAgICBsZXQgY291bnQgPSAwO1xyXG4gICAgbGV0IHN0YXRlID0gQm91bmRpbmdTcGhlcmVTdGF0ZS5ET05FO1xyXG4gICAgY29uc3QgdmlzdWFsaXplcnMgPSBkYXRhU291cmNlLnZpc3VhbGl6ZXJzO1xyXG4gICAgY29uc3QgdmlzdWFsaXplcnNMZW5ndGggPSB2aXN1YWxpemVycy5sZW5ndGg7XHJcblxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCB2aXN1YWxpemVyc0xlbmd0aDsgaSsrKSB7XHJcbiAgICAgIGNvbnN0IHZpc3VhbGl6ZXIgPSB2aXN1YWxpemVyc1tpXTtcclxuICAgICAgaWYgKGlzRGVmaW5lZCh2aXN1YWxpemVyLmdldEJvdW5kaW5nU3BoZXJlKSkge1xyXG4gICAgICAgIHN0YXRlID0gdmlzdWFsaXplci5nZXRCb3VuZGluZ1NwaGVyZShlbnRpdHksIHRtcCk7XHJcbiAgICAgICAgaWYgKCFhbGxvd1BhcnRpYWwgJiYgc3RhdGUgPT09IEJvdW5kaW5nU3BoZXJlU3RhdGUuUEVORElORykge1xyXG4gICAgICAgICAgcmV0dXJuIEJvdW5kaW5nU3BoZXJlU3RhdGUuUEVORElORztcclxuICAgICAgICB9IGVsc2UgaWYgKHN0YXRlID09PSBCb3VuZGluZ1NwaGVyZVN0YXRlLkRPTkUpIHtcclxuICAgICAgICAgIGJvdW5kaW5nU3BoZXJlc1tjb3VudF0gPSBCb3VuZGluZ1NwaGVyZS5jbG9uZShcclxuICAgICAgICAgICAgdG1wLFxyXG4gICAgICAgICAgICBib3VuZGluZ1NwaGVyZXNbY291bnRdXHJcbiAgICAgICAgICApO1xyXG4gICAgICAgICAgY291bnQrKztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAoY291bnQgPT09IDApIHtcclxuICAgICAgcmV0dXJuIEJvdW5kaW5nU3BoZXJlU3RhdGUuRkFJTEVEO1xyXG4gICAgfVxyXG5cclxuICAgIGJvdW5kaW5nU3BoZXJlcy5sZW5ndGggPSBjb3VudDtcclxuICAgIEJvdW5kaW5nU3BoZXJlLmZyb21Cb3VuZGluZ1NwaGVyZXMoYm91bmRpbmdTcGhlcmVzLCByZXN1bHQpO1xyXG4gICAgcmV0dXJuIEJvdW5kaW5nU3BoZXJlU3RhdGUuRE9ORTtcclxuICB9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBWUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQWlCQTtBQUNBO0FBQ0E7QUFGQTtBQTRCQTtBQUFBO0FBQUE7QUF0QkE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUxBO0FBUUE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUFBO0FBQUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFLQTtBQU1BO0FBQ0E7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUpBO0FBQUE7QUFBQTtBQWFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFNQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBS0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBU0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBM01BO0FBQ0E7QUFBQTtBQUFBO0FBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts":
/*!***********************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\nvar _Event = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Event */ \"./node_modules/terriajs-cesium/Source/Core/Event.js\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar LeafletScene = exports[\"default\"] = /*#__PURE__*/_createClass(function LeafletScene(map) {\n  _classCallCheck(this, LeafletScene);\n  _defineProperty(this, \"map\", void 0);\n  _defineProperty(this, \"featureClicked\", new _Event[\"default\"]());\n  _defineProperty(this, \"featureMousedown\", new _Event[\"default\"]());\n  this.map = map;\n});//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFNjZW5lLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0L0xlYWZsZXRTY2VuZS50cz84ODM2Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBDZXNpdW1FdmVudCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0V2ZW50XCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBMZWFmbGV0U2NlbmUge1xyXG4gIHJlYWRvbmx5IG1hcDogTC5NYXA7XHJcbiAgcmVhZG9ubHkgZmVhdHVyZUNsaWNrZWQgPSBuZXcgQ2VzaXVtRXZlbnQoKTtcclxuICByZWFkb25seSBmZWF0dXJlTW91c2Vkb3duID0gbmV3IENlc2l1bUV2ZW50KCk7XHJcbiAgY29uc3RydWN0b3IobWFwOiBMLk1hcCkge1xyXG4gICAgdGhpcy5tYXAgPSBtYXA7XHJcbiAgfVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUFBO0FBQUE7QUFGQTtBQUdBO0FBQ0EiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts":
/*!************************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts ***!
  \************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\nvar _Cartographic = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _EasingFunction = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/EasingFunction */ \"./node_modules/terriajs-cesium/Source/Core/EasingFunction.js\"));\nvar _Ellipsoid = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Ellipsoid */ \"./node_modules/terriajs-cesium/Source/Core/Ellipsoid.js\"));\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _requestAnimationFrame = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/requestAnimationFrame */ \"./node_modules/terriajs-cesium/Source/Core/requestAnimationFrame.js\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar TweenCollection = __webpack_require__(/*! terriajs-cesium/Source/Scene/TweenCollection */ \"./node_modules/terriajs-cesium/Source/Scene/TweenCollection.js\")[\"default\"];\nvar selectionIndicatorUrl = __webpack_require__(/*! ../../../wwwroot/images/NM-LocationTarget.svg */ \"./packages/terriajs/wwwroot/images/NM-LocationTarget.svg\");\nvar cartographicScratch = new _Cartographic[\"default\"]();\nvar LeafletSelectionIndicator = exports[\"default\"] = /*#__PURE__*/function () {\n  function LeafletSelectionIndicator(leaflet) {\n    _classCallCheck(this, LeafletSelectionIndicator);\n    _defineProperty(this, \"_leaflet\", void 0);\n    _defineProperty(this, \"_marker\", void 0);\n    _defineProperty(this, \"_tweens\", new TweenCollection());\n    _defineProperty(this, \"_selectionIndicatorTween\", void 0);\n    _defineProperty(this, \"_selectionIndicatorIsAppearing\", false);\n    _defineProperty(this, \"_selectionIndicatorDomElement\", void 0);\n    _defineProperty(this, \"_tweensAreRunning\", false);\n    this._leaflet = leaflet;\n    this._marker = _leaflet[\"default\"].marker([0, 0], {\n      icon: _leaflet[\"default\"].divIcon({\n        className: \"\",\n        html: '<img src=\"' + selectionIndicatorUrl + '\" width=\"50\" height=\"50\" alt=\"\" />',\n        iconSize: _leaflet[\"default\"].point(50, 50)\n      }),\n      zIndexOffset: 1,\n      // We increment the z index so that the selection marker appears above the item.\n      interactive: false,\n      keyboard: false\n    });\n    this._marker.addTo(this._leaflet.map);\n    this._selectionIndicatorDomElement = this._marker._icon.children[0];\n  }\n  _createClass(LeafletSelectionIndicator, [{\n    key: \"setLatLng\",\n    value: function setLatLng(latlng) {\n      this._marker.setLatLng(latlng);\n    }\n  }, {\n    key: \"animateSelectionIndicatorAppear\",\n    value: function animateSelectionIndicatorAppear() {\n      if ((0, _isDefined[\"default\"])(this._selectionIndicatorTween)) {\n        if (this._selectionIndicatorIsAppearing) {\n          // Already appearing; don't restart the animation.\n          return;\n        }\n        this._selectionIndicatorTween.cancelTween();\n        this._selectionIndicatorTween = undefined;\n      }\n      var style = this._selectionIndicatorDomElement.style;\n      this._selectionIndicatorIsAppearing = true;\n      var that = this;\n      this._selectionIndicatorTween = this._tweens.add({\n        startObject: {\n          scale: 2.0,\n          opacity: 0.0,\n          rotate: -180\n        },\n        stopObject: {\n          scale: 1.0,\n          opacity: 1.0,\n          rotate: 0\n        },\n        duration: 0.8,\n        easingFunction: _EasingFunction[\"default\"].EXPONENTIAL_OUT,\n        update: function update(value) {\n          style.opacity = value.opacity;\n          style.transform = \"scale(\" + value.scale + \") rotate(\" + value.rotate + \"deg)\";\n        },\n        complete: function complete() {\n          that._selectionIndicatorTween = undefined;\n        },\n        cancel: function cancel() {\n          that._selectionIndicatorTween = undefined;\n        }\n      });\n      this._startTweens();\n    }\n  }, {\n    key: \"animateSelectionIndicatorDepart\",\n    value: function animateSelectionIndicatorDepart() {\n      if ((0, _isDefined[\"default\"])(this._selectionIndicatorTween)) {\n        if (!this._selectionIndicatorIsAppearing) {\n          // Already disappearing, dont' restart the animation.\n          return;\n        }\n        this._selectionIndicatorTween.cancelTween();\n        this._selectionIndicatorTween = undefined;\n      }\n      var style = this._selectionIndicatorDomElement.style;\n      this._selectionIndicatorIsAppearing = false;\n      var that = this;\n      this._selectionIndicatorTween = this._tweens.add({\n        startObject: {\n          scale: 1.0,\n          opacity: 1.0\n        },\n        stopObject: {\n          scale: 1.5,\n          opacity: 0.0\n        },\n        duration: 0.8,\n        easingFunction: _EasingFunction[\"default\"].EXPONENTIAL_OUT,\n        update: function update(value) {\n          style.opacity = value.opacity;\n          style.transform = \"scale(\" + value.scale + \") rotate(0deg)\";\n        },\n        complete: function complete() {\n          that._selectionIndicatorTween = undefined;\n        },\n        cancel: function cancel() {\n          that._selectionIndicatorTween = undefined;\n        }\n      });\n      this._startTweens();\n    }\n  }, {\n    key: \"_startTweens\",\n    value: function _startTweens() {\n      var _this = this;\n      if (this._tweensAreRunning) {\n        return;\n      }\n      var feature = this._leaflet.terria.selectedFeature;\n      if ((0, _isDefined[\"default\"])(feature) && (0, _isDefined[\"default\"])(feature.position)) {\n        var cartographic = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(feature.position.getValue(this._leaflet.terria.timelineClock.currentTime), cartographicScratch);\n        this._marker.setLatLng([_Math[\"default\"].toDegrees(cartographic.latitude), _Math[\"default\"].toDegrees(cartographic.longitude)]);\n      }\n      if (this._tweens.length > 0) {\n        this._tweens.update();\n      }\n      if (this._tweens.length !== 0 || (0, _isDefined[\"default\"])(feature) && (0, _isDefined[\"default\"])(feature.position)) {\n        (0, _requestAnimationFrame[\"default\"])(function () {\n          _this._startTweens();\n        });\n      }\n    }\n  }]);\n  return LeafletSelectionIndicator;\n}();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFNlbGVjdGlvbkluZGljYXRvci50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvTGVhZmxldC9MZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yLnRzPzM1M2UiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IENhcnRvZ3JhcGhpYyBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0NhcnRvZ3JhcGhpY1wiO1xyXG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL01hdGhcIjtcclxuaW1wb3J0IEVhc2luZ0Z1bmN0aW9uIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRWFzaW5nRnVuY3Rpb25cIjtcclxuaW1wb3J0IEVsbGlwc29pZCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0VsbGlwc29pZFwiO1xyXG5pbXBvcnQgTCBmcm9tIFwibGVhZmxldFwiO1xyXG5pbXBvcnQgY2VzaXVtUmVxdWVzdEFuaW1hdGlvbkZyYW1lIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvcmVxdWVzdEFuaW1hdGlvbkZyYW1lXCI7XHJcbmltcG9ydCBpc0RlZmluZWQgZnJvbSBcIi4uLy4uL0NvcmUvaXNEZWZpbmVkXCI7XHJcblxyXG5pbXBvcnQgTGVhZmxldCBmcm9tIFwiLi4vLi4vTW9kZWxzL0xlYWZsZXRcIjtcclxuXHJcbmNvbnN0IFR3ZWVuQ29sbGVjdGlvbiA9XHJcbiAgcmVxdWlyZShcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvVHdlZW5Db2xsZWN0aW9uXCIpLmRlZmF1bHQ7XHJcbmNvbnN0IHNlbGVjdGlvbkluZGljYXRvclVybCA9IHJlcXVpcmUoXCIuLi8uLi8uLi93d3dyb290L2ltYWdlcy9OTS1Mb2NhdGlvblRhcmdldC5zdmdcIik7XHJcblxyXG5pbnRlcmZhY2UgVHdlZW4ge1xyXG4gIGNhbmNlbFR3ZWVuKCk6IHZvaWQ7XHJcbn1cclxuXHJcbmludGVyZmFjZSBUd2VlbkNvbGxlY3Rpb24ge1xyXG4gIGxlbmd0aDogbnVtYmVyO1xyXG4gIGFkZChhcmdzOiBhbnkpOiBUd2VlbjtcclxuICB1cGRhdGUoKTogdm9pZDtcclxufVxyXG5cclxuY29uc3QgY2FydG9ncmFwaGljU2NyYXRjaCA9IG5ldyBDYXJ0b2dyYXBoaWMoKTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExlYWZsZXRTZWxlY3Rpb25JbmRpY2F0b3Ige1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2xlYWZsZXQ6IExlYWZsZXQ7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfbWFya2VyOiBMLk1hcmtlcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IF90d2VlbnM6IFR3ZWVuQ29sbGVjdGlvbiA9IG5ldyBUd2VlbkNvbGxlY3Rpb24oKTtcclxuICBwcml2YXRlIF9zZWxlY3Rpb25JbmRpY2F0b3JUd2Vlbj86IFR3ZWVuO1xyXG4gIHByaXZhdGUgX3NlbGVjdGlvbkluZGljYXRvcklzQXBwZWFyaW5nOiBib29sZWFuID0gZmFsc2U7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfc2VsZWN0aW9uSW5kaWNhdG9yRG9tRWxlbWVudDogSFRNTEVsZW1lbnQ7XHJcbiAgcHJpdmF0ZSBfdHdlZW5zQXJlUnVubmluZzogYm9vbGVhbiA9IGZhbHNlO1xyXG5cclxuICBjb25zdHJ1Y3RvcihsZWFmbGV0OiBMZWFmbGV0KSB7XHJcbiAgICB0aGlzLl9sZWFmbGV0ID0gbGVhZmxldDtcclxuICAgIHRoaXMuX21hcmtlciA9IEwubWFya2VyKFswLCAwXSwge1xyXG4gICAgICBpY29uOiBMLmRpdkljb24oe1xyXG4gICAgICAgIGNsYXNzTmFtZTogXCJcIixcclxuICAgICAgICBodG1sOlxyXG4gICAgICAgICAgJzxpbWcgc3JjPVwiJyArXHJcbiAgICAgICAgICBzZWxlY3Rpb25JbmRpY2F0b3JVcmwgK1xyXG4gICAgICAgICAgJ1wiIHdpZHRoPVwiNTBcIiBoZWlnaHQ9XCI1MFwiIGFsdD1cIlwiIC8+JyxcclxuICAgICAgICBpY29uU2l6ZTogTC5wb2ludCg1MCwgNTApXHJcbiAgICAgIH0pLFxyXG4gICAgICB6SW5kZXhPZmZzZXQ6IDEsIC8vIFdlIGluY3JlbWVudCB0aGUgeiBpbmRleCBzbyB0aGF0IHRoZSBzZWxlY3Rpb24gbWFya2VyIGFwcGVhcnMgYWJvdmUgdGhlIGl0ZW0uXHJcbiAgICAgIGludGVyYWN0aXZlOiBmYWxzZSxcclxuICAgICAga2V5Ym9hcmQ6IGZhbHNlXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9tYXJrZXIuYWRkVG8odGhpcy5fbGVhZmxldC5tYXApO1xyXG4gICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yRG9tRWxlbWVudCA9ICg8YW55PnRoaXMuX21hcmtlcikuX2ljb24uY2hpbGRyZW5bMF07XHJcbiAgfVxyXG5cclxuICBzZXRMYXRMbmcobGF0bG5nOiBMLkxhdExuZykge1xyXG4gICAgdGhpcy5fbWFya2VyLnNldExhdExuZyhsYXRsbmcpO1xyXG4gIH1cclxuXHJcbiAgYW5pbWF0ZVNlbGVjdGlvbkluZGljYXRvckFwcGVhcigpIHtcclxuICAgIGlmIChpc0RlZmluZWQodGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4pKSB7XHJcbiAgICAgIGlmICh0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JJc0FwcGVhcmluZykge1xyXG4gICAgICAgIC8vIEFscmVhZHkgYXBwZWFyaW5nOyBkb24ndCByZXN0YXJ0IHRoZSBhbmltYXRpb24uXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuLmNhbmNlbFR3ZWVuKCk7XHJcbiAgICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBzdHlsZSA9IHRoaXMuX3NlbGVjdGlvbkluZGljYXRvckRvbUVsZW1lbnQuc3R5bGU7XHJcblxyXG4gICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9ySXNBcHBlYXJpbmcgPSB0cnVlO1xyXG5cclxuICAgIGNvbnN0IHRoYXQgPSB0aGlzO1xyXG4gICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4gPSB0aGlzLl90d2VlbnMuYWRkKHtcclxuICAgICAgc3RhcnRPYmplY3Q6IHtcclxuICAgICAgICBzY2FsZTogMi4wLFxyXG4gICAgICAgIG9wYWNpdHk6IDAuMCxcclxuICAgICAgICByb3RhdGU6IC0xODBcclxuICAgICAgfSxcclxuICAgICAgc3RvcE9iamVjdDoge1xyXG4gICAgICAgIHNjYWxlOiAxLjAsXHJcbiAgICAgICAgb3BhY2l0eTogMS4wLFxyXG4gICAgICAgIHJvdGF0ZTogMFxyXG4gICAgICB9LFxyXG4gICAgICBkdXJhdGlvbjogMC44LFxyXG4gICAgICBlYXNpbmdGdW5jdGlvbjogRWFzaW5nRnVuY3Rpb24uRVhQT05FTlRJQUxfT1VULFxyXG4gICAgICB1cGRhdGU6IGZ1bmN0aW9uICh2YWx1ZTogYW55KSB7XHJcbiAgICAgICAgc3R5bGUub3BhY2l0eSA9IHZhbHVlLm9wYWNpdHk7XHJcbiAgICAgICAgc3R5bGUudHJhbnNmb3JtID1cclxuICAgICAgICAgIFwic2NhbGUoXCIgKyB2YWx1ZS5zY2FsZSArIFwiKSByb3RhdGUoXCIgKyB2YWx1ZS5yb3RhdGUgKyBcImRlZylcIjtcclxuICAgICAgfSxcclxuICAgICAgY29tcGxldGU6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB0aGF0Ll9zZWxlY3Rpb25JbmRpY2F0b3JUd2VlbiA9IHVuZGVmaW5lZDtcclxuICAgICAgfSxcclxuICAgICAgY2FuY2VsOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhhdC5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4gPSB1bmRlZmluZWQ7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIHRoaXMuX3N0YXJ0VHdlZW5zKCk7XHJcbiAgfVxyXG5cclxuICBhbmltYXRlU2VsZWN0aW9uSW5kaWNhdG9yRGVwYXJ0KCkge1xyXG4gICAgaWYgKGlzRGVmaW5lZCh0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JUd2VlbikpIHtcclxuICAgICAgaWYgKCF0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3JJc0FwcGVhcmluZykge1xyXG4gICAgICAgIC8vIEFscmVhZHkgZGlzYXBwZWFyaW5nLCBkb250JyByZXN0YXJ0IHRoZSBhbmltYXRpb24uXHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuLmNhbmNlbFR3ZWVuKCk7XHJcbiAgICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdW5kZWZpbmVkO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBzdHlsZSA9IHRoaXMuX3NlbGVjdGlvbkluZGljYXRvckRvbUVsZW1lbnQuc3R5bGU7XHJcblxyXG4gICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9ySXNBcHBlYXJpbmcgPSBmYWxzZTtcclxuXHJcbiAgICBjb25zdCB0aGF0ID0gdGhpcztcclxuICAgIHRoaXMuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdGhpcy5fdHdlZW5zLmFkZCh7XHJcbiAgICAgIHN0YXJ0T2JqZWN0OiB7XHJcbiAgICAgICAgc2NhbGU6IDEuMCxcclxuICAgICAgICBvcGFjaXR5OiAxLjBcclxuICAgICAgfSxcclxuICAgICAgc3RvcE9iamVjdDoge1xyXG4gICAgICAgIHNjYWxlOiAxLjUsXHJcbiAgICAgICAgb3BhY2l0eTogMC4wXHJcbiAgICAgIH0sXHJcbiAgICAgIGR1cmF0aW9uOiAwLjgsXHJcbiAgICAgIGVhc2luZ0Z1bmN0aW9uOiBFYXNpbmdGdW5jdGlvbi5FWFBPTkVOVElBTF9PVVQsXHJcbiAgICAgIHVwZGF0ZTogZnVuY3Rpb24gKHZhbHVlOiBhbnkpIHtcclxuICAgICAgICBzdHlsZS5vcGFjaXR5ID0gdmFsdWUub3BhY2l0eTtcclxuICAgICAgICBzdHlsZS50cmFuc2Zvcm0gPSBcInNjYWxlKFwiICsgdmFsdWUuc2NhbGUgKyBcIikgcm90YXRlKDBkZWcpXCI7XHJcbiAgICAgIH0sXHJcbiAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgdGhhdC5fc2VsZWN0aW9uSW5kaWNhdG9yVHdlZW4gPSB1bmRlZmluZWQ7XHJcbiAgICAgIH0sXHJcbiAgICAgIGNhbmNlbDogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHRoYXQuX3NlbGVjdGlvbkluZGljYXRvclR3ZWVuID0gdW5kZWZpbmVkO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9zdGFydFR3ZWVucygpO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfc3RhcnRUd2VlbnMoKSB7XHJcbiAgICBpZiAodGhpcy5fdHdlZW5zQXJlUnVubmluZykge1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIGZlYXR1cmUgPSB0aGlzLl9sZWFmbGV0LnRlcnJpYS5zZWxlY3RlZEZlYXR1cmU7XHJcbiAgICBpZiAoaXNEZWZpbmVkKGZlYXR1cmUpICYmIGlzRGVmaW5lZChmZWF0dXJlLnBvc2l0aW9uKSkge1xyXG4gICAgICB2YXIgY2FydG9ncmFwaGljID0gRWxsaXBzb2lkLldHUzg0LmNhcnRlc2lhblRvQ2FydG9ncmFwaGljKFxyXG4gICAgICAgIGZlYXR1cmUucG9zaXRpb24uZ2V0VmFsdWUoXHJcbiAgICAgICAgICB0aGlzLl9sZWFmbGV0LnRlcnJpYS50aW1lbGluZUNsb2NrLmN1cnJlbnRUaW1lXHJcbiAgICAgICAgKSxcclxuICAgICAgICBjYXJ0b2dyYXBoaWNTY3JhdGNoXHJcbiAgICAgICk7XHJcbiAgICAgIHRoaXMuX21hcmtlci5zZXRMYXRMbmcoW1xyXG4gICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRvZ3JhcGhpYy5sYXRpdHVkZSksXHJcbiAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxvbmdpdHVkZSlcclxuICAgICAgXSk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHRoaXMuX3R3ZWVucy5sZW5ndGggPiAwKSB7XHJcbiAgICAgIHRoaXMuX3R3ZWVucy51cGRhdGUoKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoXHJcbiAgICAgIHRoaXMuX3R3ZWVucy5sZW5ndGggIT09IDAgfHxcclxuICAgICAgKGlzRGVmaW5lZChmZWF0dXJlKSAmJiBpc0RlZmluZWQoZmVhdHVyZS5wb3NpdGlvbikpXHJcbiAgICApIHtcclxuICAgICAgY2VzaXVtUmVxdWVzdEFuaW1hdGlvbkZyYW1lKCgpID0+IHtcclxuICAgICAgICB0aGlzLl9zdGFydFR3ZWVucygpO1xyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUVBO0FBWUE7QUFBQTtBQVdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFOQTtBQUFBO0FBRUE7QUFBQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQU1BO0FBSUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUEiLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts":
/*!****************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts ***!
  \****************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"./node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.fill.js */ \"./node_modules/core-js/modules/es.array.fill.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.is-array.js */ \"./node_modules/core-js/modules/es.array.is-array.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.join.js */ \"./node_modules/core-js/modules/es.array.join.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nvar _AssociativeArray = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/AssociativeArray */ \"./node_modules/terriajs-cesium/Source/Core/AssociativeArray.js\"));\nvar _Cartesian = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian2 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian2.js\"));\nvar _Cartesian2 = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian3 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian3.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _Color = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Color */ \"./node_modules/terriajs-cesium/Source/Core/Color.js\"));\nvar _Ellipsoid = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Ellipsoid */ \"./node_modules/terriajs-cesium/Source/Core/Ellipsoid.js\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _PolylineGlowMaterialProperty = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/PolylineGlowMaterialProperty */ \"./node_modules/terriajs-cesium/Source/DataSources/PolylineGlowMaterialProperty.js\"));\nvar _PolylineDashMaterialProperty = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/PolylineDashMaterialProperty */ \"./node_modules/terriajs-cesium/Source/DataSources/PolylineDashMaterialProperty.js\"));\nvar _esriLineStyle = __webpack_require__(/*! ../../Models/Catalog/Esri/esriLineStyle */ \"./packages/terriajs/lib/Models/Catalog/Esri/esriLineStyle.ts\");\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nvar destroyObject = __webpack_require__(/*! terriajs-cesium/Source/Core/destroyObject */ \"./node_modules/terriajs-cesium/Source/Core/destroyObject.js\")[\"default\"];\nvar writeTextToCanvas = __webpack_require__(/*! terriajs-cesium/Source/Core/writeTextToCanvas */ \"./node_modules/terriajs-cesium/Source/Core/writeTextToCanvas.js\")[\"default\"];\nvar defaultColor = _Color[\"default\"].WHITE;\nvar defaultOutlineColor = _Color[\"default\"].BLACK;\nvar defaultOutlineWidth = 1.0;\nvar defaultPixelSize = 5.0;\nvar defaultWidth = 5.0;\n\n//Single pixel black dot\nvar tmpImage = \"data:image/gif;base64,R0lGODlhAQABAPAAAAAAAP///yH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==\";\n\n//NOT IMPLEMENTED\n// Path primitive - no need identified\n// Ellipse primitive - no need identified\n// Ellipsoid primitive - 3d prim - no plans for this\n// Model primitive - 3d prim - no plans for this\n\n/**\r\n * A variable to store what sort of bounds our leaflet map has been looking at\r\n * 0 = a normal extent\r\n * 1 = zoomed in close to the east/left of anti-meridian\r\n * 2 = zoomed in close to the west/right of the anti-meridian\r\n * When this value changes we'll need to recompute the location of our points\r\n * to help them wrap around the anti-meridian\r\n */\nvar prevBoundsType = 0;\n\n/**\r\n * A {@link Visualizer} which maps {@link Entity#point} to Leaflet primitives.\r\n **/\nvar LeafletGeomVisualizer = /*#__PURE__*/function () {\n  function LeafletGeomVisualizer(leafletScene, entityCollection) {\n    _classCallCheck(this, LeafletGeomVisualizer);\n    this.leafletScene = leafletScene;\n    this.entityCollection = entityCollection;\n    _defineProperty(this, \"_featureGroup\", void 0);\n    _defineProperty(this, \"_entitiesToVisualize\", void 0);\n    _defineProperty(this, \"_entityHash\", void 0);\n    entityCollection.collectionChanged.addEventListener(this._onCollectionChanged, this);\n    this._featureGroup = _leaflet[\"default\"].featureGroup().addTo(leafletScene.map);\n    this._entitiesToVisualize = new _AssociativeArray[\"default\"]();\n    this._entityHash = {};\n    this._onCollectionChanged(entityCollection, entityCollection.values, [], []);\n  }\n  _createClass(LeafletGeomVisualizer, [{\n    key: \"_onCollectionChanged\",\n    value: function _onCollectionChanged(_entityCollection, added, removed, changed) {\n      var entity;\n      var featureGroup = this._featureGroup;\n      var entities = this._entitiesToVisualize;\n      var entityHash = this._entityHash;\n      for (var i = added.length - 1; i > -1; i--) {\n        entity = added[i];\n        if (((0, _isDefined[\"default\"])(entity.point) || (0, _isDefined[\"default\"])(entity.billboard) || (0, _isDefined[\"default\"])(entity.label)) && (0, _isDefined[\"default\"])(entity.position) || (0, _isDefined[\"default\"])(entity.polyline) || (0, _isDefined[\"default\"])(entity.polygon) || (0, _isDefined[\"default\"])(entity.rectangle)) {\n          entities.set(entity.id, entity);\n          entityHash[entity.id] = {};\n        }\n      }\n      for (var _i = changed.length - 1; _i > -1; _i--) {\n        entity = changed[_i];\n        if (((0, _isDefined[\"default\"])(entity.point) || (0, _isDefined[\"default\"])(entity.billboard) || (0, _isDefined[\"default\"])(entity.label)) && (0, _isDefined[\"default\"])(entity.position) || (0, _isDefined[\"default\"])(entity.polyline) || (0, _isDefined[\"default\"])(entity.polygon) || (0, _isDefined[\"default\"])(entity.rectangle)) {\n          entities.set(entity.id, entity);\n          entityHash[entity.id] = entityHash[entity.id] || {};\n        } else {\n          cleanEntity(entity, featureGroup, entityHash);\n          entities.remove(entity.id);\n        }\n      }\n      for (var _i2 = removed.length - 1; _i2 > -1; _i2--) {\n        entity = removed[_i2];\n        cleanEntity(entity, featureGroup, entityHash);\n        entities.remove(entity.id);\n      }\n    }\n\n    /**\r\n     * Updates the primitives created by this visualizer to match their\r\n     * Entity counterpart at the given time.\r\n     *\r\n     */\n  }, {\n    key: \"update\",\n    value: function update(time) {\n      var entities = this._entitiesToVisualize.values;\n      var entityHash = this._entityHash;\n      var bounds = this.leafletScene.map.getBounds();\n      var applyLocalisedAntiMeridianFix = false;\n      var currentBoundsType = 0;\n      if (_isCloseToEasternAntiMeridian(bounds)) {\n        applyLocalisedAntiMeridianFix = true;\n        currentBoundsType = 1;\n      } else if (_isCloseToWesternAntiMeridian(bounds)) {\n        applyLocalisedAntiMeridianFix = true;\n        currentBoundsType = 2;\n      }\n      for (var i = 0, len = entities.length; i < len; i++) {\n        var entity = entities[i];\n        var entityDetails = entityHash[entity.id];\n        if ((0, _isDefined[\"default\"])(entity._point)) {\n          this._updatePoint(entity, time, entityHash, entityDetails, applyLocalisedAntiMeridianFix === true ? bounds : undefined, prevBoundsType !== currentBoundsType);\n        }\n        if ((0, _isDefined[\"default\"])(entity.billboard)) {\n          this._updateBillboard(entity, time, entityHash, entityDetails, applyLocalisedAntiMeridianFix === true ? bounds : undefined);\n        }\n        if ((0, _isDefined[\"default\"])(entity.label)) {\n          this._updateLabel(entity, time, entityHash, entityDetails);\n        }\n        if ((0, _isDefined[\"default\"])(entity.polyline)) {\n          this._updatePolyline(entity, time, entityHash, entityDetails);\n        }\n        if ((0, _isDefined[\"default\"])(entity.polygon)) {\n          this._updatePolygon(entity, time, entityHash, entityDetails);\n        }\n        if ((0, _isDefined[\"default\"])(entity.rectangle)) {\n          this._updateRectangle(entity, time, entityHash, entityDetails);\n        }\n      }\n      prevBoundsType = currentBoundsType;\n      return true;\n    }\n  }, {\n    key: \"_updatePoint\",\n    value: function _updatePoint(entity, time, _entityHash, entityDetails, bounds, boundsJustChanged) {\n      var featureGroup = this._featureGroup;\n      var pointGraphics = entity.point;\n      var show = entity.isAvailable(time) && getValueOrDefault(pointGraphics.show, time, true);\n      if (!show) {\n        cleanPoint(entity, featureGroup, entityDetails);\n        return;\n      }\n      var details = entityDetails.point;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.point = {\n          layer: undefined,\n          lastPosition: new _Cartesian2[\"default\"](),\n          lastPixelSize: 1,\n          lastColor: new _Color[\"default\"](),\n          lastOutlineColor: new _Color[\"default\"](),\n          lastOutlineWidth: 1\n        };\n      }\n      var position = getValueOrUndefined(entity.position, time);\n      if (!(0, _isDefined[\"default\"])(position)) {\n        cleanPoint(entity, featureGroup, entityDetails);\n        return;\n      }\n      var pixelSize = getValueOrDefault(pointGraphics.pixelSize, time, defaultPixelSize);\n      var color = getValueOrDefault(pointGraphics.color, time, defaultColor);\n      var outlineColor = getValueOrDefault(pointGraphics.outlineColor, time, defaultOutlineColor);\n      var outlineWidth = getValueOrDefault(pointGraphics.outlineWidth, time, defaultOutlineWidth);\n      var layer = details.layer;\n      if (!(0, _isDefined[\"default\"])(layer)) {\n        var pointOptions = {\n          radius: pixelSize / 2.0,\n          fillColor: color.toCssColorString(),\n          fillOpacity: color.alpha,\n          color: outlineColor.toCssColorString(),\n          weight: outlineWidth,\n          opacity: outlineColor.alpha\n        };\n        layer = details.layer = _leaflet[\"default\"].circleMarker(positionToLatLng(position, bounds), pointOptions);\n        layer.on(\"click\", featureClicked.bind(undefined, this, entity));\n        layer.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(layer);\n        _Cartesian2[\"default\"].clone(position, details.lastPosition);\n        details.lastPixelSize = pixelSize;\n        _Color[\"default\"].clone(color, details.lastColor);\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        details.lastOutlineWidth = outlineWidth;\n        return layer;\n      }\n      if (!_Cartesian2[\"default\"].equals(position, details.lastPosition) || boundsJustChanged) {\n        layer.setLatLng(positionToLatLng(position, bounds));\n        _Cartesian2[\"default\"].clone(position, details.lastPosition);\n      }\n      if (pixelSize !== details.lastPixelSize) {\n        layer.setRadius(pixelSize / 2.0);\n        details.lastPixelSize = pixelSize;\n      }\n      var options = layer.options;\n      var applyStyle = false;\n      if (!_Color[\"default\"].equals(color, details.lastColor)) {\n        options.fillColor = color.toCssColorString();\n        options.fillOpacity = color.alpha;\n        _Color[\"default\"].clone(color, details.lastColor);\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(outlineColor, details.lastOutlineColor)) {\n        options.color = outlineColor.toCssColorString();\n        options.opacity = outlineColor.alpha;\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        applyStyle = true;\n      }\n      if (outlineWidth !== details.lastOutlineWidth) {\n        options.weight = outlineWidth;\n        details.lastOutlineWidth = outlineWidth;\n        applyStyle = true;\n      }\n      if (applyStyle) {\n        layer.setStyle(options);\n      }\n    }\n  }, {\n    key: \"_updateBillboard\",\n    value: function _updateBillboard(entity, time, _entityHash, entityDetails, bounds) {\n      var markerGraphics = entity.billboard;\n      var featureGroup = this._featureGroup;\n      var position;\n      var marker;\n      var details = entityDetails.billboard;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.billboard = {\n          layer: undefined\n        };\n      }\n      var geomLayer = details.layer;\n      var show = entity.isAvailable(time) && getValueOrDefault(markerGraphics.show, time, true);\n      if (show) {\n        position = getValueOrUndefined(entity.position, time);\n        show = (0, _isDefined[\"default\"])(position);\n      }\n      if (!show) {\n        cleanBillboard(entity, featureGroup, entityDetails);\n        return;\n      }\n      var latlng = positionToLatLng(position, bounds);\n      var image = getValue(markerGraphics.image, time);\n      var height = getValue(markerGraphics.height, time);\n      var width = getValue(markerGraphics.width, time);\n      var color = getValueOrDefault(markerGraphics.color, time, defaultColor);\n      var scale = getValueOrDefault(markerGraphics.scale, time, 1.0);\n      var verticalOrigin = getValueOrDefault(markerGraphics.verticalOrigin, time, 0);\n      var horizontalOrigin = getValueOrDefault(markerGraphics.horizontalOrigin, time, 0);\n      var pixelOffset = getValueOrDefault(markerGraphics.pixelOffset, time, _Cartesian[\"default\"].ZERO);\n      var imageUrl;\n      if ((0, _isDefined[\"default\"])(image)) {\n        if (typeof image === \"string\") {\n          imageUrl = image;\n        } else if ((0, _isDefined[\"default\"])(image.toDataURL)) {\n          imageUrl = image.toDataURL();\n        } else if ((0, _isDefined[\"default\"])(image.url)) {\n          imageUrl = image.url;\n        } else {\n          imageUrl = image.src;\n        }\n      }\n      var iconOptions = {\n        color: color.toCssColorString(),\n        origUrl: imageUrl,\n        scale: scale,\n        horizontalOrigin: horizontalOrigin,\n        //value: left, center, right\n        verticalOrigin: verticalOrigin //value: bottom, center, top\n      };\n      if ((0, _isDefined[\"default\"])(height) || (0, _isDefined[\"default\"])(width)) {\n        iconOptions.iconSize = [width, height];\n      }\n      var redrawIcon = false;\n      if (!(0, _isDefined[\"default\"])(geomLayer)) {\n        var markerOptions = {\n          icon: _leaflet[\"default\"].icon({\n            iconUrl: tmpImage\n          })\n        };\n        marker = _leaflet[\"default\"].marker(latlng, markerOptions);\n        marker.on(\"click\", featureClicked.bind(undefined, this, entity));\n        marker.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(marker);\n        details.layer = marker;\n        redrawIcon = true;\n      } else {\n        marker = geomLayer;\n        if (!marker.getLatLng().equals(latlng)) {\n          marker.setLatLng(latlng);\n        }\n        for (var prop in iconOptions) {\n          if ((0, _isDefined[\"default\"])(marker.options.icon) && iconOptions[prop] !== marker.options.icon.options[prop]) {\n            redrawIcon = true;\n            break;\n          }\n        }\n      }\n      if (redrawIcon) {\n        var recolorNeeded = !color.equals(defaultColor);\n        var drawBillboard = function drawBillboard(image, dataurl) {\n          iconOptions.iconUrl = dataurl || image;\n          if (!(0, _isDefined[\"default\"])(iconOptions.iconSize)) {\n            iconOptions.iconSize = [image.width * scale, image.height * scale];\n          }\n          var w = iconOptions.iconSize[0],\n            h = iconOptions.iconSize[1];\n          var xOff = w / 2 * (1 - horizontalOrigin) - pixelOffset.x;\n          var yOff = h / 2 * (1 + verticalOrigin) - pixelOffset.y;\n          iconOptions.iconAnchor = [xOff, yOff];\n          if (recolorNeeded) {\n            iconOptions.iconUrl = recolorBillboard(image, color);\n          }\n          marker.setIcon(_leaflet[\"default\"].icon(iconOptions));\n        };\n        var img = new Image();\n        img.onload = function () {\n          drawBillboard(img, imageUrl);\n        };\n        if ((0, _isDefined[\"default\"])(imageUrl)) {\n          img.src = imageUrl;\n          if (recolorNeeded) {\n            img.crossOrigin = \"anonymous\";\n          }\n        }\n      }\n    }\n  }, {\n    key: \"_updateLabel\",\n    value: function _updateLabel(entity, time, _entityHash, entityDetails) {\n      var labelGraphics = entity.label;\n      var featureGroup = this._featureGroup;\n      var position;\n      var marker;\n      var details = entityDetails.label;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.label = {\n          layer: undefined\n        };\n      }\n      var geomLayer = details.layer;\n      var show = entity.isAvailable(time) && getValueOrDefault(labelGraphics.show, time, true);\n      if (show) {\n        position = getValueOrUndefined(entity.position, time);\n        show = (0, _isDefined[\"default\"])(position);\n      }\n      if (!show) {\n        cleanLabel(entity, featureGroup, entityDetails);\n        return;\n      }\n      var cart = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(position);\n      var latlng = _leaflet[\"default\"].latLng(_Math[\"default\"].toDegrees(cart.latitude), _Math[\"default\"].toDegrees(cart.longitude));\n      var text = getValue(labelGraphics.text, time);\n      var font = getValue(labelGraphics.font, time);\n      var scale = getValueOrDefault(labelGraphics.scale, time, 1.0);\n      var fillColor = getValueOrDefault(labelGraphics.fillColor, time, defaultColor);\n      var verticalOrigin = getValueOrDefault(labelGraphics.verticalOrigin, time, 0);\n      var horizontalOrigin = getValueOrDefault(labelGraphics.horizontalOrigin, time, 0);\n      var pixelOffset = getValueOrDefault(labelGraphics.pixelOffset, time, _Cartesian[\"default\"].ZERO);\n      var iconOptions = {\n        text: text,\n        font: font,\n        color: fillColor.toCssColorString(),\n        scale: scale,\n        horizontalOrigin: horizontalOrigin,\n        //value: left, center, right\n        verticalOrigin: verticalOrigin //value: bottom, center, top\n      };\n      var redrawLabel = false;\n      if (!(0, _isDefined[\"default\"])(geomLayer)) {\n        var markerOptions = {\n          icon: _leaflet[\"default\"].icon({\n            iconUrl: tmpImage\n          })\n        };\n        marker = _leaflet[\"default\"].marker(latlng, markerOptions);\n        marker.on(\"click\", featureClicked.bind(undefined, this, entity));\n        marker.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(marker);\n        details.layer = marker;\n        redrawLabel = true;\n      } else {\n        marker = geomLayer;\n        if (!marker.getLatLng().equals(latlng)) {\n          marker.setLatLng(latlng);\n        }\n        for (var prop in iconOptions) {\n          if ((0, _isDefined[\"default\"])(marker.options.icon) && iconOptions[prop] !== marker.options.icon.options[prop]) {\n            redrawLabel = true;\n            break;\n          }\n        }\n      }\n      if (redrawLabel) {\n        var drawBillboard = function drawBillboard(image, dataurl) {\n          iconOptions.iconUrl = dataurl || image;\n          if (!(0, _isDefined[\"default\"])(iconOptions.iconSize)) {\n            iconOptions.iconSize = [image.width * scale, image.height * scale];\n          }\n          var w = iconOptions.iconSize[0],\n            h = iconOptions.iconSize[1];\n          var xOff = w / 2 * (1 - horizontalOrigin) - pixelOffset.x;\n          var yOff = h / 2 * (1 + verticalOrigin) - pixelOffset.y;\n          iconOptions.iconAnchor = [xOff, yOff];\n          marker.setIcon(_leaflet[\"default\"].icon(iconOptions));\n        };\n        var canvas = writeTextToCanvas(text, {\n          fillColor: fillColor,\n          font: font\n        });\n        var imageUrl = canvas.toDataURL();\n        var img = new Image();\n        img.onload = function () {\n          drawBillboard(img, imageUrl);\n        };\n        img.src = imageUrl;\n      }\n    }\n  }, {\n    key: \"_updateRectangle\",\n    value: function _updateRectangle(entity, time, _entityHash, entityDetails) {\n      var _rectangleGraphics$co;\n      var featureGroup = this._featureGroup;\n      var rectangleGraphics = entity.rectangle;\n      if (!(0, _isDefined[\"default\"])(rectangleGraphics)) {\n        return;\n      }\n      var show = entity.isAvailable(time) && getValueOrDefault(rectangleGraphics.show, time, true);\n      var rectangleCoordinates = (_rectangleGraphics$co = rectangleGraphics.coordinates) === null || _rectangleGraphics$co === void 0 ? void 0 : _rectangleGraphics$co.getValue(time);\n      if (!show || !(0, _isDefined[\"default\"])(rectangleCoordinates)) {\n        cleanRectangle(entity, featureGroup, entityDetails);\n        return;\n      }\n      var rectangleBounds = [[_Math[\"default\"].toDegrees(rectangleCoordinates.south), _Math[\"default\"].toDegrees(rectangleCoordinates.west)], [_Math[\"default\"].toDegrees(rectangleCoordinates.north), _Math[\"default\"].toDegrees(rectangleCoordinates.east)]];\n      var details = entityDetails.rectangle;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.rectangle = {\n          layer: undefined,\n          lastFill: undefined,\n          lastFillColor: new _Color[\"default\"](),\n          lastOutline: undefined,\n          lastOutlineColor: new _Color[\"default\"]()\n        };\n      }\n      var fill = getValueOrDefault(rectangleGraphics.fill, time, true);\n      var outline = getValueOrDefault(rectangleGraphics.outline, time, true);\n      var dashArray;\n      if (rectangleGraphics.outline instanceof _PolylineDashMaterialProperty[\"default\"]) {\n        dashArray = getDashArray(rectangleGraphics.outline, time);\n      }\n      var outlineWidth = getValueOrDefault(rectangleGraphics.outlineWidth, time, defaultOutlineWidth);\n      var outlineColor = getValueOrDefault(rectangleGraphics.outlineColor, time, defaultOutlineColor);\n      var material = getValueOrUndefined(rectangleGraphics.material, time);\n      var fillColor;\n      if ((0, _isDefined[\"default\"])(material) && (0, _isDefined[\"default\"])(material.color)) {\n        fillColor = material.color;\n      } else {\n        fillColor = defaultColor;\n      }\n      var layer = details.layer;\n      if (!(0, _isDefined[\"default\"])(layer)) {\n        var polygonOptions = {\n          fill: fill,\n          fillColor: fillColor.toCssColorString(),\n          fillOpacity: fillColor.alpha,\n          weight: outline ? outlineWidth : 0.0,\n          color: outlineColor.toCssColorString(),\n          opacity: outlineColor.alpha\n        };\n        if (outline && dashArray) {\n          polygonOptions.dashArray = dashArray.map(function (x) {\n            return x * outlineWidth;\n          }).join(\",\");\n        }\n        layer = details.layer = _leaflet[\"default\"].rectangle(rectangleBounds, polygonOptions);\n        layer.on(\"click\", featureClicked.bind(undefined, this, entity));\n        layer.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(layer);\n        details.lastFill = fill;\n        details.lastOutline = outline;\n        _Color[\"default\"].clone(fillColor, details.lastFillColor);\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        return;\n      }\n      var options = layer.options;\n      var applyStyle = false;\n      if (fill !== details.lastFill) {\n        options.fill = fill;\n        details.lastFill = fill;\n        applyStyle = true;\n      }\n      if (outline !== details.lastOutline) {\n        options.weight = outline ? outlineWidth : 0.0;\n        details.lastOutline = outline;\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(fillColor, details.lastFillColor)) {\n        options.fillColor = fillColor.toCssColorString();\n        options.fillOpacity = fillColor.alpha;\n        _Color[\"default\"].clone(fillColor, details.lastFillColor);\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(outlineColor, details.lastOutlineColor)) {\n        options.color = outlineColor.toCssColorString();\n        options.opacity = outlineColor.alpha;\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        applyStyle = true;\n      }\n      if (!layer.getBounds().equals(rectangleBounds)) {\n        layer.setBounds(rectangleBounds);\n      }\n      if (applyStyle) {\n        layer.setStyle(options);\n      }\n    }\n  }, {\n    key: \"_updatePolygon\",\n    value: function _updatePolygon(entity, time, _entityHash, entityDetails) {\n      var featureGroup = this._featureGroup;\n      var polygonGraphics = entity.polygon;\n      var show = entity.isAvailable(time) && getValueOrDefault(polygonGraphics.show, time, true);\n      if (!show) {\n        cleanPolygon(entity, featureGroup, entityDetails);\n        return;\n      }\n      var details = entityDetails.polygon;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.polygon = {\n          layer: undefined,\n          lastHierarchy: undefined,\n          lastFill: undefined,\n          lastFillColor: new _Color[\"default\"](),\n          lastOutline: undefined,\n          lastOutlineColor: new _Color[\"default\"]()\n        };\n      }\n      var hierarchy = getValueOrUndefined(polygonGraphics.hierarchy, time);\n      if (!(0, _isDefined[\"default\"])(hierarchy)) {\n        cleanPolygon(entity, featureGroup, entityDetails);\n        return;\n      }\n      var fill = getValueOrDefault(polygonGraphics.fill, time, true);\n      var outline = getValueOrDefault(polygonGraphics.outline, time, true);\n      var dashArray;\n      if (polygonGraphics.outline instanceof _PolylineDashMaterialProperty[\"default\"]) {\n        dashArray = getDashArray(polygonGraphics.outline, time);\n      }\n      var outlineWidth = getValueOrDefault(polygonGraphics.outlineWidth, time, defaultOutlineWidth);\n      var outlineColor = getValueOrDefault(polygonGraphics.outlineColor, time, defaultOutlineColor);\n      var material = getValueOrUndefined(polygonGraphics.material, time);\n      var fillColor;\n      if ((0, _isDefined[\"default\"])(material) && (0, _isDefined[\"default\"])(material.color)) {\n        fillColor = material.color;\n      } else {\n        fillColor = defaultColor;\n      }\n      var layer = details.layer;\n      if (!(0, _isDefined[\"default\"])(layer)) {\n        var polygonOptions = {\n          fill: fill,\n          fillColor: fillColor.toCssColorString(),\n          fillOpacity: fillColor.alpha,\n          weight: outline ? outlineWidth : 0.0,\n          color: outlineColor.toCssColorString(),\n          opacity: outlineColor.alpha\n        };\n        if (outline && dashArray) {\n          polygonOptions.dashArray = dashArray.map(function (x) {\n            return x * outlineWidth;\n          }).join(\",\");\n        }\n        layer = details.layer = _leaflet[\"default\"].polygon(hierarchyToLatLngs(hierarchy), polygonOptions);\n        layer.on(\"click\", featureClicked.bind(undefined, this, entity));\n        layer.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n        featureGroup.addLayer(layer);\n        details.lastHierarchy = hierarchy;\n        details.lastFill = fill;\n        details.lastOutline = outline;\n        _Color[\"default\"].clone(fillColor, details.lastFillColor);\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        return;\n      }\n      if (hierarchy !== details.lastHierarchy) {\n        layer.setLatLngs(hierarchyToLatLngs(hierarchy));\n        details.lastHierarchy = hierarchy;\n      }\n      var options = layer.options;\n      var applyStyle = false;\n      if (fill !== details.lastFill) {\n        options.fill = fill;\n        details.lastFill = fill;\n        applyStyle = true;\n      }\n      if (outline !== details.lastOutline) {\n        options.weight = outline ? outlineWidth : 0.0;\n        details.lastOutline = outline;\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(fillColor, details.lastFillColor)) {\n        options.fillColor = fillColor.toCssColorString();\n        options.fillOpacity = fillColor.alpha;\n        _Color[\"default\"].clone(fillColor, details.lastFillColor);\n        applyStyle = true;\n      }\n      if (!_Color[\"default\"].equals(outlineColor, details.lastOutlineColor)) {\n        options.color = outlineColor.toCssColorString();\n        options.opacity = outlineColor.alpha;\n        _Color[\"default\"].clone(outlineColor, details.lastOutlineColor);\n        applyStyle = true;\n      }\n      if (applyStyle) {\n        layer.setStyle(options);\n      }\n    }\n  }, {\n    key: \"_updatePolyline\",\n    value: function _updatePolyline(entity, time, _entityHash, entityDetails) {\n      var polylineGraphics = entity.polyline;\n      var featureGroup = this._featureGroup;\n      var positions, polyline;\n      var details = entityDetails.polyline;\n      if (!(0, _isDefined[\"default\"])(details)) {\n        details = entityDetails.polyline = {\n          layer: undefined\n        };\n      }\n      var geomLayer = details.layer;\n      var show = entity.isAvailable(time) && getValueOrDefault(polylineGraphics.show, time, true);\n      if (show) {\n        positions = getValueOrUndefined(polylineGraphics.positions, time);\n        show = (0, _isDefined[\"default\"])(positions);\n      }\n      if (!show) {\n        cleanPolyline(entity, featureGroup, entityDetails);\n        return;\n      }\n      var carts = _Ellipsoid[\"default\"].WGS84.cartesianArrayToCartographicArray(positions);\n      var latlngs = [];\n      for (var p = 0; p < carts.length; p++) {\n        latlngs.push(_leaflet[\"default\"].latLng(_Math[\"default\"].toDegrees(carts[p].latitude), _Math[\"default\"].toDegrees(carts[p].longitude)));\n      }\n      var color;\n      var dashArray;\n      var width;\n      if (polylineGraphics.material instanceof _PolylineGlowMaterialProperty[\"default\"]) {\n        color = defaultColor;\n        width = defaultWidth;\n      } else {\n        var material = polylineGraphics.material.getValue(time);\n        if ((0, _isDefined[\"default\"])(material)) {\n          color = material.color;\n        }\n        color = color || defaultColor;\n        width = getValueOrDefault(polylineGraphics.width, time, defaultWidth);\n      }\n      if (polylineGraphics.material instanceof _PolylineDashMaterialProperty[\"default\"]) {\n        dashArray = getDashArray(polylineGraphics.material, time);\n      }\n      var polylineOptions = {\n        color: color.toCssColorString(),\n        weight: width,\n        opacity: color.alpha\n      };\n      if (dashArray) {\n        polylineOptions.dashArray = dashArray.map(function (x) {\n          return x * width;\n        }).join(\",\");\n      }\n      if (!(0, _isDefined[\"default\"])(geomLayer)) {\n        if (latlngs.length > 0) {\n          polyline = _leaflet[\"default\"].polyline(latlngs, polylineOptions);\n          polyline.on(\"click\", featureClicked.bind(undefined, this, entity));\n          polyline.on(\"mousedown\", featureMousedown.bind(undefined, this, entity));\n          featureGroup.addLayer(polyline);\n          details.layer = polyline;\n        }\n      } else {\n        polyline = geomLayer;\n        var curLatLngs = polyline.getLatLngs();\n        var bPosChange = latlngs.length !== curLatLngs.length;\n        for (var i = 0; i < curLatLngs.length && !bPosChange; i++) {\n          var latlng = curLatLngs[i];\n          if (latlng instanceof _leaflet[\"default\"].LatLng && !latlng.equals(latlngs[i])) {\n            bPosChange = true;\n          }\n        }\n        if (bPosChange) {\n          polyline.setLatLngs(latlngs);\n        }\n        for (var prop in polylineOptions) {\n          if (polylineOptions[prop] !== polyline.options[prop]) {\n            polyline.setStyle(polylineOptions);\n            break;\n          }\n        }\n      }\n    }\n\n    /**\r\n     * Returns true if this object was destroyed; otherwise, false.\r\n     *\r\n     */\n  }, {\n    key: \"isDestroyed\",\n    value: function isDestroyed() {\n      return false;\n    }\n\n    /**\r\n     * Removes and destroys all primitives created by this instance.\r\n     */\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      var entities = this._entitiesToVisualize.values;\n      var entityHash = this._entityHash;\n      for (var i = entities.length - 1; i > -1; i--) {\n        cleanEntity(entities[i], this._featureGroup, entityHash);\n      }\n      this.entityCollection.collectionChanged.removeEventListener(this._onCollectionChanged, this);\n      this.leafletScene.map.removeLayer(this._featureGroup);\n      return destroyObject(this);\n    }\n\n    /**\r\n     * Computes the rectangular bounds which encloses the collection of\r\n     * entities to be visualized.\r\n     */\n  }, {\n    key: \"getLatLngBounds\",\n    value: function getLatLngBounds() {\n      var _this = this;\n      var result;\n      Object.keys(this._entityHash).forEach(function (entityId) {\n        var entityDetails = _this._entityHash[entityId];\n        Object.keys(entityDetails).forEach(function (primitiveId) {\n          var primitive = entityDetails[primitiveId];\n          if ((0, _isDefined[\"default\"])(primitive.layer)) {\n            if ((0, _isDefined[\"default\"])(primitive.layer.getBounds)) {\n              var bounds = primitive.layer.getBounds();\n              if ((0, _isDefined[\"default\"])(bounds)) {\n                result = result === undefined ? _leaflet[\"default\"].latLngBounds(bounds.getSouthWest(), bounds.getNorthEast()) : result.extend(bounds);\n              }\n            }\n            if ((0, _isDefined[\"default\"])(primitive.layer.getLatLng)) {\n              var latLng = primitive.layer.getLatLng();\n              if ((0, _isDefined[\"default\"])(latLng)) {\n                result = result === undefined ? _leaflet[\"default\"].latLngBounds([latLng]) : result.extend(latLng);\n              }\n            }\n          }\n        });\n      });\n      return result;\n    }\n  }]);\n  return LeafletGeomVisualizer;\n}();\nfunction getDashArray(material, time) {\n  var dashArray;\n  var dashPattern = material.dashPattern ? material.dashPattern.getValue(time) : undefined;\n  return (0, _esriLineStyle.getLineStyleLeaflet)(dashPattern);\n}\nfunction cleanEntity(entity, group, entityHash) {\n  var details = entityHash[entity.id];\n  cleanPoint(entity, group, details);\n  cleanPolygon(entity, group, details);\n  cleanBillboard(entity, group, details);\n  cleanLabel(entity, group, details);\n  cleanPolyline(entity, group, details);\n  delete entityHash[entity.id];\n}\nfunction cleanPoint(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.point) && (0, _isDefined[\"default\"])(details.point.layer)) {\n    group.removeLayer(details.point.layer);\n    details.point = undefined;\n  }\n}\nfunction cleanPolygon(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.polygon) && (0, _isDefined[\"default\"])(details.polygon.layer)) {\n    group.removeLayer(details.polygon.layer);\n    details.polygon = undefined;\n  }\n}\nfunction cleanBillboard(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.billboard) && (0, _isDefined[\"default\"])(details.billboard.layer)) {\n    group.removeLayer(details.billboard.layer);\n    details.billboard = undefined;\n  }\n}\nfunction cleanLabel(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.label) && (0, _isDefined[\"default\"])(details.label.layer)) {\n    group.removeLayer(details.label.layer);\n    details.label = undefined;\n  }\n}\nfunction cleanPolyline(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.polyline) && (0, _isDefined[\"default\"])(details.polyline.layer)) {\n    group.removeLayer(details.polyline.layer);\n    details.polyline = undefined;\n  }\n}\nfunction cleanRectangle(_entity, group, details) {\n  if ((0, _isDefined[\"default\"])(details.rectangle) && (0, _isDefined[\"default\"])(details.rectangle.layer)) {\n    group.removeLayer(details.rectangle.layer);\n    details.rectangle = undefined;\n  }\n}\nfunction _isCloseToEasternAntiMeridian(bounds) {\n  var w = bounds.getWest();\n  var e = bounds.getEast();\n  if (w > 140 && (e < -140 || e > 180)) {\n    return true;\n  }\n  return false;\n}\nfunction _isCloseToWesternAntiMeridian(bounds) {\n  var w = bounds.getWest();\n  var e = bounds.getEast();\n  if ((w > 180 || w < -140) && e < -140) {\n    return true;\n  }\n  return false;\n}\nfunction positionToLatLng(position, bounds) {\n  var cartographic = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(position);\n  var lon = _Math[\"default\"].toDegrees(cartographic.longitude);\n  if (bounds !== undefined) {\n    if (_isCloseToEasternAntiMeridian(bounds)) {\n      if (lon < -140) {\n        lon = lon + 360;\n      }\n    } else if (_isCloseToWesternAntiMeridian(bounds)) {\n      if (lon > 140) {\n        lon = lon - 360;\n      }\n    }\n  }\n  return _leaflet[\"default\"].latLng(_Math[\"default\"].toDegrees(cartographic.latitude), lon);\n}\nfunction hierarchyToLatLngs(hierarchy) {\n  var holes = [];\n  var positions = Array.isArray(hierarchy) ? hierarchy : hierarchy.positions;\n  if (hierarchy.holes.length > 0) {\n    hierarchy.holes.forEach(function (hole) {\n      holes.push(convertEntityPositionsToLatLons(hole.positions));\n    });\n    return [convertEntityPositionsToLatLons(positions)].concat(holes);\n  } else {\n    return convertEntityPositionsToLatLons(positions);\n  }\n}\n\n//Recolor an image using 2d canvas\nfunction recolorBillboard(img, color) {\n  var canvas = document.createElement(\"canvas\");\n  canvas.width = img.width;\n  canvas.height = img.height;\n\n  // Copy the image contents to the canvas\n  var context = canvas.getContext(\"2d\");\n  if (context === null) {\n    return;\n  }\n  context.drawImage(img, 0, 0);\n  var image = context.getImageData(0, 0, canvas.width, canvas.height);\n  var normClr = [color.red, color.green, color.blue, color.alpha];\n  var length = image.data.length; //pixel count * 4\n  for (var i = 0; i < length; i += 4) {\n    for (var j = 0; j < 4; j++) {\n      image.data[j + i] *= normClr[j];\n    }\n  }\n  context.putImageData(image, 0, 0);\n  return canvas.toDataURL();\n}\nfunction featureClicked(visualizer, entity, event) {\n  visualizer.leafletScene.featureClicked.raiseEvent(entity, event);\n}\nfunction featureMousedown(visualizer, entity, event) {\n  visualizer.leafletScene.featureMousedown.raiseEvent(entity, event);\n}\nfunction getValue(property, time) {\n  if ((0, _isDefined[\"default\"])(property)) {\n    return property.getValue(time);\n  }\n}\nfunction getValueOrDefault(property, time, defaultValue) {\n  if ((0, _isDefined[\"default\"])(property)) {\n    var value = property.getValue(time);\n    if ((0, _isDefined[\"default\"])(value)) {\n      return value;\n    }\n  }\n  return defaultValue;\n}\nfunction getValueOrUndefined(property, time) {\n  if ((0, _isDefined[\"default\"])(property)) {\n    return property.getValue(time);\n  }\n}\nfunction convertEntityPositionsToLatLons(positions) {\n  var carts = _Ellipsoid[\"default\"].WGS84.cartesianArrayToCartographicArray(positions);\n  var latlngs = [];\n  var lastLongitude;\n  for (var p = 0; p < carts.length; p++) {\n    var lon = _Math[\"default\"].toDegrees(carts[p].longitude);\n    if (lastLongitude !== undefined) {\n      if (lastLongitude - lon > 180) {\n        lon = lon + 360;\n      } else if (lastLongitude - lon < -180) {\n        lon = lon - 360;\n      }\n    }\n    latlngs.push(_leaflet[\"default\"].latLng(_Math[\"default\"].toDegrees(carts[p].latitude), lon));\n    lastLongitude = lon;\n  }\n  return latlngs;\n}\nvar LeafletVisualizer = exports[\"default\"] = /*#__PURE__*/function () {\n  function LeafletVisualizer() {\n    _classCallCheck(this, LeafletVisualizer);\n  }\n  _createClass(LeafletVisualizer, [{\n    key: \"visualizersCallback\",\n    value: function visualizersCallback(leafletScene, _entityCluster, dataSource) {\n      var entities = dataSource.entities;\n      return [new LeafletGeomVisualizer(leafletScene, entities)];\n    }\n  }]);\n  return LeafletVisualizer;\n}();//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFZpc3VhbGl6ZXIudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXQvTGVhZmxldFZpc3VhbGl6ZXIudHM/ZmRlOCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQXNzb2NpYXRpdmVBcnJheSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0Fzc29jaWF0aXZlQXJyYXlcIjtcclxuaW1wb3J0IENhcnRlc2lhbjIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9DYXJ0ZXNpYW4yXCI7XHJcbmltcG9ydCBDYXJ0ZXNpYW4zIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2FydGVzaWFuM1wiO1xyXG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL01hdGhcIjtcclxuaW1wb3J0IENvbG9yIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ29sb3JcIjtcclxuaW1wb3J0IERhdGFTb3VyY2UgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvRGF0YVNvdXJjZVwiO1xyXG5pbXBvcnQgRWxsaXBzb2lkIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvRWxsaXBzb2lkXCI7XHJcbmltcG9ydCBFbnRpdHkgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvRW50aXR5XCI7XHJcbmltcG9ydCBFbnRpdHlDb2xsZWN0aW9uIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0VudGl0eUNvbGxlY3Rpb25cIjtcclxuaW1wb3J0IEVudGl0eUNsdXN0ZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvRW50aXR5Q2x1c3RlclwiO1xyXG5pbXBvcnQgaXNEZWZpbmVkIGZyb20gXCIuLi8uLi9Db3JlL2lzRGVmaW5lZFwiO1xyXG5pbXBvcnQgSnVsaWFuRGF0ZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0p1bGlhbkRhdGVcIjtcclxuaW1wb3J0IEwsIHsgTGF0TG5nQm91bmRzLCBQb2x5bGluZU9wdGlvbnMsIExhdExuZ0JvdW5kc0xpdGVyYWwgfSBmcm9tIFwibGVhZmxldFwiO1xyXG5pbXBvcnQgTGVhZmxldFNjZW5lIGZyb20gXCIuL0xlYWZsZXRTY2VuZVwiO1xyXG5pbXBvcnQgUG9seWdvbkhpZXJhcmNoeSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL1BvbHlnb25IaWVyYXJjaHlcIjtcclxuaW1wb3J0IFBvbHlsaW5lR2xvd01hdGVyaWFsUHJvcGVydHkgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvUG9seWxpbmVHbG93TWF0ZXJpYWxQcm9wZXJ0eVwiO1xyXG5pbXBvcnQgUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9Qb2x5bGluZURhc2hNYXRlcmlhbFByb3BlcnR5XCI7XHJcbmltcG9ydCBQcm9wZXJ0eSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9EYXRhU291cmNlcy9Qcm9wZXJ0eVwiO1xyXG5pbXBvcnQgUmVjdGFuZ2xlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvUmVjdGFuZ2xlXCI7XHJcbmltcG9ydCB7IGdldExpbmVTdHlsZUxlYWZsZXQgfSBmcm9tIFwiLi4vLi4vTW9kZWxzL0NhdGFsb2cvRXNyaS9lc3JpTGluZVN0eWxlXCI7XHJcblxyXG5jb25zdCBkZXN0cm95T2JqZWN0ID1cclxuICByZXF1aXJlKFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL2Rlc3Ryb3lPYmplY3RcIikuZGVmYXVsdDtcclxuY29uc3Qgd3JpdGVUZXh0VG9DYW52YXMgPVxyXG4gIHJlcXVpcmUoXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvd3JpdGVUZXh0VG9DYW52YXNcIikuZGVmYXVsdDtcclxuXHJcbmludGVyZmFjZSBQb2ludERldGFpbHMge1xyXG4gIGxheWVyPzogTC5DaXJjbGVNYXJrZXI7XHJcbiAgbGFzdFBvc2l0aW9uOiBDYXJ0ZXNpYW4zO1xyXG4gIGxhc3RQaXhlbFNpemU6IG51bWJlcjtcclxuICBsYXN0Q29sb3I6IENvbG9yO1xyXG4gIGxhc3RPdXRsaW5lQ29sb3I6IENvbG9yO1xyXG4gIGxhc3RPdXRsaW5lV2lkdGg6IG51bWJlcjtcclxufVxyXG5cclxuaW50ZXJmYWNlIFBvbHlnb25EZXRhaWxzIHtcclxuICBsYXllcj86IEwuUG9seWdvbjtcclxuICBsYXN0SGllcmFyY2h5PzogUG9seWdvbkhpZXJhcmNoeTtcclxuICBsYXN0RmlsbD86IGJvb2xlYW47XHJcbiAgbGFzdEZpbGxDb2xvcjogQ29sb3I7XHJcbiAgbGFzdE91dGxpbmU/OiBib29sZWFuO1xyXG4gIGxhc3RPdXRsaW5lQ29sb3I6IENvbG9yO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgUmVjdGFuZ2xlRGV0YWlscyB7XHJcbiAgbGF5ZXI/OiBMLlJlY3RhbmdsZTtcclxuICBsYXN0RmlsbD86IGJvb2xlYW47XHJcbiAgbGFzdEZpbGxDb2xvcjogQ29sb3I7XHJcbiAgbGFzdE91dGxpbmU/OiBib29sZWFuO1xyXG4gIGxhc3RPdXRsaW5lQ29sb3I6IENvbG9yO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgQmlsbGJvYXJkRGV0YWlscyB7XHJcbiAgbGF5ZXI/OiBMLk1hcmtlcjtcclxufVxyXG5cclxuaW50ZXJmYWNlIExhYmVsRGV0YWlscyB7XHJcbiAgbGF5ZXI/OiBMLk1hcmtlcjtcclxufVxyXG5cclxuaW50ZXJmYWNlIFBvbHlsaW5lRGV0YWlscyB7XHJcbiAgbGF5ZXI/OiBMLlBvbHlsaW5lO1xyXG59XHJcblxyXG5pbnRlcmZhY2UgRW50aXR5RGV0YWlscyB7XHJcbiAgcG9pbnQ/OiBQb2ludERldGFpbHM7XHJcbiAgcG9seWdvbj86IFBvbHlnb25EZXRhaWxzO1xyXG4gIGJpbGxib2FyZD86IEJpbGxib2FyZERldGFpbHM7XHJcbiAgbGFiZWw/OiBMYWJlbERldGFpbHM7XHJcbiAgcG9seWxpbmU/OiBQb2x5bGluZURldGFpbHM7XHJcbiAgcmVjdGFuZ2xlPzogUmVjdGFuZ2xlRGV0YWlscztcclxufVxyXG5cclxuaW50ZXJmYWNlIEVudGl0eUhhc2gge1xyXG4gIFtrZXk6IHN0cmluZ106IEVudGl0eURldGFpbHM7XHJcbn1cclxuXHJcbmNvbnN0IGRlZmF1bHRDb2xvciA9IENvbG9yLldISVRFO1xyXG5jb25zdCBkZWZhdWx0T3V0bGluZUNvbG9yID0gQ29sb3IuQkxBQ0s7XHJcbmNvbnN0IGRlZmF1bHRPdXRsaW5lV2lkdGggPSAxLjA7XHJcbmNvbnN0IGRlZmF1bHRQaXhlbFNpemUgPSA1LjA7XHJcbmNvbnN0IGRlZmF1bHRXaWR0aCA9IDUuMDtcclxuXHJcbi8vU2luZ2xlIHBpeGVsIGJsYWNrIGRvdFxyXG5jb25zdCB0bXBJbWFnZSA9XHJcbiAgXCJkYXRhOmltYWdlL2dpZjtiYXNlNjQsUjBsR09EbGhBUUFCQVBBQUFBQUFBUC8vL3lINUJBQUFBQUFBTEFBQUFBQUJBQUVBQUFJQ1JBRUFPdz09XCI7XHJcblxyXG4vL05PVCBJTVBMRU1FTlRFRFxyXG4vLyBQYXRoIHByaW1pdGl2ZSAtIG5vIG5lZWQgaWRlbnRpZmllZFxyXG4vLyBFbGxpcHNlIHByaW1pdGl2ZSAtIG5vIG5lZWQgaWRlbnRpZmllZFxyXG4vLyBFbGxpcHNvaWQgcHJpbWl0aXZlIC0gM2QgcHJpbSAtIG5vIHBsYW5zIGZvciB0aGlzXHJcbi8vIE1vZGVsIHByaW1pdGl2ZSAtIDNkIHByaW0gLSBubyBwbGFucyBmb3IgdGhpc1xyXG5cclxuLyoqXHJcbiAqIEEgdmFyaWFibGUgdG8gc3RvcmUgd2hhdCBzb3J0IG9mIGJvdW5kcyBvdXIgbGVhZmxldCBtYXAgaGFzIGJlZW4gbG9va2luZyBhdFxyXG4gKiAwID0gYSBub3JtYWwgZXh0ZW50XHJcbiAqIDEgPSB6b29tZWQgaW4gY2xvc2UgdG8gdGhlIGVhc3QvbGVmdCBvZiBhbnRpLW1lcmlkaWFuXHJcbiAqIDIgPSB6b29tZWQgaW4gY2xvc2UgdG8gdGhlIHdlc3QvcmlnaHQgb2YgdGhlIGFudGktbWVyaWRpYW5cclxuICogV2hlbiB0aGlzIHZhbHVlIGNoYW5nZXMgd2UnbGwgbmVlZCB0byByZWNvbXB1dGUgdGhlIGxvY2F0aW9uIG9mIG91ciBwb2ludHNcclxuICogdG8gaGVscCB0aGVtIHdyYXAgYXJvdW5kIHRoZSBhbnRpLW1lcmlkaWFuXHJcbiAqL1xyXG5sZXQgcHJldkJvdW5kc1R5cGUgPSAwO1xyXG5cclxuLyoqXHJcbiAqIEEge0BsaW5rIFZpc3VhbGl6ZXJ9IHdoaWNoIG1hcHMge0BsaW5rIEVudGl0eSNwb2ludH0gdG8gTGVhZmxldCBwcmltaXRpdmVzLlxyXG4gKiovXHJcbmNsYXNzIExlYWZsZXRHZW9tVmlzdWFsaXplciB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfZmVhdHVyZUdyb3VwOiBMLkZlYXR1cmVHcm91cDtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9lbnRpdGllc1RvVmlzdWFsaXplOiBBc3NvY2lhdGl2ZUFycmF5O1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2VudGl0eUhhc2g6IEVudGl0eUhhc2g7XHJcblxyXG4gIGNvbnN0cnVjdG9yKFxyXG4gICAgcmVhZG9ubHkgbGVhZmxldFNjZW5lOiBMZWFmbGV0U2NlbmUsXHJcbiAgICByZWFkb25seSBlbnRpdHlDb2xsZWN0aW9uOiBFbnRpdHlDb2xsZWN0aW9uXHJcbiAgKSB7XHJcbiAgICBlbnRpdHlDb2xsZWN0aW9uLmNvbGxlY3Rpb25DaGFuZ2VkLmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgIHRoaXMuX29uQ29sbGVjdGlvbkNoYW5nZWQsXHJcbiAgICAgIHRoaXNcclxuICAgICk7XHJcbiAgICB0aGlzLl9mZWF0dXJlR3JvdXAgPSBMLmZlYXR1cmVHcm91cCgpLmFkZFRvKGxlYWZsZXRTY2VuZS5tYXApO1xyXG4gICAgdGhpcy5fZW50aXRpZXNUb1Zpc3VhbGl6ZSA9IG5ldyBBc3NvY2lhdGl2ZUFycmF5KCk7XHJcbiAgICB0aGlzLl9lbnRpdHlIYXNoID0ge307XHJcblxyXG4gICAgdGhpcy5fb25Db2xsZWN0aW9uQ2hhbmdlZChcclxuICAgICAgZW50aXR5Q29sbGVjdGlvbixcclxuICAgICAgZW50aXR5Q29sbGVjdGlvbi52YWx1ZXMsXHJcbiAgICAgIFtdLFxyXG4gICAgICBbXVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX29uQ29sbGVjdGlvbkNoYW5nZWQoXHJcbiAgICBfZW50aXR5Q29sbGVjdGlvbjogRW50aXR5Q29sbGVjdGlvbixcclxuICAgIGFkZGVkOiBFbnRpdHlbXSxcclxuICAgIHJlbW92ZWQ6IEVudGl0eVtdLFxyXG4gICAgY2hhbmdlZDogRW50aXR5W11cclxuICApIHtcclxuICAgIGxldCBlbnRpdHk7XHJcbiAgICBjb25zdCBmZWF0dXJlR3JvdXAgPSB0aGlzLl9mZWF0dXJlR3JvdXA7XHJcbiAgICBjb25zdCBlbnRpdGllcyA9IHRoaXMuX2VudGl0aWVzVG9WaXN1YWxpemU7XHJcbiAgICBjb25zdCBlbnRpdHlIYXNoID0gdGhpcy5fZW50aXR5SGFzaDtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gYWRkZWQubGVuZ3RoIC0gMTsgaSA+IC0xOyBpLS0pIHtcclxuICAgICAgZW50aXR5ID0gYWRkZWRbaV07XHJcbiAgICAgIGlmIChcclxuICAgICAgICAoKGlzRGVmaW5lZChlbnRpdHkucG9pbnQpIHx8XHJcbiAgICAgICAgICBpc0RlZmluZWQoZW50aXR5LmJpbGxib2FyZCkgfHxcclxuICAgICAgICAgIGlzRGVmaW5lZChlbnRpdHkubGFiZWwpKSAmJlxyXG4gICAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5wb3NpdGlvbikpIHx8XHJcbiAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5wb2x5bGluZSkgfHxcclxuICAgICAgICBpc0RlZmluZWQoZW50aXR5LnBvbHlnb24pIHx8XHJcbiAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5yZWN0YW5nbGUpXHJcbiAgICAgICkge1xyXG4gICAgICAgIGVudGl0aWVzLnNldChlbnRpdHkuaWQsIGVudGl0eSk7XHJcbiAgICAgICAgZW50aXR5SGFzaFtlbnRpdHkuaWRdID0ge307XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGxldCBpID0gY2hhbmdlZC5sZW5ndGggLSAxOyBpID4gLTE7IGktLSkge1xyXG4gICAgICBlbnRpdHkgPSBjaGFuZ2VkW2ldO1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgKChpc0RlZmluZWQoZW50aXR5LnBvaW50KSB8fFxyXG4gICAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5iaWxsYm9hcmQpIHx8XHJcbiAgICAgICAgICBpc0RlZmluZWQoZW50aXR5LmxhYmVsKSkgJiZcclxuICAgICAgICAgIGlzRGVmaW5lZChlbnRpdHkucG9zaXRpb24pKSB8fFxyXG4gICAgICAgIGlzRGVmaW5lZChlbnRpdHkucG9seWxpbmUpIHx8XHJcbiAgICAgICAgaXNEZWZpbmVkKGVudGl0eS5wb2x5Z29uKSB8fFxyXG4gICAgICAgIGlzRGVmaW5lZChlbnRpdHkucmVjdGFuZ2xlKVxyXG4gICAgICApIHtcclxuICAgICAgICBlbnRpdGllcy5zZXQoZW50aXR5LmlkLCBlbnRpdHkpO1xyXG4gICAgICAgIGVudGl0eUhhc2hbZW50aXR5LmlkXSA9IGVudGl0eUhhc2hbZW50aXR5LmlkXSB8fCB7fTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBjbGVhbkVudGl0eShlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5SGFzaCk7XHJcbiAgICAgICAgZW50aXRpZXMucmVtb3ZlKGVudGl0eS5pZCk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBmb3IgKGxldCBpID0gcmVtb3ZlZC5sZW5ndGggLSAxOyBpID4gLTE7IGktLSkge1xyXG4gICAgICBlbnRpdHkgPSByZW1vdmVkW2ldO1xyXG4gICAgICBjbGVhbkVudGl0eShlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5SGFzaCk7XHJcbiAgICAgIGVudGl0aWVzLnJlbW92ZShlbnRpdHkuaWQpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogVXBkYXRlcyB0aGUgcHJpbWl0aXZlcyBjcmVhdGVkIGJ5IHRoaXMgdmlzdWFsaXplciB0byBtYXRjaCB0aGVpclxyXG4gICAqIEVudGl0eSBjb3VudGVycGFydCBhdCB0aGUgZ2l2ZW4gdGltZS5cclxuICAgKlxyXG4gICAqL1xyXG4gIHB1YmxpYyB1cGRhdGUodGltZTogSnVsaWFuRGF0ZSk6IGJvb2xlYW4ge1xyXG4gICAgY29uc3QgZW50aXRpZXMgPSB0aGlzLl9lbnRpdGllc1RvVmlzdWFsaXplLnZhbHVlcztcclxuICAgIGNvbnN0IGVudGl0eUhhc2ggPSB0aGlzLl9lbnRpdHlIYXNoO1xyXG5cclxuICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMubGVhZmxldFNjZW5lLm1hcC5nZXRCb3VuZHMoKTtcclxuICAgIGxldCBhcHBseUxvY2FsaXNlZEFudGlNZXJpZGlhbkZpeCA9IGZhbHNlO1xyXG4gICAgbGV0IGN1cnJlbnRCb3VuZHNUeXBlID0gMDtcclxuICAgIGlmIChfaXNDbG9zZVRvRWFzdGVybkFudGlNZXJpZGlhbihib3VuZHMpKSB7XHJcbiAgICAgIGFwcGx5TG9jYWxpc2VkQW50aU1lcmlkaWFuRml4ID0gdHJ1ZTtcclxuICAgICAgY3VycmVudEJvdW5kc1R5cGUgPSAxO1xyXG4gICAgfSBlbHNlIGlmIChfaXNDbG9zZVRvV2VzdGVybkFudGlNZXJpZGlhbihib3VuZHMpKSB7XHJcbiAgICAgIGFwcGx5TG9jYWxpc2VkQW50aU1lcmlkaWFuRml4ID0gdHJ1ZTtcclxuICAgICAgY3VycmVudEJvdW5kc1R5cGUgPSAyO1xyXG4gICAgfVxyXG5cclxuICAgIGZvciAobGV0IGkgPSAwLCBsZW4gPSBlbnRpdGllcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xyXG4gICAgICBjb25zdCBlbnRpdHkgPSBlbnRpdGllc1tpXTtcclxuICAgICAgY29uc3QgZW50aXR5RGV0YWlscyA9IGVudGl0eUhhc2hbZW50aXR5LmlkXTtcclxuXHJcbiAgICAgIGlmIChpc0RlZmluZWQoZW50aXR5Ll9wb2ludCkpIHtcclxuICAgICAgICB0aGlzLl91cGRhdGVQb2ludChcclxuICAgICAgICAgIGVudGl0eSxcclxuICAgICAgICAgIHRpbWUsXHJcbiAgICAgICAgICBlbnRpdHlIYXNoLFxyXG4gICAgICAgICAgZW50aXR5RGV0YWlscyxcclxuICAgICAgICAgIGFwcGx5TG9jYWxpc2VkQW50aU1lcmlkaWFuRml4ID09PSB0cnVlID8gYm91bmRzIDogdW5kZWZpbmVkLFxyXG4gICAgICAgICAgcHJldkJvdW5kc1R5cGUgIT09IGN1cnJlbnRCb3VuZHNUeXBlXHJcbiAgICAgICAgKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoaXNEZWZpbmVkKGVudGl0eS5iaWxsYm9hcmQpKSB7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlQmlsbGJvYXJkKFxyXG4gICAgICAgICAgZW50aXR5LFxyXG4gICAgICAgICAgdGltZSxcclxuICAgICAgICAgIGVudGl0eUhhc2gsXHJcbiAgICAgICAgICBlbnRpdHlEZXRhaWxzLFxyXG4gICAgICAgICAgYXBwbHlMb2NhbGlzZWRBbnRpTWVyaWRpYW5GaXggPT09IHRydWUgPyBib3VuZHMgOiB1bmRlZmluZWRcclxuICAgICAgICApO1xyXG4gICAgICB9XHJcbiAgICAgIGlmIChpc0RlZmluZWQoZW50aXR5LmxhYmVsKSkge1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZUxhYmVsKGVudGl0eSwgdGltZSwgZW50aXR5SGFzaCwgZW50aXR5RGV0YWlscyk7XHJcbiAgICAgIH1cclxuICAgICAgaWYgKGlzRGVmaW5lZChlbnRpdHkucG9seWxpbmUpKSB7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUG9seWxpbmUoZW50aXR5LCB0aW1lLCBlbnRpdHlIYXNoLCBlbnRpdHlEZXRhaWxzKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoaXNEZWZpbmVkKGVudGl0eS5wb2x5Z29uKSkge1xyXG4gICAgICAgIHRoaXMuX3VwZGF0ZVBvbHlnb24oZW50aXR5LCB0aW1lLCBlbnRpdHlIYXNoLCBlbnRpdHlEZXRhaWxzKTtcclxuICAgICAgfVxyXG4gICAgICBpZiAoaXNEZWZpbmVkKGVudGl0eS5yZWN0YW5nbGUpKSB7XHJcbiAgICAgICAgdGhpcy5fdXBkYXRlUmVjdGFuZ2xlKGVudGl0eSwgdGltZSwgZW50aXR5SGFzaCwgZW50aXR5RGV0YWlscyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIHByZXZCb3VuZHNUeXBlID0gY3VycmVudEJvdW5kc1R5cGU7XHJcbiAgICByZXR1cm4gdHJ1ZTtcclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3VwZGF0ZVBvaW50KFxyXG4gICAgZW50aXR5OiBFbnRpdHksXHJcbiAgICB0aW1lOiBKdWxpYW5EYXRlLFxyXG4gICAgX2VudGl0eUhhc2g6IEVudGl0eUhhc2gsXHJcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzLFxyXG4gICAgYm91bmRzOiBMYXRMbmdCb3VuZHMgfCB1bmRlZmluZWQsXHJcbiAgICBib3VuZHNKdXN0Q2hhbmdlZDogYm9vbGVhblxyXG4gICkge1xyXG4gICAgY29uc3QgZmVhdHVyZUdyb3VwID0gdGhpcy5fZmVhdHVyZUdyb3VwO1xyXG4gICAgY29uc3QgcG9pbnRHcmFwaGljcyA9IGVudGl0eS5wb2ludCE7XHJcblxyXG4gICAgY29uc3Qgc2hvdyA9XHJcbiAgICAgIGVudGl0eS5pc0F2YWlsYWJsZSh0aW1lKSAmJlxyXG4gICAgICBnZXRWYWx1ZU9yRGVmYXVsdChwb2ludEdyYXBoaWNzLnNob3csIHRpbWUsIHRydWUpO1xyXG4gICAgaWYgKCFzaG93KSB7XHJcbiAgICAgIGNsZWFuUG9pbnQoZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLnBvaW50O1xyXG4gICAgaWYgKCFpc0RlZmluZWQoZGV0YWlscykpIHtcclxuICAgICAgZGV0YWlscyA9IGVudGl0eURldGFpbHMucG9pbnQgPSB7XHJcbiAgICAgICAgbGF5ZXI6IHVuZGVmaW5lZCxcclxuICAgICAgICBsYXN0UG9zaXRpb246IG5ldyBDYXJ0ZXNpYW4zKCksXHJcbiAgICAgICAgbGFzdFBpeGVsU2l6ZTogMSxcclxuICAgICAgICBsYXN0Q29sb3I6IG5ldyBDb2xvcigpLFxyXG4gICAgICAgIGxhc3RPdXRsaW5lQ29sb3I6IG5ldyBDb2xvcigpLFxyXG4gICAgICAgIGxhc3RPdXRsaW5lV2lkdGg6IDFcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwb3NpdGlvbiA9IGdldFZhbHVlT3JVbmRlZmluZWQoZW50aXR5LnBvc2l0aW9uLCB0aW1lKTtcclxuICAgIGlmICghaXNEZWZpbmVkKHBvc2l0aW9uKSkge1xyXG4gICAgICBjbGVhblBvaW50KGVudGl0eSwgZmVhdHVyZUdyb3VwLCBlbnRpdHlEZXRhaWxzKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IHBpeGVsU2l6ZSA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBwb2ludEdyYXBoaWNzLnBpeGVsU2l6ZSxcclxuICAgICAgdGltZSxcclxuICAgICAgZGVmYXVsdFBpeGVsU2l6ZVxyXG4gICAgKTtcclxuICAgIGNvbnN0IGNvbG9yID0gZ2V0VmFsdWVPckRlZmF1bHQocG9pbnRHcmFwaGljcy5jb2xvciwgdGltZSwgZGVmYXVsdENvbG9yKTtcclxuICAgIGNvbnN0IG91dGxpbmVDb2xvciA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBwb2ludEdyYXBoaWNzLm91dGxpbmVDb2xvcixcclxuICAgICAgdGltZSxcclxuICAgICAgZGVmYXVsdE91dGxpbmVDb2xvclxyXG4gICAgKTtcclxuICAgIGNvbnN0IG91dGxpbmVXaWR0aCA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBwb2ludEdyYXBoaWNzLm91dGxpbmVXaWR0aCxcclxuICAgICAgdGltZSxcclxuICAgICAgZGVmYXVsdE91dGxpbmVXaWR0aFxyXG4gICAgKTtcclxuXHJcbiAgICBsZXQgbGF5ZXIgPSBkZXRhaWxzLmxheWVyO1xyXG5cclxuICAgIGlmICghaXNEZWZpbmVkKGxheWVyKSkge1xyXG4gICAgICBjb25zdCBwb2ludE9wdGlvbnMgPSB7XHJcbiAgICAgICAgcmFkaXVzOiBwaXhlbFNpemUgLyAyLjAsXHJcbiAgICAgICAgZmlsbENvbG9yOiBjb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXHJcbiAgICAgICAgZmlsbE9wYWNpdHk6IGNvbG9yLmFscGhhLFxyXG4gICAgICAgIGNvbG9yOiBvdXRsaW5lQ29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxyXG4gICAgICAgIHdlaWdodDogb3V0bGluZVdpZHRoLFxyXG4gICAgICAgIG9wYWNpdHk6IG91dGxpbmVDb2xvci5hbHBoYVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgbGF5ZXIgPSBkZXRhaWxzLmxheWVyID0gTC5jaXJjbGVNYXJrZXIoXHJcbiAgICAgICAgcG9zaXRpb25Ub0xhdExuZyhwb3NpdGlvbiwgYm91bmRzKSxcclxuICAgICAgICBwb2ludE9wdGlvbnNcclxuICAgICAgKTtcclxuICAgICAgbGF5ZXIub24oXCJjbGlja1wiLCBmZWF0dXJlQ2xpY2tlZC5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgIGxheWVyLm9uKFwibW91c2Vkb3duXCIsIGZlYXR1cmVNb3VzZWRvd24uYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xyXG4gICAgICBmZWF0dXJlR3JvdXAuYWRkTGF5ZXIobGF5ZXIpO1xyXG5cclxuICAgICAgQ2FydGVzaWFuMy5jbG9uZShwb3NpdGlvbiwgZGV0YWlscy5sYXN0UG9zaXRpb24pO1xyXG4gICAgICBkZXRhaWxzLmxhc3RQaXhlbFNpemUgPSBwaXhlbFNpemU7XHJcbiAgICAgIENvbG9yLmNsb25lKGNvbG9yLCBkZXRhaWxzLmxhc3RDb2xvcik7XHJcbiAgICAgIENvbG9yLmNsb25lKG91dGxpbmVDb2xvciwgZGV0YWlscy5sYXN0T3V0bGluZUNvbG9yKTtcclxuICAgICAgZGV0YWlscy5sYXN0T3V0bGluZVdpZHRoID0gb3V0bGluZVdpZHRoO1xyXG5cclxuICAgICAgcmV0dXJuIGxheWVyO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChcclxuICAgICAgIUNhcnRlc2lhbjMuZXF1YWxzKHBvc2l0aW9uLCBkZXRhaWxzLmxhc3RQb3NpdGlvbikgfHxcclxuICAgICAgYm91bmRzSnVzdENoYW5nZWRcclxuICAgICkge1xyXG4gICAgICBsYXllci5zZXRMYXRMbmcocG9zaXRpb25Ub0xhdExuZyhwb3NpdGlvbiwgYm91bmRzKSk7XHJcbiAgICAgIENhcnRlc2lhbjMuY2xvbmUocG9zaXRpb24sIGRldGFpbHMubGFzdFBvc2l0aW9uKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAocGl4ZWxTaXplICE9PSBkZXRhaWxzLmxhc3RQaXhlbFNpemUpIHtcclxuICAgICAgbGF5ZXIuc2V0UmFkaXVzKHBpeGVsU2l6ZSAvIDIuMCk7XHJcbiAgICAgIGRldGFpbHMubGFzdFBpeGVsU2l6ZSA9IHBpeGVsU2l6ZTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBvcHRpb25zID0gbGF5ZXIub3B0aW9ucztcclxuICAgIGxldCBhcHBseVN0eWxlID0gZmFsc2U7XHJcblxyXG4gICAgaWYgKCFDb2xvci5lcXVhbHMoY29sb3IsIGRldGFpbHMubGFzdENvbG9yKSkge1xyXG4gICAgICBvcHRpb25zLmZpbGxDb2xvciA9IGNvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKTtcclxuICAgICAgb3B0aW9ucy5maWxsT3BhY2l0eSA9IGNvbG9yLmFscGhhO1xyXG4gICAgICBDb2xvci5jbG9uZShjb2xvciwgZGV0YWlscy5sYXN0Q29sb3IpO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIUNvbG9yLmVxdWFscyhvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcikpIHtcclxuICAgICAgb3B0aW9ucy5jb2xvciA9IG91dGxpbmVDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCk7XHJcbiAgICAgIG9wdGlvbnMub3BhY2l0eSA9IG91dGxpbmVDb2xvci5hbHBoYTtcclxuICAgICAgQ29sb3IuY2xvbmUob3V0bGluZUNvbG9yLCBkZXRhaWxzLmxhc3RPdXRsaW5lQ29sb3IpO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3V0bGluZVdpZHRoICE9PSBkZXRhaWxzLmxhc3RPdXRsaW5lV2lkdGgpIHtcclxuICAgICAgb3B0aW9ucy53ZWlnaHQgPSBvdXRsaW5lV2lkdGg7XHJcbiAgICAgIGRldGFpbHMubGFzdE91dGxpbmVXaWR0aCA9IG91dGxpbmVXaWR0aDtcclxuICAgICAgYXBwbHlTdHlsZSA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGFwcGx5U3R5bGUpIHtcclxuICAgICAgbGF5ZXIuc2V0U3R5bGUob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF91cGRhdGVCaWxsYm9hcmQoXHJcbiAgICBlbnRpdHk6IEVudGl0eSxcclxuICAgIHRpbWU6IEp1bGlhbkRhdGUsXHJcbiAgICBfZW50aXR5SGFzaDogRW50aXR5SGFzaCxcclxuICAgIGVudGl0eURldGFpbHM6IEVudGl0eURldGFpbHMsXHJcbiAgICBib3VuZHM6IExhdExuZ0JvdW5kcyB8IHVuZGVmaW5lZFxyXG4gICkge1xyXG4gICAgY29uc3QgbWFya2VyR3JhcGhpY3MgPSBlbnRpdHkuYmlsbGJvYXJkITtcclxuICAgIGNvbnN0IGZlYXR1cmVHcm91cCA9IHRoaXMuX2ZlYXR1cmVHcm91cDtcclxuICAgIGxldCBwb3NpdGlvbjtcclxuICAgIGxldCBtYXJrZXI6IEwuTWFya2VyO1xyXG5cclxuICAgIGxldCBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5iaWxsYm9hcmQ7XHJcbiAgICBpZiAoIWlzRGVmaW5lZChkZXRhaWxzKSkge1xyXG4gICAgICBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5iaWxsYm9hcmQgPSB7XHJcbiAgICAgICAgbGF5ZXI6IHVuZGVmaW5lZFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdlb21MYXllciA9IGRldGFpbHMubGF5ZXI7XHJcblxyXG4gICAgbGV0IHNob3cgPVxyXG4gICAgICBlbnRpdHkuaXNBdmFpbGFibGUodGltZSkgJiZcclxuICAgICAgZ2V0VmFsdWVPckRlZmF1bHQobWFya2VyR3JhcGhpY3Muc2hvdywgdGltZSwgdHJ1ZSk7XHJcbiAgICBpZiAoc2hvdykge1xyXG4gICAgICBwb3NpdGlvbiA9IGdldFZhbHVlT3JVbmRlZmluZWQoZW50aXR5LnBvc2l0aW9uLCB0aW1lKTtcclxuICAgICAgc2hvdyA9IGlzRGVmaW5lZChwb3NpdGlvbik7XHJcbiAgICB9XHJcbiAgICBpZiAoIXNob3cpIHtcclxuICAgICAgY2xlYW5CaWxsYm9hcmQoZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgbGF0bG5nID0gcG9zaXRpb25Ub0xhdExuZyhwb3NpdGlvbiwgYm91bmRzKTtcclxuICAgIGNvbnN0IGltYWdlOiBhbnkgPSBnZXRWYWx1ZShtYXJrZXJHcmFwaGljcy5pbWFnZSwgdGltZSk7XHJcbiAgICBjb25zdCBoZWlnaHQ6IG51bWJlciB8IHVuZGVmaW5lZCA9IGdldFZhbHVlKG1hcmtlckdyYXBoaWNzLmhlaWdodCwgdGltZSk7XHJcbiAgICBjb25zdCB3aWR0aDogbnVtYmVyIHwgdW5kZWZpbmVkID0gZ2V0VmFsdWUobWFya2VyR3JhcGhpY3Mud2lkdGgsIHRpbWUpO1xyXG4gICAgY29uc3QgY29sb3IgPSBnZXRWYWx1ZU9yRGVmYXVsdChtYXJrZXJHcmFwaGljcy5jb2xvciwgdGltZSwgZGVmYXVsdENvbG9yKTtcclxuICAgIGNvbnN0IHNjYWxlID0gZ2V0VmFsdWVPckRlZmF1bHQobWFya2VyR3JhcGhpY3Muc2NhbGUsIHRpbWUsIDEuMCk7XHJcbiAgICBjb25zdCB2ZXJ0aWNhbE9yaWdpbiA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBtYXJrZXJHcmFwaGljcy52ZXJ0aWNhbE9yaWdpbixcclxuICAgICAgdGltZSxcclxuICAgICAgMFxyXG4gICAgKTtcclxuICAgIGNvbnN0IGhvcml6b250YWxPcmlnaW4gPSBnZXRWYWx1ZU9yRGVmYXVsdChcclxuICAgICAgbWFya2VyR3JhcGhpY3MuaG9yaXpvbnRhbE9yaWdpbixcclxuICAgICAgdGltZSxcclxuICAgICAgMFxyXG4gICAgKTtcclxuICAgIGNvbnN0IHBpeGVsT2Zmc2V0ID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIG1hcmtlckdyYXBoaWNzLnBpeGVsT2Zmc2V0LFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBDYXJ0ZXNpYW4yLlpFUk9cclxuICAgICk7XHJcblxyXG4gICAgbGV0IGltYWdlVXJsOiBzdHJpbmcgfCB1bmRlZmluZWQ7XHJcbiAgICBpZiAoaXNEZWZpbmVkKGltYWdlKSkge1xyXG4gICAgICBpZiAodHlwZW9mIGltYWdlID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgaW1hZ2VVcmwgPSBpbWFnZTtcclxuICAgICAgfSBlbHNlIGlmIChpc0RlZmluZWQoaW1hZ2UudG9EYXRhVVJMKSkge1xyXG4gICAgICAgIGltYWdlVXJsID0gaW1hZ2UudG9EYXRhVVJMKCk7XHJcbiAgICAgIH0gZWxzZSBpZiAoaXNEZWZpbmVkKGltYWdlLnVybCkpIHtcclxuICAgICAgICBpbWFnZVVybCA9IGltYWdlLnVybDtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBpbWFnZVVybCA9IGltYWdlLnNyYztcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGljb25PcHRpb25zOiBhbnkgPSB7XHJcbiAgICAgIGNvbG9yOiBjb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXHJcbiAgICAgIG9yaWdVcmw6IGltYWdlVXJsLFxyXG4gICAgICBzY2FsZTogc2NhbGUsXHJcbiAgICAgIGhvcml6b250YWxPcmlnaW46IGhvcml6b250YWxPcmlnaW4sIC8vdmFsdWU6IGxlZnQsIGNlbnRlciwgcmlnaHRcclxuICAgICAgdmVydGljYWxPcmlnaW46IHZlcnRpY2FsT3JpZ2luIC8vdmFsdWU6IGJvdHRvbSwgY2VudGVyLCB0b3BcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGlzRGVmaW5lZChoZWlnaHQpIHx8IGlzRGVmaW5lZCh3aWR0aCkpIHtcclxuICAgICAgaWNvbk9wdGlvbnMuaWNvblNpemUgPSBbd2lkdGgsIGhlaWdodF07XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlZHJhd0ljb24gPSBmYWxzZTtcclxuICAgIGlmICghaXNEZWZpbmVkKGdlb21MYXllcikpIHtcclxuICAgICAgY29uc3QgbWFya2VyT3B0aW9ucyA9IHsgaWNvbjogTC5pY29uKHsgaWNvblVybDogdG1wSW1hZ2UgfSkgfTtcclxuICAgICAgbWFya2VyID0gTC5tYXJrZXIobGF0bG5nLCBtYXJrZXJPcHRpb25zKTtcclxuICAgICAgbWFya2VyLm9uKFwiY2xpY2tcIiwgZmVhdHVyZUNsaWNrZWQuYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xyXG4gICAgICBtYXJrZXIub24oXCJtb3VzZWRvd25cIiwgZmVhdHVyZU1vdXNlZG93bi5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgIGZlYXR1cmVHcm91cC5hZGRMYXllcihtYXJrZXIpO1xyXG4gICAgICBkZXRhaWxzLmxheWVyID0gbWFya2VyO1xyXG4gICAgICByZWRyYXdJY29uID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG1hcmtlciA9IGdlb21MYXllcjtcclxuICAgICAgaWYgKCFtYXJrZXIuZ2V0TGF0TG5nKCkuZXF1YWxzKGxhdGxuZykpIHtcclxuICAgICAgICBtYXJrZXIuc2V0TGF0TG5nKGxhdGxuZyk7XHJcbiAgICAgIH1cclxuICAgICAgZm9yIChjb25zdCBwcm9wIGluIGljb25PcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgaXNEZWZpbmVkKG1hcmtlci5vcHRpb25zLmljb24pICYmXHJcbiAgICAgICAgICBpY29uT3B0aW9uc1twcm9wXSAhPT0gKDxhbnk+bWFya2VyLm9wdGlvbnMuaWNvbi5vcHRpb25zKVtwcm9wXVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgcmVkcmF3SWNvbiA9IHRydWU7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBpZiAocmVkcmF3SWNvbikge1xyXG4gICAgICBjb25zdCByZWNvbG9yTmVlZGVkID0gIWNvbG9yLmVxdWFscyhkZWZhdWx0Q29sb3IpO1xyXG4gICAgICBjb25zdCBkcmF3QmlsbGJvYXJkID0gZnVuY3Rpb24gKFxyXG4gICAgICAgIGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50LFxyXG4gICAgICAgIGRhdGF1cmw6IHN0cmluZyB8IHVuZGVmaW5lZFxyXG4gICAgICApIHtcclxuICAgICAgICBpY29uT3B0aW9ucy5pY29uVXJsID0gZGF0YXVybCB8fCBpbWFnZTtcclxuICAgICAgICBpZiAoIWlzRGVmaW5lZChpY29uT3B0aW9ucy5pY29uU2l6ZSkpIHtcclxuICAgICAgICAgIGljb25PcHRpb25zLmljb25TaXplID0gW2ltYWdlLndpZHRoICogc2NhbGUsIGltYWdlLmhlaWdodCAqIHNjYWxlXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29uc3QgdyA9IGljb25PcHRpb25zLmljb25TaXplWzBdLFxyXG4gICAgICAgICAgaCA9IGljb25PcHRpb25zLmljb25TaXplWzFdO1xyXG4gICAgICAgIGNvbnN0IHhPZmYgPSAodyAvIDIpICogKDEgLSBob3Jpem9udGFsT3JpZ2luKSAtIHBpeGVsT2Zmc2V0Lng7XHJcbiAgICAgICAgY29uc3QgeU9mZiA9IChoIC8gMikgKiAoMSArIHZlcnRpY2FsT3JpZ2luKSAtIHBpeGVsT2Zmc2V0Lnk7XHJcbiAgICAgICAgaWNvbk9wdGlvbnMuaWNvbkFuY2hvciA9IFt4T2ZmLCB5T2ZmXTtcclxuXHJcbiAgICAgICAgaWYgKHJlY29sb3JOZWVkZWQpIHtcclxuICAgICAgICAgIGljb25PcHRpb25zLmljb25VcmwgPSByZWNvbG9yQmlsbGJvYXJkKGltYWdlLCBjb2xvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG1hcmtlci5zZXRJY29uKEwuaWNvbihpY29uT3B0aW9ucykpO1xyXG4gICAgICB9O1xyXG4gICAgICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgaW1nLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBkcmF3QmlsbGJvYXJkKGltZywgaW1hZ2VVcmwpO1xyXG4gICAgICB9O1xyXG4gICAgICBpZiAoaXNEZWZpbmVkKGltYWdlVXJsKSkge1xyXG4gICAgICAgIGltZy5zcmMgPSBpbWFnZVVybDtcclxuICAgICAgICBpZiAocmVjb2xvck5lZWRlZCkge1xyXG4gICAgICAgICAgaW1nLmNyb3NzT3JpZ2luID0gXCJhbm9ueW1vdXNcIjtcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3VwZGF0ZUxhYmVsKFxyXG4gICAgZW50aXR5OiBFbnRpdHksXHJcbiAgICB0aW1lOiBKdWxpYW5EYXRlLFxyXG4gICAgX2VudGl0eUhhc2g6IEVudGl0eUhhc2gsXHJcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbiAgKSB7XHJcbiAgICBjb25zdCBsYWJlbEdyYXBoaWNzID0gZW50aXR5LmxhYmVsITtcclxuICAgIGNvbnN0IGZlYXR1cmVHcm91cCA9IHRoaXMuX2ZlYXR1cmVHcm91cDtcclxuICAgIGxldCBwb3NpdGlvbjtcclxuICAgIGxldCBtYXJrZXI6IEwuTWFya2VyO1xyXG5cclxuICAgIGxldCBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5sYWJlbDtcclxuICAgIGlmICghaXNEZWZpbmVkKGRldGFpbHMpKSB7XHJcbiAgICAgIGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLmxhYmVsID0ge1xyXG4gICAgICAgIGxheWVyOiB1bmRlZmluZWRcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBnZW9tTGF5ZXIgPSBkZXRhaWxzLmxheWVyO1xyXG5cclxuICAgIGxldCBzaG93ID1cclxuICAgICAgZW50aXR5LmlzQXZhaWxhYmxlKHRpbWUpICYmXHJcbiAgICAgIGdldFZhbHVlT3JEZWZhdWx0KGxhYmVsR3JhcGhpY3Muc2hvdywgdGltZSwgdHJ1ZSk7XHJcbiAgICBpZiAoc2hvdykge1xyXG4gICAgICBwb3NpdGlvbiA9IGdldFZhbHVlT3JVbmRlZmluZWQoZW50aXR5LnBvc2l0aW9uLCB0aW1lKTtcclxuICAgICAgc2hvdyA9IGlzRGVmaW5lZChwb3NpdGlvbik7XHJcbiAgICB9XHJcbiAgICBpZiAoIXNob3cpIHtcclxuICAgICAgY2xlYW5MYWJlbChlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5RGV0YWlscyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjYXJ0ID0gRWxsaXBzb2lkLldHUzg0LmNhcnRlc2lhblRvQ2FydG9ncmFwaGljKHBvc2l0aW9uKTtcclxuICAgIGNvbnN0IGxhdGxuZyA9IEwubGF0TG5nKFxyXG4gICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0LmxhdGl0dWRlKSxcclxuICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydC5sb25naXR1ZGUpXHJcbiAgICApO1xyXG4gICAgY29uc3QgdGV4dCA9IGdldFZhbHVlKGxhYmVsR3JhcGhpY3MudGV4dCwgdGltZSk7XHJcbiAgICBjb25zdCBmb250ID0gZ2V0VmFsdWUobGFiZWxHcmFwaGljcy5mb250IGFzIHVua25vd24gYXMgUHJvcGVydHksIHRpbWUpO1xyXG4gICAgY29uc3Qgc2NhbGUgPSBnZXRWYWx1ZU9yRGVmYXVsdChsYWJlbEdyYXBoaWNzLnNjYWxlLCB0aW1lLCAxLjApO1xyXG4gICAgY29uc3QgZmlsbENvbG9yID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIGxhYmVsR3JhcGhpY3MuZmlsbENvbG9yIGFzIHVua25vd24gYXMgUHJvcGVydHksXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIGRlZmF1bHRDb2xvclxyXG4gICAgKTtcclxuICAgIGNvbnN0IHZlcnRpY2FsT3JpZ2luID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIGxhYmVsR3JhcGhpY3MudmVydGljYWxPcmlnaW4sXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIDBcclxuICAgICk7XHJcbiAgICBjb25zdCBob3Jpem9udGFsT3JpZ2luID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIGxhYmVsR3JhcGhpY3MuaG9yaXpvbnRhbE9yaWdpbixcclxuICAgICAgdGltZSxcclxuICAgICAgMFxyXG4gICAgKTtcclxuICAgIGNvbnN0IHBpeGVsT2Zmc2V0ID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIGxhYmVsR3JhcGhpY3MucGl4ZWxPZmZzZXQsXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIENhcnRlc2lhbjIuWkVST1xyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBpY29uT3B0aW9uczogYW55ID0ge1xyXG4gICAgICB0ZXh0OiB0ZXh0LFxyXG4gICAgICBmb250OiBmb250LFxyXG4gICAgICBjb2xvcjogZmlsbENvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKSxcclxuICAgICAgc2NhbGU6IHNjYWxlLFxyXG4gICAgICBob3Jpem9udGFsT3JpZ2luOiBob3Jpem9udGFsT3JpZ2luLCAvL3ZhbHVlOiBsZWZ0LCBjZW50ZXIsIHJpZ2h0XHJcbiAgICAgIHZlcnRpY2FsT3JpZ2luOiB2ZXJ0aWNhbE9yaWdpbiAvL3ZhbHVlOiBib3R0b20sIGNlbnRlciwgdG9wXHJcbiAgICB9O1xyXG5cclxuICAgIGxldCByZWRyYXdMYWJlbCA9IGZhbHNlO1xyXG4gICAgaWYgKCFpc0RlZmluZWQoZ2VvbUxheWVyKSkge1xyXG4gICAgICBjb25zdCBtYXJrZXJPcHRpb25zID0geyBpY29uOiBMLmljb24oeyBpY29uVXJsOiB0bXBJbWFnZSB9KSB9O1xyXG4gICAgICBtYXJrZXIgPSBMLm1hcmtlcihsYXRsbmcsIG1hcmtlck9wdGlvbnMpO1xyXG4gICAgICBtYXJrZXIub24oXCJjbGlja1wiLCBmZWF0dXJlQ2xpY2tlZC5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgIG1hcmtlci5vbihcIm1vdXNlZG93blwiLCBmZWF0dXJlTW91c2Vkb3duLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcclxuICAgICAgZmVhdHVyZUdyb3VwLmFkZExheWVyKG1hcmtlcik7XHJcbiAgICAgIGRldGFpbHMubGF5ZXIgPSBtYXJrZXI7XHJcbiAgICAgIHJlZHJhd0xhYmVsID0gdHJ1ZTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIG1hcmtlciA9IGdlb21MYXllcjtcclxuICAgICAgaWYgKCFtYXJrZXIuZ2V0TGF0TG5nKCkuZXF1YWxzKGxhdGxuZykpIHtcclxuICAgICAgICBtYXJrZXIuc2V0TGF0TG5nKGxhdGxuZyk7XHJcbiAgICAgIH1cclxuICAgICAgZm9yIChjb25zdCBwcm9wIGluIGljb25PcHRpb25zKSB7XHJcbiAgICAgICAgaWYgKFxyXG4gICAgICAgICAgaXNEZWZpbmVkKG1hcmtlci5vcHRpb25zLmljb24pICYmXHJcbiAgICAgICAgICBpY29uT3B0aW9uc1twcm9wXSAhPT0gKDxhbnk+bWFya2VyLm9wdGlvbnMuaWNvbi5vcHRpb25zKVtwcm9wXVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgcmVkcmF3TGFiZWwgPSB0cnVlO1xyXG4gICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKHJlZHJhd0xhYmVsKSB7XHJcbiAgICAgIGNvbnN0IGRyYXdCaWxsYm9hcmQgPSBmdW5jdGlvbiAoXHJcbiAgICAgICAgaW1hZ2U6IEhUTUxJbWFnZUVsZW1lbnQsXHJcbiAgICAgICAgZGF0YXVybDogc3RyaW5nXHJcbiAgICAgICkge1xyXG4gICAgICAgIGljb25PcHRpb25zLmljb25VcmwgPSBkYXRhdXJsIHx8IGltYWdlO1xyXG4gICAgICAgIGlmICghaXNEZWZpbmVkKGljb25PcHRpb25zLmljb25TaXplKSkge1xyXG4gICAgICAgICAgaWNvbk9wdGlvbnMuaWNvblNpemUgPSBbaW1hZ2Uud2lkdGggKiBzY2FsZSwgaW1hZ2UuaGVpZ2h0ICogc2NhbGVdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb25zdCB3ID0gaWNvbk9wdGlvbnMuaWNvblNpemVbMF0sXHJcbiAgICAgICAgICBoID0gaWNvbk9wdGlvbnMuaWNvblNpemVbMV07XHJcbiAgICAgICAgY29uc3QgeE9mZiA9ICh3IC8gMikgKiAoMSAtIGhvcml6b250YWxPcmlnaW4pIC0gcGl4ZWxPZmZzZXQueDtcclxuICAgICAgICBjb25zdCB5T2ZmID0gKGggLyAyKSAqICgxICsgdmVydGljYWxPcmlnaW4pIC0gcGl4ZWxPZmZzZXQueTtcclxuICAgICAgICBpY29uT3B0aW9ucy5pY29uQW5jaG9yID0gW3hPZmYsIHlPZmZdO1xyXG4gICAgICAgIG1hcmtlci5zZXRJY29uKEwuaWNvbihpY29uT3B0aW9ucykpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgY29uc3QgY2FudmFzID0gd3JpdGVUZXh0VG9DYW52YXModGV4dCwge1xyXG4gICAgICAgIGZpbGxDb2xvcjogZmlsbENvbG9yLFxyXG4gICAgICAgIGZvbnQ6IGZvbnRcclxuICAgICAgfSk7XHJcbiAgICAgIGNvbnN0IGltYWdlVXJsID0gY2FudmFzLnRvRGF0YVVSTCgpO1xyXG5cclxuICAgICAgY29uc3QgaW1nID0gbmV3IEltYWdlKCk7XHJcbiAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZHJhd0JpbGxib2FyZChpbWcsIGltYWdlVXJsKTtcclxuICAgICAgfTtcclxuICAgICAgaW1nLnNyYyA9IGltYWdlVXJsO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfdXBkYXRlUmVjdGFuZ2xlKFxyXG4gICAgZW50aXR5OiBFbnRpdHksXHJcbiAgICB0aW1lOiBKdWxpYW5EYXRlLFxyXG4gICAgX2VudGl0eUhhc2g6IEVudGl0eUhhc2gsXHJcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbiAgKSB7XHJcbiAgICBjb25zdCBmZWF0dXJlR3JvdXAgPSB0aGlzLl9mZWF0dXJlR3JvdXA7XHJcbiAgICBjb25zdCByZWN0YW5nbGVHcmFwaGljcyA9IGVudGl0eS5yZWN0YW5nbGU7XHJcblxyXG4gICAgaWYgKCFpc0RlZmluZWQocmVjdGFuZ2xlR3JhcGhpY3MpKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBzaG93ID1cclxuICAgICAgZW50aXR5LmlzQXZhaWxhYmxlKHRpbWUpICYmXHJcbiAgICAgIGdldFZhbHVlT3JEZWZhdWx0KHJlY3RhbmdsZUdyYXBoaWNzLnNob3csIHRpbWUsIHRydWUpO1xyXG5cclxuICAgIGNvbnN0IHJlY3RhbmdsZUNvb3JkaW5hdGVzID0gcmVjdGFuZ2xlR3JhcGhpY3MuY29vcmRpbmF0ZXM/LmdldFZhbHVlKFxyXG4gICAgICB0aW1lXHJcbiAgICApIGFzIFJlY3RhbmdsZTtcclxuXHJcbiAgICBpZiAoIXNob3cgfHwgIWlzRGVmaW5lZChyZWN0YW5nbGVDb29yZGluYXRlcykpIHtcclxuICAgICAgY2xlYW5SZWN0YW5nbGUoZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgcmVjdGFuZ2xlQm91bmRzOiBMYXRMbmdCb3VuZHNMaXRlcmFsID0gW1xyXG4gICAgICBbXHJcbiAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlQ29vcmRpbmF0ZXMuc291dGgpLFxyXG4gICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKHJlY3RhbmdsZUNvb3JkaW5hdGVzLndlc3QpXHJcbiAgICAgIF0sXHJcbiAgICAgIFtcclxuICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhyZWN0YW5nbGVDb29yZGluYXRlcy5ub3J0aCksXHJcbiAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlQ29vcmRpbmF0ZXMuZWFzdClcclxuICAgICAgXVxyXG4gICAgXTtcclxuXHJcbiAgICBsZXQgZGV0YWlscyA9IGVudGl0eURldGFpbHMucmVjdGFuZ2xlO1xyXG4gICAgaWYgKCFpc0RlZmluZWQoZGV0YWlscykpIHtcclxuICAgICAgZGV0YWlscyA9IGVudGl0eURldGFpbHMucmVjdGFuZ2xlID0ge1xyXG4gICAgICAgIGxheWVyOiB1bmRlZmluZWQsXHJcbiAgICAgICAgbGFzdEZpbGw6IHVuZGVmaW5lZCxcclxuICAgICAgICBsYXN0RmlsbENvbG9yOiBuZXcgQ29sb3IoKSxcclxuICAgICAgICBsYXN0T3V0bGluZTogdW5kZWZpbmVkLFxyXG4gICAgICAgIGxhc3RPdXRsaW5lQ29sb3I6IG5ldyBDb2xvcigpXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBjb25zdCBmaWxsID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIHJlY3RhbmdsZUdyYXBoaWNzLmZpbGwgYXMgdW5rbm93biBhcyBQcm9wZXJ0eSxcclxuICAgICAgdGltZSxcclxuICAgICAgdHJ1ZVxyXG4gICAgKTtcclxuICAgIGNvbnN0IG91dGxpbmUgPSBnZXRWYWx1ZU9yRGVmYXVsdChyZWN0YW5nbGVHcmFwaGljcy5vdXRsaW5lLCB0aW1lLCB0cnVlKTtcclxuICAgIGxldCBkYXNoQXJyYXk7XHJcbiAgICBpZiAocmVjdGFuZ2xlR3JhcGhpY3Mub3V0bGluZSBpbnN0YW5jZW9mIFBvbHlsaW5lRGFzaE1hdGVyaWFsUHJvcGVydHkpIHtcclxuICAgICAgZGFzaEFycmF5ID0gZ2V0RGFzaEFycmF5KHJlY3RhbmdsZUdyYXBoaWNzLm91dGxpbmUsIHRpbWUpO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IG91dGxpbmVXaWR0aCA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICByZWN0YW5nbGVHcmFwaGljcy5vdXRsaW5lV2lkdGggYXMgdW5rbm93biBhcyBQcm9wZXJ0eSxcclxuICAgICAgdGltZSxcclxuICAgICAgZGVmYXVsdE91dGxpbmVXaWR0aFxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBvdXRsaW5lQ29sb3IgPSBnZXRWYWx1ZU9yRGVmYXVsdChcclxuICAgICAgcmVjdGFuZ2xlR3JhcGhpY3Mub3V0bGluZUNvbG9yIGFzIHVua25vd24gYXMgUHJvcGVydHksXHJcbiAgICAgIHRpbWUsXHJcbiAgICAgIGRlZmF1bHRPdXRsaW5lQ29sb3JcclxuICAgICk7XHJcblxyXG4gICAgY29uc3QgbWF0ZXJpYWwgPSBnZXRWYWx1ZU9yVW5kZWZpbmVkKFxyXG4gICAgICByZWN0YW5nbGVHcmFwaGljcy5tYXRlcmlhbCBhcyB1bmtub3duIGFzIFByb3BlcnR5LFxyXG4gICAgICB0aW1lXHJcbiAgICApO1xyXG4gICAgbGV0IGZpbGxDb2xvcjtcclxuICAgIGlmIChpc0RlZmluZWQobWF0ZXJpYWwpICYmIGlzRGVmaW5lZChtYXRlcmlhbC5jb2xvcikpIHtcclxuICAgICAgZmlsbENvbG9yID0gbWF0ZXJpYWwuY29sb3I7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBmaWxsQ29sb3IgPSBkZWZhdWx0Q29sb3I7XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGxheWVyID0gZGV0YWlscy5sYXllcjtcclxuICAgIGlmICghaXNEZWZpbmVkKGxheWVyKSkge1xyXG4gICAgICBjb25zdCBwb2x5Z29uT3B0aW9uczogUG9seWxpbmVPcHRpb25zID0ge1xyXG4gICAgICAgIGZpbGw6IGZpbGwsXHJcbiAgICAgICAgZmlsbENvbG9yOiBmaWxsQ29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxyXG4gICAgICAgIGZpbGxPcGFjaXR5OiBmaWxsQ29sb3IuYWxwaGEsXHJcbiAgICAgICAgd2VpZ2h0OiBvdXRsaW5lID8gb3V0bGluZVdpZHRoIDogMC4wLFxyXG4gICAgICAgIGNvbG9yOiBvdXRsaW5lQ29sb3IudG9Dc3NDb2xvclN0cmluZygpLFxyXG4gICAgICAgIG9wYWNpdHk6IG91dGxpbmVDb2xvci5hbHBoYVxyXG4gICAgICB9O1xyXG5cclxuICAgICAgaWYgKG91dGxpbmUgJiYgZGFzaEFycmF5KSB7XHJcbiAgICAgICAgcG9seWdvbk9wdGlvbnMuZGFzaEFycmF5ID0gZGFzaEFycmF5XHJcbiAgICAgICAgICAubWFwKCh4KSA9PiB4ICogb3V0bGluZVdpZHRoKVxyXG4gICAgICAgICAgLmpvaW4oXCIsXCIpO1xyXG4gICAgICB9XHJcblxyXG4gICAgICBsYXllciA9IGRldGFpbHMubGF5ZXIgPSBMLnJlY3RhbmdsZShyZWN0YW5nbGVCb3VuZHMsIHBvbHlnb25PcHRpb25zKTtcclxuXHJcbiAgICAgIGxheWVyLm9uKFwiY2xpY2tcIiwgZmVhdHVyZUNsaWNrZWQuYmluZCh1bmRlZmluZWQsIHRoaXMsIGVudGl0eSkpO1xyXG4gICAgICBsYXllci5vbihcIm1vdXNlZG93blwiLCBmZWF0dXJlTW91c2Vkb3duLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcclxuICAgICAgZmVhdHVyZUdyb3VwLmFkZExheWVyKGxheWVyKTtcclxuXHJcbiAgICAgIGRldGFpbHMubGFzdEZpbGwgPSBmaWxsO1xyXG4gICAgICBkZXRhaWxzLmxhc3RPdXRsaW5lID0gb3V0bGluZTtcclxuICAgICAgQ29sb3IuY2xvbmUoZmlsbENvbG9yLCBkZXRhaWxzLmxhc3RGaWxsQ29sb3IpO1xyXG4gICAgICBDb2xvci5jbG9uZShvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcik7XHJcblxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IGxheWVyLm9wdGlvbnM7XHJcbiAgICBsZXQgYXBwbHlTdHlsZSA9IGZhbHNlO1xyXG5cclxuICAgIGlmIChmaWxsICE9PSBkZXRhaWxzLmxhc3RGaWxsKSB7XHJcbiAgICAgIG9wdGlvbnMuZmlsbCA9IGZpbGw7XHJcbiAgICAgIGRldGFpbHMubGFzdEZpbGwgPSBmaWxsO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3V0bGluZSAhPT0gZGV0YWlscy5sYXN0T3V0bGluZSkge1xyXG4gICAgICBvcHRpb25zLndlaWdodCA9IG91dGxpbmUgPyBvdXRsaW5lV2lkdGggOiAwLjA7XHJcbiAgICAgIGRldGFpbHMubGFzdE91dGxpbmUgPSBvdXRsaW5lO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIUNvbG9yLmVxdWFscyhmaWxsQ29sb3IsIGRldGFpbHMubGFzdEZpbGxDb2xvcikpIHtcclxuICAgICAgb3B0aW9ucy5maWxsQ29sb3IgPSBmaWxsQ29sb3IudG9Dc3NDb2xvclN0cmluZygpO1xyXG4gICAgICBvcHRpb25zLmZpbGxPcGFjaXR5ID0gZmlsbENvbG9yLmFscGhhO1xyXG4gICAgICBDb2xvci5jbG9uZShmaWxsQ29sb3IsIGRldGFpbHMubGFzdEZpbGxDb2xvcik7XHJcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghQ29sb3IuZXF1YWxzKG91dGxpbmVDb2xvciwgZGV0YWlscy5sYXN0T3V0bGluZUNvbG9yKSkge1xyXG4gICAgICBvcHRpb25zLmNvbG9yID0gb3V0bGluZUNvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKTtcclxuICAgICAgb3B0aW9ucy5vcGFjaXR5ID0gb3V0bGluZUNvbG9yLmFscGhhO1xyXG4gICAgICBDb2xvci5jbG9uZShvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcik7XHJcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghbGF5ZXIuZ2V0Qm91bmRzKCkuZXF1YWxzKHJlY3RhbmdsZUJvdW5kcykpIHtcclxuICAgICAgbGF5ZXIuc2V0Qm91bmRzKHJlY3RhbmdsZUJvdW5kcyk7XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGFwcGx5U3R5bGUpIHtcclxuICAgICAgbGF5ZXIuc2V0U3R5bGUob3B0aW9ucyk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF91cGRhdGVQb2x5Z29uKFxyXG4gICAgZW50aXR5OiBFbnRpdHksXHJcbiAgICB0aW1lOiBKdWxpYW5EYXRlLFxyXG4gICAgX2VudGl0eUhhc2g6IEVudGl0eUhhc2gsXHJcbiAgICBlbnRpdHlEZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbiAgKSB7XHJcbiAgICBjb25zdCBmZWF0dXJlR3JvdXAgPSB0aGlzLl9mZWF0dXJlR3JvdXA7XHJcbiAgICBjb25zdCBwb2x5Z29uR3JhcGhpY3MgPSBlbnRpdHkucG9seWdvbiE7XHJcblxyXG4gICAgY29uc3Qgc2hvdyA9XHJcbiAgICAgIGVudGl0eS5pc0F2YWlsYWJsZSh0aW1lKSAmJlxyXG4gICAgICBnZXRWYWx1ZU9yRGVmYXVsdChwb2x5Z29uR3JhcGhpY3Muc2hvdywgdGltZSwgdHJ1ZSk7XHJcbiAgICBpZiAoIXNob3cpIHtcclxuICAgICAgY2xlYW5Qb2x5Z29uKGVudGl0eSwgZmVhdHVyZUdyb3VwLCBlbnRpdHlEZXRhaWxzKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGxldCBkZXRhaWxzID0gZW50aXR5RGV0YWlscy5wb2x5Z29uO1xyXG4gICAgaWYgKCFpc0RlZmluZWQoZGV0YWlscykpIHtcclxuICAgICAgZGV0YWlscyA9IGVudGl0eURldGFpbHMucG9seWdvbiA9IHtcclxuICAgICAgICBsYXllcjogdW5kZWZpbmVkLFxyXG4gICAgICAgIGxhc3RIaWVyYXJjaHk6IHVuZGVmaW5lZCxcclxuICAgICAgICBsYXN0RmlsbDogdW5kZWZpbmVkLFxyXG4gICAgICAgIGxhc3RGaWxsQ29sb3I6IG5ldyBDb2xvcigpLFxyXG4gICAgICAgIGxhc3RPdXRsaW5lOiB1bmRlZmluZWQsXHJcbiAgICAgICAgbGFzdE91dGxpbmVDb2xvcjogbmV3IENvbG9yKClcclxuICAgICAgfTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBoaWVyYXJjaHkgPSBnZXRWYWx1ZU9yVW5kZWZpbmVkKHBvbHlnb25HcmFwaGljcy5oaWVyYXJjaHksIHRpbWUpO1xyXG4gICAgaWYgKCFpc0RlZmluZWQoaGllcmFyY2h5KSkge1xyXG4gICAgICBjbGVhblBvbHlnb24oZW50aXR5LCBmZWF0dXJlR3JvdXAsIGVudGl0eURldGFpbHMpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZmlsbCA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICBwb2x5Z29uR3JhcGhpY3MuZmlsbCBhcyB1bmtub3duIGFzIFByb3BlcnR5LFxyXG4gICAgICB0aW1lLFxyXG4gICAgICB0cnVlXHJcbiAgICApO1xyXG4gICAgY29uc3Qgb3V0bGluZSA9IGdldFZhbHVlT3JEZWZhdWx0KHBvbHlnb25HcmFwaGljcy5vdXRsaW5lLCB0aW1lLCB0cnVlKTtcclxuICAgIGxldCBkYXNoQXJyYXk7XHJcbiAgICBpZiAocG9seWdvbkdyYXBoaWNzLm91dGxpbmUgaW5zdGFuY2VvZiBQb2x5bGluZURhc2hNYXRlcmlhbFByb3BlcnR5KSB7XHJcbiAgICAgIGRhc2hBcnJheSA9IGdldERhc2hBcnJheShwb2x5Z29uR3JhcGhpY3Mub3V0bGluZSwgdGltZSk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb3V0bGluZVdpZHRoID0gZ2V0VmFsdWVPckRlZmF1bHQoXHJcbiAgICAgIHBvbHlnb25HcmFwaGljcy5vdXRsaW5lV2lkdGggYXMgdW5rbm93biBhcyBQcm9wZXJ0eSxcclxuICAgICAgdGltZSxcclxuICAgICAgZGVmYXVsdE91dGxpbmVXaWR0aFxyXG4gICAgKTtcclxuXHJcbiAgICBjb25zdCBvdXRsaW5lQ29sb3IgPSBnZXRWYWx1ZU9yRGVmYXVsdChcclxuICAgICAgcG9seWdvbkdyYXBoaWNzLm91dGxpbmVDb2xvciBhcyB1bmtub3duIGFzIFByb3BlcnR5LFxyXG4gICAgICB0aW1lLFxyXG4gICAgICBkZWZhdWx0T3V0bGluZUNvbG9yXHJcbiAgICApO1xyXG5cclxuICAgIGNvbnN0IG1hdGVyaWFsID0gZ2V0VmFsdWVPclVuZGVmaW5lZChcclxuICAgICAgcG9seWdvbkdyYXBoaWNzLm1hdGVyaWFsIGFzIHVua25vd24gYXMgUHJvcGVydHksXHJcbiAgICAgIHRpbWVcclxuICAgICk7XHJcbiAgICBsZXQgZmlsbENvbG9yO1xyXG4gICAgaWYgKGlzRGVmaW5lZChtYXRlcmlhbCkgJiYgaXNEZWZpbmVkKG1hdGVyaWFsLmNvbG9yKSkge1xyXG4gICAgICBmaWxsQ29sb3IgPSBtYXRlcmlhbC5jb2xvcjtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGZpbGxDb2xvciA9IGRlZmF1bHRDb2xvcjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgbGF5ZXIgPSBkZXRhaWxzLmxheWVyO1xyXG4gICAgaWYgKCFpc0RlZmluZWQobGF5ZXIpKSB7XHJcbiAgICAgIGNvbnN0IHBvbHlnb25PcHRpb25zOiBQb2x5bGluZU9wdGlvbnMgPSB7XHJcbiAgICAgICAgZmlsbDogZmlsbCxcclxuICAgICAgICBmaWxsQ29sb3I6IGZpbGxDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXHJcbiAgICAgICAgZmlsbE9wYWNpdHk6IGZpbGxDb2xvci5hbHBoYSxcclxuICAgICAgICB3ZWlnaHQ6IG91dGxpbmUgPyBvdXRsaW5lV2lkdGggOiAwLjAsXHJcbiAgICAgICAgY29sb3I6IG91dGxpbmVDb2xvci50b0Nzc0NvbG9yU3RyaW5nKCksXHJcbiAgICAgICAgb3BhY2l0eTogb3V0bGluZUNvbG9yLmFscGhhXHJcbiAgICAgIH07XHJcblxyXG4gICAgICBpZiAob3V0bGluZSAmJiBkYXNoQXJyYXkpIHtcclxuICAgICAgICBwb2x5Z29uT3B0aW9ucy5kYXNoQXJyYXkgPSBkYXNoQXJyYXlcclxuICAgICAgICAgIC5tYXAoKHgpID0+IHggKiBvdXRsaW5lV2lkdGgpXHJcbiAgICAgICAgICAuam9pbihcIixcIik7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGxheWVyID0gZGV0YWlscy5sYXllciA9IEwucG9seWdvbihcclxuICAgICAgICBoaWVyYXJjaHlUb0xhdExuZ3MoaGllcmFyY2h5KSxcclxuICAgICAgICBwb2x5Z29uT3B0aW9uc1xyXG4gICAgICApO1xyXG4gICAgICBsYXllci5vbihcImNsaWNrXCIsIGZlYXR1cmVDbGlja2VkLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcclxuICAgICAgbGF5ZXIub24oXCJtb3VzZWRvd25cIiwgZmVhdHVyZU1vdXNlZG93bi5iaW5kKHVuZGVmaW5lZCwgdGhpcywgZW50aXR5KSk7XHJcbiAgICAgIGZlYXR1cmVHcm91cC5hZGRMYXllcihsYXllcik7XHJcblxyXG4gICAgICBkZXRhaWxzLmxhc3RIaWVyYXJjaHkgPSBoaWVyYXJjaHk7XHJcbiAgICAgIGRldGFpbHMubGFzdEZpbGwgPSBmaWxsO1xyXG4gICAgICBkZXRhaWxzLmxhc3RPdXRsaW5lID0gb3V0bGluZTtcclxuICAgICAgQ29sb3IuY2xvbmUoZmlsbENvbG9yLCBkZXRhaWxzLmxhc3RGaWxsQ29sb3IpO1xyXG4gICAgICBDb2xvci5jbG9uZShvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcik7XHJcblxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgaWYgKGhpZXJhcmNoeSAhPT0gZGV0YWlscy5sYXN0SGllcmFyY2h5KSB7XHJcbiAgICAgIGxheWVyLnNldExhdExuZ3MoaGllcmFyY2h5VG9MYXRMbmdzKGhpZXJhcmNoeSkpO1xyXG4gICAgICBkZXRhaWxzLmxhc3RIaWVyYXJjaHkgPSBoaWVyYXJjaHk7XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3Qgb3B0aW9ucyA9IGxheWVyLm9wdGlvbnM7XHJcbiAgICBsZXQgYXBwbHlTdHlsZSA9IGZhbHNlO1xyXG5cclxuICAgIGlmIChmaWxsICE9PSBkZXRhaWxzLmxhc3RGaWxsKSB7XHJcbiAgICAgIG9wdGlvbnMuZmlsbCA9IGZpbGw7XHJcbiAgICAgIGRldGFpbHMubGFzdEZpbGwgPSBmaWxsO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAob3V0bGluZSAhPT0gZGV0YWlscy5sYXN0T3V0bGluZSkge1xyXG4gICAgICBvcHRpb25zLndlaWdodCA9IG91dGxpbmUgPyBvdXRsaW5lV2lkdGggOiAwLjA7XHJcbiAgICAgIGRldGFpbHMubGFzdE91dGxpbmUgPSBvdXRsaW5lO1xyXG4gICAgICBhcHBseVN0eWxlID0gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIUNvbG9yLmVxdWFscyhmaWxsQ29sb3IsIGRldGFpbHMubGFzdEZpbGxDb2xvcikpIHtcclxuICAgICAgb3B0aW9ucy5maWxsQ29sb3IgPSBmaWxsQ29sb3IudG9Dc3NDb2xvclN0cmluZygpO1xyXG4gICAgICBvcHRpb25zLmZpbGxPcGFjaXR5ID0gZmlsbENvbG9yLmFscGhhO1xyXG4gICAgICBDb2xvci5jbG9uZShmaWxsQ29sb3IsIGRldGFpbHMubGFzdEZpbGxDb2xvcik7XHJcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmICghQ29sb3IuZXF1YWxzKG91dGxpbmVDb2xvciwgZGV0YWlscy5sYXN0T3V0bGluZUNvbG9yKSkge1xyXG4gICAgICBvcHRpb25zLmNvbG9yID0gb3V0bGluZUNvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKTtcclxuICAgICAgb3B0aW9ucy5vcGFjaXR5ID0gb3V0bGluZUNvbG9yLmFscGhhO1xyXG4gICAgICBDb2xvci5jbG9uZShvdXRsaW5lQ29sb3IsIGRldGFpbHMubGFzdE91dGxpbmVDb2xvcik7XHJcbiAgICAgIGFwcGx5U3R5bGUgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChhcHBseVN0eWxlKSB7XHJcbiAgICAgIGxheWVyLnNldFN0eWxlKG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfdXBkYXRlUG9seWxpbmUoXHJcbiAgICBlbnRpdHk6IEVudGl0eSxcclxuICAgIHRpbWU6IEp1bGlhbkRhdGUsXHJcbiAgICBfZW50aXR5SGFzaDogRW50aXR5SGFzaCxcclxuICAgIGVudGl0eURldGFpbHM6IEVudGl0eURldGFpbHNcclxuICApIHtcclxuICAgIGNvbnN0IHBvbHlsaW5lR3JhcGhpY3MgPSBlbnRpdHkucG9seWxpbmUhO1xyXG4gICAgY29uc3QgZmVhdHVyZUdyb3VwID0gdGhpcy5fZmVhdHVyZUdyb3VwO1xyXG4gICAgbGV0IHBvc2l0aW9ucywgcG9seWxpbmU7XHJcblxyXG4gICAgbGV0IGRldGFpbHMgPSBlbnRpdHlEZXRhaWxzLnBvbHlsaW5lO1xyXG4gICAgaWYgKCFpc0RlZmluZWQoZGV0YWlscykpIHtcclxuICAgICAgZGV0YWlscyA9IGVudGl0eURldGFpbHMucG9seWxpbmUgPSB7XHJcbiAgICAgICAgbGF5ZXI6IHVuZGVmaW5lZFxyXG4gICAgICB9O1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGdlb21MYXllciA9IGRldGFpbHMubGF5ZXI7XHJcblxyXG4gICAgbGV0IHNob3cgPVxyXG4gICAgICBlbnRpdHkuaXNBdmFpbGFibGUodGltZSkgJiZcclxuICAgICAgZ2V0VmFsdWVPckRlZmF1bHQocG9seWxpbmVHcmFwaGljcy5zaG93LCB0aW1lLCB0cnVlKTtcclxuICAgIGlmIChzaG93KSB7XHJcbiAgICAgIHBvc2l0aW9ucyA9IGdldFZhbHVlT3JVbmRlZmluZWQocG9seWxpbmVHcmFwaGljcy5wb3NpdGlvbnMsIHRpbWUpO1xyXG4gICAgICBzaG93ID0gaXNEZWZpbmVkKHBvc2l0aW9ucyk7XHJcbiAgICB9XHJcbiAgICBpZiAoIXNob3cpIHtcclxuICAgICAgY2xlYW5Qb2x5bGluZShlbnRpdHksIGZlYXR1cmVHcm91cCwgZW50aXR5RGV0YWlscyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBjYXJ0cyA9IEVsbGlwc29pZC5XR1M4NC5jYXJ0ZXNpYW5BcnJheVRvQ2FydG9ncmFwaGljQXJyYXkocG9zaXRpb25zKTtcclxuICAgIGNvbnN0IGxhdGxuZ3MgPSBbXTtcclxuICAgIGZvciAobGV0IHAgPSAwOyBwIDwgY2FydHMubGVuZ3RoOyBwKyspIHtcclxuICAgICAgbGF0bG5ncy5wdXNoKFxyXG4gICAgICAgIEwubGF0TG5nKFxyXG4gICAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydHNbcF0ubGF0aXR1ZGUpLFxyXG4gICAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydHNbcF0ubG9uZ2l0dWRlKVxyXG4gICAgICAgIClcclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgY29sb3I7XHJcbiAgICBsZXQgZGFzaEFycmF5OiBudW1iZXJbXSB8IHVuZGVmaW5lZDtcclxuICAgIGxldCB3aWR0aDogbnVtYmVyO1xyXG4gICAgaWYgKHBvbHlsaW5lR3JhcGhpY3MubWF0ZXJpYWwgaW5zdGFuY2VvZiBQb2x5bGluZUdsb3dNYXRlcmlhbFByb3BlcnR5KSB7XHJcbiAgICAgIGNvbG9yID0gZGVmYXVsdENvbG9yO1xyXG4gICAgICB3aWR0aCA9IGRlZmF1bHRXaWR0aDtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbnN0IG1hdGVyaWFsID0gcG9seWxpbmVHcmFwaGljcy5tYXRlcmlhbC5nZXRWYWx1ZSh0aW1lKTtcclxuICAgICAgaWYgKGlzRGVmaW5lZChtYXRlcmlhbCkpIHtcclxuICAgICAgICBjb2xvciA9IG1hdGVyaWFsLmNvbG9yO1xyXG4gICAgICB9XHJcbiAgICAgIGNvbG9yID0gY29sb3IgfHwgZGVmYXVsdENvbG9yO1xyXG4gICAgICB3aWR0aCA9IGdldFZhbHVlT3JEZWZhdWx0KFxyXG4gICAgICAgIHBvbHlsaW5lR3JhcGhpY3Mud2lkdGggYXMgdW5rbm93biBhcyBQcm9wZXJ0eSxcclxuICAgICAgICB0aW1lLFxyXG4gICAgICAgIGRlZmF1bHRXaWR0aFxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgaWYgKHBvbHlsaW5lR3JhcGhpY3MubWF0ZXJpYWwgaW5zdGFuY2VvZiBQb2x5bGluZURhc2hNYXRlcmlhbFByb3BlcnR5KSB7XHJcbiAgICAgIGRhc2hBcnJheSA9IGdldERhc2hBcnJheShwb2x5bGluZUdyYXBoaWNzLm1hdGVyaWFsLCB0aW1lKTtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBwb2x5bGluZU9wdGlvbnM6IFBvbHlsaW5lT3B0aW9ucyA9IHtcclxuICAgICAgY29sb3I6IGNvbG9yLnRvQ3NzQ29sb3JTdHJpbmcoKSxcclxuICAgICAgd2VpZ2h0OiB3aWR0aCxcclxuICAgICAgb3BhY2l0eTogY29sb3IuYWxwaGFcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGRhc2hBcnJheSkge1xyXG4gICAgICBwb2x5bGluZU9wdGlvbnMuZGFzaEFycmF5ID0gZGFzaEFycmF5Lm1hcCgoeCkgPT4geCAqIHdpZHRoKS5qb2luKFwiLFwiKTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoIWlzRGVmaW5lZChnZW9tTGF5ZXIpKSB7XHJcbiAgICAgIGlmIChsYXRsbmdzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICBwb2x5bGluZSA9IEwucG9seWxpbmUobGF0bG5ncywgcG9seWxpbmVPcHRpb25zKTtcclxuICAgICAgICBwb2x5bGluZS5vbihcImNsaWNrXCIsIGZlYXR1cmVDbGlja2VkLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpKTtcclxuICAgICAgICBwb2x5bGluZS5vbihcclxuICAgICAgICAgIFwibW91c2Vkb3duXCIsXHJcbiAgICAgICAgICBmZWF0dXJlTW91c2Vkb3duLmJpbmQodW5kZWZpbmVkLCB0aGlzLCBlbnRpdHkpXHJcbiAgICAgICAgKTtcclxuICAgICAgICBmZWF0dXJlR3JvdXAuYWRkTGF5ZXIocG9seWxpbmUpO1xyXG4gICAgICAgIGRldGFpbHMubGF5ZXIgPSBwb2x5bGluZTtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcG9seWxpbmUgPSBnZW9tTGF5ZXI7XHJcbiAgICAgIGNvbnN0IGN1ckxhdExuZ3MgPSBwb2x5bGluZS5nZXRMYXRMbmdzKCk7XHJcbiAgICAgIGxldCBiUG9zQ2hhbmdlID0gbGF0bG5ncy5sZW5ndGggIT09IGN1ckxhdExuZ3MubGVuZ3RoO1xyXG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1ckxhdExuZ3MubGVuZ3RoICYmICFiUG9zQ2hhbmdlOyBpKyspIHtcclxuICAgICAgICBjb25zdCBsYXRsbmcgPSBjdXJMYXRMbmdzW2ldO1xyXG4gICAgICAgIGlmIChsYXRsbmcgaW5zdGFuY2VvZiBMLkxhdExuZyAmJiAhbGF0bG5nLmVxdWFscyhsYXRsbmdzW2ldKSkge1xyXG4gICAgICAgICAgYlBvc0NoYW5nZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGlmIChiUG9zQ2hhbmdlKSB7XHJcbiAgICAgICAgcG9seWxpbmUuc2V0TGF0TG5ncyhsYXRsbmdzKTtcclxuICAgICAgfVxyXG5cclxuICAgICAgZm9yIChsZXQgcHJvcCBpbiBwb2x5bGluZU9wdGlvbnMpIHtcclxuICAgICAgICBpZiAoKDxhbnk+cG9seWxpbmVPcHRpb25zKVtwcm9wXSAhPT0gKDxhbnk+cG9seWxpbmUub3B0aW9ucylbcHJvcF0pIHtcclxuICAgICAgICAgIHBvbHlsaW5lLnNldFN0eWxlKHBvbHlsaW5lT3B0aW9ucyk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgICB9XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFJldHVybnMgdHJ1ZSBpZiB0aGlzIG9iamVjdCB3YXMgZGVzdHJveWVkOyBvdGhlcndpc2UsIGZhbHNlLlxyXG4gICAqXHJcbiAgICovXHJcbiAgaXNEZXN0cm95ZWQoKTogYm9vbGVhbiB7XHJcbiAgICByZXR1cm4gZmFsc2U7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBSZW1vdmVzIGFuZCBkZXN0cm95cyBhbGwgcHJpbWl0aXZlcyBjcmVhdGVkIGJ5IHRoaXMgaW5zdGFuY2UuXHJcbiAgICovXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIGNvbnN0IGVudGl0aWVzID0gdGhpcy5fZW50aXRpZXNUb1Zpc3VhbGl6ZS52YWx1ZXM7XHJcbiAgICBjb25zdCBlbnRpdHlIYXNoID0gdGhpcy5fZW50aXR5SGFzaDtcclxuXHJcbiAgICBmb3IgKGxldCBpID0gZW50aXRpZXMubGVuZ3RoIC0gMTsgaSA+IC0xOyBpLS0pIHtcclxuICAgICAgY2xlYW5FbnRpdHkoZW50aXRpZXNbaV0sIHRoaXMuX2ZlYXR1cmVHcm91cCwgZW50aXR5SGFzaCk7XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5lbnRpdHlDb2xsZWN0aW9uLmNvbGxlY3Rpb25DaGFuZ2VkLnJlbW92ZUV2ZW50TGlzdGVuZXIoXHJcbiAgICAgIHRoaXMuX29uQ29sbGVjdGlvbkNoYW5nZWQsXHJcbiAgICAgIHRoaXNcclxuICAgICk7XHJcbiAgICB0aGlzLmxlYWZsZXRTY2VuZS5tYXAucmVtb3ZlTGF5ZXIodGhpcy5fZmVhdHVyZUdyb3VwKTtcclxuICAgIHJldHVybiBkZXN0cm95T2JqZWN0KHRoaXMpO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQ29tcHV0ZXMgdGhlIHJlY3Rhbmd1bGFyIGJvdW5kcyB3aGljaCBlbmNsb3NlcyB0aGUgY29sbGVjdGlvbiBvZlxyXG4gICAqIGVudGl0aWVzIHRvIGJlIHZpc3VhbGl6ZWQuXHJcbiAgICovXHJcbiAgZ2V0TGF0TG5nQm91bmRzKCk6IExhdExuZ0JvdW5kcyB8IHVuZGVmaW5lZCB7XHJcbiAgICBsZXQgcmVzdWx0OiBMYXRMbmdCb3VuZHMgfCB1bmRlZmluZWQ7XHJcblxyXG4gICAgT2JqZWN0LmtleXModGhpcy5fZW50aXR5SGFzaCkuZm9yRWFjaCgoZW50aXR5SWQpID0+IHtcclxuICAgICAgY29uc3QgZW50aXR5RGV0YWlsczogYW55ID0gdGhpcy5fZW50aXR5SGFzaFtlbnRpdHlJZF07XHJcblxyXG4gICAgICBPYmplY3Qua2V5cyhlbnRpdHlEZXRhaWxzKS5mb3JFYWNoKChwcmltaXRpdmVJZCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IHByaW1pdGl2ZSA9IGVudGl0eURldGFpbHNbcHJpbWl0aXZlSWRdO1xyXG5cclxuICAgICAgICBpZiAoaXNEZWZpbmVkKHByaW1pdGl2ZS5sYXllcikpIHtcclxuICAgICAgICAgIGlmIChpc0RlZmluZWQocHJpbWl0aXZlLmxheWVyLmdldEJvdW5kcykpIHtcclxuICAgICAgICAgICAgY29uc3QgYm91bmRzID0gcHJpbWl0aXZlLmxheWVyLmdldEJvdW5kcygpO1xyXG4gICAgICAgICAgICBpZiAoaXNEZWZpbmVkKGJvdW5kcykpIHtcclxuICAgICAgICAgICAgICByZXN1bHQgPVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID09PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICAgPyBMLmxhdExuZ0JvdW5kcyhib3VuZHMuZ2V0U291dGhXZXN0KCksIGJvdW5kcy5nZXROb3J0aEVhc3QoKSlcclxuICAgICAgICAgICAgICAgICAgOiByZXN1bHQuZXh0ZW5kKGJvdW5kcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICAgIGlmIChpc0RlZmluZWQocHJpbWl0aXZlLmxheWVyLmdldExhdExuZykpIHtcclxuICAgICAgICAgICAgY29uc3QgbGF0TG5nID0gcHJpbWl0aXZlLmxheWVyLmdldExhdExuZygpO1xyXG4gICAgICAgICAgICBpZiAoaXNEZWZpbmVkKGxhdExuZykpIHtcclxuICAgICAgICAgICAgICByZXN1bHQgPVxyXG4gICAgICAgICAgICAgICAgcmVzdWx0ID09PSB1bmRlZmluZWRcclxuICAgICAgICAgICAgICAgICAgPyBMLmxhdExuZ0JvdW5kcyhbbGF0TG5nXSlcclxuICAgICAgICAgICAgICAgICAgOiByZXN1bHQuZXh0ZW5kKGxhdExuZyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldERhc2hBcnJheShcclxuICBtYXRlcmlhbDogUG9seWxpbmVEYXNoTWF0ZXJpYWxQcm9wZXJ0eSxcclxuICB0aW1lOiBKdWxpYW5EYXRlXHJcbik6IG51bWJlcltdIHtcclxuICBsZXQgZGFzaEFycmF5O1xyXG5cclxuICBjb25zdCBkYXNoUGF0dGVybiA9IG1hdGVyaWFsLmRhc2hQYXR0ZXJuXHJcbiAgICA/IG1hdGVyaWFsLmRhc2hQYXR0ZXJuLmdldFZhbHVlKHRpbWUpXHJcbiAgICA6IHVuZGVmaW5lZDtcclxuXHJcbiAgcmV0dXJuIGdldExpbmVTdHlsZUxlYWZsZXQoZGFzaFBhdHRlcm4pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBjbGVhbkVudGl0eShcclxuICBlbnRpdHk6IEVudGl0eSxcclxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXHJcbiAgZW50aXR5SGFzaDogRW50aXR5SGFzaFxyXG4pIHtcclxuICBjb25zdCBkZXRhaWxzID0gZW50aXR5SGFzaFtlbnRpdHkuaWRdO1xyXG5cclxuICBjbGVhblBvaW50KGVudGl0eSwgZ3JvdXAsIGRldGFpbHMpO1xyXG4gIGNsZWFuUG9seWdvbihlbnRpdHksIGdyb3VwLCBkZXRhaWxzKTtcclxuICBjbGVhbkJpbGxib2FyZChlbnRpdHksIGdyb3VwLCBkZXRhaWxzKTtcclxuICBjbGVhbkxhYmVsKGVudGl0eSwgZ3JvdXAsIGRldGFpbHMpO1xyXG4gIGNsZWFuUG9seWxpbmUoZW50aXR5LCBncm91cCwgZGV0YWlscyk7XHJcblxyXG4gIGRlbGV0ZSBlbnRpdHlIYXNoW2VudGl0eS5pZF07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFuUG9pbnQoXHJcbiAgX2VudGl0eTogRW50aXR5LFxyXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcclxuICBkZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbikge1xyXG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5wb2ludCkgJiYgaXNEZWZpbmVkKGRldGFpbHMucG9pbnQubGF5ZXIpKSB7XHJcbiAgICBncm91cC5yZW1vdmVMYXllcihkZXRhaWxzLnBvaW50LmxheWVyKTtcclxuICAgIGRldGFpbHMucG9pbnQgPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjbGVhblBvbHlnb24oXHJcbiAgX2VudGl0eTogRW50aXR5LFxyXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcclxuICBkZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbikge1xyXG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5wb2x5Z29uKSAmJiBpc0RlZmluZWQoZGV0YWlscy5wb2x5Z29uLmxheWVyKSkge1xyXG4gICAgZ3JvdXAucmVtb3ZlTGF5ZXIoZGV0YWlscy5wb2x5Z29uLmxheWVyKTtcclxuICAgIGRldGFpbHMucG9seWdvbiA9IHVuZGVmaW5lZDtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFuQmlsbGJvYXJkKFxyXG4gIF9lbnRpdHk6IEVudGl0eSxcclxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXHJcbiAgZGV0YWlsczogRW50aXR5RGV0YWlsc1xyXG4pIHtcclxuICBpZiAoaXNEZWZpbmVkKGRldGFpbHMuYmlsbGJvYXJkKSAmJiBpc0RlZmluZWQoZGV0YWlscy5iaWxsYm9hcmQubGF5ZXIpKSB7XHJcbiAgICBncm91cC5yZW1vdmVMYXllcihkZXRhaWxzLmJpbGxib2FyZC5sYXllcik7XHJcbiAgICBkZXRhaWxzLmJpbGxib2FyZCA9IHVuZGVmaW5lZDtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNsZWFuTGFiZWwoXHJcbiAgX2VudGl0eTogRW50aXR5LFxyXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcclxuICBkZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbikge1xyXG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5sYWJlbCkgJiYgaXNEZWZpbmVkKGRldGFpbHMubGFiZWwubGF5ZXIpKSB7XHJcbiAgICBncm91cC5yZW1vdmVMYXllcihkZXRhaWxzLmxhYmVsLmxheWVyKTtcclxuICAgIGRldGFpbHMubGFiZWwgPSB1bmRlZmluZWQ7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjbGVhblBvbHlsaW5lKFxyXG4gIF9lbnRpdHk6IEVudGl0eSxcclxuICBncm91cDogTC5GZWF0dXJlR3JvdXAsXHJcbiAgZGV0YWlsczogRW50aXR5RGV0YWlsc1xyXG4pIHtcclxuICBpZiAoaXNEZWZpbmVkKGRldGFpbHMucG9seWxpbmUpICYmIGlzRGVmaW5lZChkZXRhaWxzLnBvbHlsaW5lLmxheWVyKSkge1xyXG4gICAgZ3JvdXAucmVtb3ZlTGF5ZXIoZGV0YWlscy5wb2x5bGluZS5sYXllcik7XHJcbiAgICBkZXRhaWxzLnBvbHlsaW5lID0gdW5kZWZpbmVkO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2xlYW5SZWN0YW5nbGUoXHJcbiAgX2VudGl0eTogRW50aXR5LFxyXG4gIGdyb3VwOiBMLkZlYXR1cmVHcm91cCxcclxuICBkZXRhaWxzOiBFbnRpdHlEZXRhaWxzXHJcbikge1xyXG4gIGlmIChpc0RlZmluZWQoZGV0YWlscy5yZWN0YW5nbGUpICYmIGlzRGVmaW5lZChkZXRhaWxzLnJlY3RhbmdsZS5sYXllcikpIHtcclxuICAgIGdyb3VwLnJlbW92ZUxheWVyKGRldGFpbHMucmVjdGFuZ2xlLmxheWVyKTtcclxuICAgIGRldGFpbHMucmVjdGFuZ2xlID0gdW5kZWZpbmVkO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gX2lzQ2xvc2VUb0Vhc3Rlcm5BbnRpTWVyaWRpYW4oYm91bmRzOiBMYXRMbmdCb3VuZHMpIHtcclxuICBjb25zdCB3ID0gYm91bmRzLmdldFdlc3QoKTtcclxuICBjb25zdCBlID0gYm91bmRzLmdldEVhc3QoKTtcclxuICBpZiAodyA+IDE0MCAmJiAoZSA8IC0xNDAgfHwgZSA+IDE4MCkpIHtcclxuICAgIHJldHVybiB0cnVlO1xyXG4gIH1cclxuICByZXR1cm4gZmFsc2U7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIF9pc0Nsb3NlVG9XZXN0ZXJuQW50aU1lcmlkaWFuKGJvdW5kczogTGF0TG5nQm91bmRzKSB7XHJcbiAgY29uc3QgdyA9IGJvdW5kcy5nZXRXZXN0KCk7XHJcbiAgY29uc3QgZSA9IGJvdW5kcy5nZXRFYXN0KCk7XHJcbiAgaWYgKCh3ID4gMTgwIHx8IHcgPCAtMTQwKSAmJiBlIDwgLTE0MCkge1xyXG4gICAgcmV0dXJuIHRydWU7XHJcbiAgfVxyXG4gIHJldHVybiBmYWxzZTtcclxufVxyXG5cclxuZnVuY3Rpb24gcG9zaXRpb25Ub0xhdExuZyhcclxuICBwb3NpdGlvbjogQ2FydGVzaWFuMyxcclxuICBib3VuZHM6IExhdExuZ0JvdW5kcyB8IHVuZGVmaW5lZFxyXG4pIHtcclxuICB2YXIgY2FydG9ncmFwaGljID0gRWxsaXBzb2lkLldHUzg0LmNhcnRlc2lhblRvQ2FydG9ncmFwaGljKHBvc2l0aW9uKTtcclxuICBsZXQgbG9uID0gQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxvbmdpdHVkZSk7XHJcbiAgaWYgKGJvdW5kcyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICBpZiAoX2lzQ2xvc2VUb0Vhc3Rlcm5BbnRpTWVyaWRpYW4oYm91bmRzKSkge1xyXG4gICAgICBpZiAobG9uIDwgLTE0MCkge1xyXG4gICAgICAgIGxvbiA9IGxvbiArIDM2MDtcclxuICAgICAgfVxyXG4gICAgfSBlbHNlIGlmIChfaXNDbG9zZVRvV2VzdGVybkFudGlNZXJpZGlhbihib3VuZHMpKSB7XHJcbiAgICAgIGlmIChsb24gPiAxNDApIHtcclxuICAgICAgICBsb24gPSBsb24gLSAzNjA7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIEwubGF0TG5nKENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRvZ3JhcGhpYy5sYXRpdHVkZSksIGxvbik7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGhpZXJhcmNoeVRvTGF0TG5ncyhoaWVyYXJjaHk6IFBvbHlnb25IaWVyYXJjaHkpIHtcclxuICBsZXQgaG9sZXM6IEwuTGF0TG5nW11bXSA9IFtdO1xyXG4gIGNvbnN0IHBvc2l0aW9ucyA9IEFycmF5LmlzQXJyYXkoaGllcmFyY2h5KSA/IGhpZXJhcmNoeSA6IGhpZXJhcmNoeS5wb3NpdGlvbnM7XHJcbiAgaWYgKGhpZXJhcmNoeS5ob2xlcy5sZW5ndGggPiAwKSB7XHJcbiAgICBoaWVyYXJjaHkuaG9sZXMuZm9yRWFjaCgoaG9sZSkgPT4ge1xyXG4gICAgICBob2xlcy5wdXNoKGNvbnZlcnRFbnRpdHlQb3NpdGlvbnNUb0xhdExvbnMoaG9sZS5wb3NpdGlvbnMpKTtcclxuICAgIH0pO1xyXG4gICAgcmV0dXJuIFtjb252ZXJ0RW50aXR5UG9zaXRpb25zVG9MYXRMb25zKHBvc2l0aW9ucyksIC4uLmhvbGVzXTtcclxuICB9IGVsc2Uge1xyXG4gICAgcmV0dXJuIGNvbnZlcnRFbnRpdHlQb3NpdGlvbnNUb0xhdExvbnMocG9zaXRpb25zKTtcclxuICB9XHJcbn1cclxuXHJcbi8vUmVjb2xvciBhbiBpbWFnZSB1c2luZyAyZCBjYW52YXNcclxuZnVuY3Rpb24gcmVjb2xvckJpbGxib2FyZChcclxuICBpbWc6IEhUTUxJbWFnZUVsZW1lbnQsXHJcbiAgY29sb3I6IENvbG9yXHJcbik6IHN0cmluZyB8IHVuZGVmaW5lZCB7XHJcbiAgY29uc3QgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcclxuICBjYW52YXMud2lkdGggPSBpbWcud2lkdGg7XHJcbiAgY2FudmFzLmhlaWdodCA9IGltZy5oZWlnaHQ7XHJcblxyXG4gIC8vIENvcHkgdGhlIGltYWdlIGNvbnRlbnRzIHRvIHRoZSBjYW52YXNcclxuICBjb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoXCIyZFwiKTtcclxuICBpZiAoY29udGV4dCA9PT0gbnVsbCkge1xyXG4gICAgcmV0dXJuO1xyXG4gIH1cclxuXHJcbiAgY29udGV4dC5kcmF3SW1hZ2UoaW1nLCAwLCAwKTtcclxuICBjb25zdCBpbWFnZSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGNhbnZhcy53aWR0aCwgY2FudmFzLmhlaWdodCk7XHJcbiAgY29uc3Qgbm9ybUNsciA9IFtjb2xvci5yZWQsIGNvbG9yLmdyZWVuLCBjb2xvci5ibHVlLCBjb2xvci5hbHBoYV07XHJcblxyXG4gIGNvbnN0IGxlbmd0aCA9IGltYWdlLmRhdGEubGVuZ3RoOyAvL3BpeGVsIGNvdW50ICogNFxyXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICs9IDQpIHtcclxuICAgIGZvciAobGV0IGogPSAwOyBqIDwgNDsgaisrKSB7XHJcbiAgICAgIGltYWdlLmRhdGFbaiArIGldICo9IG5vcm1DbHJbal07XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBjb250ZXh0LnB1dEltYWdlRGF0YShpbWFnZSwgMCwgMCk7XHJcbiAgcmV0dXJuIGNhbnZhcy50b0RhdGFVUkwoKTtcclxufVxyXG5cclxuZnVuY3Rpb24gZmVhdHVyZUNsaWNrZWQoXHJcbiAgdmlzdWFsaXplcjogTGVhZmxldEdlb21WaXN1YWxpemVyLFxyXG4gIGVudGl0eTogRW50aXR5LFxyXG4gIGV2ZW50OiBMLkxlYWZsZXRFdmVudFxyXG4pIHtcclxuICB2aXN1YWxpemVyLmxlYWZsZXRTY2VuZS5mZWF0dXJlQ2xpY2tlZC5yYWlzZUV2ZW50KGVudGl0eSwgZXZlbnQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBmZWF0dXJlTW91c2Vkb3duKFxyXG4gIHZpc3VhbGl6ZXI6IExlYWZsZXRHZW9tVmlzdWFsaXplcixcclxuICBlbnRpdHk6IEVudGl0eSxcclxuICBldmVudDogTC5MZWFmbGV0RXZlbnRcclxuKSB7XHJcbiAgdmlzdWFsaXplci5sZWFmbGV0U2NlbmUuZmVhdHVyZU1vdXNlZG93bi5yYWlzZUV2ZW50KGVudGl0eSwgZXZlbnQpO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRWYWx1ZTxUPihcclxuICBwcm9wZXJ0eTogUHJvcGVydHkgfCB1bmRlZmluZWQsXHJcbiAgdGltZTogSnVsaWFuRGF0ZVxyXG4pOiBUIHwgdW5kZWZpbmVkIHtcclxuICBpZiAoaXNEZWZpbmVkKHByb3BlcnR5KSkge1xyXG4gICAgcmV0dXJuIHByb3BlcnR5LmdldFZhbHVlKHRpbWUpO1xyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0VmFsdWVPckRlZmF1bHQ8VD4oXHJcbiAgcHJvcGVydHk6IFByb3BlcnR5IHwgdW5kZWZpbmVkLFxyXG4gIHRpbWU6IEp1bGlhbkRhdGUsXHJcbiAgZGVmYXVsdFZhbHVlOiBUXHJcbik6IFQge1xyXG4gIGlmIChpc0RlZmluZWQocHJvcGVydHkpKSB7XHJcbiAgICBjb25zdCB2YWx1ZSA9IHByb3BlcnR5LmdldFZhbHVlKHRpbWUpO1xyXG4gICAgaWYgKGlzRGVmaW5lZCh2YWx1ZSkpIHtcclxuICAgICAgcmV0dXJuIHZhbHVlO1xyXG4gICAgfVxyXG4gIH1cclxuICByZXR1cm4gZGVmYXVsdFZhbHVlO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRWYWx1ZU9yVW5kZWZpbmVkKHByb3BlcnR5OiBQcm9wZXJ0eSB8IHVuZGVmaW5lZCwgdGltZTogSnVsaWFuRGF0ZSkge1xyXG4gIGlmIChpc0RlZmluZWQocHJvcGVydHkpKSB7XHJcbiAgICByZXR1cm4gcHJvcGVydHkuZ2V0VmFsdWUodGltZSk7XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjb252ZXJ0RW50aXR5UG9zaXRpb25zVG9MYXRMb25zKHBvc2l0aW9uczogQ2FydGVzaWFuM1tdKTogTC5MYXRMbmdbXSB7XHJcbiAgdmFyIGNhcnRzID0gRWxsaXBzb2lkLldHUzg0LmNhcnRlc2lhbkFycmF5VG9DYXJ0b2dyYXBoaWNBcnJheShwb3NpdGlvbnMpO1xyXG4gIHZhciBsYXRsbmdzOiBMLkxhdExuZ1tdID0gW107XHJcbiAgbGV0IGxhc3RMb25naXR1ZGU7XHJcbiAgZm9yICh2YXIgcCA9IDA7IHAgPCBjYXJ0cy5sZW5ndGg7IHArKykge1xyXG4gICAgbGV0IGxvbiA9IENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRzW3BdLmxvbmdpdHVkZSk7XHJcblxyXG4gICAgaWYgKGxhc3RMb25naXR1ZGUgIT09IHVuZGVmaW5lZCkge1xyXG4gICAgICBpZiAobGFzdExvbmdpdHVkZSAtIGxvbiA+IDE4MCkge1xyXG4gICAgICAgIGxvbiA9IGxvbiArIDM2MDtcclxuICAgICAgfSBlbHNlIGlmIChsYXN0TG9uZ2l0dWRlIC0gbG9uIDwgLTE4MCkge1xyXG4gICAgICAgIGxvbiA9IGxvbiAtIDM2MDtcclxuICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIGxhdGxuZ3MucHVzaChMLmxhdExuZyhDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0c1twXS5sYXRpdHVkZSksIGxvbikpO1xyXG4gICAgbGFzdExvbmdpdHVkZSA9IGxvbjtcclxuICB9XHJcbiAgcmV0dXJuIGxhdGxuZ3M7XHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIExlYWZsZXRWaXN1YWxpemVyIHtcclxuICB2aXN1YWxpemVyc0NhbGxiYWNrKFxyXG4gICAgbGVhZmxldFNjZW5lOiBMZWFmbGV0U2NlbmUsXHJcbiAgICBfZW50aXR5Q2x1c3RlcjogRW50aXR5Q2x1c3RlcixcclxuICAgIGRhdGFTb3VyY2U6IERhdGFTb3VyY2VcclxuICApIHtcclxuICAgIGNvbnN0IGVudGl0aWVzID0gZGF0YVNvdXJjZS5lbnRpdGllcztcclxuICAgIHJldHVybiBbbmV3IExlYWZsZXRHZW9tVmlzdWFsaXplcihsZWFmbGV0U2NlbmUsIGVudGl0aWVzKV07XHJcbiAgfVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFJQTtBQUVBO0FBR0E7QUFDQTtBQUdBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBRUE7QUFzREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQVFBO0FBR0E7QUFBQTtBQUZBO0FBQ0E7QUFBQTtBQUFBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQU1BO0FBQUE7QUFBQTtBQUFBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFTQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSkE7QUFBQTtBQUFBO0FBTUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQVFBO0FBQ0E7QUFDQTtBQU9BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFVQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBS0E7QUFNQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQVNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBS0E7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBUUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUVBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBS0E7QUFLQTtBQU1BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFPQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUlBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQVdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFLQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFNQTtBQU1BO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQU1BO0FBTUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFFQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQVFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFNQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUhBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBSUE7QUFFQTtBQUlBO0FBQ0E7QUFFQTtBQUtBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBRUE7QUFLQTtBQUNBO0FBRUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU1BO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/LeafletPatched.js":
/*!*****************************************************!*\
  !*** ./packages/terriajs/lib/Map/LeafletPatched.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n// Function taken from Leaflet 1.0.1 (https://github.com/Leaflet/Leaflet/blob/v1.0.1/src/layer/vector/Canvas.js#L254-L267)\n// Leaflet 1.0.2 and later don't trigger click events for every Path, so feature selection only gives 1 result.\n// Updated to incorporate function changes up to v1.7.1\n_leaflet[\"default\"].Canvas.prototype._onClick = function (e) {\n  var point = this._map.mouseEventToLayerPoint(e);\n  var layers = [];\n  for (var order = this._drawFirst; order; order = order.next) {\n    var layer = order.layer;\n    if (layer.options.interactive && layer._containsPoint(point)) {\n      if (!(e.type === \"click\" || e.type !== \"preclick\") || !this._map._draggableMoved(layer)) {\n        layers.push(layer);\n      }\n    }\n  }\n  this._fireEvent(layers.length ? layers : false, e);\n};\nvar _default = exports[\"default\"] = _leaflet[\"default\"];//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL0xlYWZsZXRQYXRjaGVkLmpzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01hcC9MZWFmbGV0UGF0Y2hlZC5qcz85ZmRjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBMIGZyb20gXCJsZWFmbGV0XCI7XHJcblxyXG4vLyBGdW5jdGlvbiB0YWtlbiBmcm9tIExlYWZsZXQgMS4wLjEgKGh0dHBzOi8vZ2l0aHViLmNvbS9MZWFmbGV0L0xlYWZsZXQvYmxvYi92MS4wLjEvc3JjL2xheWVyL3ZlY3Rvci9DYW52YXMuanMjTDI1NC1MMjY3KVxyXG4vLyBMZWFmbGV0IDEuMC4yIGFuZCBsYXRlciBkb24ndCB0cmlnZ2VyIGNsaWNrIGV2ZW50cyBmb3IgZXZlcnkgUGF0aCwgc28gZmVhdHVyZSBzZWxlY3Rpb24gb25seSBnaXZlcyAxIHJlc3VsdC5cclxuLy8gVXBkYXRlZCB0byBpbmNvcnBvcmF0ZSBmdW5jdGlvbiBjaGFuZ2VzIHVwIHRvIHYxLjcuMVxyXG5MLkNhbnZhcy5wcm90b3R5cGUuX29uQ2xpY2sgPSBmdW5jdGlvbiAoZSkge1xyXG4gIGNvbnN0IHBvaW50ID0gdGhpcy5fbWFwLm1vdXNlRXZlbnRUb0xheWVyUG9pbnQoZSk7XHJcbiAgY29uc3QgbGF5ZXJzID0gW107XHJcbiAgZm9yIChsZXQgb3JkZXIgPSB0aGlzLl9kcmF3Rmlyc3Q7IG9yZGVyOyBvcmRlciA9IG9yZGVyLm5leHQpIHtcclxuICAgIGNvbnN0IGxheWVyID0gb3JkZXIubGF5ZXI7XHJcbiAgICBpZiAobGF5ZXIub3B0aW9ucy5pbnRlcmFjdGl2ZSAmJiBsYXllci5fY29udGFpbnNQb2ludChwb2ludCkpIHtcclxuICAgICAgaWYgKFxyXG4gICAgICAgICEoZS50eXBlID09PSBcImNsaWNrXCIgfHwgZS50eXBlICE9PSBcInByZWNsaWNrXCIpIHx8XHJcbiAgICAgICAgIXRoaXMuX21hcC5fZHJhZ2dhYmxlTW92ZWQobGF5ZXIpXHJcbiAgICAgICkge1xyXG4gICAgICAgIGxheWVycy5wdXNoKGxheWVyKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gIH1cclxuICB0aGlzLl9maXJlRXZlbnQobGF5ZXJzLmxlbmd0aCA/IGxheWVycyA6IGZhbHNlLCBlKTtcclxufTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IEw7XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBIiwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/LeafletPatched.js\n");

/***/ }),

/***/ "./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts":
/*!*********************************************************************!*\
  !*** ./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts ***!
  \*********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = rectangleToLatLngBounds;\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\n/**\r\n * Converts a Cesium Rectangle into a Leaflet LatLngBounds.\r\n * @param {Rectangle} rectangle The rectangle to convert.\r\n * @return {L.latLngBounds} The equivalent Leaflet latLngBounds.\r\n */\nfunction rectangleToLatLngBounds(rectangle) {\n  var west = _Math[\"default\"].toDegrees(rectangle.west);\n  var south = _Math[\"default\"].toDegrees(rectangle.south);\n  var east = _Math[\"default\"].toDegrees(rectangle.east);\n  var north = _Math[\"default\"].toDegrees(rectangle.north);\n  return _leaflet[\"default\"].latLngBounds([south, west], [north, east]);\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTWFwL1ZlY3Rvci9yZWN0YW5nbGVUb0xhdExuZ0JvdW5kcy50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9NYXAvVmVjdG9yL3JlY3RhbmdsZVRvTGF0TG5nQm91bmRzLnRzPzllOGQiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEwgZnJvbSBcImxlYWZsZXRcIjtcclxuaW1wb3J0IENlc2l1bU1hdGggZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9NYXRoXCI7XHJcbmltcG9ydCBSZWN0YW5nbGUgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9SZWN0YW5nbGVcIjtcclxuXHJcbi8qKlxyXG4gKiBDb252ZXJ0cyBhIENlc2l1bSBSZWN0YW5nbGUgaW50byBhIExlYWZsZXQgTGF0TG5nQm91bmRzLlxyXG4gKiBAcGFyYW0ge1JlY3RhbmdsZX0gcmVjdGFuZ2xlIFRoZSByZWN0YW5nbGUgdG8gY29udmVydC5cclxuICogQHJldHVybiB7TC5sYXRMbmdCb3VuZHN9IFRoZSBlcXVpdmFsZW50IExlYWZsZXQgbGF0TG5nQm91bmRzLlxyXG4gKi9cclxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmVjdGFuZ2xlVG9MYXRMbmdCb3VuZHMocmVjdGFuZ2xlOiBSZWN0YW5nbGUpIHtcclxuICB2YXIgd2VzdCA9IENlc2l1bU1hdGgudG9EZWdyZWVzKHJlY3RhbmdsZS53ZXN0KTtcclxuICB2YXIgc291dGggPSBDZXNpdW1NYXRoLnRvRGVncmVlcyhyZWN0YW5nbGUuc291dGgpO1xyXG4gIHZhciBlYXN0ID0gQ2VzaXVtTWF0aC50b0RlZ3JlZXMocmVjdGFuZ2xlLmVhc3QpO1xyXG4gIHZhciBub3J0aCA9IENlc2l1bU1hdGgudG9EZWdyZWVzKHJlY3RhbmdsZS5ub3J0aCk7XHJcbiAgcmV0dXJuIEwubGF0TG5nQm91bmRzKFtzb3V0aCwgd2VzdF0sIFtub3J0aCwgZWFzdF0pO1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBO0FBQ0E7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Models/Catalog/Esri/esriLineStyle.ts":
/*!********************************************************************!*\
  !*** ./packages/terriajs/lib/Models/Catalog/Esri/esriLineStyle.ts ***!
  \********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.getLineStyleCesium = getLineStyleCesium;\nexports.getLineStyleLeaflet = getLineStyleLeaflet;\nvar defaultDashArray = [4, 3];\nvar esriLineStyleCesium = {\n  esriSLSDot: 7,\n  //\"   -\"\n  esriSLSDashDot: 2017,\n  //\"   ----   -\"\n  esriSLSDashDotDot: 16273,\n  // '  --------   -   - '\n  esriSLSLongDash: 2047,\n  // '   --------'\n  esriSLSLongDashDot: 4081,\n  // '   --------   -'\n  esriSLSShortDash: 4095,\n  //' ----'\n  esriSLSShortDot: 13107,\n  //' ---- -'\n  esriSLSShortDashDot: 8179,\n  //' ---- - -'\n  esriSLSShortDashDotDot: 16281 //' - - - -'\n};\nvar esriLineStyleLealet = {\n  7: [1, 3],\n  2017: [4, 3, 1, 3],\n  16273: [8, 3, 1, 3, 1, 3],\n  2047: [8, 3],\n  4081: [8, 3, 1, 3],\n  4095: [4, 1],\n  13107: [1, 1],\n  8179: [4, 1, 1, 1],\n  16281: [4, 1, 1, 1, 1, 1]\n};\nfunction getLineStyleLeaflet(dashPattern) {\n  if (esriLineStyleLealet[dashPattern]) {\n    return esriLineStyleLealet[dashPattern];\n  }\n  return defaultDashArray;\n}\nfunction getLineStyleCesium(styleName) {\n  if (esriLineStyleCesium[styleName]) {\n    return esriLineStyleCesium[styleName];\n  }\n  return undefined;\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0NhdGFsb2cvRXNyaS9lc3JpTGluZVN0eWxlLnRzLmpzIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vcGFja2FnZXMvdGVycmlhanMvbGliL01vZGVscy9DYXRhbG9nL0VzcmkvZXNyaUxpbmVTdHlsZS50cz82ODFmIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGRlZmF1bHREYXNoQXJyYXkgPSBbNCwgM107XHJcblxyXG5jb25zdCBlc3JpTGluZVN0eWxlQ2VzaXVtOiB7XHJcbiAgW2tleTogc3RyaW5nXTogbnVtYmVyO1xyXG59ID0ge1xyXG4gIGVzcmlTTFNEb3Q6IDcsIC8vXCIgICAtXCJcclxuICBlc3JpU0xTRGFzaERvdDogMjAxNywgLy9cIiAgIC0tLS0gICAtXCJcclxuICBlc3JpU0xTRGFzaERvdERvdDogMTYyNzMsIC8vICcgIC0tLS0tLS0tICAgLSAgIC0gJ1xyXG4gIGVzcmlTTFNMb25nRGFzaDogMjA0NywgLy8gJyAgIC0tLS0tLS0tJ1xyXG4gIGVzcmlTTFNMb25nRGFzaERvdDogNDA4MSwgLy8gJyAgIC0tLS0tLS0tICAgLSdcclxuICBlc3JpU0xTU2hvcnREYXNoOiA0MDk1LCAvLycgLS0tLSdcclxuICBlc3JpU0xTU2hvcnREb3Q6IDEzMTA3LCAvLycgLS0tLSAtJ1xyXG4gIGVzcmlTTFNTaG9ydERhc2hEb3Q6IDgxNzksIC8vJyAtLS0tIC0gLSdcclxuICBlc3JpU0xTU2hvcnREYXNoRG90RG90OiAxNjI4MSAvLycgLSAtIC0gLSdcclxufTtcclxuXHJcbmNvbnN0IGVzcmlMaW5lU3R5bGVMZWFsZXQ6IHtcclxuICBba2V5OiBudW1iZXJdOiBudW1iZXJbXTtcclxufSA9IHtcclxuICA3OiBbMSwgM10sXHJcbiAgMjAxNzogWzQsIDMsIDEsIDNdLFxyXG4gIDE2MjczOiBbOCwgMywgMSwgMywgMSwgM10sXHJcbiAgMjA0NzogWzgsIDNdLFxyXG4gIDQwODE6IFs4LCAzLCAxLCAzXSxcclxuICA0MDk1OiBbNCwgMV0sXHJcbiAgMTMxMDc6IFsxLCAxXSxcclxuICA4MTc5OiBbNCwgMSwgMSwgMV0sXHJcbiAgMTYyODE6IFs0LCAxLCAxLCAxLCAxLCAxXVxyXG59O1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldExpbmVTdHlsZUxlYWZsZXQoZGFzaFBhdHRlcm46IG51bWJlcik6IG51bWJlcltdIHtcclxuICBpZiAoZXNyaUxpbmVTdHlsZUxlYWxldFtkYXNoUGF0dGVybl0pIHtcclxuICAgIHJldHVybiBlc3JpTGluZVN0eWxlTGVhbGV0W2Rhc2hQYXR0ZXJuXTtcclxuICB9XHJcbiAgcmV0dXJuIGRlZmF1bHREYXNoQXJyYXk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRMaW5lU3R5bGVDZXNpdW0oc3R5bGVOYW1lOiBzdHJpbmcpIHtcclxuICBpZiAoZXNyaUxpbmVTdHlsZUNlc2l1bVtzdHlsZU5hbWVdKSB7XHJcbiAgICByZXR1cm4gZXNyaUxpbmVTdHlsZUNlc2l1bVtzdHlsZU5hbWVdO1xyXG4gIH1cclxuICByZXR1cm4gdW5kZWZpbmVkO1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBQTtBQUVBO0FBR0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFDQTtBQUNBO0FBRUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Models/Catalog/Esri/esriLineStyle.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Models/Leaflet.ts":
/*!*************************************************!*\
  !*** ./packages/terriajs/lib/Models/Leaflet.ts ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.async-iterator.js */ \"./node_modules/core-js/modules/es.symbol.async-iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-string-tag.js */ \"./node_modules/core-js/modules/es.symbol.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.array.from.js */ \"./node_modules/core-js/modules/es.array.from.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"./node_modules/core-js/modules/es.array.slice.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-string.js */ \"./node_modules/core-js/modules/es.date.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.json.to-string-tag.js */ \"./node_modules/core-js/modules/es.json.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.math.to-string-tag.js */ \"./node_modules/core-js/modules/es.math.to-string-tag.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.regexp.to-string.js */ \"./node_modules/core-js/modules/es.regexp.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.weak-map.js */ \"./node_modules/core-js/modules/es.weak-map.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports[\"default\"] = void 0;\n__webpack_require__(/*! core-js/modules/es.array.concat.js */ \"./node_modules/core-js/modules/es.array.concat.js\");\n__webpack_require__(/*! core-js/modules/es.array.filter.js */ \"./node_modules/core-js/modules/es.array.filter.js\");\n__webpack_require__(/*! core-js/modules/es.array.find-index.js */ \"./node_modules/core-js/modules/es.array.find-index.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.index-of.js */ \"./node_modules/core-js/modules/es.array.index-of.js\");\n__webpack_require__(/*! core-js/modules/es.array.is-array.js */ \"./node_modules/core-js/modules/es.array.is-array.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.join.js */ \"./node_modules/core-js/modules/es.array.join.js\");\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\n__webpack_require__(/*! core-js/modules/es.array.reduce.js */ \"./node_modules/core-js/modules/es.array.reduce.js\");\n__webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n__webpack_require__(/*! core-js/modules/es.array.sort.js */ \"./node_modules/core-js/modules/es.array.sort.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.function.name.js */ \"./node_modules/core-js/modules/es.function.name.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.promise.js */ \"./node_modules/core-js/modules/es.promise.js\");\n__webpack_require__(/*! core-js/modules/es.promise.finally.js */ \"./node_modules/core-js/modules/es.promise.finally.js\");\n__webpack_require__(/*! core-js/modules/es.regexp.exec.js */ \"./node_modules/core-js/modules/es.regexp.exec.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.string.replace.js */ \"./node_modules/core-js/modules/es.string.replace.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.timers.js */ \"./node_modules/core-js/modules/web.timers.js\");\nvar _mobx = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\nvar _mobxUtils = __webpack_require__(/*! mobx-utils */ \"./node_modules/mobx-utils/mobx-utils.module.js\");\nvar _cancelAnimationFrame = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/cancelAnimationFrame */ \"./node_modules/terriajs-cesium/Source/Core/cancelAnimationFrame.js\"));\nvar _Cartesian = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartesian2 */ \"./node_modules/terriajs-cesium/Source/Core/Cartesian2.js\"));\nvar _Cartographic = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Cartographic */ \"./node_modules/terriajs-cesium/Source/Core/Cartographic.js\"));\nvar _defaultValue = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/defaultValue */ \"./node_modules/terriajs-cesium/Source/Core/defaultValue.js\"));\nvar _Ellipsoid = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Ellipsoid */ \"./node_modules/terriajs-cesium/Source/Core/Ellipsoid.js\"));\nvar _EventHelper = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/EventHelper */ \"./node_modules/terriajs-cesium/Source/Core/EventHelper.js\"));\nvar _Math = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Math */ \"./node_modules/terriajs-cesium/Source/Core/Math.js\"));\nvar _Rectangle = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/Rectangle */ \"./node_modules/terriajs-cesium/Source/Core/Rectangle.js\"));\nvar _requestAnimationFrame = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Core/requestAnimationFrame */ \"./node_modules/terriajs-cesium/Source/Core/requestAnimationFrame.js\"));\nvar _DataSource = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/DataSource */ \"./node_modules/terriajs-cesium/Source/DataSources/DataSource.js\"));\nvar _DataSourceCollection = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/DataSources/DataSourceCollection */ \"./node_modules/terriajs-cesium/Source/DataSources/DataSourceCollection.js\"));\nvar _SplitDirection = _interopRequireDefault(__webpack_require__(/*! terriajs-cesium/Source/Scene/SplitDirection */ \"./node_modules/terriajs-cesium/Source/Scene/SplitDirection.js\"));\nvar _terriajsHtml2canvas = _interopRequireDefault(__webpack_require__(/*! terriajs-html2canvas */ \"./node_modules/terriajs-html2canvas/dist/npm/index.js\"));\nvar _filterOutUndefined = _interopRequireDefault(__webpack_require__(/*! ../Core/filterOutUndefined */ \"./packages/terriajs/lib/Core/filterOutUndefined.ts\"));\nvar _isDefined = _interopRequireDefault(__webpack_require__(/*! ../Core/isDefined */ \"./packages/terriajs/lib/Core/isDefined.ts\"));\nvar _runLater = _interopRequireDefault(__webpack_require__(/*! ../Core/runLater */ \"./packages/terriajs/lib/Core/runLater.ts\"));\nvar _ImageryProviderLeafletGridLayer = _interopRequireWildcard(__webpack_require__(/*! ../Map/Leaflet/ImageryProviderLeafletGridLayer */ \"./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletGridLayer.ts\"));\nvar _ImageryProviderLeafletTileLayer = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/ImageryProviderLeafletTileLayer */ \"./packages/terriajs/lib/Map/Leaflet/ImageryProviderLeafletTileLayer.ts\"));\nvar _LeafletDataSourceDisplay = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/LeafletDataSourceDisplay */ \"./packages/terriajs/lib/Map/Leaflet/LeafletDataSourceDisplay.ts\"));\nvar _LeafletScene = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/LeafletScene */ \"./packages/terriajs/lib/Map/Leaflet/LeafletScene.ts\"));\nvar _LeafletSelectionIndicator = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/LeafletSelectionIndicator */ \"./packages/terriajs/lib/Map/Leaflet/LeafletSelectionIndicator.ts\"));\nvar _LeafletVisualizer = _interopRequireDefault(__webpack_require__(/*! ../Map/Leaflet/LeafletVisualizer */ \"./packages/terriajs/lib/Map/Leaflet/LeafletVisualizer.ts\"));\nvar _LeafletPatched = _interopRequireDefault(__webpack_require__(/*! ../Map/LeafletPatched */ \"./packages/terriajs/lib/Map/LeafletPatched.js\"));\nvar _PickedFeatures = _interopRequireDefault(__webpack_require__(/*! ../Map/PickedFeatures/PickedFeatures */ \"./packages/terriajs/lib/Map/PickedFeatures/PickedFeatures.ts\"));\nvar _rectangleToLatLngBounds = _interopRequireDefault(__webpack_require__(/*! ../Map/Vector/rectangleToLatLngBounds */ \"./packages/terriajs/lib/Map/Vector/rectangleToLatLngBounds.ts\"));\nvar _FeatureInfoUrlTemplateMixin = _interopRequireDefault(__webpack_require__(/*! ../ModelMixins/FeatureInfoUrlTemplateMixin */ \"./packages/terriajs/lib/ModelMixins/FeatureInfoUrlTemplateMixin.ts\"));\nvar _MappableMixin = _interopRequireWildcard(__webpack_require__(/*! ../ModelMixins/MappableMixin */ \"./packages/terriajs/lib/ModelMixins/MappableMixin.ts\"));\nvar _TileErrorHandlerMixin = _interopRequireDefault(__webpack_require__(/*! ../ModelMixins/TileErrorHandlerMixin */ \"./packages/terriajs/lib/ModelMixins/TileErrorHandlerMixin.ts\"));\nvar _ImageryProviderTraits = _interopRequireDefault(__webpack_require__(/*! ../Traits/TraitsClasses/ImageryProviderTraits */ \"./packages/terriajs/lib/Traits/TraitsClasses/ImageryProviderTraits.ts\"));\nvar _SplitterTraits = _interopRequireDefault(__webpack_require__(/*! ../Traits/TraitsClasses/SplitterTraits */ \"./packages/terriajs/lib/Traits/TraitsClasses/SplitterTraits.ts\"));\nvar _CameraView = _interopRequireDefault(__webpack_require__(/*! ./CameraView */ \"./packages/terriajs/lib/Models/CameraView.ts\"));\nvar _hasTraits = _interopRequireDefault(__webpack_require__(/*! ./Definition/hasTraits */ \"./packages/terriajs/lib/Models/Definition/hasTraits.ts\"));\nvar _Feature = _interopRequireDefault(__webpack_require__(/*! ./Feature/Feature */ \"./packages/terriajs/lib/Models/Feature/Feature.ts\"));\nvar _GlobeOrMap2 = _interopRequireDefault(__webpack_require__(/*! ./GlobeOrMap */ \"./packages/terriajs/lib/Models/GlobeOrMap.ts\"));\nvar _LeafletAttribution = __webpack_require__(/*! ./LeafletAttribution */ \"./packages/terriajs/lib/Models/LeafletAttribution.ts\");\nvar _class, _descriptor, _descriptor2, _descriptor3;\nfunction _getRequireWildcardCache(e) { if (\"function\" != typeof WeakMap) return null; var r = new WeakMap(), t = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(e) { return e ? t : r; })(e); }\nfunction _interopRequireWildcard(e, r) { if (!r && e && e.__esModule) return e; if (null === e || \"object\" != _typeof(e) && \"function\" != typeof e) return { \"default\": e }; var t = _getRequireWildcardCache(r); if (t && t.has(e)) return t.get(e); var n = { __proto__: null }, a = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var u in e) if (\"default\" !== u && Object.prototype.hasOwnProperty.call(e, u)) { var i = a ? Object.getOwnPropertyDescriptor(e, u) : null; i && (i.get || i.set) ? Object.defineProperty(n, u, i) : n[u] = e[u]; } return n[\"default\"] = e, t && t.set(e, n), n; }\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _createForOfIteratorHelper(o, allowArrayLike) { var it = typeof Symbol !== \"undefined\" && o[Symbol.iterator] || o[\"@@iterator\"]; if (!it) { if (Array.isArray(o) || (it = _unsupportedIterableToArray(o)) || allowArrayLike && o && typeof o.length === \"number\") { if (it) o = it; var i = 0; var F = function F() {}; return { s: F, n: function n() { if (i >= o.length) return { done: true }; return { done: false, value: o[i++] }; }, e: function e(_e) { throw _e; }, f: F }; } throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); } var normalCompletion = true, didErr = false, err; return { s: function s() { it = it.call(o); }, n: function n() { var step = it.next(); normalCompletion = step.done; return step; }, e: function e(_e2) { didErr = true; err = _e2; }, f: function f() { try { if (!normalCompletion && it[\"return\"] != null) it[\"return\"](); } finally { if (didErr) throw err; } } }; }\nfunction _regeneratorRuntime() { \"use strict\"; /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */ _regeneratorRuntime = function _regeneratorRuntime() { return e; }; var t, e = {}, r = Object.prototype, n = r.hasOwnProperty, o = Object.defineProperty || function (t, e, r) { t[e] = r.value; }, i = \"function\" == typeof Symbol ? Symbol : {}, a = i.iterator || \"@@iterator\", c = i.asyncIterator || \"@@asyncIterator\", u = i.toStringTag || \"@@toStringTag\"; function define(t, e, r) { return Object.defineProperty(t, e, { value: r, enumerable: !0, configurable: !0, writable: !0 }), t[e]; } try { define({}, \"\"); } catch (t) { define = function define(t, e, r) { return t[e] = r; }; } function wrap(t, e, r, n) { var i = e && e.prototype instanceof Generator ? e : Generator, a = Object.create(i.prototype), c = new Context(n || []); return o(a, \"_invoke\", { value: makeInvokeMethod(t, r, c) }), a; } function tryCatch(t, e, r) { try { return { type: \"normal\", arg: t.call(e, r) }; } catch (t) { return { type: \"throw\", arg: t }; } } e.wrap = wrap; var h = \"suspendedStart\", l = \"suspendedYield\", f = \"executing\", s = \"completed\", y = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} var p = {}; define(p, a, function () { return this; }); var d = Object.getPrototypeOf, v = d && d(d(values([]))); v && v !== r && n.call(v, a) && (p = v); var g = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(p); function defineIteratorMethods(t) { [\"next\", \"throw\", \"return\"].forEach(function (e) { define(t, e, function (t) { return this._invoke(e, t); }); }); } function AsyncIterator(t, e) { function invoke(r, o, i, a) { var c = tryCatch(t[r], t, o); if (\"throw\" !== c.type) { var u = c.arg, h = u.value; return h && \"object\" == _typeof(h) && n.call(h, \"__await\") ? e.resolve(h.__await).then(function (t) { invoke(\"next\", t, i, a); }, function (t) { invoke(\"throw\", t, i, a); }) : e.resolve(h).then(function (t) { u.value = t, i(u); }, function (t) { return invoke(\"throw\", t, i, a); }); } a(c.arg); } var r; o(this, \"_invoke\", { value: function value(t, n) { function callInvokeWithMethodAndArg() { return new e(function (e, r) { invoke(t, n, e, r); }); } return r = r ? r.then(callInvokeWithMethodAndArg, callInvokeWithMethodAndArg) : callInvokeWithMethodAndArg(); } }); } function makeInvokeMethod(e, r, n) { var o = h; return function (i, a) { if (o === f) throw new Error(\"Generator is already running\"); if (o === s) { if (\"throw\" === i) throw a; return { value: t, done: !0 }; } for (n.method = i, n.arg = a;;) { var c = n.delegate; if (c) { var u = maybeInvokeDelegate(c, n); if (u) { if (u === y) continue; return u; } } if (\"next\" === n.method) n.sent = n._sent = n.arg;else if (\"throw\" === n.method) { if (o === h) throw o = s, n.arg; n.dispatchException(n.arg); } else \"return\" === n.method && n.abrupt(\"return\", n.arg); o = f; var p = tryCatch(e, r, n); if (\"normal\" === p.type) { if (o = n.done ? s : l, p.arg === y) continue; return { value: p.arg, done: n.done }; } \"throw\" === p.type && (o = s, n.method = \"throw\", n.arg = p.arg); } }; } function maybeInvokeDelegate(e, r) { var n = r.method, o = e.iterator[n]; if (o === t) return r.delegate = null, \"throw\" === n && e.iterator[\"return\"] && (r.method = \"return\", r.arg = t, maybeInvokeDelegate(e, r), \"throw\" === r.method) || \"return\" !== n && (r.method = \"throw\", r.arg = new TypeError(\"The iterator does not provide a '\" + n + \"' method\")), y; var i = tryCatch(o, e.iterator, r.arg); if (\"throw\" === i.type) return r.method = \"throw\", r.arg = i.arg, r.delegate = null, y; var a = i.arg; return a ? a.done ? (r[e.resultName] = a.value, r.next = e.nextLoc, \"return\" !== r.method && (r.method = \"next\", r.arg = t), r.delegate = null, y) : a : (r.method = \"throw\", r.arg = new TypeError(\"iterator result is not an object\"), r.delegate = null, y); } function pushTryEntry(t) { var e = { tryLoc: t[0] }; 1 in t && (e.catchLoc = t[1]), 2 in t && (e.finallyLoc = t[2], e.afterLoc = t[3]), this.tryEntries.push(e); } function resetTryEntry(t) { var e = t.completion || {}; e.type = \"normal\", delete e.arg, t.completion = e; } function Context(t) { this.tryEntries = [{ tryLoc: \"root\" }], t.forEach(pushTryEntry, this), this.reset(!0); } function values(e) { if (e || \"\" === e) { var r = e[a]; if (r) return r.call(e); if (\"function\" == typeof e.next) return e; if (!isNaN(e.length)) { var o = -1, i = function next() { for (; ++o < e.length;) if (n.call(e, o)) return next.value = e[o], next.done = !1, next; return next.value = t, next.done = !0, next; }; return i.next = i; } } throw new TypeError(_typeof(e) + \" is not iterable\"); } return GeneratorFunction.prototype = GeneratorFunctionPrototype, o(g, \"constructor\", { value: GeneratorFunctionPrototype, configurable: !0 }), o(GeneratorFunctionPrototype, \"constructor\", { value: GeneratorFunction, configurable: !0 }), GeneratorFunction.displayName = define(GeneratorFunctionPrototype, u, \"GeneratorFunction\"), e.isGeneratorFunction = function (t) { var e = \"function\" == typeof t && t.constructor; return !!e && (e === GeneratorFunction || \"GeneratorFunction\" === (e.displayName || e.name)); }, e.mark = function (t) { return Object.setPrototypeOf ? Object.setPrototypeOf(t, GeneratorFunctionPrototype) : (t.__proto__ = GeneratorFunctionPrototype, define(t, u, \"GeneratorFunction\")), t.prototype = Object.create(g), t; }, e.awrap = function (t) { return { __await: t }; }, defineIteratorMethods(AsyncIterator.prototype), define(AsyncIterator.prototype, c, function () { return this; }), e.AsyncIterator = AsyncIterator, e.async = function (t, r, n, o, i) { void 0 === i && (i = Promise); var a = new AsyncIterator(wrap(t, r, n, o), i); return e.isGeneratorFunction(r) ? a : a.next().then(function (t) { return t.done ? t.value : a.next(); }); }, defineIteratorMethods(g), define(g, u, \"Generator\"), define(g, a, function () { return this; }), define(g, \"toString\", function () { return \"[object Generator]\"; }), e.keys = function (t) { var e = Object(t), r = []; for (var n in e) r.push(n); return r.reverse(), function next() { for (; r.length;) { var t = r.pop(); if (t in e) return next.value = t, next.done = !1, next; } return next.done = !0, next; }; }, e.values = values, Context.prototype = { constructor: Context, reset: function reset(e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = t, this.done = !1, this.delegate = null, this.method = \"next\", this.arg = t, this.tryEntries.forEach(resetTryEntry), !e) for (var r in this) \"t\" === r.charAt(0) && n.call(this, r) && !isNaN(+r.slice(1)) && (this[r] = t); }, stop: function stop() { this.done = !0; var t = this.tryEntries[0].completion; if (\"throw\" === t.type) throw t.arg; return this.rval; }, dispatchException: function dispatchException(e) { if (this.done) throw e; var r = this; function handle(n, o) { return a.type = \"throw\", a.arg = e, r.next = n, o && (r.method = \"next\", r.arg = t), !!o; } for (var o = this.tryEntries.length - 1; o >= 0; --o) { var i = this.tryEntries[o], a = i.completion; if (\"root\" === i.tryLoc) return handle(\"end\"); if (i.tryLoc <= this.prev) { var c = n.call(i, \"catchLoc\"), u = n.call(i, \"finallyLoc\"); if (c && u) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } else if (c) { if (this.prev < i.catchLoc) return handle(i.catchLoc, !0); } else { if (!u) throw new Error(\"try statement without catch or finally\"); if (this.prev < i.finallyLoc) return handle(i.finallyLoc); } } } }, abrupt: function abrupt(t, e) { for (var r = this.tryEntries.length - 1; r >= 0; --r) { var o = this.tryEntries[r]; if (o.tryLoc <= this.prev && n.call(o, \"finallyLoc\") && this.prev < o.finallyLoc) { var i = o; break; } } i && (\"break\" === t || \"continue\" === t) && i.tryLoc <= e && e <= i.finallyLoc && (i = null); var a = i ? i.completion : {}; return a.type = t, a.arg = e, i ? (this.method = \"next\", this.next = i.finallyLoc, y) : this.complete(a); }, complete: function complete(t, e) { if (\"throw\" === t.type) throw t.arg; return \"break\" === t.type || \"continue\" === t.type ? this.next = t.arg : \"return\" === t.type ? (this.rval = this.arg = t.arg, this.method = \"return\", this.next = \"end\") : \"normal\" === t.type && e && (this.next = e), y; }, finish: function finish(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.finallyLoc === t) return this.complete(r.completion, r.afterLoc), resetTryEntry(r), y; } }, \"catch\": function _catch(t) { for (var e = this.tryEntries.length - 1; e >= 0; --e) { var r = this.tryEntries[e]; if (r.tryLoc === t) { var n = r.completion; if (\"throw\" === n.type) { var o = n.arg; resetTryEntry(r); } return o; } } throw new Error(\"illegal catch attempt\"); }, delegateYield: function delegateYield(e, r, n) { return this.delegate = { iterator: values(e), resultName: r, nextLoc: n }, \"next\" === this.method && (this.arg = t), y; } }, e; }\nfunction asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }\nfunction _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"next\", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, \"throw\", err); } _next(undefined); }); }; }\nfunction _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread(); }\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\"); }\nfunction _unsupportedIterableToArray(o, minLen) { if (!o) return; if (typeof o === \"string\") return _arrayLikeToArray(o, minLen); var n = Object.prototype.toString.call(o).slice(8, -1); if (n === \"Object\" && o.constructor) n = o.constructor.name; if (n === \"Map\" || n === \"Set\") return Array.from(o); if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen); }\nfunction _iterableToArray(iter) { if (typeof Symbol !== \"undefined\" && iter[Symbol.iterator] != null || iter[\"@@iterator\"] != null) return Array.from(iter); }\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) return _arrayLikeToArray(arr); }\nfunction _arrayLikeToArray(arr, len) { if (len == null || len > arr.length) len = arr.length; for (var i = 0, arr2 = new Array(len); i < len; i++) arr2[i] = arr[i]; return arr2; }\nfunction _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }\nfunction _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'transform-class-properties is enabled and runs after the decorators transform.'); }\n// We want TS to look at the type declared in lib/ThirdParty/terriajs-cesium-extra/index.d.ts\n// and import doesn't allows us to do that, so instead we use require + type casting to ensure\n// we still maintain the type checking, without TS screaming with errors\nvar FeatureDetection = __webpack_require__(/*! terriajs-cesium/Source/Core/FeatureDetection */ \"./node_modules/terriajs-cesium/Source/Core/FeatureDetection.js\")[\"default\"];\n\n// This class is an observer. It probably won't contain any observables itself\nvar Leaflet = exports[\"default\"] = (_class = /*#__PURE__*/function (_GlobeOrMap) {\n  _inherits(Leaflet, _GlobeOrMap);\n  function Leaflet(terriaViewer, container) {\n    var _this;\n    _classCallCheck(this, Leaflet);\n    _this = _callSuper(this, Leaflet);\n    _defineProperty(_assertThisInitialized(_this), \"type\", \"Leaflet\");\n    _defineProperty(_assertThisInitialized(_this), \"terria\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"terriaViewer\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"map\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"scene\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"dataSources\", new _DataSourceCollection[\"default\"]());\n    _defineProperty(_assertThisInitialized(_this), \"dataSourceDisplay\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"canShowSplitter\", true);\n    _defineProperty(_assertThisInitialized(_this), \"_attributionControl\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_leafletVisualizer\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_eventHelper\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_selectionIndicator\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_stopRequestAnimationFrame\", false);\n    _defineProperty(_assertThisInitialized(_this), \"_cesiumReqAnimFrameId\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_pickedFeatures\", undefined);\n    _defineProperty(_assertThisInitialized(_this), \"_pauseMapInteractionCount\", 0);\n    /* Disposers */\n    _defineProperty(_assertThisInitialized(_this), \"_disposeWorkbenchMapItemsSubscription\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_disposeDisableInteractionSubscription\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_disposeSelectedFeatureSubscription\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_disposeSplitterReaction\", void 0);\n    // These are used to split CesiumTileLayer and MapboxCanvasVectorTileLayer\n    _initializerDefineProperty(_assertThisInitialized(_this), \"size\", _descriptor, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"nw\", _descriptor2, _assertThisInitialized(_this));\n    _initializerDefineProperty(_assertThisInitialized(_this), \"se\", _descriptor3, _assertThisInitialized(_this));\n    _defineProperty(_assertThisInitialized(_this), \"_createImageryLayer\", (0, _mobxUtils.computedFn)(function (ip, clippingRectangle) {\n      var layerOptions = {\n        bounds: clippingRectangle && (0, _rectangleToLatLngBounds[\"default\"])(clippingRectangle)\n      };\n      // We have two different kinds of ImageryProviderLeaflet layers\n      // - Grid layer will use the ImageryProvider in the more traditional way - calling `requestImage` to draw the image on to a canvas\n      // - Tile layer will pass tile URLs to leaflet objects - which is a bit more \"Leaflety\" than Grid layer\n      // Tile layer is preferred. Grid layer mainly exists for custom Imagery Providers which aren't just a tile of image URLs\n      if ((0, _ImageryProviderLeafletGridLayer.isImageryProviderGridLayer)(ip)) {\n        return new _ImageryProviderLeafletGridLayer[\"default\"](_assertThisInitialized(_this), ip, layerOptions);\n      } else {\n        return new _ImageryProviderLeafletTileLayer[\"default\"](_assertThisInitialized(_this), ip, layerOptions);\n      }\n    }));\n    (0, _mobx.makeObservable)(_assertThisInitialized(_this));\n    _this.terria = terriaViewer.terria;\n    _this.terriaViewer = terriaViewer;\n    _this.map = _LeafletPatched[\"default\"].map(container, {\n      zoomControl: false,\n      attributionControl: false,\n      zoomSnap: 1,\n      // Change to  0.2 for incremental zoom when Chrome fixes canvas scaling gaps\n      preferCanvas: true,\n      worldCopyJump: false\n    }).setView([-28.5, 135], 5);\n    _this.map.on(\"move\", function () {\n      return _this.updateMapObservables();\n    });\n    _this.map.on(\"zoom\", function () {\n      return _this.updateMapObservables();\n    });\n    _this.scene = new _LeafletScene[\"default\"](_this.map);\n    _this._attributionControl = new _LeafletAttribution.LeafletAttribution(_this.terria);\n    _this.map.addControl(_this._attributionControl);\n    _this._leafletVisualizer = new _LeafletVisualizer[\"default\"]();\n    _this._selectionIndicator = new _LeafletSelectionIndicator[\"default\"](_assertThisInitialized(_this));\n    _this.dataSourceDisplay = new _LeafletDataSourceDisplay[\"default\"]({\n      scene: _this.scene,\n      dataSourceCollection: _this.dataSources,\n      visualizersCallback: _this._leafletVisualizer.visualizersCallback // TODO: fix type error\n    });\n    _this._eventHelper = new _EventHelper[\"default\"]();\n    _this._eventHelper.add(_this.terria.timelineClock.onTick, function (clock) {\n      _this.dataSourceDisplay.update(clock.currentTime);\n    });\n    var ticker = function ticker() {\n      if (!_this._stopRequestAnimationFrame) {\n        _this.terria.timelineClock.tick();\n        _this._cesiumReqAnimFrameId = (0, _requestAnimationFrame[\"default\"])(ticker);\n      }\n    };\n\n    // Start ticker asynchronously to avoid calling an action in the consctructor\n    (0, _runLater[\"default\"])(ticker);\n    _this._disposeWorkbenchMapItemsSubscription = _this.observeModelLayer();\n    _this._disposeSplitterReaction = _this._reactToSplitterChanges();\n    _this._disposeDisableInteractionSubscription = (0, _mobx.autorun)(function () {\n      var map = _this.map;\n      var interactions = (0, _filterOutUndefined[\"default\"])([map.touchZoom, map.doubleClickZoom, map.scrollWheelZoom, map.boxZoom, map.keyboard, map.dragging, map.tap]);\n      var pickLocation = _this.pickLocation.bind(_assertThisInitialized(_this));\n      var pickFeature = function pickFeature(entity, event) {\n        _this._featurePicked(entity, event);\n      };\n\n      // Update mouse coords on mouse move\n      _this.map.on(\"mousemove\", function (e) {\n        var mouseEvent = e;\n        _this.mouseCoords.updateCoordinatesFromLeaflet(_this.terria, mouseEvent.originalEvent);\n      });\n      if (_this.terriaViewer.disableInteraction) {\n        interactions.forEach(function (handler) {\n          return handler.disable();\n        });\n        _this.map.off(\"click\", pickLocation);\n        _this.scene.featureClicked.removeEventListener(pickFeature);\n        _this._disposeSelectedFeatureSubscription && _this._disposeSelectedFeatureSubscription();\n      } else {\n        interactions.forEach(function (handler) {\n          return handler.enable();\n        });\n        _this.map.on(\"click\", pickLocation);\n        _this.scene.featureClicked.addEventListener(pickFeature);\n        _this._disposeSelectedFeatureSubscription = (0, _mobx.autorun)(function () {\n          var feature = _this.terria.selectedFeature;\n          _this._selectFeature(feature);\n        });\n      }\n    });\n    _this._initProgressEvent();\n    return _this;\n  }\n  _createClass(Leaflet, [{\n    key: \"updateMapObservables\",\n    value: function updateMapObservables() {\n      this.size = this.map.getSize();\n      this.nw = this.map.containerPointToLayerPoint([0, 0]);\n      this.se = this.map.containerPointToLayerPoint(this.size);\n    }\n  }, {\n    key: \"_makeImageryLayerFromParts\",\n    value: function _makeImageryLayerFromParts(parts, item) {\n      if (_TileErrorHandlerMixin[\"default\"].isMixedInto(item)) {\n        // because this code path can run multiple times, make sure we remove the\n        // handler if it is already registered\n        parts.imageryProvider.errorEvent.removeEventListener(item.onTileLoadError, item);\n        parts.imageryProvider.errorEvent.addEventListener(item.onTileLoadError, item);\n      }\n      return this._createImageryLayer(parts.imageryProvider, parts.clippingRectangle);\n    }\n  }, {\n    key: \"attributionPrefix\",\n    get: function get() {\n      return this._attributionControl.prefix;\n    }\n  }, {\n    key: \"attributions\",\n    get: function get() {\n      return this._attributionControl.dataAttributions;\n    }\n\n    /**\r\n     * sets up loading listeners\r\n     */\n  }, {\n    key: \"_initProgressEvent\",\n    value: function _initProgressEvent() {\n      var _this2 = this;\n      var onTileLoadChange = function onTileLoadChange() {\n        var tilesLoadingCount = 0;\n        _this2.map.eachLayer(function (layerOrGridlayer) {\n          // _tiles is protected but our knockout-loading-logic accesses it here anyway\n          var layer = layerOrGridlayer;\n          if (layer !== null && layer !== void 0 && layer._tiles) {\n            // Count all tiles not marked as loaded\n            tilesLoadingCount += Object.keys(layer._tiles).filter(function (key) {\n              return !layer._tiles[key].loaded;\n            }).length;\n          }\n        });\n        _this2._updateTilesLoadingCount(tilesLoadingCount);\n      };\n      this.map.on(\"layeradd\", function (evt) {\n        // This check makes sure we only watch tile layers, and also protects us if this private variable gets changed.\n        if (typeof evt.layer._tiles !== \"undefined\") {\n          evt.layer.on(\"tileloadstart tileload load\", onTileLoadChange);\n        }\n      }.bind(this));\n      this.map.on(\"layerremove\", function (evt) {\n        evt.layer.off(\"tileloadstart tileload load\", onTileLoadChange);\n      }.bind(this));\n    }\n\n    /**\r\n     * Pick feature from mouse click event.\r\n     */\n  }, {\n    key: \"pickLocation\",\n    value: function pickLocation(e) {\n      var mouseEvent = e;\n\n      // Handle click events that cross the anti-meridian\n      if (mouseEvent.latlng.lng > 180 || mouseEvent.latlng.lng < -180) {\n        mouseEvent.latlng = mouseEvent.latlng.wrap();\n      }\n\n      // if (!this._dragboxcompleted && that.map.dragging.enabled()) {\n      this._pickFeatures(mouseEvent.latlng);\n      // }\n      // this._dragboxcompleted = false;\n    }\n  }, {\n    key: \"getContainer\",\n    value: function getContainer() {\n      return this.map.getContainer();\n    }\n  }, {\n    key: \"pauseMapInteraction\",\n    value: function pauseMapInteraction() {\n      ++this._pauseMapInteractionCount;\n      if (this._pauseMapInteractionCount === 1) {\n        this.map.dragging.disable();\n      }\n    }\n  }, {\n    key: \"resumeMapInteraction\",\n    value: function resumeMapInteraction() {\n      var _this3 = this;\n      --this._pauseMapInteractionCount;\n      if (this._pauseMapInteractionCount === 0) {\n        setTimeout(function () {\n          if (_this3._pauseMapInteractionCount === 0) {\n            _this3.map.dragging.enable();\n          }\n        }, 0);\n      }\n    }\n  }, {\n    key: \"destroy\",\n    value: function destroy() {\n      this._disposeSelectedFeatureSubscription && this._disposeSelectedFeatureSubscription();\n      this._disposeSplitterReaction();\n      this._disposeWorkbenchMapItemsSubscription();\n      this._eventHelper.removeAll();\n      this._disposeDisableInteractionSubscription();\n      // This variable prevents a race condition if destroy() is called\n      // synchronously as a result of timelineClock ticking due to ticker()\n      this._stopRequestAnimationFrame = true;\n      if ((0, _isDefined[\"default\"])(this._cesiumReqAnimFrameId)) {\n        (0, _cancelAnimationFrame[\"default\"])(this._cesiumReqAnimFrameId);\n      }\n      this.dataSourceDisplay.destroy();\n      this.map.off(\"move\");\n      this.map.off(\"zoom\");\n      this.map.remove();\n    }\n  }, {\n    key: \"availableCatalogItems\",\n    get: function get() {\n      var catalogItems = [].concat(_toConsumableArray(this.terriaViewer.items.get()), [this.terriaViewer.baseMap]);\n      return catalogItems;\n    }\n  }, {\n    key: \"availableDataSources\",\n    get: function get() {\n      var _ref;\n      var catalogItems = this.availableCatalogItems;\n      /* Handle datasources */\n      var allMapItems = (_ref = []).concat.apply(_ref, _toConsumableArray(catalogItems.filter(_isDefined[\"default\"]).map(function (item) {\n        return item.mapItems;\n      })));\n      var dataSources = allMapItems.filter(isDataSource);\n      return dataSources;\n    }\n  }, {\n    key: \"observeModelLayer\",\n    value: function observeModelLayer() {\n      var _this4 = this;\n      // Setup reaction to sync datSources collection with availableDataSources\n      //\n      // To avoid buggy concurrent syncs, we have to ensure that even when\n      // multiple sync reactions are triggered, we run them one after the\n      // other. To do this, we make each run of the reaction wait for the\n      // previous `syncDataSourcesPromise` to finish before starting itself.\n      var syncDataSourcesPromise = Promise.resolve();\n      var dataSourcesReactionDisposer = (0, _mobx.reaction)(function () {\n        return _this4.availableDataSources;\n      }, function () {\n        syncDataSourcesPromise = syncDataSourcesPromise.then( /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee() {\n          return _regeneratorRuntime().wrap(function _callee$(_context) {\n            while (1) switch (_context.prev = _context.next) {\n              case 0:\n                _context.next = 2;\n                return _this4.syncDataSourceCollection(_this4.availableDataSources, _this4.dataSources);\n              case 2:\n                _this4.notifyRepaintRequired();\n              case 3:\n              case \"end\":\n                return _context.stop();\n            }\n          }, _callee);\n        })))[\"catch\"](console.error);\n      }, {\n        fireImmediately: true\n      });\n\n      // Reaction to sync imagery from model layer with cesium map\n      var imageryReactionDisposer = (0, _mobx.autorun)(function () {\n        var _ref3;\n        var catalogItems = _this4.availableCatalogItems;\n        // Flatmap\n        var allImageryMapItems = (_ref3 = []).concat.apply(_ref3, _toConsumableArray(catalogItems.filter(_isDefined[\"default\"]).map(function (item) {\n          return item.mapItems.filter(_MappableMixin.ImageryParts.is).map(function (parts) {\n            return {\n              item: item,\n              parts: parts\n            };\n          });\n        })));\n        var allImagery = allImageryMapItems.map(function (_ref4) {\n          var item = _ref4.item,\n            parts = _ref4.parts;\n          if ((0, _hasTraits[\"default\"])(item, _ImageryProviderTraits[\"default\"], \"leafletUpdateInterval\")) {\n            parts.imageryProvider._leafletUpdateInterval = item.leafletUpdateInterval;\n          }\n          return {\n            parts: parts,\n            layer: _this4._makeImageryLayerFromParts(parts, item)\n          };\n        });\n\n        // Delete imagery layers no longer in the model\n        _this4.map.eachLayer(function (mapLayer) {\n          if (isImageryLayer(mapLayer) || mapLayer instanceof _ImageryProviderLeafletGridLayer[\"default\"]) {\n            var index = allImagery.findIndex(function (im) {\n              return im.layer === mapLayer;\n            });\n            if (index === -1) {\n              _this4.map.removeLayer(mapLayer);\n            }\n          }\n        });\n\n        // Add layer and update its zIndex\n        var zIndex = 100; // Start at an arbitrary value\n        allImagery.reverse().forEach(function (_ref5) {\n          var parts = _ref5.parts,\n            layer = _ref5.layer;\n          if (parts.show) {\n            layer.setOpacity(parts.alpha);\n            layer.setZIndex(zIndex);\n            zIndex++;\n            if (!_this4.map.hasLayer(layer)) {\n              _this4.map.addLayer(layer);\n            }\n          } else {\n            _this4.map.removeLayer(layer);\n          }\n        });\n      });\n      return function () {\n        dataSourcesReactionDisposer();\n        imageryReactionDisposer();\n      };\n    }\n\n    /**\r\n     * Syncs the `dataSources` collection against the latest `availableDataSources`.\r\n     *\r\n     */\n  }, {\n    key: \"syncDataSourceCollection\",\n    value: (function () {\n      var _syncDataSourceCollection = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee2(availableDataSources, dataSources) {\n        var i, ds, _iterator, _step, _ds;\n        return _regeneratorRuntime().wrap(function _callee2$(_context2) {\n          while (1) switch (_context2.prev = _context2.next) {\n            case 0:\n              // 1. Remove deleted data sources\n              //\n              // Iterate backwards because we're removing items.\n              for (i = dataSources.length - 1; i >= 0; i--) {\n                ds = dataSources.get(i);\n                if (availableDataSources.indexOf(ds) === -1 || !ds.show) {\n                  dataSources.remove(ds);\n                }\n              }\n\n              // 2. Add new data sources\n              _iterator = _createForOfIteratorHelper(availableDataSources);\n              _context2.prev = 2;\n              _iterator.s();\n            case 4:\n              if ((_step = _iterator.n()).done) {\n                _context2.next = 11;\n                break;\n              }\n              _ds = _step.value;\n              if (!(!dataSources.contains(_ds) && _ds.show)) {\n                _context2.next = 9;\n                break;\n              }\n              _context2.next = 9;\n              return dataSources.add(_ds);\n            case 9:\n              _context2.next = 4;\n              break;\n            case 11:\n              _context2.next = 16;\n              break;\n            case 13:\n              _context2.prev = 13;\n              _context2.t0 = _context2[\"catch\"](2);\n              _iterator.e(_context2.t0);\n            case 16:\n              _context2.prev = 16;\n              _iterator.f();\n              return _context2.finish(16);\n            case 19:\n              // 3. Ensure stacking order matches order in `availableDataSources` - first item appears on top.\n              (0, _mobx.runInAction)(function () {\n                return availableDataSources.forEach(function (ds) {\n                  // There is a buggy/un-intended side-effect when calling raiseToTop() with\n                  // a source that doesn't exist in the collection. Doing this will replace\n                  // the last entry in the collection with the new one. So we should be\n                  // careful to raiseToTop() only if the DS already exists in the collection.\n                  // Relevant code:\n                  //   https://github.com/CesiumGS/cesium/blob/dbd452328a48bfc4e192146862a9f8fa15789dc8/packages/engine/Source/DataSources/DataSourceCollection.js#L298-L299\n                  dataSources.contains(ds) && dataSources.raiseToTop(ds);\n                });\n              });\n            case 20:\n            case \"end\":\n              return _context2.stop();\n          }\n        }, _callee2, null, [[2, 13, 16, 19]]);\n      }));\n      function syncDataSourceCollection(_x, _x2) {\n        return _syncDataSourceCollection.apply(this, arguments);\n      }\n      return syncDataSourceCollection;\n    }())\n  }, {\n    key: \"doZoomTo\",\n    value: function doZoomTo(target) {\n      var flightDurationSeconds = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 3.0;\n      if (!(0, _isDefined[\"default\"])(target)) {\n        return Promise.resolve();\n        //throw new DeveloperError(\"target is required.\");\n      }\n      var bounds;\n\n      // Target is a KML data source\n      if ((0, _isDefined[\"default\"])(target.entities)) {\n        if ((0, _isDefined[\"default\"])(this.dataSourceDisplay)) {\n          bounds = this.dataSourceDisplay.getLatLngBounds(target);\n        }\n      } else {\n        var extent;\n        if (target instanceof _Rectangle[\"default\"]) {\n          extent = target;\n        } else if (target instanceof _CameraView[\"default\"]) {\n          extent = target.rectangle;\n        } else if (_MappableMixin[\"default\"].isMixedInto(target)) {\n          if ((0, _isDefined[\"default\"])(target.cesiumRectangle)) {\n            extent = target.cesiumRectangle;\n          }\n          if (!(0, _isDefined[\"default\"])(extent)) {\n            // Zoom to the first item!\n            return this.doZoomTo(target.mapItems[0], flightDurationSeconds);\n          }\n        } else {\n          extent = target.rectangle;\n        }\n\n        // Account for a bounding box crossing the date line.\n        if (extent.east < extent.west) {\n          extent = _Rectangle[\"default\"].clone(extent);\n          extent.east += _Math[\"default\"].TWO_PI;\n        }\n        bounds = (0, _rectangleToLatLngBounds[\"default\"])(extent);\n      }\n      if ((0, _isDefined[\"default\"])(bounds)) {\n        this.map.flyToBounds(bounds, {\n          animate: flightDurationSeconds > 0.0,\n          duration: flightDurationSeconds\n        });\n      }\n      return Promise.resolve();\n    }\n  }, {\n    key: \"getCurrentCameraView\",\n    value: function getCurrentCameraView() {\n      var bounds = this.map.getBounds();\n      return new _CameraView[\"default\"](_Rectangle[\"default\"].fromDegrees(bounds.getWest(), bounds.getSouth(), bounds.getEast(), bounds.getNorth()));\n    }\n  }, {\n    key: \"notifyRepaintRequired\",\n    value: function notifyRepaintRequired() {\n      // No action necessary.\n    }\n  }, {\n    key: \"pickFromLocation\",\n    value: function pickFromLocation(latLngHeight, providerCoords, existingFeatures) {\n      this._pickFeatures(_LeafletPatched[\"default\"].latLng({\n        lat: latLngHeight.latitude,\n        lng: latLngHeight.longitude,\n        alt: latLngHeight.height\n      }), providerCoords, existingFeatures);\n    }\n\n    /*\r\n     * There are two \"listeners\" for clicks which are set up in our constructor.\r\n     * - One fires for any click: `map.on('click', ...`.  It calls `pickFeatures`.\r\n     * - One fires only for vector features: `this.scene.featureClicked.addEventListener`.\r\n     *    It calls `featurePicked`, which calls `pickFeatures` and then adds the feature it found, if any.\r\n     * These events can fire in either order.\r\n     * Billboards do not fire the first event.\r\n     *\r\n     * Note that `pickFeatures` does nothing if `leaflet._pickedFeatures` is already set.\r\n     * Otherwise, it sets it, runs `runLater` to clear it, and starts the asynchronous raster feature picking.\r\n     *\r\n     * So:\r\n     * If only the first event is received, it triggers the raster-feature picking as desired.\r\n     * If both are received in the order above, the second adds the vector features to the list of raster features as desired.\r\n     * If both are received in the reverse order, the vector-feature click kicks off the same behavior as the other click would have;\r\n     * and when the next click is received, it is ignored - again, as desired.\r\n     */\n  }, {\n    key: \"_featurePicked\",\n    value: function _featurePicked(entity, event) {\n      this._pickFeatures(event.latlng);\n\n      // Ignore clicks on the feature highlight.\n      if (entity.entityCollection && entity.entityCollection.owner) {\n        var owner = entity.entityCollection.owner;\n        if (owner instanceof _DataSource[\"default\"] && owner.name == _GlobeOrMap2[\"default\"]._featureHighlightName) {\n          return;\n        }\n      }\n      var feature = _Feature[\"default\"].fromEntityCollectionOrEntity(entity);\n      var catalogItem = feature._catalogItem;\n      if (_FeatureInfoUrlTemplateMixin[\"default\"].isMixedInto(catalogItem) && typeof catalogItem.getFeaturesFromPickResult === \"function\" && this.terria.allowFeatureInfoRequests) {\n        var _this$_pickedFeatures;\n        var result = catalogItem.getFeaturesFromPickResult.bind(catalogItem)(undefined, entity, (((_this$_pickedFeatures = this._pickedFeatures) === null || _this$_pickedFeatures === void 0 ? void 0 : _this$_pickedFeatures.features.length) || 0) < catalogItem.maxRequests);\n        if (result && (0, _isDefined[\"default\"])(this._pickedFeatures)) {\n          if (Array.isArray(result)) {\n            var _this$_pickedFeatures2;\n            (_this$_pickedFeatures2 = this._pickedFeatures.features).push.apply(_this$_pickedFeatures2, _toConsumableArray(result));\n          } else {\n            this._pickedFeatures.features.push(result);\n          }\n        }\n      } else if ((0, _isDefined[\"default\"])(this._pickedFeatures)) {\n        this._pickedFeatures.features.push(feature);\n      }\n      if ((0, _isDefined[\"default\"])(this._pickedFeatures) && (0, _isDefined[\"default\"])(feature) && feature.position) {\n        this._pickedFeatures.pickPosition = feature.position._value;\n      }\n    }\n  }, {\n    key: \"_pickFeatures\",\n    value: function _pickFeatures(latlng, tileCoordinates, existingFeatures) {\n      var _this5 = this;\n      var ignoreSplitter = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;\n      if ((0, _isDefined[\"default\"])(this._pickedFeatures)) {\n        // Picking is already in progress.\n        return;\n      }\n      this._pickedFeatures = new _PickedFeatures[\"default\"]();\n      if ((0, _isDefined[\"default\"])(existingFeatures)) {\n        this._pickedFeatures.features = existingFeatures;\n      }\n\n      // We run this later because vector click events and the map click event can come through in any order, but we can\n      // be reasonably sure that all of them will be processed by the time our runLater func is invoked.\n      var cleanup = (0, _runLater[\"default\"])(function () {\n        // Set this again just in case a vector pick came through and reset it to the vector's position.\n        var newPickLocation = _Ellipsoid[\"default\"].WGS84.cartographicToCartesian(pickedLocation);\n        (0, _mobx.runInAction)(function () {\n          var mapInteractionModeStack = _this5.terria.mapInteractionModeStack;\n          if ((0, _isDefined[\"default\"])(mapInteractionModeStack) && mapInteractionModeStack.length > 0) {\n            var _pickedFeatures = mapInteractionModeStack[mapInteractionModeStack.length - 1].pickedFeatures;\n            if ((0, _isDefined[\"default\"])(_pickedFeatures)) {\n              _pickedFeatures.pickPosition = newPickLocation;\n            }\n          } else if ((0, _isDefined[\"default\"])(_this5.terria.pickedFeatures)) {\n            _this5.terria.pickedFeatures.pickPosition = newPickLocation;\n          }\n        });\n\n        // Unset this so that the next click will start building features from scratch.\n        _this5._pickedFeatures = undefined;\n      });\n      var imageryLayers = [];\n      if (this.terria.allowFeatureInfoRequests) {\n        this.map.eachLayer(function (layer) {\n          if (isImageryLayer(layer)) {\n            imageryLayers.push(layer);\n          }\n        });\n      }\n\n      // we need items sorted in reverse order by their zIndex to get correct ordering of feature info\n      imageryLayers.sort(function (a, b) {\n        if (!(0, _isDefined[\"default\"])(a.options.zIndex) || !(0, _isDefined[\"default\"])(b.options.zIndex)) {\n          return 0;\n        }\n        if (a.options.zIndex < b.options.zIndex) {\n          return 1;\n        }\n        if (a.options.zIndex > b.options.zIndex) {\n          return -1;\n        }\n        return 0;\n      });\n      tileCoordinates = (0, _defaultValue[\"default\"])(tileCoordinates, {});\n      var pickedLocation = _Cartographic[\"default\"].fromDegrees(latlng.lng, latlng.lat);\n      this._pickedFeatures.pickPosition = _Ellipsoid[\"default\"].WGS84.cartographicToCartesian(pickedLocation);\n      var imageryFeaturePromises = imageryLayers.map( /*#__PURE__*/function () {\n        var _ref6 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee3(imageryLayer) {\n          var _tileCoordinates$imag, _tileCoordinates;\n          var imageryLayerUrl, longRadians, latRadians, coords, features;\n          return _regeneratorRuntime().wrap(function _callee3$(_context3) {\n            while (1) switch (_context3.prev = _context3.next) {\n              case 0:\n                imageryLayerUrl = imageryLayer.imageryProvider.url;\n                longRadians = _Math[\"default\"].toRadians(latlng.lng);\n                latRadians = _Math[\"default\"].toRadians(latlng.lat);\n                if (!((_tileCoordinates$imag = (_tileCoordinates = tileCoordinates) === null || _tileCoordinates === void 0 ? void 0 : _tileCoordinates[imageryLayerUrl]) !== null && _tileCoordinates$imag !== void 0)) {\n                  _context3.next = 7;\n                  break;\n                }\n                _context3.t0 = _tileCoordinates$imag;\n                _context3.next = 10;\n                break;\n              case 7:\n                _context3.next = 9;\n                return imageryLayer.getFeaturePickingCoords(_this5.map, longRadians, latRadians);\n              case 9:\n                _context3.t0 = _context3.sent;\n              case 10:\n                coords = _context3.t0;\n                _context3.next = 13;\n                return imageryLayer.pickFeatures(coords.x, coords.y, coords.level, longRadians, latRadians);\n              case 13:\n                features = _context3.sent;\n                // Make sure ImageryLayerFeatureInfo has imagery layer property\n                features === null || features === void 0 || features.forEach(function (feature) {\n                  return feature.imageryLayer = imageryLayer;\n                });\n                return _context3.abrupt(\"return\", {\n                  features: features,\n                  imageryLayer: imageryLayer,\n                  coords: coords\n                });\n              case 16:\n              case \"end\":\n                return _context3.stop();\n            }\n          }, _callee3);\n        }));\n        return function (_x3) {\n          return _ref6.apply(this, arguments);\n        };\n      }());\n      var pickedFeatures = this._pickedFeatures;\n\n      // We want the all available promise to return after the cleanup one to\n      // make sure all vector click events have resolved.\n      pickedFeatures.allFeaturesAvailablePromise = Promise.all([cleanup, Promise.all(imageryFeaturePromises).then(function (results) {\n        (0, _mobx.runInAction)(function () {\n          pickedFeatures.isLoading = false;\n        });\n        pickedFeatures.providerCoords = {};\n        var filteredResults = results.filter(function (result) {\n          return (0, _isDefined[\"default\"])(result.features) && result.features.length > 0;\n        });\n        pickedFeatures.providerCoords = filteredResults.reduce(function (coordsSoFar, result) {\n          var _result$imageryLayer;\n          var imageryProvider = (_result$imageryLayer = result.imageryLayer) === null || _result$imageryLayer === void 0 ? void 0 : _result$imageryLayer.imageryProvider;\n          if (imageryProvider) coordsSoFar[imageryProvider.url] = result.coords;\n          return coordsSoFar;\n        }, {});\n        var features = filteredResults.reduce(function (allFeatures, result) {\n          if (_this5.terria.showSplitter && ignoreSplitter === false && (0, _isDefined[\"default\"])(pickedFeatures.pickPosition)) {\n            // Skip this feature, unless the imagery layer is on the picked side or\n            // belongs to both sides of the splitter\n            var screenPosition = _this5._computePositionOnScreen(pickedFeatures.pickPosition);\n            var pickedSide = _this5._getSplitterSideForScreenPosition(screenPosition);\n            var layerDirection = result.imageryLayer.splitDirection;\n            if (!(layerDirection === pickedSide || layerDirection === _SplitDirection[\"default\"].NONE)) {\n              return allFeatures;\n            }\n          }\n          return allFeatures.concat(result.features.map(function (feature) {\n            // For features without a position, use the picked location.\n            if (!(0, _isDefined[\"default\"])(feature.position)) {\n              feature.position = pickedLocation;\n            }\n            return _this5._createFeatureFromImageryLayerFeature(feature);\n          }));\n        }, pickedFeatures.features);\n        (0, _mobx.runInAction)(function () {\n          pickedFeatures.features = features;\n        });\n      })[\"catch\"](function (e) {\n        (0, _mobx.runInAction)(function () {\n          pickedFeatures.isLoading = false;\n          pickedFeatures.error = \"An unknown error occurred while picking features.\";\n        });\n        throw e;\n      })]).then(function () {\n        return undefined;\n      });\n      (0, _mobx.runInAction)(function () {\n        var mapInteractionModeStack = _this5.terria.mapInteractionModeStack;\n        if ((0, _isDefined[\"default\"])(mapInteractionModeStack) && mapInteractionModeStack.length > 0) {\n          mapInteractionModeStack[mapInteractionModeStack.length - 1].pickedFeatures = _this5._pickedFeatures;\n        } else {\n          _this5.terria.pickedFeatures = _this5._pickedFeatures;\n        }\n      });\n    }\n  }, {\n    key: \"_reactToSplitterChanges\",\n    value: function _reactToSplitterChanges() {\n      var _this6 = this;\n      return (0, _mobx.autorun)(function () {\n        var items = _this6.terria.mainViewer.items.get();\n        var showSplitter = _this6.terria.showSplitter;\n        var splitPosition = _this6.terria.splitPosition;\n        items.forEach(function (item) {\n          if (_MappableMixin[\"default\"].isMixedInto(item) && (0, _hasTraits[\"default\"])(item, _SplitterTraits[\"default\"], \"splitDirection\")) {\n            var layers = _this6.getImageryLayersForItem(item);\n            var splitDirection = item.splitDirection;\n            layers.forEach((0, _mobx.action)(function (layer) {\n              if (showSplitter) {\n                layer.splitDirection = splitDirection;\n                layer.splitPosition = splitPosition;\n              } else {\n                layer.splitDirection = _SplitDirection[\"default\"].NONE;\n                layer.splitPosition = splitPosition;\n              }\n            }));\n          }\n        });\n        _this6.notifyRepaintRequired();\n      });\n    }\n  }, {\n    key: \"getImageryLayersForItem\",\n    value: function getImageryLayersForItem(item) {\n      var _this7 = this;\n      return (0, _filterOutUndefined[\"default\"])(item.mapItems.map(function (m) {\n        if (_MappableMixin.ImageryParts.is(m)) {\n          var layer = _this7._makeImageryLayerFromParts(m, item);\n          return layer instanceof _ImageryProviderLeafletTileLayer[\"default\"] || layer instanceof _ImageryProviderLeafletGridLayer[\"default\"] ? layer : undefined;\n        }\n      }));\n    }\n\n    /**\r\n     * Computes the screen position of a given world position.\r\n     * @param position The world position in Earth-centered Fixed coordinates.\r\n     * @param [result] The instance to which to copy the result.\r\n     * @return The screen position, or undefined if the position is not on the screen.\r\n     */\n  }, {\n    key: \"_computePositionOnScreen\",\n    value: function _computePositionOnScreen(position, result) {\n      var cartographicScratch = new _Cartographic[\"default\"]();\n      var cartographic = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(position, cartographicScratch);\n      var point = this.map.latLngToContainerPoint(_LeafletPatched[\"default\"].latLng(_Math[\"default\"].toDegrees(cartographic.latitude), _Math[\"default\"].toDegrees(cartographic.longitude)));\n      if ((0, _isDefined[\"default\"])(result)) {\n        result.x = point.x;\n        result.y = point.y;\n      } else {\n        result = new _Cartesian[\"default\"](point.x, point.y);\n      }\n      return result;\n    }\n  }, {\n    key: \"_selectFeature\",\n    value: function _selectFeature(feature) {\n      this._highlightFeature(feature);\n      if ((0, _isDefined[\"default\"])(feature) && (0, _isDefined[\"default\"])(feature.position)) {\n        var cartographicScratch = new _Cartographic[\"default\"]();\n        var cartographic = _Ellipsoid[\"default\"].WGS84.cartesianToCartographic(feature.position.getValue(this.terria.timelineClock.currentTime), cartographicScratch);\n        this._selectionIndicator.setLatLng(_LeafletPatched[\"default\"].latLng([_Math[\"default\"].toDegrees(cartographic.latitude), _Math[\"default\"].toDegrees(cartographic.longitude)]));\n        this._selectionIndicator.animateSelectionIndicatorAppear();\n      } else {\n        this._selectionIndicator.animateSelectionIndicatorDepart();\n      }\n    }\n  }, {\n    key: \"getClipsForSplitter\",\n    value: function getClipsForSplitter() {\n      var clipLeft = \"\";\n      var clipRight = \"\";\n      var clipPositionWithinMap = 0;\n      var clipX = 0;\n      if (this.terria.showSplitter) {\n        var map = this.map;\n        var size = map.getSize();\n        var nw = map.containerPointToLayerPoint([0, 0]);\n        var se = map.containerPointToLayerPoint(size);\n        clipPositionWithinMap = size.x * this.terria.splitPosition;\n        clipX = Math.round(nw.x + clipPositionWithinMap);\n        clipLeft = \"rect(\" + [nw.y, clipX, se.y, nw.x].join(\"px,\") + \"px)\";\n        clipRight = \"rect(\" + [nw.y, se.x, se.y, clipX].join(\"px,\") + \"px)\";\n      }\n      return {\n        left: clipLeft,\n        right: clipRight,\n        clipPositionWithinMap: clipPositionWithinMap,\n        clipX: clipX\n      };\n    }\n  }, {\n    key: \"isSplitterDragThumb\",\n    value: function isSplitterDragThumb(element) {\n      return element.className && element.className.indexOf && element.className.indexOf(\"tjs-splitter__thumb\") >= 0;\n    }\n  }, {\n    key: \"captureScreenshot\",\n    value: function captureScreenshot() {\n      var _this8 = this;\n      // Temporarily hide the map credits.\n      this._attributionControl.remove();\n      try {\n        // html2canvas can't handle the clip style which is used for the splitter. So if the splitter is active, we render\n        // a left image and a right image and compose them. Also remove the splitter drag thumb.\n        var promise;\n        if (this.terria.showSplitter) {\n          var clips = this.getClipsForSplitter();\n          var clipLeft = clips.left.replace(/ /g, \"\");\n          var clipRight = clips.right.replace(/ /g, \"\");\n          promise = (0, _terriajsHtml2canvas[\"default\"])(this.map.getContainer(), {\n            useCORS: true,\n            ignoreElements: function ignoreElements(element) {\n              return element.style.clip !== undefined && element.style.clip !== null && element.style.clip.replace(/ /g, \"\") === clipRight || _this8.isSplitterDragThumb(element);\n            }\n          }).then(function (leftCanvas) {\n            return (0, _terriajsHtml2canvas[\"default\"])(_this8.map.getContainer(), {\n              useCORS: true,\n              ignoreElements: function ignoreElements(element) {\n                return element.style.clip !== undefined && element.style.clip !== null && element.style.clip.replace(/ /g, \"\") === clipLeft || _this8.isSplitterDragThumb(element);\n              }\n            }).then(function (rightCanvas) {\n              var combined = document.createElement(\"canvas\");\n              combined.width = leftCanvas.width;\n              combined.height = leftCanvas.height;\n              var context = combined.getContext(\"2d\");\n              if (context === undefined || context === null) {\n                // Error\n                return null;\n              }\n              var split = clips.clipPositionWithinMap * window.devicePixelRatio;\n              context.drawImage(leftCanvas, 0, 0, split, combined.height, 0, 0, split, combined.height);\n              context.drawImage(rightCanvas, split, 0, combined.width - split, combined.height, split, 0, combined.width - split, combined.height);\n              return combined;\n            });\n          });\n        } else {\n          promise = (0, _terriajsHtml2canvas[\"default\"])(this.map.getContainer(), {\n            useCORS: true\n          });\n        }\n        return promise.then(function (canvas) {\n          return canvas.toDataURL(\"image/png\");\n        })[\"finally\"](function () {\n          _this8._attributionControl.addTo(_this8.map);\n        });\n      } catch (e) {\n        this._attributionControl.addTo(this.map);\n        return Promise.reject(e);\n      }\n    }\n  }, {\n    key: \"_addVectorTileHighlight\",\n    value: function _addVectorTileHighlight(imageryProvider, rectangle) {\n      var map = this.map;\n      var options = {\n        opacity: 1,\n        bounds: (0, _rectangleToLatLngBounds[\"default\"])(rectangle)\n      };\n      if ((0, _isDefined[\"default\"])(map.options.maxZoom)) {\n        options.maxZoom = map.options.maxZoom;\n      }\n      var layer = new _ImageryProviderLeafletGridLayer[\"default\"](this, imageryProvider, options);\n      layer.addTo(map);\n      layer.bringToFront();\n      return function () {\n        map.removeLayer(layer);\n      };\n    }\n  }]);\n  return Leaflet;\n}(_GlobeOrMap2[\"default\"]), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"size\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor2 = _applyDecoratedDescriptor(_class.prototype, \"nw\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _descriptor3 = _applyDecoratedDescriptor(_class.prototype, \"se\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n}), _applyDecoratedDescriptor(_class.prototype, \"updateMapObservables\", [_mobx.action], Object.getOwnPropertyDescriptor(_class.prototype, \"updateMapObservables\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"attributions\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"attributions\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"availableCatalogItems\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"availableCatalogItems\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"availableDataSources\", [_mobx.computed], Object.getOwnPropertyDescriptor(_class.prototype, \"availableDataSources\"), _class.prototype), _applyDecoratedDescriptor(_class.prototype, \"_featurePicked\", [_mobx.action], Object.getOwnPropertyDescriptor(_class.prototype, \"_featurePicked\"), _class.prototype)), _class);\nfunction isImageryLayer(someLayer) {\n  return \"imageryProvider\" in someLayer;\n}\nfunction isDataSource(object) {\n  return \"entities\" in object;\n}//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0xlYWZsZXQudHMuanMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0xlYWZsZXQudHM/ZmQ4MSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBHcmlkTGF5ZXIgfSBmcm9tIFwibGVhZmxldFwiO1xyXG5pbXBvcnQge1xyXG4gIGFjdGlvbixcclxuICBhdXRvcnVuLFxyXG4gIGNvbXB1dGVkLFxyXG4gIG1ha2VPYnNlcnZhYmxlLFxyXG4gIG9ic2VydmFibGUsXHJcbiAgcmVhY3Rpb24sXHJcbiAgcnVuSW5BY3Rpb25cclxufSBmcm9tIFwibW9ieFwiO1xyXG5pbXBvcnQgeyBjb21wdXRlZEZuIH0gZnJvbSBcIm1vYngtdXRpbHNcIjtcclxuaW1wb3J0IGNlc2l1bUNhbmNlbEFuaW1hdGlvbkZyYW1lIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvY2FuY2VsQW5pbWF0aW9uRnJhbWVcIjtcclxuaW1wb3J0IENhcnRlc2lhbjIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9DYXJ0ZXNpYW4yXCI7XHJcbmltcG9ydCBDYXJ0ZXNpYW4zIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2FydGVzaWFuM1wiO1xyXG5pbXBvcnQgQ2FydG9ncmFwaGljIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvQ2FydG9ncmFwaGljXCI7XHJcbmltcG9ydCBDbG9jayBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0Nsb2NrXCI7XHJcbmltcG9ydCBkZWZhdWx0VmFsdWUgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9kZWZhdWx0VmFsdWVcIjtcclxuaW1wb3J0IEVsbGlwc29pZCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0VsbGlwc29pZFwiO1xyXG5pbXBvcnQgRXZlbnRIZWxwZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvQ29yZS9FdmVudEhlbHBlclwiO1xyXG5pbXBvcnQgQ2VzaXVtTWF0aCBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL01hdGhcIjtcclxuaW1wb3J0IFJlY3RhbmdsZSBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL1JlY3RhbmdsZVwiO1xyXG5pbXBvcnQgY2VzaXVtUmVxdWVzdEFuaW1hdGlvbkZyYW1lIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0NvcmUvcmVxdWVzdEFuaW1hdGlvbkZyYW1lXCI7XHJcbmltcG9ydCBEYXRhU291cmNlIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0RhdGFTb3VyY2VcIjtcclxuaW1wb3J0IERhdGFTb3VyY2VDb2xsZWN0aW9uIGZyb20gXCJ0ZXJyaWFqcy1jZXNpdW0vU291cmNlL0RhdGFTb3VyY2VzL0RhdGFTb3VyY2VDb2xsZWN0aW9uXCI7XHJcbmltcG9ydCBFbnRpdHkgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvRGF0YVNvdXJjZXMvRW50aXR5XCI7XHJcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcInRlcnJpYWpzLWNlc2l1bS9Tb3VyY2UvU2NlbmUvSW1hZ2VyeVByb3ZpZGVyXCI7XHJcbmltcG9ydCBTcGxpdERpcmVjdGlvbiBmcm9tIFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9TY2VuZS9TcGxpdERpcmVjdGlvblwiO1xyXG5pbXBvcnQgaHRtbDJjYW52YXMgZnJvbSBcInRlcnJpYWpzLWh0bWwyY2FudmFzXCI7XHJcbmltcG9ydCBmaWx0ZXJPdXRVbmRlZmluZWQgZnJvbSBcIi4uL0NvcmUvZmlsdGVyT3V0VW5kZWZpbmVkXCI7XHJcbmltcG9ydCBpc0RlZmluZWQgZnJvbSBcIi4uL0NvcmUvaXNEZWZpbmVkXCI7XHJcbmltcG9ydCBMYXRMb25IZWlnaHQgZnJvbSBcIi4uL0NvcmUvTGF0TG9uSGVpZ2h0XCI7XHJcbmltcG9ydCBydW5MYXRlciBmcm9tIFwiLi4vQ29yZS9ydW5MYXRlclwiO1xyXG5pbXBvcnQgTWFwYm94VmVjdG9yVGlsZUltYWdlcnlQcm92aWRlciBmcm9tIFwiLi4vTWFwL0ltYWdlcnlQcm92aWRlci9NYXBib3hWZWN0b3JUaWxlSW1hZ2VyeVByb3ZpZGVyXCI7XHJcbmltcG9ydCBQcm90b21hcHNJbWFnZXJ5UHJvdmlkZXIgZnJvbSBcIi4uL01hcC9JbWFnZXJ5UHJvdmlkZXIvUHJvdG9tYXBzSW1hZ2VyeVByb3ZpZGVyXCI7XHJcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0R3JpZExheWVyLCB7XHJcbiAgaXNJbWFnZXJ5UHJvdmlkZXJHcmlkTGF5ZXIgYXMgc3VwcG9ydHNJbWFnZXJ5UHJvdmlkZXJHcmlkTGF5ZXJcclxufSBmcm9tIFwiLi4vTWFwL0xlYWZsZXQvSW1hZ2VyeVByb3ZpZGVyTGVhZmxldEdyaWRMYXllclwiO1xyXG5pbXBvcnQgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllciBmcm9tIFwiLi4vTWFwL0xlYWZsZXQvSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllclwiO1xyXG5pbXBvcnQgTGVhZmxldERhdGFTb3VyY2VEaXNwbGF5IGZyb20gXCIuLi9NYXAvTGVhZmxldC9MZWFmbGV0RGF0YVNvdXJjZURpc3BsYXlcIjtcclxuaW1wb3J0IExlYWZsZXRTY2VuZSBmcm9tIFwiLi4vTWFwL0xlYWZsZXQvTGVhZmxldFNjZW5lXCI7XHJcbmltcG9ydCBMZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yIGZyb20gXCIuLi9NYXAvTGVhZmxldC9MZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yXCI7XHJcbmltcG9ydCBMZWFmbGV0VmlzdWFsaXplciBmcm9tIFwiLi4vTWFwL0xlYWZsZXQvTGVhZmxldFZpc3VhbGl6ZXJcIjtcclxuaW1wb3J0IEwgZnJvbSBcIi4uL01hcC9MZWFmbGV0UGF0Y2hlZFwiO1xyXG5pbXBvcnQgUGlja2VkRmVhdHVyZXMsIHtcclxuICBQcm92aWRlckNvb3JkcyxcclxuICBQcm92aWRlckNvb3Jkc01hcFxyXG59IGZyb20gXCIuLi9NYXAvUGlja2VkRmVhdHVyZXMvUGlja2VkRmVhdHVyZXNcIjtcclxuaW1wb3J0IHJlY3RhbmdsZVRvTGF0TG5nQm91bmRzIGZyb20gXCIuLi9NYXAvVmVjdG9yL3JlY3RhbmdsZVRvTGF0TG5nQm91bmRzXCI7XHJcbmltcG9ydCBGZWF0dXJlSW5mb1VybFRlbXBsYXRlTWl4aW4gZnJvbSBcIi4uL01vZGVsTWl4aW5zL0ZlYXR1cmVJbmZvVXJsVGVtcGxhdGVNaXhpblwiO1xyXG5pbXBvcnQgTWFwcGFibGVNaXhpbiwge1xyXG4gIEltYWdlcnlQYXJ0cyxcclxuICBNYXBJdGVtXHJcbn0gZnJvbSBcIi4uL01vZGVsTWl4aW5zL01hcHBhYmxlTWl4aW5cIjtcclxuaW1wb3J0IFRpbGVFcnJvckhhbmRsZXJNaXhpbiBmcm9tIFwiLi4vTW9kZWxNaXhpbnMvVGlsZUVycm9ySGFuZGxlck1peGluXCI7XHJcbmltcG9ydCBJbWFnZXJ5UHJvdmlkZXJUcmFpdHMgZnJvbSBcIi4uL1RyYWl0cy9UcmFpdHNDbGFzc2VzL0ltYWdlcnlQcm92aWRlclRyYWl0c1wiO1xyXG5pbXBvcnQgU3BsaXR0ZXJUcmFpdHMgZnJvbSBcIi4uL1RyYWl0cy9UcmFpdHNDbGFzc2VzL1NwbGl0dGVyVHJhaXRzXCI7XHJcbmltcG9ydCBUZXJyaWFWaWV3ZXIgZnJvbSBcIi4uL1ZpZXdNb2RlbHMvVGVycmlhVmlld2VyXCI7XHJcbmltcG9ydCBDYW1lcmFWaWV3IGZyb20gXCIuL0NhbWVyYVZpZXdcIjtcclxuaW1wb3J0IGhhc1RyYWl0cyBmcm9tIFwiLi9EZWZpbml0aW9uL2hhc1RyYWl0c1wiO1xyXG5pbXBvcnQgVGVycmlhRmVhdHVyZSBmcm9tIFwiLi9GZWF0dXJlL0ZlYXR1cmVcIjtcclxuaW1wb3J0IEdsb2JlT3JNYXAgZnJvbSBcIi4vR2xvYmVPck1hcFwiO1xyXG5pbXBvcnQgeyBMZWFmbGV0QXR0cmlidXRpb24gfSBmcm9tIFwiLi9MZWFmbGV0QXR0cmlidXRpb25cIjtcclxuaW1wb3J0IFRlcnJpYSBmcm9tIFwiLi9UZXJyaWFcIjtcclxuXHJcbi8vIFdlIHdhbnQgVFMgdG8gbG9vayBhdCB0aGUgdHlwZSBkZWNsYXJlZCBpbiBsaWIvVGhpcmRQYXJ0eS90ZXJyaWFqcy1jZXNpdW0tZXh0cmEvaW5kZXguZC50c1xyXG4vLyBhbmQgaW1wb3J0IGRvZXNuJ3QgYWxsb3dzIHVzIHRvIGRvIHRoYXQsIHNvIGluc3RlYWQgd2UgdXNlIHJlcXVpcmUgKyB0eXBlIGNhc3RpbmcgdG8gZW5zdXJlXHJcbi8vIHdlIHN0aWxsIG1haW50YWluIHRoZSB0eXBlIGNoZWNraW5nLCB3aXRob3V0IFRTIHNjcmVhbWluZyB3aXRoIGVycm9yc1xyXG5jb25zdCBGZWF0dXJlRGV0ZWN0aW9uOiBGZWF0dXJlRGV0ZWN0aW9uID1cclxuICByZXF1aXJlKFwidGVycmlhanMtY2VzaXVtL1NvdXJjZS9Db3JlL0ZlYXR1cmVEZXRlY3Rpb25cIikuZGVmYXVsdDtcclxuXHJcbi8vIFRoaXMgY2xhc3MgaXMgYW4gb2JzZXJ2ZXIuIEl0IHByb2JhYmx5IHdvbid0IGNvbnRhaW4gYW55IG9ic2VydmFibGVzIGl0c2VsZlxyXG5cclxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgTGVhZmxldCBleHRlbmRzIEdsb2JlT3JNYXAge1xyXG4gIHJlYWRvbmx5IHR5cGUgPSBcIkxlYWZsZXRcIjtcclxuICByZWFkb25seSB0ZXJyaWE6IFRlcnJpYTtcclxuICByZWFkb25seSB0ZXJyaWFWaWV3ZXI6IFRlcnJpYVZpZXdlcjtcclxuICByZWFkb25seSBtYXA6IEwuTWFwO1xyXG4gIHJlYWRvbmx5IHNjZW5lOiBMZWFmbGV0U2NlbmU7XHJcbiAgcmVhZG9ubHkgZGF0YVNvdXJjZXM6IERhdGFTb3VyY2VDb2xsZWN0aW9uID0gbmV3IERhdGFTb3VyY2VDb2xsZWN0aW9uKCk7XHJcbiAgcmVhZG9ubHkgZGF0YVNvdXJjZURpc3BsYXk6IExlYWZsZXREYXRhU291cmNlRGlzcGxheTtcclxuICByZWFkb25seSBjYW5TaG93U3BsaXR0ZXIgPSB0cnVlO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2F0dHJpYnV0aW9uQ29udHJvbDogTGVhZmxldEF0dHJpYnV0aW9uO1xyXG4gIHByaXZhdGUgcmVhZG9ubHkgX2xlYWZsZXRWaXN1YWxpemVyOiBMZWFmbGV0VmlzdWFsaXplcjtcclxuICBwcml2YXRlIHJlYWRvbmx5IF9ldmVudEhlbHBlcjogRXZlbnRIZWxwZXI7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfc2VsZWN0aW9uSW5kaWNhdG9yOiBMZWFmbGV0U2VsZWN0aW9uSW5kaWNhdG9yO1xyXG4gIHByaXZhdGUgX3N0b3BSZXF1ZXN0QW5pbWF0aW9uRnJhbWU6IGJvb2xlYW4gPSBmYWxzZTtcclxuICBwcml2YXRlIF9jZXNpdW1SZXFBbmltRnJhbWVJZDogbnVtYmVyIHwgdW5kZWZpbmVkO1xyXG4gIHByaXZhdGUgX3BpY2tlZEZlYXR1cmVzOiBQaWNrZWRGZWF0dXJlcyB8IHVuZGVmaW5lZCA9IHVuZGVmaW5lZDtcclxuICBwcml2YXRlIF9wYXVzZU1hcEludGVyYWN0aW9uQ291bnQgPSAwO1xyXG5cclxuICAvKiBEaXNwb3NlcnMgKi9cclxuICBwcml2YXRlIHJlYWRvbmx5IF9kaXNwb3NlV29ya2JlbmNoTWFwSXRlbXNTdWJzY3JpcHRpb246ICgpID0+IHZvaWQ7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfZGlzcG9zZURpc2FibGVJbnRlcmFjdGlvblN1YnNjcmlwdGlvbjogKCkgPT4gdm9pZDtcclxuICBwcml2YXRlIF9kaXNwb3NlU2VsZWN0ZWRGZWF0dXJlU3Vic2NyaXB0aW9uPzogKCkgPT4gdm9pZDtcclxuICBwcml2YXRlIF9kaXNwb3NlU3BsaXR0ZXJSZWFjdGlvbjogKCkgPT4gdm9pZDtcclxuXHJcbiAgLy8gVGhlc2UgYXJlIHVzZWQgdG8gc3BsaXQgQ2VzaXVtVGlsZUxheWVyIGFuZCBNYXBib3hDYW52YXNWZWN0b3JUaWxlTGF5ZXJcclxuICBAb2JzZXJ2YWJsZSBzaXplOiBMLlBvaW50IHwgdW5kZWZpbmVkO1xyXG4gIEBvYnNlcnZhYmxlIG53OiBMLlBvaW50IHwgdW5kZWZpbmVkO1xyXG4gIEBvYnNlcnZhYmxlIHNlOiBMLlBvaW50IHwgdW5kZWZpbmVkO1xyXG5cclxuICBAYWN0aW9uXHJcbiAgcHJpdmF0ZSB1cGRhdGVNYXBPYnNlcnZhYmxlcygpIHtcclxuICAgIHRoaXMuc2l6ZSA9IHRoaXMubWFwLmdldFNpemUoKTtcclxuICAgIHRoaXMubncgPSB0aGlzLm1hcC5jb250YWluZXJQb2ludFRvTGF5ZXJQb2ludChbMCwgMF0pO1xyXG4gICAgdGhpcy5zZSA9IHRoaXMubWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KHRoaXMuc2l6ZSk7XHJcbiAgfVxyXG5cclxuICBwcml2YXRlIF9jcmVhdGVJbWFnZXJ5TGF5ZXI6IChcclxuICAgIGlwOiBJbWFnZXJ5UHJvdmlkZXIsXHJcbiAgICBjbGlwcGluZ1JlY3RhbmdsZTogUmVjdGFuZ2xlIHwgdW5kZWZpbmVkXHJcbiAgKSA9PiBHcmlkTGF5ZXIgPSBjb21wdXRlZEZuKChpcCwgY2xpcHBpbmdSZWN0YW5nbGUpID0+IHtcclxuICAgIGNvbnN0IGxheWVyT3B0aW9ucyA9IHtcclxuICAgICAgYm91bmRzOiBjbGlwcGluZ1JlY3RhbmdsZSAmJiByZWN0YW5nbGVUb0xhdExuZ0JvdW5kcyhjbGlwcGluZ1JlY3RhbmdsZSlcclxuICAgIH07XHJcbiAgICAvLyBXZSBoYXZlIHR3byBkaWZmZXJlbnQga2luZHMgb2YgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldCBsYXllcnNcclxuICAgIC8vIC0gR3JpZCBsYXllciB3aWxsIHVzZSB0aGUgSW1hZ2VyeVByb3ZpZGVyIGluIHRoZSBtb3JlIHRyYWRpdGlvbmFsIHdheSAtIGNhbGxpbmcgYHJlcXVlc3RJbWFnZWAgdG8gZHJhdyB0aGUgaW1hZ2Ugb24gdG8gYSBjYW52YXNcclxuICAgIC8vIC0gVGlsZSBsYXllciB3aWxsIHBhc3MgdGlsZSBVUkxzIHRvIGxlYWZsZXQgb2JqZWN0cyAtIHdoaWNoIGlzIGEgYml0IG1vcmUgXCJMZWFmbGV0eVwiIHRoYW4gR3JpZCBsYXllclxyXG4gICAgLy8gVGlsZSBsYXllciBpcyBwcmVmZXJyZWQuIEdyaWQgbGF5ZXIgbWFpbmx5IGV4aXN0cyBmb3IgY3VzdG9tIEltYWdlcnkgUHJvdmlkZXJzIHdoaWNoIGFyZW4ndCBqdXN0IGEgdGlsZSBvZiBpbWFnZSBVUkxzXHJcbiAgICBpZiAoc3VwcG9ydHNJbWFnZXJ5UHJvdmlkZXJHcmlkTGF5ZXIoaXApKSB7XHJcbiAgICAgIHJldHVybiBuZXcgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldEdyaWRMYXllcih0aGlzLCBpcCwgbGF5ZXJPcHRpb25zKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiBuZXcgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllcih0aGlzLCBpcCwgbGF5ZXJPcHRpb25zKTtcclxuICAgIH1cclxuICB9KTtcclxuXHJcbiAgcHJpdmF0ZSBfbWFrZUltYWdlcnlMYXllckZyb21QYXJ0cyhcclxuICAgIHBhcnRzOiBJbWFnZXJ5UGFydHMsXHJcbiAgICBpdGVtOiBNYXBwYWJsZU1peGluLkluc3RhbmNlXHJcbiAgKSB7XHJcbiAgICBpZiAoVGlsZUVycm9ySGFuZGxlck1peGluLmlzTWl4ZWRJbnRvKGl0ZW0pKSB7XHJcbiAgICAgIC8vIGJlY2F1c2UgdGhpcyBjb2RlIHBhdGggY2FuIHJ1biBtdWx0aXBsZSB0aW1lcywgbWFrZSBzdXJlIHdlIHJlbW92ZSB0aGVcclxuICAgICAgLy8gaGFuZGxlciBpZiBpdCBpcyBhbHJlYWR5IHJlZ2lzdGVyZWRcclxuICAgICAgcGFydHMuaW1hZ2VyeVByb3ZpZGVyLmVycm9yRXZlbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcclxuICAgICAgICBpdGVtLm9uVGlsZUxvYWRFcnJvcixcclxuICAgICAgICBpdGVtXHJcbiAgICAgICk7XHJcbiAgICAgIHBhcnRzLmltYWdlcnlQcm92aWRlci5lcnJvckV2ZW50LmFkZEV2ZW50TGlzdGVuZXIoXHJcbiAgICAgICAgaXRlbS5vblRpbGVMb2FkRXJyb3IsXHJcbiAgICAgICAgaXRlbVxyXG4gICAgICApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXMuX2NyZWF0ZUltYWdlcnlMYXllcihcclxuICAgICAgcGFydHMuaW1hZ2VyeVByb3ZpZGVyLFxyXG4gICAgICBwYXJ0cy5jbGlwcGluZ1JlY3RhbmdsZVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGNvbnN0cnVjdG9yKHRlcnJpYVZpZXdlcjogVGVycmlhVmlld2VyLCBjb250YWluZXI6IHN0cmluZyB8IEhUTUxFbGVtZW50KSB7XHJcbiAgICBzdXBlcigpO1xyXG4gICAgbWFrZU9ic2VydmFibGUodGhpcyk7XHJcbiAgICB0aGlzLnRlcnJpYSA9IHRlcnJpYVZpZXdlci50ZXJyaWE7XHJcbiAgICB0aGlzLnRlcnJpYVZpZXdlciA9IHRlcnJpYVZpZXdlcjtcclxuICAgIHRoaXMubWFwID0gTC5tYXAoY29udGFpbmVyLCB7XHJcbiAgICAgIHpvb21Db250cm9sOiBmYWxzZSxcclxuICAgICAgYXR0cmlidXRpb25Db250cm9sOiBmYWxzZSxcclxuICAgICAgem9vbVNuYXA6IDEsIC8vIENoYW5nZSB0byAgMC4yIGZvciBpbmNyZW1lbnRhbCB6b29tIHdoZW4gQ2hyb21lIGZpeGVzIGNhbnZhcyBzY2FsaW5nIGdhcHNcclxuICAgICAgcHJlZmVyQ2FudmFzOiB0cnVlLFxyXG4gICAgICB3b3JsZENvcHlKdW1wOiBmYWxzZVxyXG4gICAgfSkuc2V0VmlldyhbLTI4LjUsIDEzNV0sIDUpO1xyXG5cclxuICAgIHRoaXMubWFwLm9uKFwibW92ZVwiLCAoKSA9PiB0aGlzLnVwZGF0ZU1hcE9ic2VydmFibGVzKCkpO1xyXG4gICAgdGhpcy5tYXAub24oXCJ6b29tXCIsICgpID0+IHRoaXMudXBkYXRlTWFwT2JzZXJ2YWJsZXMoKSk7XHJcblxyXG4gICAgdGhpcy5zY2VuZSA9IG5ldyBMZWFmbGV0U2NlbmUodGhpcy5tYXApO1xyXG5cclxuICAgIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbCA9IG5ldyBMZWFmbGV0QXR0cmlidXRpb24odGhpcy50ZXJyaWEpO1xyXG4gICAgdGhpcy5tYXAuYWRkQ29udHJvbCh0aGlzLl9hdHRyaWJ1dGlvbkNvbnRyb2wpO1xyXG5cclxuICAgIHRoaXMuX2xlYWZsZXRWaXN1YWxpemVyID0gbmV3IExlYWZsZXRWaXN1YWxpemVyKCk7XHJcbiAgICB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3IgPSBuZXcgTGVhZmxldFNlbGVjdGlvbkluZGljYXRvcih0aGlzKTtcclxuXHJcbiAgICB0aGlzLmRhdGFTb3VyY2VEaXNwbGF5ID0gbmV3IExlYWZsZXREYXRhU291cmNlRGlzcGxheSh7XHJcbiAgICAgIHNjZW5lOiB0aGlzLnNjZW5lLFxyXG4gICAgICBkYXRhU291cmNlQ29sbGVjdGlvbjogdGhpcy5kYXRhU291cmNlcyxcclxuICAgICAgdmlzdWFsaXplcnNDYWxsYmFjazogPGFueT50aGlzLl9sZWFmbGV0VmlzdWFsaXplci52aXN1YWxpemVyc0NhbGxiYWNrIC8vIFRPRE86IGZpeCB0eXBlIGVycm9yXHJcbiAgICB9KTtcclxuXHJcbiAgICB0aGlzLl9ldmVudEhlbHBlciA9IG5ldyBFdmVudEhlbHBlcigpO1xyXG5cclxuICAgIHRoaXMuX2V2ZW50SGVscGVyLmFkZCh0aGlzLnRlcnJpYS50aW1lbGluZUNsb2NrLm9uVGljaywgPGFueT4oKFxyXG4gICAgICBjbG9jazogQ2xvY2tcclxuICAgICkgPT4ge1xyXG4gICAgICB0aGlzLmRhdGFTb3VyY2VEaXNwbGF5LnVwZGF0ZShjbG9jay5jdXJyZW50VGltZSk7XHJcbiAgICB9KSk7XHJcblxyXG4gICAgY29uc3QgdGlja2VyID0gKCkgPT4ge1xyXG4gICAgICBpZiAoIXRoaXMuX3N0b3BSZXF1ZXN0QW5pbWF0aW9uRnJhbWUpIHtcclxuICAgICAgICB0aGlzLnRlcnJpYS50aW1lbGluZUNsb2NrLnRpY2soKTtcclxuICAgICAgICB0aGlzLl9jZXNpdW1SZXFBbmltRnJhbWVJZCA9IGNlc2l1bVJlcXVlc3RBbmltYXRpb25GcmFtZSh0aWNrZXIpO1xyXG4gICAgICB9XHJcbiAgICB9O1xyXG5cclxuICAgIC8vIFN0YXJ0IHRpY2tlciBhc3luY2hyb25vdXNseSB0byBhdm9pZCBjYWxsaW5nIGFuIGFjdGlvbiBpbiB0aGUgY29uc2N0cnVjdG9yXHJcbiAgICBydW5MYXRlcih0aWNrZXIpO1xyXG5cclxuICAgIHRoaXMuX2Rpc3Bvc2VXb3JrYmVuY2hNYXBJdGVtc1N1YnNjcmlwdGlvbiA9IHRoaXMub2JzZXJ2ZU1vZGVsTGF5ZXIoKTtcclxuICAgIHRoaXMuX2Rpc3Bvc2VTcGxpdHRlclJlYWN0aW9uID0gdGhpcy5fcmVhY3RUb1NwbGl0dGVyQ2hhbmdlcygpO1xyXG5cclxuICAgIHRoaXMuX2Rpc3Bvc2VEaXNhYmxlSW50ZXJhY3Rpb25TdWJzY3JpcHRpb24gPSBhdXRvcnVuKCgpID0+IHtcclxuICAgICAgY29uc3QgbWFwID0gdGhpcy5tYXA7XHJcbiAgICAgIGNvbnN0IGludGVyYWN0aW9ucyA9IGZpbHRlck91dFVuZGVmaW5lZChbXHJcbiAgICAgICAgbWFwLnRvdWNoWm9vbSxcclxuICAgICAgICBtYXAuZG91YmxlQ2xpY2tab29tLFxyXG4gICAgICAgIG1hcC5zY3JvbGxXaGVlbFpvb20sXHJcbiAgICAgICAgbWFwLmJveFpvb20sXHJcbiAgICAgICAgbWFwLmtleWJvYXJkLFxyXG4gICAgICAgIG1hcC5kcmFnZ2luZyxcclxuICAgICAgICBtYXAudGFwXHJcbiAgICAgIF0pO1xyXG4gICAgICBjb25zdCBwaWNrTG9jYXRpb24gPSB0aGlzLnBpY2tMb2NhdGlvbi5iaW5kKHRoaXMpO1xyXG4gICAgICBjb25zdCBwaWNrRmVhdHVyZSA9IChlbnRpdHk6IEVudGl0eSwgZXZlbnQ6IEwuTGVhZmxldE1vdXNlRXZlbnQpID0+IHtcclxuICAgICAgICB0aGlzLl9mZWF0dXJlUGlja2VkKGVudGl0eSwgZXZlbnQpO1xyXG4gICAgICB9O1xyXG5cclxuICAgICAgLy8gVXBkYXRlIG1vdXNlIGNvb3JkcyBvbiBtb3VzZSBtb3ZlXHJcbiAgICAgIHRoaXMubWFwLm9uKFwibW91c2Vtb3ZlXCIsIChlOiBMLkxlYWZsZXRFdmVudCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1vdXNlRXZlbnQgPSA8TC5MZWFmbGV0TW91c2VFdmVudD5lO1xyXG4gICAgICAgIHRoaXMubW91c2VDb29yZHMudXBkYXRlQ29vcmRpbmF0ZXNGcm9tTGVhZmxldChcclxuICAgICAgICAgIHRoaXMudGVycmlhLFxyXG4gICAgICAgICAgbW91c2VFdmVudC5vcmlnaW5hbEV2ZW50XHJcbiAgICAgICAgKTtcclxuICAgICAgfSk7XHJcblxyXG4gICAgICBpZiAodGhpcy50ZXJyaWFWaWV3ZXIuZGlzYWJsZUludGVyYWN0aW9uKSB7XHJcbiAgICAgICAgaW50ZXJhY3Rpb25zLmZvckVhY2goKGhhbmRsZXIpID0+IGhhbmRsZXIuZGlzYWJsZSgpKTtcclxuICAgICAgICB0aGlzLm1hcC5vZmYoXCJjbGlja1wiLCBwaWNrTG9jYXRpb24pO1xyXG4gICAgICAgIHRoaXMuc2NlbmUuZmVhdHVyZUNsaWNrZWQucmVtb3ZlRXZlbnRMaXN0ZW5lcihwaWNrRmVhdHVyZSk7XHJcbiAgICAgICAgdGhpcy5fZGlzcG9zZVNlbGVjdGVkRmVhdHVyZVN1YnNjcmlwdGlvbiAmJlxyXG4gICAgICAgICAgdGhpcy5fZGlzcG9zZVNlbGVjdGVkRmVhdHVyZVN1YnNjcmlwdGlvbigpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGludGVyYWN0aW9ucy5mb3JFYWNoKChoYW5kbGVyKSA9PiBoYW5kbGVyLmVuYWJsZSgpKTtcclxuICAgICAgICB0aGlzLm1hcC5vbihcImNsaWNrXCIsIHBpY2tMb2NhdGlvbik7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5mZWF0dXJlQ2xpY2tlZC5hZGRFdmVudExpc3RlbmVyKHBpY2tGZWF0dXJlKTtcclxuICAgICAgICB0aGlzLl9kaXNwb3NlU2VsZWN0ZWRGZWF0dXJlU3Vic2NyaXB0aW9uID0gYXV0b3J1bigoKSA9PiB7XHJcbiAgICAgICAgICBjb25zdCBmZWF0dXJlID0gdGhpcy50ZXJyaWEuc2VsZWN0ZWRGZWF0dXJlO1xyXG4gICAgICAgICAgdGhpcy5fc2VsZWN0RmVhdHVyZShmZWF0dXJlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgfVxyXG4gICAgfSk7XHJcblxyXG4gICAgdGhpcy5faW5pdFByb2dyZXNzRXZlbnQoKTtcclxuICB9XHJcblxyXG4gIGdldCBhdHRyaWJ1dGlvblByZWZpeCgpIHtcclxuICAgIHJldHVybiB0aGlzLl9hdHRyaWJ1dGlvbkNvbnRyb2wucHJlZml4O1xyXG4gIH1cclxuXHJcbiAgQGNvbXB1dGVkXHJcbiAgZ2V0IGF0dHJpYnV0aW9ucygpIHtcclxuICAgIHJldHVybiB0aGlzLl9hdHRyaWJ1dGlvbkNvbnRyb2wuZGF0YUF0dHJpYnV0aW9ucztcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIHNldHMgdXAgbG9hZGluZyBsaXN0ZW5lcnNcclxuICAgKi9cclxuICBwcml2YXRlIF9pbml0UHJvZ3Jlc3NFdmVudCgpIHtcclxuICAgIGNvbnN0IG9uVGlsZUxvYWRDaGFuZ2UgPSAoKSA9PiB7XHJcbiAgICAgIHZhciB0aWxlc0xvYWRpbmdDb3VudCA9IDA7XHJcblxyXG4gICAgICB0aGlzLm1hcC5lYWNoTGF5ZXIoZnVuY3Rpb24gKGxheWVyT3JHcmlkbGF5ZXIpIHtcclxuICAgICAgICAvLyBfdGlsZXMgaXMgcHJvdGVjdGVkIGJ1dCBvdXIga25vY2tvdXQtbG9hZGluZy1sb2dpYyBhY2Nlc3NlcyBpdCBoZXJlIGFueXdheVxyXG4gICAgICAgIGNvbnN0IGxheWVyID0gbGF5ZXJPckdyaWRsYXllciBhcyBhbnk7XHJcbiAgICAgICAgaWYgKGxheWVyPy5fdGlsZXMpIHtcclxuICAgICAgICAgIC8vIENvdW50IGFsbCB0aWxlcyBub3QgbWFya2VkIGFzIGxvYWRlZFxyXG4gICAgICAgICAgdGlsZXNMb2FkaW5nQ291bnQgKz0gT2JqZWN0LmtleXMobGF5ZXIuX3RpbGVzKS5maWx0ZXIoXHJcbiAgICAgICAgICAgIChrZXkpID0+ICFsYXllci5fdGlsZXNba2V5XS5sb2FkZWRcclxuICAgICAgICAgICkubGVuZ3RoO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICB0aGlzLl91cGRhdGVUaWxlc0xvYWRpbmdDb3VudCh0aWxlc0xvYWRpbmdDb3VudCk7XHJcbiAgICB9O1xyXG5cclxuICAgIHRoaXMubWFwLm9uKFxyXG4gICAgICBcImxheWVyYWRkXCIsXHJcbiAgICAgIGZ1bmN0aW9uIChldnQ6IGFueSkge1xyXG4gICAgICAgIC8vIFRoaXMgY2hlY2sgbWFrZXMgc3VyZSB3ZSBvbmx5IHdhdGNoIHRpbGUgbGF5ZXJzLCBhbmQgYWxzbyBwcm90ZWN0cyB1cyBpZiB0aGlzIHByaXZhdGUgdmFyaWFibGUgZ2V0cyBjaGFuZ2VkLlxyXG4gICAgICAgIGlmICh0eXBlb2YgZXZ0LmxheWVyLl90aWxlcyAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgICAgICAgZXZ0LmxheWVyLm9uKFwidGlsZWxvYWRzdGFydCB0aWxlbG9hZCBsb2FkXCIsIG9uVGlsZUxvYWRDaGFuZ2UpO1xyXG4gICAgICAgIH1cclxuICAgICAgfS5iaW5kKHRoaXMpXHJcbiAgICApO1xyXG5cclxuICAgIHRoaXMubWFwLm9uKFxyXG4gICAgICBcImxheWVycmVtb3ZlXCIsXHJcbiAgICAgIGZ1bmN0aW9uIChldnQ6IGFueSkge1xyXG4gICAgICAgIGV2dC5sYXllci5vZmYoXCJ0aWxlbG9hZHN0YXJ0IHRpbGVsb2FkIGxvYWRcIiwgb25UaWxlTG9hZENoYW5nZSk7XHJcbiAgICAgIH0uYmluZCh0aGlzKVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIFBpY2sgZmVhdHVyZSBmcm9tIG1vdXNlIGNsaWNrIGV2ZW50LlxyXG4gICAqL1xyXG4gIHByaXZhdGUgcGlja0xvY2F0aW9uKGU6IEwuTGVhZmxldEV2ZW50KSB7XHJcbiAgICBjb25zdCBtb3VzZUV2ZW50ID0gPEwuTGVhZmxldE1vdXNlRXZlbnQ+ZTtcclxuXHJcbiAgICAvLyBIYW5kbGUgY2xpY2sgZXZlbnRzIHRoYXQgY3Jvc3MgdGhlIGFudGktbWVyaWRpYW5cclxuICAgIGlmIChtb3VzZUV2ZW50LmxhdGxuZy5sbmcgPiAxODAgfHwgbW91c2VFdmVudC5sYXRsbmcubG5nIDwgLTE4MCkge1xyXG4gICAgICBtb3VzZUV2ZW50LmxhdGxuZyA9IG1vdXNlRXZlbnQubGF0bG5nLndyYXAoKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBpZiAoIXRoaXMuX2RyYWdib3hjb21wbGV0ZWQgJiYgdGhhdC5tYXAuZHJhZ2dpbmcuZW5hYmxlZCgpKSB7XHJcbiAgICB0aGlzLl9waWNrRmVhdHVyZXMobW91c2VFdmVudC5sYXRsbmcpO1xyXG4gICAgLy8gfVxyXG4gICAgLy8gdGhpcy5fZHJhZ2JveGNvbXBsZXRlZCA9IGZhbHNlO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q29udGFpbmVyKCkge1xyXG4gICAgcmV0dXJuIHRoaXMubWFwLmdldENvbnRhaW5lcigpO1xyXG4gIH1cclxuXHJcbiAgcGF1c2VNYXBJbnRlcmFjdGlvbigpIHtcclxuICAgICsrdGhpcy5fcGF1c2VNYXBJbnRlcmFjdGlvbkNvdW50O1xyXG4gICAgaWYgKHRoaXMuX3BhdXNlTWFwSW50ZXJhY3Rpb25Db3VudCA9PT0gMSkge1xyXG4gICAgICB0aGlzLm1hcC5kcmFnZ2luZy5kaXNhYmxlKCk7XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICByZXN1bWVNYXBJbnRlcmFjdGlvbigpIHtcclxuICAgIC0tdGhpcy5fcGF1c2VNYXBJbnRlcmFjdGlvbkNvdW50O1xyXG4gICAgaWYgKHRoaXMuX3BhdXNlTWFwSW50ZXJhY3Rpb25Db3VudCA9PT0gMCkge1xyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBpZiAodGhpcy5fcGF1c2VNYXBJbnRlcmFjdGlvbkNvdW50ID09PSAwKSB7XHJcbiAgICAgICAgICB0aGlzLm1hcC5kcmFnZ2luZy5lbmFibGUoKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0sIDApO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIHRoaXMuX2Rpc3Bvc2VTZWxlY3RlZEZlYXR1cmVTdWJzY3JpcHRpb24gJiZcclxuICAgICAgdGhpcy5fZGlzcG9zZVNlbGVjdGVkRmVhdHVyZVN1YnNjcmlwdGlvbigpO1xyXG4gICAgdGhpcy5fZGlzcG9zZVNwbGl0dGVyUmVhY3Rpb24oKTtcclxuICAgIHRoaXMuX2Rpc3Bvc2VXb3JrYmVuY2hNYXBJdGVtc1N1YnNjcmlwdGlvbigpO1xyXG4gICAgdGhpcy5fZXZlbnRIZWxwZXIucmVtb3ZlQWxsKCk7XHJcbiAgICB0aGlzLl9kaXNwb3NlRGlzYWJsZUludGVyYWN0aW9uU3Vic2NyaXB0aW9uKCk7XHJcbiAgICAvLyBUaGlzIHZhcmlhYmxlIHByZXZlbnRzIGEgcmFjZSBjb25kaXRpb24gaWYgZGVzdHJveSgpIGlzIGNhbGxlZFxyXG4gICAgLy8gc3luY2hyb25vdXNseSBhcyBhIHJlc3VsdCBvZiB0aW1lbGluZUNsb2NrIHRpY2tpbmcgZHVlIHRvIHRpY2tlcigpXHJcbiAgICB0aGlzLl9zdG9wUmVxdWVzdEFuaW1hdGlvbkZyYW1lID0gdHJ1ZTtcclxuICAgIGlmIChpc0RlZmluZWQodGhpcy5fY2VzaXVtUmVxQW5pbUZyYW1lSWQpKSB7XHJcbiAgICAgIGNlc2l1bUNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuX2Nlc2l1bVJlcUFuaW1GcmFtZUlkKTtcclxuICAgIH1cclxuICAgIHRoaXMuZGF0YVNvdXJjZURpc3BsYXkuZGVzdHJveSgpO1xyXG4gICAgdGhpcy5tYXAub2ZmKFwibW92ZVwiKTtcclxuICAgIHRoaXMubWFwLm9mZihcInpvb21cIik7XHJcbiAgICB0aGlzLm1hcC5yZW1vdmUoKTtcclxuICB9XHJcblxyXG4gIEBjb21wdXRlZFxyXG4gIGdldCBhdmFpbGFibGVDYXRhbG9nSXRlbXMoKSB7XHJcbiAgICBjb25zdCBjYXRhbG9nSXRlbXMgPSBbXHJcbiAgICAgIC4uLnRoaXMudGVycmlhVmlld2VyLml0ZW1zLmdldCgpLFxyXG4gICAgICB0aGlzLnRlcnJpYVZpZXdlci5iYXNlTWFwXHJcbiAgICBdO1xyXG4gICAgcmV0dXJuIGNhdGFsb2dJdGVtcztcclxuICB9XHJcblxyXG4gIEBjb21wdXRlZFxyXG4gIGdldCBhdmFpbGFibGVEYXRhU291cmNlcygpIHtcclxuICAgIGNvbnN0IGNhdGFsb2dJdGVtcyA9IHRoaXMuYXZhaWxhYmxlQ2F0YWxvZ0l0ZW1zO1xyXG4gICAgLyogSGFuZGxlIGRhdGFzb3VyY2VzICovXHJcbiAgICBjb25zdCBhbGxNYXBJdGVtcyA9IChbXSBhcyBNYXBJdGVtW10pLmNvbmNhdChcclxuICAgICAgLi4uY2F0YWxvZ0l0ZW1zLmZpbHRlcihpc0RlZmluZWQpLm1hcCgoaXRlbSkgPT4gaXRlbS5tYXBJdGVtcylcclxuICAgICk7XHJcbiAgICBjb25zdCBkYXRhU291cmNlcyA9IGFsbE1hcEl0ZW1zLmZpbHRlcihpc0RhdGFTb3VyY2UpO1xyXG4gICAgcmV0dXJuIGRhdGFTb3VyY2VzO1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBvYnNlcnZlTW9kZWxMYXllcigpIHtcclxuICAgIC8vIFNldHVwIHJlYWN0aW9uIHRvIHN5bmMgZGF0U291cmNlcyBjb2xsZWN0aW9uIHdpdGggYXZhaWxhYmxlRGF0YVNvdXJjZXNcclxuICAgIC8vXHJcbiAgICAvLyBUbyBhdm9pZCBidWdneSBjb25jdXJyZW50IHN5bmNzLCB3ZSBoYXZlIHRvIGVuc3VyZSB0aGF0IGV2ZW4gd2hlblxyXG4gICAgLy8gbXVsdGlwbGUgc3luYyByZWFjdGlvbnMgYXJlIHRyaWdnZXJlZCwgd2UgcnVuIHRoZW0gb25lIGFmdGVyIHRoZVxyXG4gICAgLy8gb3RoZXIuIFRvIGRvIHRoaXMsIHdlIG1ha2UgZWFjaCBydW4gb2YgdGhlIHJlYWN0aW9uIHdhaXQgZm9yIHRoZVxyXG4gICAgLy8gcHJldmlvdXMgYHN5bmNEYXRhU291cmNlc1Byb21pc2VgIHRvIGZpbmlzaCBiZWZvcmUgc3RhcnRpbmcgaXRzZWxmLlxyXG4gICAgbGV0IHN5bmNEYXRhU291cmNlc1Byb21pc2U6IFByb21pc2U8dm9pZD4gPSBQcm9taXNlLnJlc29sdmUoKTtcclxuICAgIGNvbnN0IGRhdGFTb3VyY2VzUmVhY3Rpb25EaXNwb3NlciA9IHJlYWN0aW9uKFxyXG4gICAgICAoKSA9PiB0aGlzLmF2YWlsYWJsZURhdGFTb3VyY2VzLFxyXG4gICAgICAoKSA9PiB7XHJcbiAgICAgICAgc3luY0RhdGFTb3VyY2VzUHJvbWlzZSA9IHN5bmNEYXRhU291cmNlc1Byb21pc2VcclxuICAgICAgICAgIC50aGVuKGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgYXdhaXQgdGhpcy5zeW5jRGF0YVNvdXJjZUNvbGxlY3Rpb24oXHJcbiAgICAgICAgICAgICAgdGhpcy5hdmFpbGFibGVEYXRhU291cmNlcyxcclxuICAgICAgICAgICAgICB0aGlzLmRhdGFTb3VyY2VzXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHRoaXMubm90aWZ5UmVwYWludFJlcXVpcmVkKCk7XHJcbiAgICAgICAgICB9KVxyXG4gICAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xyXG4gICAgICB9LFxyXG4gICAgICB7IGZpcmVJbW1lZGlhdGVseTogdHJ1ZSB9XHJcbiAgICApO1xyXG5cclxuICAgIC8vIFJlYWN0aW9uIHRvIHN5bmMgaW1hZ2VyeSBmcm9tIG1vZGVsIGxheWVyIHdpdGggY2VzaXVtIG1hcFxyXG4gICAgY29uc3QgaW1hZ2VyeVJlYWN0aW9uRGlzcG9zZXIgPSBhdXRvcnVuKCgpID0+IHtcclxuICAgICAgY29uc3QgY2F0YWxvZ0l0ZW1zID0gdGhpcy5hdmFpbGFibGVDYXRhbG9nSXRlbXM7XHJcbiAgICAgIC8vIEZsYXRtYXBcclxuICAgICAgY29uc3QgYWxsSW1hZ2VyeU1hcEl0ZW1zID0gKFxyXG4gICAgICAgIFtdIGFzIHtcclxuICAgICAgICAgIGl0ZW06IE1hcHBhYmxlTWl4aW4uSW5zdGFuY2U7XHJcbiAgICAgICAgICBwYXJ0czogSW1hZ2VyeVBhcnRzO1xyXG4gICAgICAgIH1bXVxyXG4gICAgICApLmNvbmNhdChcclxuICAgICAgICAuLi5jYXRhbG9nSXRlbXNcclxuICAgICAgICAgIC5maWx0ZXIoaXNEZWZpbmVkKVxyXG4gICAgICAgICAgLm1hcCgoaXRlbSkgPT5cclxuICAgICAgICAgICAgaXRlbS5tYXBJdGVtc1xyXG4gICAgICAgICAgICAgIC5maWx0ZXIoSW1hZ2VyeVBhcnRzLmlzKVxyXG4gICAgICAgICAgICAgIC5tYXAoKHBhcnRzOiBJbWFnZXJ5UGFydHMpID0+ICh7IGl0ZW0sIHBhcnRzIH0pKVxyXG4gICAgICAgICAgKVxyXG4gICAgICApO1xyXG5cclxuICAgICAgY29uc3QgYWxsSW1hZ2VyeSA9IGFsbEltYWdlcnlNYXBJdGVtcy5tYXAoKHsgaXRlbSwgcGFydHMgfSkgPT4ge1xyXG4gICAgICAgIGlmIChoYXNUcmFpdHMoaXRlbSwgSW1hZ2VyeVByb3ZpZGVyVHJhaXRzLCBcImxlYWZsZXRVcGRhdGVJbnRlcnZhbFwiKSkge1xyXG4gICAgICAgICAgKHBhcnRzLmltYWdlcnlQcm92aWRlciBhcyBhbnkpLl9sZWFmbGV0VXBkYXRlSW50ZXJ2YWwgPVxyXG4gICAgICAgICAgICBpdGVtLmxlYWZsZXRVcGRhdGVJbnRlcnZhbDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIHBhcnRzOiBwYXJ0cyxcclxuICAgICAgICAgIGxheWVyOiB0aGlzLl9tYWtlSW1hZ2VyeUxheWVyRnJvbVBhcnRzKHBhcnRzLCBpdGVtKVxyXG4gICAgICAgIH07XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgLy8gRGVsZXRlIGltYWdlcnkgbGF5ZXJzIG5vIGxvbmdlciBpbiB0aGUgbW9kZWxcclxuICAgICAgdGhpcy5tYXAuZWFjaExheWVyKChtYXBMYXllcikgPT4ge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIGlzSW1hZ2VyeUxheWVyKG1hcExheWVyKSB8fFxyXG4gICAgICAgICAgbWFwTGF5ZXIgaW5zdGFuY2VvZiBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0R3JpZExheWVyXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICBjb25zdCBpbmRleCA9IGFsbEltYWdlcnkuZmluZEluZGV4KChpbSkgPT4gaW0ubGF5ZXIgPT09IG1hcExheWVyKTtcclxuICAgICAgICAgIGlmIChpbmRleCA9PT0gLTEpIHtcclxuICAgICAgICAgICAgdGhpcy5tYXAucmVtb3ZlTGF5ZXIobWFwTGF5ZXIpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBBZGQgbGF5ZXIgYW5kIHVwZGF0ZSBpdHMgekluZGV4XHJcbiAgICAgIGxldCB6SW5kZXggPSAxMDA7IC8vIFN0YXJ0IGF0IGFuIGFyYml0cmFyeSB2YWx1ZVxyXG4gICAgICBhbGxJbWFnZXJ5LnJldmVyc2UoKS5mb3JFYWNoKCh7IHBhcnRzLCBsYXllciB9KSA9PiB7XHJcbiAgICAgICAgaWYgKHBhcnRzLnNob3cpIHtcclxuICAgICAgICAgIGxheWVyLnNldE9wYWNpdHkocGFydHMuYWxwaGEpO1xyXG4gICAgICAgICAgbGF5ZXIuc2V0WkluZGV4KHpJbmRleCk7XHJcbiAgICAgICAgICB6SW5kZXgrKztcclxuXHJcbiAgICAgICAgICBpZiAoIXRoaXMubWFwLmhhc0xheWVyKGxheWVyKSkge1xyXG4gICAgICAgICAgICB0aGlzLm1hcC5hZGRMYXllcihsYXllcik7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgIHRoaXMubWFwLnJlbW92ZUxheWVyKGxheWVyKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgZGF0YVNvdXJjZXNSZWFjdGlvbkRpc3Bvc2VyKCk7XHJcbiAgICAgIGltYWdlcnlSZWFjdGlvbkRpc3Bvc2VyKCk7XHJcbiAgICB9O1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogU3luY3MgdGhlIGBkYXRhU291cmNlc2AgY29sbGVjdGlvbiBhZ2FpbnN0IHRoZSBsYXRlc3QgYGF2YWlsYWJsZURhdGFTb3VyY2VzYC5cclxuICAgKlxyXG4gICAqL1xyXG4gIHByaXZhdGUgYXN5bmMgc3luY0RhdGFTb3VyY2VDb2xsZWN0aW9uKFxyXG4gICAgYXZhaWxhYmxlRGF0YVNvdXJjZXM6IERhdGFTb3VyY2VbXSxcclxuICAgIGRhdGFTb3VyY2VzOiBEYXRhU291cmNlQ29sbGVjdGlvblxyXG4gICkge1xyXG4gICAgLy8gMS4gUmVtb3ZlIGRlbGV0ZWQgZGF0YSBzb3VyY2VzXHJcbiAgICAvL1xyXG4gICAgLy8gSXRlcmF0ZSBiYWNrd2FyZHMgYmVjYXVzZSB3ZSdyZSByZW1vdmluZyBpdGVtcy5cclxuICAgIGZvciAobGV0IGkgPSBkYXRhU291cmNlcy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkge1xyXG4gICAgICBjb25zdCBkcyA9IGRhdGFTb3VyY2VzLmdldChpKTtcclxuICAgICAgaWYgKGF2YWlsYWJsZURhdGFTb3VyY2VzLmluZGV4T2YoZHMpID09PSAtMSB8fCAhZHMuc2hvdykge1xyXG4gICAgICAgIGRhdGFTb3VyY2VzLnJlbW92ZShkcyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyAyLiBBZGQgbmV3IGRhdGEgc291cmNlc1xyXG4gICAgZm9yIChsZXQgZHMgb2YgYXZhaWxhYmxlRGF0YVNvdXJjZXMpIHtcclxuICAgICAgaWYgKCFkYXRhU291cmNlcy5jb250YWlucyhkcykgJiYgZHMuc2hvdykge1xyXG4gICAgICAgIGF3YWl0IGRhdGFTb3VyY2VzLmFkZChkcyk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvLyAzLiBFbnN1cmUgc3RhY2tpbmcgb3JkZXIgbWF0Y2hlcyBvcmRlciBpbiBgYXZhaWxhYmxlRGF0YVNvdXJjZXNgIC0gZmlyc3QgaXRlbSBhcHBlYXJzIG9uIHRvcC5cclxuICAgIHJ1bkluQWN0aW9uKCgpID0+XHJcbiAgICAgIGF2YWlsYWJsZURhdGFTb3VyY2VzLmZvckVhY2goKGRzKSA9PiB7XHJcbiAgICAgICAgLy8gVGhlcmUgaXMgYSBidWdneS91bi1pbnRlbmRlZCBzaWRlLWVmZmVjdCB3aGVuIGNhbGxpbmcgcmFpc2VUb1RvcCgpIHdpdGhcclxuICAgICAgICAvLyBhIHNvdXJjZSB0aGF0IGRvZXNuJ3QgZXhpc3QgaW4gdGhlIGNvbGxlY3Rpb24uIERvaW5nIHRoaXMgd2lsbCByZXBsYWNlXHJcbiAgICAgICAgLy8gdGhlIGxhc3QgZW50cnkgaW4gdGhlIGNvbGxlY3Rpb24gd2l0aCB0aGUgbmV3IG9uZS4gU28gd2Ugc2hvdWxkIGJlXHJcbiAgICAgICAgLy8gY2FyZWZ1bCB0byByYWlzZVRvVG9wKCkgb25seSBpZiB0aGUgRFMgYWxyZWFkeSBleGlzdHMgaW4gdGhlIGNvbGxlY3Rpb24uXHJcbiAgICAgICAgLy8gUmVsZXZhbnQgY29kZTpcclxuICAgICAgICAvLyAgIGh0dHBzOi8vZ2l0aHViLmNvbS9DZXNpdW1HUy9jZXNpdW0vYmxvYi9kYmQ0NTIzMjhhNDhiZmM0ZTE5MjE0Njg2MmE5ZjhmYTE1Nzg5ZGM4L3BhY2thZ2VzL2VuZ2luZS9Tb3VyY2UvRGF0YVNvdXJjZXMvRGF0YVNvdXJjZUNvbGxlY3Rpb24uanMjTDI5OC1MMjk5XHJcbiAgICAgICAgZGF0YVNvdXJjZXMuY29udGFpbnMoZHMpICYmIGRhdGFTb3VyY2VzLnJhaXNlVG9Ub3AoZHMpO1xyXG4gICAgICB9KVxyXG4gICAgKTtcclxuICB9XHJcblxyXG4gIGRvWm9vbVRvKFxyXG4gICAgdGFyZ2V0OiBDYW1lcmFWaWV3IHwgUmVjdGFuZ2xlIHwgRGF0YVNvdXJjZSB8IE1hcHBhYmxlTWl4aW4uSW5zdGFuY2UgfCBhbnksXHJcbiAgICBmbGlnaHREdXJhdGlvblNlY29uZHM6IG51bWJlciA9IDMuMFxyXG4gICk6IFByb21pc2U8dm9pZD4ge1xyXG4gICAgaWYgKCFpc0RlZmluZWQodGFyZ2V0KSkge1xyXG4gICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCk7XHJcbiAgICAgIC8vdGhyb3cgbmV3IERldmVsb3BlckVycm9yKFwidGFyZ2V0IGlzIHJlcXVpcmVkLlwiKTtcclxuICAgIH1cclxuICAgIGxldCBib3VuZHM7XHJcblxyXG4gICAgLy8gVGFyZ2V0IGlzIGEgS01MIGRhdGEgc291cmNlXHJcbiAgICBpZiAoaXNEZWZpbmVkKHRhcmdldC5lbnRpdGllcykpIHtcclxuICAgICAgaWYgKGlzRGVmaW5lZCh0aGlzLmRhdGFTb3VyY2VEaXNwbGF5KSkge1xyXG4gICAgICAgIGJvdW5kcyA9IHRoaXMuZGF0YVNvdXJjZURpc3BsYXkuZ2V0TGF0TG5nQm91bmRzKHRhcmdldCk7XHJcbiAgICAgIH1cclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGxldCBleHRlbnQ7XHJcblxyXG4gICAgICBpZiAodGFyZ2V0IGluc3RhbmNlb2YgUmVjdGFuZ2xlKSB7XHJcbiAgICAgICAgZXh0ZW50ID0gdGFyZ2V0O1xyXG4gICAgICB9IGVsc2UgaWYgKHRhcmdldCBpbnN0YW5jZW9mIENhbWVyYVZpZXcpIHtcclxuICAgICAgICBleHRlbnQgPSB0YXJnZXQucmVjdGFuZ2xlO1xyXG4gICAgICB9IGVsc2UgaWYgKE1hcHBhYmxlTWl4aW4uaXNNaXhlZEludG8odGFyZ2V0KSkge1xyXG4gICAgICAgIGlmIChpc0RlZmluZWQodGFyZ2V0LmNlc2l1bVJlY3RhbmdsZSkpIHtcclxuICAgICAgICAgIGV4dGVudCA9IHRhcmdldC5jZXNpdW1SZWN0YW5nbGU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghaXNEZWZpbmVkKGV4dGVudCkpIHtcclxuICAgICAgICAgIC8vIFpvb20gdG8gdGhlIGZpcnN0IGl0ZW0hXHJcbiAgICAgICAgICByZXR1cm4gdGhpcy5kb1pvb21Ubyh0YXJnZXQubWFwSXRlbXNbMF0sIGZsaWdodER1cmF0aW9uU2Vjb25kcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGV4dGVudCA9IHRhcmdldC5yZWN0YW5nbGU7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIC8vIEFjY291bnQgZm9yIGEgYm91bmRpbmcgYm94IGNyb3NzaW5nIHRoZSBkYXRlIGxpbmUuXHJcbiAgICAgIGlmIChleHRlbnQuZWFzdCA8IGV4dGVudC53ZXN0KSB7XHJcbiAgICAgICAgZXh0ZW50ID0gUmVjdGFuZ2xlLmNsb25lKGV4dGVudCk7XHJcbiAgICAgICAgZXh0ZW50LmVhc3QgKz0gQ2VzaXVtTWF0aC5UV09fUEk7XHJcbiAgICAgIH1cclxuICAgICAgYm91bmRzID0gcmVjdGFuZ2xlVG9MYXRMbmdCb3VuZHMoZXh0ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBpZiAoaXNEZWZpbmVkKGJvdW5kcykpIHtcclxuICAgICAgdGhpcy5tYXAuZmx5VG9Cb3VuZHMoYm91bmRzLCB7XHJcbiAgICAgICAgYW5pbWF0ZTogZmxpZ2h0RHVyYXRpb25TZWNvbmRzID4gMC4wLFxyXG4gICAgICAgIGR1cmF0aW9uOiBmbGlnaHREdXJhdGlvblNlY29uZHNcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgpO1xyXG4gIH1cclxuXHJcbiAgZ2V0Q3VycmVudENhbWVyYVZpZXcoKTogQ2FtZXJhVmlldyB7XHJcbiAgICBjb25zdCBib3VuZHMgPSB0aGlzLm1hcC5nZXRCb3VuZHMoKTtcclxuICAgIHJldHVybiBuZXcgQ2FtZXJhVmlldyhcclxuICAgICAgUmVjdGFuZ2xlLmZyb21EZWdyZWVzKFxyXG4gICAgICAgIGJvdW5kcy5nZXRXZXN0KCksXHJcbiAgICAgICAgYm91bmRzLmdldFNvdXRoKCksXHJcbiAgICAgICAgYm91bmRzLmdldEVhc3QoKSxcclxuICAgICAgICBib3VuZHMuZ2V0Tm9ydGgoKVxyXG4gICAgICApXHJcbiAgICApO1xyXG4gIH1cclxuXHJcbiAgbm90aWZ5UmVwYWludFJlcXVpcmVkKCkge1xyXG4gICAgLy8gTm8gYWN0aW9uIG5lY2Vzc2FyeS5cclxuICB9XHJcblxyXG4gIHBpY2tGcm9tTG9jYXRpb24oXHJcbiAgICBsYXRMbmdIZWlnaHQ6IExhdExvbkhlaWdodCxcclxuICAgIHByb3ZpZGVyQ29vcmRzOiBQcm92aWRlckNvb3Jkc01hcCxcclxuICAgIGV4aXN0aW5nRmVhdHVyZXM6IFRlcnJpYUZlYXR1cmVbXVxyXG4gICkge1xyXG4gICAgdGhpcy5fcGlja0ZlYXR1cmVzKFxyXG4gICAgICBMLmxhdExuZyh7XHJcbiAgICAgICAgbGF0OiBsYXRMbmdIZWlnaHQubGF0aXR1ZGUsXHJcbiAgICAgICAgbG5nOiBsYXRMbmdIZWlnaHQubG9uZ2l0dWRlLFxyXG4gICAgICAgIGFsdDogbGF0TG5nSGVpZ2h0LmhlaWdodFxyXG4gICAgICB9KSxcclxuICAgICAgcHJvdmlkZXJDb29yZHMsXHJcbiAgICAgIGV4aXN0aW5nRmVhdHVyZXNcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKlxyXG4gICAqIFRoZXJlIGFyZSB0d28gXCJsaXN0ZW5lcnNcIiBmb3IgY2xpY2tzIHdoaWNoIGFyZSBzZXQgdXAgaW4gb3VyIGNvbnN0cnVjdG9yLlxyXG4gICAqIC0gT25lIGZpcmVzIGZvciBhbnkgY2xpY2s6IGBtYXAub24oJ2NsaWNrJywgLi4uYC4gIEl0IGNhbGxzIGBwaWNrRmVhdHVyZXNgLlxyXG4gICAqIC0gT25lIGZpcmVzIG9ubHkgZm9yIHZlY3RvciBmZWF0dXJlczogYHRoaXMuc2NlbmUuZmVhdHVyZUNsaWNrZWQuYWRkRXZlbnRMaXN0ZW5lcmAuXHJcbiAgICogICAgSXQgY2FsbHMgYGZlYXR1cmVQaWNrZWRgLCB3aGljaCBjYWxscyBgcGlja0ZlYXR1cmVzYCBhbmQgdGhlbiBhZGRzIHRoZSBmZWF0dXJlIGl0IGZvdW5kLCBpZiBhbnkuXHJcbiAgICogVGhlc2UgZXZlbnRzIGNhbiBmaXJlIGluIGVpdGhlciBvcmRlci5cclxuICAgKiBCaWxsYm9hcmRzIGRvIG5vdCBmaXJlIHRoZSBmaXJzdCBldmVudC5cclxuICAgKlxyXG4gICAqIE5vdGUgdGhhdCBgcGlja0ZlYXR1cmVzYCBkb2VzIG5vdGhpbmcgaWYgYGxlYWZsZXQuX3BpY2tlZEZlYXR1cmVzYCBpcyBhbHJlYWR5IHNldC5cclxuICAgKiBPdGhlcndpc2UsIGl0IHNldHMgaXQsIHJ1bnMgYHJ1bkxhdGVyYCB0byBjbGVhciBpdCwgYW5kIHN0YXJ0cyB0aGUgYXN5bmNocm9ub3VzIHJhc3RlciBmZWF0dXJlIHBpY2tpbmcuXHJcbiAgICpcclxuICAgKiBTbzpcclxuICAgKiBJZiBvbmx5IHRoZSBmaXJzdCBldmVudCBpcyByZWNlaXZlZCwgaXQgdHJpZ2dlcnMgdGhlIHJhc3Rlci1mZWF0dXJlIHBpY2tpbmcgYXMgZGVzaXJlZC5cclxuICAgKiBJZiBib3RoIGFyZSByZWNlaXZlZCBpbiB0aGUgb3JkZXIgYWJvdmUsIHRoZSBzZWNvbmQgYWRkcyB0aGUgdmVjdG9yIGZlYXR1cmVzIHRvIHRoZSBsaXN0IG9mIHJhc3RlciBmZWF0dXJlcyBhcyBkZXNpcmVkLlxyXG4gICAqIElmIGJvdGggYXJlIHJlY2VpdmVkIGluIHRoZSByZXZlcnNlIG9yZGVyLCB0aGUgdmVjdG9yLWZlYXR1cmUgY2xpY2sga2lja3Mgb2ZmIHRoZSBzYW1lIGJlaGF2aW9yIGFzIHRoZSBvdGhlciBjbGljayB3b3VsZCBoYXZlO1xyXG4gICAqIGFuZCB3aGVuIHRoZSBuZXh0IGNsaWNrIGlzIHJlY2VpdmVkLCBpdCBpcyBpZ25vcmVkIC0gYWdhaW4sIGFzIGRlc2lyZWQuXHJcbiAgICovXHJcblxyXG4gIEBhY3Rpb25cclxuICBwcml2YXRlIF9mZWF0dXJlUGlja2VkKGVudGl0eTogRW50aXR5LCBldmVudDogTC5MZWFmbGV0TW91c2VFdmVudCkge1xyXG4gICAgdGhpcy5fcGlja0ZlYXR1cmVzKGV2ZW50LmxhdGxuZyk7XHJcblxyXG4gICAgLy8gSWdub3JlIGNsaWNrcyBvbiB0aGUgZmVhdHVyZSBoaWdobGlnaHQuXHJcbiAgICBpZiAoZW50aXR5LmVudGl0eUNvbGxlY3Rpb24gJiYgZW50aXR5LmVudGl0eUNvbGxlY3Rpb24ub3duZXIpIHtcclxuICAgICAgY29uc3Qgb3duZXIgPSBlbnRpdHkuZW50aXR5Q29sbGVjdGlvbi5vd25lcjtcclxuICAgICAgaWYgKFxyXG4gICAgICAgIG93bmVyIGluc3RhbmNlb2YgRGF0YVNvdXJjZSAmJlxyXG4gICAgICAgIG93bmVyLm5hbWUgPT0gR2xvYmVPck1hcC5fZmVhdHVyZUhpZ2hsaWdodE5hbWVcclxuICAgICAgKSB7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgY29uc3QgZmVhdHVyZSA9IFRlcnJpYUZlYXR1cmUuZnJvbUVudGl0eUNvbGxlY3Rpb25PckVudGl0eShlbnRpdHkpO1xyXG5cclxuICAgIGNvbnN0IGNhdGFsb2dJdGVtID0gZmVhdHVyZS5fY2F0YWxvZ0l0ZW07XHJcblxyXG4gICAgaWYgKFxyXG4gICAgICBGZWF0dXJlSW5mb1VybFRlbXBsYXRlTWl4aW4uaXNNaXhlZEludG8oY2F0YWxvZ0l0ZW0pICYmXHJcbiAgICAgIHR5cGVvZiBjYXRhbG9nSXRlbS5nZXRGZWF0dXJlc0Zyb21QaWNrUmVzdWx0ID09PSBcImZ1bmN0aW9uXCIgJiZcclxuICAgICAgdGhpcy50ZXJyaWEuYWxsb3dGZWF0dXJlSW5mb1JlcXVlc3RzXHJcbiAgICApIHtcclxuICAgICAgY29uc3QgcmVzdWx0ID0gY2F0YWxvZ0l0ZW0uZ2V0RmVhdHVyZXNGcm9tUGlja1Jlc3VsdC5iaW5kKGNhdGFsb2dJdGVtKShcclxuICAgICAgICB1bmRlZmluZWQsXHJcbiAgICAgICAgZW50aXR5LFxyXG4gICAgICAgICh0aGlzLl9waWNrZWRGZWF0dXJlcz8uZmVhdHVyZXMubGVuZ3RoIHx8IDApIDwgY2F0YWxvZ0l0ZW0ubWF4UmVxdWVzdHNcclxuICAgICAgKTtcclxuICAgICAgaWYgKHJlc3VsdCAmJiBpc0RlZmluZWQodGhpcy5fcGlja2VkRmVhdHVyZXMpKSB7XHJcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmVzdWx0KSkge1xyXG4gICAgICAgICAgdGhpcy5fcGlja2VkRmVhdHVyZXMuZmVhdHVyZXMucHVzaCguLi5yZXN1bHQpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICB0aGlzLl9waWNrZWRGZWF0dXJlcy5mZWF0dXJlcy5wdXNoKHJlc3VsdCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICB9IGVsc2UgaWYgKGlzRGVmaW5lZCh0aGlzLl9waWNrZWRGZWF0dXJlcykpIHtcclxuICAgICAgdGhpcy5fcGlja2VkRmVhdHVyZXMuZmVhdHVyZXMucHVzaChmZWF0dXJlKTtcclxuICAgIH1cclxuICAgIGlmIChcclxuICAgICAgaXNEZWZpbmVkKHRoaXMuX3BpY2tlZEZlYXR1cmVzKSAmJlxyXG4gICAgICBpc0RlZmluZWQoZmVhdHVyZSkgJiZcclxuICAgICAgZmVhdHVyZS5wb3NpdGlvblxyXG4gICAgKSB7XHJcbiAgICAgIHRoaXMuX3BpY2tlZEZlYXR1cmVzLnBpY2tQb3NpdGlvbiA9ICg8YW55PmZlYXR1cmUucG9zaXRpb24pLl92YWx1ZTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIHByaXZhdGUgX3BpY2tGZWF0dXJlcyhcclxuICAgIGxhdGxuZzogTC5MYXRMbmcsXHJcbiAgICB0aWxlQ29vcmRpbmF0ZXM/OiBSZWNvcmQ8c3RyaW5nLCBQcm92aWRlckNvb3Jkcz4sXHJcbiAgICBleGlzdGluZ0ZlYXR1cmVzPzogVGVycmlhRmVhdHVyZVtdLFxyXG4gICAgaWdub3JlU3BsaXR0ZXI6IGJvb2xlYW4gPSBmYWxzZVxyXG4gICkge1xyXG4gICAgaWYgKGlzRGVmaW5lZCh0aGlzLl9waWNrZWRGZWF0dXJlcykpIHtcclxuICAgICAgLy8gUGlja2luZyBpcyBhbHJlYWR5IGluIHByb2dyZXNzLlxyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgdGhpcy5fcGlja2VkRmVhdHVyZXMgPSBuZXcgUGlja2VkRmVhdHVyZXMoKTtcclxuXHJcbiAgICBpZiAoaXNEZWZpbmVkKGV4aXN0aW5nRmVhdHVyZXMpKSB7XHJcbiAgICAgIHRoaXMuX3BpY2tlZEZlYXR1cmVzLmZlYXR1cmVzID0gZXhpc3RpbmdGZWF0dXJlcztcclxuICAgIH1cclxuXHJcbiAgICAvLyBXZSBydW4gdGhpcyBsYXRlciBiZWNhdXNlIHZlY3RvciBjbGljayBldmVudHMgYW5kIHRoZSBtYXAgY2xpY2sgZXZlbnQgY2FuIGNvbWUgdGhyb3VnaCBpbiBhbnkgb3JkZXIsIGJ1dCB3ZSBjYW5cclxuICAgIC8vIGJlIHJlYXNvbmFibHkgc3VyZSB0aGF0IGFsbCBvZiB0aGVtIHdpbGwgYmUgcHJvY2Vzc2VkIGJ5IHRoZSB0aW1lIG91ciBydW5MYXRlciBmdW5jIGlzIGludm9rZWQuXHJcbiAgICBjb25zdCBjbGVhbnVwID0gcnVuTGF0ZXIoKCkgPT4ge1xyXG4gICAgICAvLyBTZXQgdGhpcyBhZ2FpbiBqdXN0IGluIGNhc2UgYSB2ZWN0b3IgcGljayBjYW1lIHRocm91Z2ggYW5kIHJlc2V0IGl0IHRvIHRoZSB2ZWN0b3IncyBwb3NpdGlvbi5cclxuICAgICAgY29uc3QgbmV3UGlja0xvY2F0aW9uID1cclxuICAgICAgICBFbGxpcHNvaWQuV0dTODQuY2FydG9ncmFwaGljVG9DYXJ0ZXNpYW4ocGlja2VkTG9jYXRpb24pO1xyXG4gICAgICBydW5JbkFjdGlvbigoKSA9PiB7XHJcbiAgICAgICAgY29uc3QgbWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2sgPSB0aGlzLnRlcnJpYS5tYXBJbnRlcmFjdGlvbk1vZGVTdGFjaztcclxuICAgICAgICBpZiAoXHJcbiAgICAgICAgICBpc0RlZmluZWQobWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2spICYmXHJcbiAgICAgICAgICBtYXBJbnRlcmFjdGlvbk1vZGVTdGFjay5sZW5ndGggPiAwXHJcbiAgICAgICAgKSB7XHJcbiAgICAgICAgICBjb25zdCBwaWNrZWRGZWF0dXJlcyA9XHJcbiAgICAgICAgICAgIG1hcEludGVyYWN0aW9uTW9kZVN0YWNrW21hcEludGVyYWN0aW9uTW9kZVN0YWNrLmxlbmd0aCAtIDFdXHJcbiAgICAgICAgICAgICAgLnBpY2tlZEZlYXR1cmVzO1xyXG4gICAgICAgICAgaWYgKGlzRGVmaW5lZChwaWNrZWRGZWF0dXJlcykpIHtcclxuICAgICAgICAgICAgcGlja2VkRmVhdHVyZXMucGlja1Bvc2l0aW9uID0gbmV3UGlja0xvY2F0aW9uO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSBpZiAoaXNEZWZpbmVkKHRoaXMudGVycmlhLnBpY2tlZEZlYXR1cmVzKSkge1xyXG4gICAgICAgICAgdGhpcy50ZXJyaWEucGlja2VkRmVhdHVyZXMucGlja1Bvc2l0aW9uID0gbmV3UGlja0xvY2F0aW9uO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcblxyXG4gICAgICAvLyBVbnNldCB0aGlzIHNvIHRoYXQgdGhlIG5leHQgY2xpY2sgd2lsbCBzdGFydCBidWlsZGluZyBmZWF0dXJlcyBmcm9tIHNjcmF0Y2guXHJcbiAgICAgIHRoaXMuX3BpY2tlZEZlYXR1cmVzID0gdW5kZWZpbmVkO1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgaW1hZ2VyeUxheWVyczogSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllcltdID0gW107XHJcbiAgICBpZiAodGhpcy50ZXJyaWEuYWxsb3dGZWF0dXJlSW5mb1JlcXVlc3RzKSB7XHJcbiAgICAgIHRoaXMubWFwLmVhY2hMYXllcigobGF5ZXIpID0+IHtcclxuICAgICAgICBpZiAoaXNJbWFnZXJ5TGF5ZXIobGF5ZXIpKSB7XHJcbiAgICAgICAgICBpbWFnZXJ5TGF5ZXJzLnB1c2gobGF5ZXIpO1xyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gd2UgbmVlZCBpdGVtcyBzb3J0ZWQgaW4gcmV2ZXJzZSBvcmRlciBieSB0aGVpciB6SW5kZXggdG8gZ2V0IGNvcnJlY3Qgb3JkZXJpbmcgb2YgZmVhdHVyZSBpbmZvXHJcbiAgICBpbWFnZXJ5TGF5ZXJzLnNvcnQoXHJcbiAgICAgIChcclxuICAgICAgICBhOiBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyLFxyXG4gICAgICAgIGI6IEltYWdlcnlQcm92aWRlckxlYWZsZXRUaWxlTGF5ZXJcclxuICAgICAgKSA9PiB7XHJcbiAgICAgICAgaWYgKCFpc0RlZmluZWQoYS5vcHRpb25zLnpJbmRleCkgfHwgIWlzRGVmaW5lZChiLm9wdGlvbnMuekluZGV4KSkge1xyXG4gICAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhLm9wdGlvbnMuekluZGV4IDwgYi5vcHRpb25zLnpJbmRleCkge1xyXG4gICAgICAgICAgcmV0dXJuIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChhLm9wdGlvbnMuekluZGV4ID4gYi5vcHRpb25zLnpJbmRleCkge1xyXG4gICAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gMDtcclxuICAgICAgfVxyXG4gICAgKTtcclxuXHJcbiAgICB0aWxlQ29vcmRpbmF0ZXMgPSBkZWZhdWx0VmFsdWUodGlsZUNvb3JkaW5hdGVzLCB7fSk7XHJcblxyXG4gICAgY29uc3QgcGlja2VkTG9jYXRpb24gPSBDYXJ0b2dyYXBoaWMuZnJvbURlZ3JlZXMobGF0bG5nLmxuZywgbGF0bG5nLmxhdCk7XHJcbiAgICB0aGlzLl9waWNrZWRGZWF0dXJlcy5waWNrUG9zaXRpb24gPVxyXG4gICAgICBFbGxpcHNvaWQuV0dTODQuY2FydG9ncmFwaGljVG9DYXJ0ZXNpYW4ocGlja2VkTG9jYXRpb24pO1xyXG5cclxuICAgIGNvbnN0IGltYWdlcnlGZWF0dXJlUHJvbWlzZXMgPSBpbWFnZXJ5TGF5ZXJzLm1hcChhc3luYyAoaW1hZ2VyeUxheWVyKSA9PiB7XHJcbiAgICAgIGNvbnN0IGltYWdlcnlMYXllclVybCA9ICg8YW55PmltYWdlcnlMYXllci5pbWFnZXJ5UHJvdmlkZXIpLnVybDtcclxuICAgICAgY29uc3QgbG9uZ1JhZGlhbnMgPSBDZXNpdW1NYXRoLnRvUmFkaWFucyhsYXRsbmcubG5nKTtcclxuICAgICAgY29uc3QgbGF0UmFkaWFucyA9IENlc2l1bU1hdGgudG9SYWRpYW5zKGxhdGxuZy5sYXQpO1xyXG5cclxuICAgICAgY29uc3QgY29vcmRzID1cclxuICAgICAgICB0aWxlQ29vcmRpbmF0ZXM/LltpbWFnZXJ5TGF5ZXJVcmxdID8/XHJcbiAgICAgICAgKGF3YWl0IGltYWdlcnlMYXllci5nZXRGZWF0dXJlUGlja2luZ0Nvb3JkcyhcclxuICAgICAgICAgIHRoaXMubWFwLFxyXG4gICAgICAgICAgbG9uZ1JhZGlhbnMsXHJcbiAgICAgICAgICBsYXRSYWRpYW5zXHJcbiAgICAgICAgKSk7XHJcblxyXG4gICAgICBjb25zdCBmZWF0dXJlcyA9IGF3YWl0IGltYWdlcnlMYXllci5waWNrRmVhdHVyZXMoXHJcbiAgICAgICAgY29vcmRzLngsXHJcbiAgICAgICAgY29vcmRzLnksXHJcbiAgICAgICAgY29vcmRzLmxldmVsLFxyXG4gICAgICAgIGxvbmdSYWRpYW5zLFxyXG4gICAgICAgIGxhdFJhZGlhbnNcclxuICAgICAgKTtcclxuXHJcbiAgICAgIC8vIE1ha2Ugc3VyZSBJbWFnZXJ5TGF5ZXJGZWF0dXJlSW5mbyBoYXMgaW1hZ2VyeSBsYXllciBwcm9wZXJ0eVxyXG4gICAgICBmZWF0dXJlcz8uZm9yRWFjaCgoZmVhdHVyZSkgPT4gKGZlYXR1cmUuaW1hZ2VyeUxheWVyID0gaW1hZ2VyeUxheWVyKSk7XHJcblxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIGZlYXR1cmVzOiBmZWF0dXJlcyxcclxuICAgICAgICBpbWFnZXJ5TGF5ZXI6IGltYWdlcnlMYXllcixcclxuICAgICAgICBjb29yZHM6IGNvb3Jkc1xyXG4gICAgICB9O1xyXG4gICAgfSk7XHJcblxyXG4gICAgY29uc3QgcGlja2VkRmVhdHVyZXMgPSB0aGlzLl9waWNrZWRGZWF0dXJlcztcclxuXHJcbiAgICAvLyBXZSB3YW50IHRoZSBhbGwgYXZhaWxhYmxlIHByb21pc2UgdG8gcmV0dXJuIGFmdGVyIHRoZSBjbGVhbnVwIG9uZSB0b1xyXG4gICAgLy8gbWFrZSBzdXJlIGFsbCB2ZWN0b3IgY2xpY2sgZXZlbnRzIGhhdmUgcmVzb2x2ZWQuXHJcbiAgICBwaWNrZWRGZWF0dXJlcy5hbGxGZWF0dXJlc0F2YWlsYWJsZVByb21pc2UgPSBQcm9taXNlLmFsbChbXHJcbiAgICAgIGNsZWFudXAsXHJcbiAgICAgIFByb21pc2UuYWxsKGltYWdlcnlGZWF0dXJlUHJvbWlzZXMpXHJcbiAgICAgICAgLnRoZW4oKHJlc3VsdHMpID0+IHtcclxuICAgICAgICAgIHJ1bkluQWN0aW9uKCgpID0+IHtcclxuICAgICAgICAgICAgcGlja2VkRmVhdHVyZXMuaXNMb2FkaW5nID0gZmFsc2U7XHJcbiAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICBwaWNrZWRGZWF0dXJlcy5wcm92aWRlckNvb3JkcyA9IHt9O1xyXG4gICAgICAgICAgY29uc3QgZmlsdGVyZWRSZXN1bHRzID0gcmVzdWx0cy5maWx0ZXIoXHJcbiAgICAgICAgICAgIChyZXN1bHQpID0+IGlzRGVmaW5lZChyZXN1bHQuZmVhdHVyZXMpICYmIHJlc3VsdC5mZWF0dXJlcy5sZW5ndGggPiAwXHJcbiAgICAgICAgICApO1xyXG5cclxuICAgICAgICAgIHBpY2tlZEZlYXR1cmVzLnByb3ZpZGVyQ29vcmRzID0gZmlsdGVyZWRSZXN1bHRzLnJlZHVjZShmdW5jdGlvbiAoXHJcbiAgICAgICAgICAgIGNvb3Jkc1NvRmFyOiBQcm92aWRlckNvb3Jkc01hcCxcclxuICAgICAgICAgICAgcmVzdWx0XHJcbiAgICAgICAgICApIHtcclxuICAgICAgICAgICAgY29uc3QgaW1hZ2VyeVByb3ZpZGVyID0gcmVzdWx0LmltYWdlcnlMYXllcj8uaW1hZ2VyeVByb3ZpZGVyO1xyXG4gICAgICAgICAgICBpZiAoaW1hZ2VyeVByb3ZpZGVyKVxyXG4gICAgICAgICAgICAgIGNvb3Jkc1NvRmFyWyg8YW55PmltYWdlcnlQcm92aWRlcikudXJsXSA9IHJlc3VsdC5jb29yZHM7XHJcbiAgICAgICAgICAgIHJldHVybiBjb29yZHNTb0ZhcjtcclxuICAgICAgICAgIH0sXHJcbiAgICAgICAgICB7fSk7XHJcblxyXG4gICAgICAgICAgY29uc3QgZmVhdHVyZXMgPSBmaWx0ZXJlZFJlc3VsdHMucmVkdWNlKChhbGxGZWF0dXJlcywgcmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICB0aGlzLnRlcnJpYS5zaG93U3BsaXR0ZXIgJiZcclxuICAgICAgICAgICAgICBpZ25vcmVTcGxpdHRlciA9PT0gZmFsc2UgJiZcclxuICAgICAgICAgICAgICBpc0RlZmluZWQocGlja2VkRmVhdHVyZXMucGlja1Bvc2l0aW9uKVxyXG4gICAgICAgICAgICApIHtcclxuICAgICAgICAgICAgICAvLyBTa2lwIHRoaXMgZmVhdHVyZSwgdW5sZXNzIHRoZSBpbWFnZXJ5IGxheWVyIGlzIG9uIHRoZSBwaWNrZWQgc2lkZSBvclxyXG4gICAgICAgICAgICAgIC8vIGJlbG9uZ3MgdG8gYm90aCBzaWRlcyBvZiB0aGUgc3BsaXR0ZXJcclxuICAgICAgICAgICAgICBjb25zdCBzY3JlZW5Qb3NpdGlvbiA9IHRoaXMuX2NvbXB1dGVQb3NpdGlvbk9uU2NyZWVuKFxyXG4gICAgICAgICAgICAgICAgcGlja2VkRmVhdHVyZXMucGlja1Bvc2l0aW9uXHJcbiAgICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgICBjb25zdCBwaWNrZWRTaWRlID1cclxuICAgICAgICAgICAgICAgIHRoaXMuX2dldFNwbGl0dGVyU2lkZUZvclNjcmVlblBvc2l0aW9uKHNjcmVlblBvc2l0aW9uKTtcclxuICAgICAgICAgICAgICBjb25zdCBsYXllckRpcmVjdGlvbiA9IHJlc3VsdC5pbWFnZXJ5TGF5ZXIuc3BsaXREaXJlY3Rpb247XHJcblxyXG4gICAgICAgICAgICAgIGlmIChcclxuICAgICAgICAgICAgICAgICEoXHJcbiAgICAgICAgICAgICAgICAgIGxheWVyRGlyZWN0aW9uID09PSBwaWNrZWRTaWRlIHx8XHJcbiAgICAgICAgICAgICAgICAgIGxheWVyRGlyZWN0aW9uID09PSBTcGxpdERpcmVjdGlvbi5OT05FXHJcbiAgICAgICAgICAgICAgICApXHJcbiAgICAgICAgICAgICAgKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gYWxsRmVhdHVyZXM7XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICByZXR1cm4gYWxsRmVhdHVyZXMuY29uY2F0KFxyXG4gICAgICAgICAgICAgIHJlc3VsdC5mZWF0dXJlcyEubWFwKChmZWF0dXJlKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAvLyBGb3IgZmVhdHVyZXMgd2l0aG91dCBhIHBvc2l0aW9uLCB1c2UgdGhlIHBpY2tlZCBsb2NhdGlvbi5cclxuICAgICAgICAgICAgICAgIGlmICghaXNEZWZpbmVkKGZlYXR1cmUucG9zaXRpb24pKSB7XHJcbiAgICAgICAgICAgICAgICAgIGZlYXR1cmUucG9zaXRpb24gPSBwaWNrZWRMb2NhdGlvbjtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5fY3JlYXRlRmVhdHVyZUZyb21JbWFnZXJ5TGF5ZXJGZWF0dXJlKGZlYXR1cmUpO1xyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICB9LCBwaWNrZWRGZWF0dXJlcy5mZWF0dXJlcyk7XHJcbiAgICAgICAgICBydW5JbkFjdGlvbigoKSA9PiB7XHJcbiAgICAgICAgICAgIHBpY2tlZEZlYXR1cmVzLmZlYXR1cmVzID0gZmVhdHVyZXM7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5jYXRjaCgoZSkgPT4ge1xyXG4gICAgICAgICAgcnVuSW5BY3Rpb24oKCkgPT4ge1xyXG4gICAgICAgICAgICBwaWNrZWRGZWF0dXJlcy5pc0xvYWRpbmcgPSBmYWxzZTtcclxuICAgICAgICAgICAgcGlja2VkRmVhdHVyZXMuZXJyb3IgPVxyXG4gICAgICAgICAgICAgIFwiQW4gdW5rbm93biBlcnJvciBvY2N1cnJlZCB3aGlsZSBwaWNraW5nIGZlYXR1cmVzLlwiO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICB0aHJvdyBlO1xyXG4gICAgICAgIH0pXHJcbiAgICBdKS50aGVuKCgpID0+IHVuZGVmaW5lZCk7XHJcblxyXG4gICAgcnVuSW5BY3Rpb24oKCkgPT4ge1xyXG4gICAgICBjb25zdCBtYXBJbnRlcmFjdGlvbk1vZGVTdGFjayA9IHRoaXMudGVycmlhLm1hcEludGVyYWN0aW9uTW9kZVN0YWNrO1xyXG4gICAgICBpZiAoXHJcbiAgICAgICAgaXNEZWZpbmVkKG1hcEludGVyYWN0aW9uTW9kZVN0YWNrKSAmJlxyXG4gICAgICAgIG1hcEludGVyYWN0aW9uTW9kZVN0YWNrLmxlbmd0aCA+IDBcclxuICAgICAgKSB7XHJcbiAgICAgICAgbWFwSW50ZXJhY3Rpb25Nb2RlU3RhY2tbXHJcbiAgICAgICAgICBtYXBJbnRlcmFjdGlvbk1vZGVTdGFjay5sZW5ndGggLSAxXHJcbiAgICAgICAgXS5waWNrZWRGZWF0dXJlcyA9IHRoaXMuX3BpY2tlZEZlYXR1cmVzO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHRoaXMudGVycmlhLnBpY2tlZEZlYXR1cmVzID0gdGhpcy5fcGlja2VkRmVhdHVyZXM7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gIH1cclxuXHJcbiAgX3JlYWN0VG9TcGxpdHRlckNoYW5nZXMoKSB7XHJcbiAgICByZXR1cm4gYXV0b3J1bigoKSA9PiB7XHJcbiAgICAgIGNvbnN0IGl0ZW1zID0gdGhpcy50ZXJyaWEubWFpblZpZXdlci5pdGVtcy5nZXQoKTtcclxuICAgICAgY29uc3Qgc2hvd1NwbGl0dGVyID0gdGhpcy50ZXJyaWEuc2hvd1NwbGl0dGVyO1xyXG4gICAgICBjb25zdCBzcGxpdFBvc2l0aW9uID0gdGhpcy50ZXJyaWEuc3BsaXRQb3NpdGlvbjtcclxuICAgICAgaXRlbXMuZm9yRWFjaCgoaXRlbSkgPT4ge1xyXG4gICAgICAgIGlmIChcclxuICAgICAgICAgIE1hcHBhYmxlTWl4aW4uaXNNaXhlZEludG8oaXRlbSkgJiZcclxuICAgICAgICAgIGhhc1RyYWl0cyhpdGVtLCBTcGxpdHRlclRyYWl0cywgXCJzcGxpdERpcmVjdGlvblwiKVxyXG4gICAgICAgICkge1xyXG4gICAgICAgICAgY29uc3QgbGF5ZXJzID0gdGhpcy5nZXRJbWFnZXJ5TGF5ZXJzRm9ySXRlbShpdGVtKTtcclxuICAgICAgICAgIGNvbnN0IHNwbGl0RGlyZWN0aW9uID0gaXRlbS5zcGxpdERpcmVjdGlvbjtcclxuXHJcbiAgICAgICAgICBsYXllcnMuZm9yRWFjaChcclxuICAgICAgICAgICAgYWN0aW9uKChsYXllcikgPT4ge1xyXG4gICAgICAgICAgICAgIGlmIChzaG93U3BsaXR0ZXIpIHtcclxuICAgICAgICAgICAgICAgIGxheWVyLnNwbGl0RGlyZWN0aW9uID0gc3BsaXREaXJlY3Rpb247XHJcbiAgICAgICAgICAgICAgICBsYXllci5zcGxpdFBvc2l0aW9uID0gc3BsaXRQb3NpdGlvbjtcclxuICAgICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgbGF5ZXIuc3BsaXREaXJlY3Rpb24gPSBTcGxpdERpcmVjdGlvbi5OT05FO1xyXG4gICAgICAgICAgICAgICAgbGF5ZXIuc3BsaXRQb3NpdGlvbiA9IHNwbGl0UG9zaXRpb247XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgICB0aGlzLm5vdGlmeVJlcGFpbnRSZXF1aXJlZCgpO1xyXG4gICAgfSk7XHJcbiAgfVxyXG5cclxuICBnZXRJbWFnZXJ5TGF5ZXJzRm9ySXRlbShcclxuICAgIGl0ZW06IE1hcHBhYmxlTWl4aW4uSW5zdGFuY2VcclxuICApOiAoSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllciB8IEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIpW10ge1xyXG4gICAgcmV0dXJuIGZpbHRlck91dFVuZGVmaW5lZChcclxuICAgICAgaXRlbS5tYXBJdGVtcy5tYXAoKG0pID0+IHtcclxuICAgICAgICBpZiAoSW1hZ2VyeVBhcnRzLmlzKG0pKSB7XHJcbiAgICAgICAgICBjb25zdCBsYXllciA9IHRoaXMuX21ha2VJbWFnZXJ5TGF5ZXJGcm9tUGFydHMobSwgaXRlbSk7XHJcbiAgICAgICAgICByZXR1cm4gbGF5ZXIgaW5zdGFuY2VvZiBJbWFnZXJ5UHJvdmlkZXJMZWFmbGV0VGlsZUxheWVyIHx8XHJcbiAgICAgICAgICAgIGxheWVyIGluc3RhbmNlb2YgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldEdyaWRMYXllclxyXG4gICAgICAgICAgICA/IGxheWVyXHJcbiAgICAgICAgICAgIDogdW5kZWZpbmVkO1xyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICAvKipcclxuICAgKiBDb21wdXRlcyB0aGUgc2NyZWVuIHBvc2l0aW9uIG9mIGEgZ2l2ZW4gd29ybGQgcG9zaXRpb24uXHJcbiAgICogQHBhcmFtIHBvc2l0aW9uIFRoZSB3b3JsZCBwb3NpdGlvbiBpbiBFYXJ0aC1jZW50ZXJlZCBGaXhlZCBjb29yZGluYXRlcy5cclxuICAgKiBAcGFyYW0gW3Jlc3VsdF0gVGhlIGluc3RhbmNlIHRvIHdoaWNoIHRvIGNvcHkgdGhlIHJlc3VsdC5cclxuICAgKiBAcmV0dXJuIFRoZSBzY3JlZW4gcG9zaXRpb24sIG9yIHVuZGVmaW5lZCBpZiB0aGUgcG9zaXRpb24gaXMgbm90IG9uIHRoZSBzY3JlZW4uXHJcbiAgICovXHJcbiAgcHJpdmF0ZSBfY29tcHV0ZVBvc2l0aW9uT25TY3JlZW4oXHJcbiAgICBwb3NpdGlvbjogQ2FydGVzaWFuMyxcclxuICAgIHJlc3VsdD86IENhcnRlc2lhbjJcclxuICApOiBDYXJ0ZXNpYW4yIHtcclxuICAgIGNvbnN0IGNhcnRvZ3JhcGhpY1NjcmF0Y2ggPSBuZXcgQ2FydG9ncmFwaGljKCk7XHJcbiAgICBjb25zdCBjYXJ0b2dyYXBoaWMgPSBFbGxpcHNvaWQuV0dTODQuY2FydGVzaWFuVG9DYXJ0b2dyYXBoaWMoXHJcbiAgICAgIHBvc2l0aW9uLFxyXG4gICAgICBjYXJ0b2dyYXBoaWNTY3JhdGNoXHJcbiAgICApO1xyXG4gICAgY29uc3QgcG9pbnQgPSB0aGlzLm1hcC5sYXRMbmdUb0NvbnRhaW5lclBvaW50KFxyXG4gICAgICBMLmxhdExuZyhcclxuICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0b2dyYXBoaWMubGF0aXR1ZGUpLFxyXG4gICAgICAgIENlc2l1bU1hdGgudG9EZWdyZWVzKGNhcnRvZ3JhcGhpYy5sb25naXR1ZGUpXHJcbiAgICAgIClcclxuICAgICk7XHJcblxyXG4gICAgaWYgKGlzRGVmaW5lZChyZXN1bHQpKSB7XHJcbiAgICAgIHJlc3VsdC54ID0gcG9pbnQueDtcclxuICAgICAgcmVzdWx0LnkgPSBwb2ludC55O1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVzdWx0ID0gbmV3IENhcnRlc2lhbjIocG9pbnQueCwgcG9pbnQueSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcmVzdWx0O1xyXG4gIH1cclxuXHJcbiAgcHJpdmF0ZSBfc2VsZWN0RmVhdHVyZShmZWF0dXJlOiBUZXJyaWFGZWF0dXJlIHwgdW5kZWZpbmVkKSB7XHJcbiAgICB0aGlzLl9oaWdobGlnaHRGZWF0dXJlKGZlYXR1cmUpO1xyXG5cclxuICAgIGlmIChpc0RlZmluZWQoZmVhdHVyZSkgJiYgaXNEZWZpbmVkKGZlYXR1cmUucG9zaXRpb24pKSB7XHJcbiAgICAgIGNvbnN0IGNhcnRvZ3JhcGhpY1NjcmF0Y2ggPSBuZXcgQ2FydG9ncmFwaGljKCk7XHJcbiAgICAgIGNvbnN0IGNhcnRvZ3JhcGhpYyA9IEVsbGlwc29pZC5XR1M4NC5jYXJ0ZXNpYW5Ub0NhcnRvZ3JhcGhpYyhcclxuICAgICAgICBmZWF0dXJlLnBvc2l0aW9uLmdldFZhbHVlKHRoaXMudGVycmlhLnRpbWVsaW5lQ2xvY2suY3VycmVudFRpbWUpLFxyXG4gICAgICAgIGNhcnRvZ3JhcGhpY1NjcmF0Y2hcclxuICAgICAgKTtcclxuICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yLnNldExhdExuZyhcclxuICAgICAgICBMLmxhdExuZyhbXHJcbiAgICAgICAgICBDZXNpdW1NYXRoLnRvRGVncmVlcyhjYXJ0b2dyYXBoaWMubGF0aXR1ZGUpLFxyXG4gICAgICAgICAgQ2VzaXVtTWF0aC50b0RlZ3JlZXMoY2FydG9ncmFwaGljLmxvbmdpdHVkZSlcclxuICAgICAgICBdKVxyXG4gICAgICApO1xyXG4gICAgICB0aGlzLl9zZWxlY3Rpb25JbmRpY2F0b3IuYW5pbWF0ZVNlbGVjdGlvbkluZGljYXRvckFwcGVhcigpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgdGhpcy5fc2VsZWN0aW9uSW5kaWNhdG9yLmFuaW1hdGVTZWxlY3Rpb25JbmRpY2F0b3JEZXBhcnQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGdldENsaXBzRm9yU3BsaXR0ZXIoKTogYW55IHtcclxuICAgIGxldCBjbGlwTGVmdDogc3RyaW5nID0gXCJcIjtcclxuICAgIGxldCBjbGlwUmlnaHQ6IHN0cmluZyA9IFwiXCI7XHJcbiAgICBsZXQgY2xpcFBvc2l0aW9uV2l0aGluTWFwOiBudW1iZXIgPSAwO1xyXG4gICAgbGV0IGNsaXBYOiBudW1iZXIgPSAwO1xyXG4gICAgaWYgKHRoaXMudGVycmlhLnNob3dTcGxpdHRlcikge1xyXG4gICAgICBjb25zdCBtYXAgPSB0aGlzLm1hcDtcclxuICAgICAgY29uc3Qgc2l6ZSA9IG1hcC5nZXRTaXplKCk7XHJcbiAgICAgIGNvbnN0IG53ID0gbWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KFswLCAwXSk7XHJcbiAgICAgIGNvbnN0IHNlID0gbWFwLmNvbnRhaW5lclBvaW50VG9MYXllclBvaW50KHNpemUpO1xyXG4gICAgICBjbGlwUG9zaXRpb25XaXRoaW5NYXAgPSBzaXplLnggKiB0aGlzLnRlcnJpYS5zcGxpdFBvc2l0aW9uO1xyXG4gICAgICBjbGlwWCA9IE1hdGgucm91bmQobncueCArIGNsaXBQb3NpdGlvbldpdGhpbk1hcCk7XHJcbiAgICAgIGNsaXBMZWZ0ID0gXCJyZWN0KFwiICsgW253LnksIGNsaXBYLCBzZS55LCBudy54XS5qb2luKFwicHgsXCIpICsgXCJweClcIjtcclxuICAgICAgY2xpcFJpZ2h0ID0gXCJyZWN0KFwiICsgW253LnksIHNlLngsIHNlLnksIGNsaXBYXS5qb2luKFwicHgsXCIpICsgXCJweClcIjtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4ge1xyXG4gICAgICBsZWZ0OiBjbGlwTGVmdCxcclxuICAgICAgcmlnaHQ6IGNsaXBSaWdodCxcclxuICAgICAgY2xpcFBvc2l0aW9uV2l0aGluTWFwOiBjbGlwUG9zaXRpb25XaXRoaW5NYXAsXHJcbiAgICAgIGNsaXBYOiBjbGlwWFxyXG4gICAgfTtcclxuICB9XHJcblxyXG4gIGlzU3BsaXR0ZXJEcmFnVGh1bWIoZWxlbWVudDogSFRNTEVsZW1lbnQpOiBib29sZWFuIHwgXCJcIiB7XHJcbiAgICByZXR1cm4gKFxyXG4gICAgICBlbGVtZW50LmNsYXNzTmFtZSAmJlxyXG4gICAgICBlbGVtZW50LmNsYXNzTmFtZS5pbmRleE9mICYmXHJcbiAgICAgIGVsZW1lbnQuY2xhc3NOYW1lLmluZGV4T2YoXCJ0anMtc3BsaXR0ZXJfX3RodW1iXCIpID49IDBcclxuICAgICk7XHJcbiAgfVxyXG5cclxuICBjYXB0dXJlU2NyZWVuc2hvdCgpOiBQcm9taXNlPHN0cmluZz4ge1xyXG4gICAgLy8gVGVtcG9yYXJpbHkgaGlkZSB0aGUgbWFwIGNyZWRpdHMuXHJcbiAgICB0aGlzLl9hdHRyaWJ1dGlvbkNvbnRyb2wucmVtb3ZlKCk7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgLy8gaHRtbDJjYW52YXMgY2FuJ3QgaGFuZGxlIHRoZSBjbGlwIHN0eWxlIHdoaWNoIGlzIHVzZWQgZm9yIHRoZSBzcGxpdHRlci4gU28gaWYgdGhlIHNwbGl0dGVyIGlzIGFjdGl2ZSwgd2UgcmVuZGVyXHJcbiAgICAgIC8vIGEgbGVmdCBpbWFnZSBhbmQgYSByaWdodCBpbWFnZSBhbmQgY29tcG9zZSB0aGVtLiBBbHNvIHJlbW92ZSB0aGUgc3BsaXR0ZXIgZHJhZyB0aHVtYi5cclxuICAgICAgbGV0IHByb21pc2U6IGFueTtcclxuICAgICAgaWYgKHRoaXMudGVycmlhLnNob3dTcGxpdHRlcikge1xyXG4gICAgICAgIGNvbnN0IGNsaXBzID0gdGhpcy5nZXRDbGlwc0ZvclNwbGl0dGVyKCk7XHJcbiAgICAgICAgY29uc3QgY2xpcExlZnQgPSBjbGlwcy5sZWZ0LnJlcGxhY2UoLyAvZywgXCJcIik7XHJcbiAgICAgICAgY29uc3QgY2xpcFJpZ2h0ID0gY2xpcHMucmlnaHQucmVwbGFjZSgvIC9nLCBcIlwiKTtcclxuICAgICAgICBwcm9taXNlID0gaHRtbDJjYW52YXModGhpcy5tYXAuZ2V0Q29udGFpbmVyKCksIHtcclxuICAgICAgICAgIHVzZUNPUlM6IHRydWUsXHJcbiAgICAgICAgICBpZ25vcmVFbGVtZW50czogKGVsZW1lbnQ6IEhUTUxFbGVtZW50KSA9PlxyXG4gICAgICAgICAgICAoZWxlbWVudC5zdHlsZS5jbGlwICE9PSB1bmRlZmluZWQgJiZcclxuICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmNsaXAgIT09IG51bGwgJiZcclxuICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmNsaXAucmVwbGFjZSgvIC9nLCBcIlwiKSA9PT0gY2xpcFJpZ2h0KSB8fFxyXG4gICAgICAgICAgICB0aGlzLmlzU3BsaXR0ZXJEcmFnVGh1bWIoZWxlbWVudClcclxuICAgICAgICB9KS50aGVuKChsZWZ0Q2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgcmV0dXJuIGh0bWwyY2FudmFzKHRoaXMubWFwLmdldENvbnRhaW5lcigpLCB7XHJcbiAgICAgICAgICAgIHVzZUNPUlM6IHRydWUsXHJcbiAgICAgICAgICAgIGlnbm9yZUVsZW1lbnRzOiAoZWxlbWVudDogSFRNTEVsZW1lbnQpID0+XHJcbiAgICAgICAgICAgICAgKGVsZW1lbnQuc3R5bGUuY2xpcCAhPT0gdW5kZWZpbmVkICYmXHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnN0eWxlLmNsaXAgIT09IG51bGwgJiZcclxuICAgICAgICAgICAgICAgIGVsZW1lbnQuc3R5bGUuY2xpcC5yZXBsYWNlKC8gL2csIFwiXCIpID09PSBjbGlwTGVmdCkgfHxcclxuICAgICAgICAgICAgICB0aGlzLmlzU3BsaXR0ZXJEcmFnVGh1bWIoZWxlbWVudClcclxuICAgICAgICAgIH0pLnRoZW4oKHJpZ2h0Q2FudmFzOiBIVE1MQ2FudmFzRWxlbWVudCkgPT4ge1xyXG4gICAgICAgICAgICBjb25zdCBjb21iaW5lZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJjYW52YXNcIik7XHJcbiAgICAgICAgICAgIGNvbWJpbmVkLndpZHRoID0gbGVmdENhbnZhcy53aWR0aDtcclxuICAgICAgICAgICAgY29tYmluZWQuaGVpZ2h0ID0gbGVmdENhbnZhcy5oZWlnaHQ7XHJcbiAgICAgICAgICAgIGNvbnN0IGNvbnRleHQ6IENhbnZhc1JlbmRlcmluZ0NvbnRleHQyRCB8IG51bGwgPVxyXG4gICAgICAgICAgICAgIGNvbWJpbmVkLmdldENvbnRleHQoXCIyZFwiKTtcclxuICAgICAgICAgICAgaWYgKGNvbnRleHQgPT09IHVuZGVmaW5lZCB8fCBjb250ZXh0ID09PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgLy8gRXJyb3JcclxuICAgICAgICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgY29uc3Qgc3BsaXQgPSBjbGlwcy5jbGlwUG9zaXRpb25XaXRoaW5NYXAgKiB3aW5kb3cuZGV2aWNlUGl4ZWxSYXRpbztcclxuICAgICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoXHJcbiAgICAgICAgICAgICAgbGVmdENhbnZhcyxcclxuICAgICAgICAgICAgICAwLFxyXG4gICAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgICAgc3BsaXQsXHJcbiAgICAgICAgICAgICAgY29tYmluZWQuaGVpZ2h0LFxyXG4gICAgICAgICAgICAgIDAsXHJcbiAgICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgICBzcGxpdCxcclxuICAgICAgICAgICAgICBjb21iaW5lZC5oZWlnaHRcclxuICAgICAgICAgICAgKTtcclxuICAgICAgICAgICAgY29udGV4dC5kcmF3SW1hZ2UoXHJcbiAgICAgICAgICAgICAgcmlnaHRDYW52YXMsXHJcbiAgICAgICAgICAgICAgc3BsaXQsXHJcbiAgICAgICAgICAgICAgMCxcclxuICAgICAgICAgICAgICBjb21iaW5lZC53aWR0aCAtIHNwbGl0LFxyXG4gICAgICAgICAgICAgIGNvbWJpbmVkLmhlaWdodCxcclxuICAgICAgICAgICAgICBzcGxpdCxcclxuICAgICAgICAgICAgICAwLFxyXG4gICAgICAgICAgICAgIGNvbWJpbmVkLndpZHRoIC0gc3BsaXQsXHJcbiAgICAgICAgICAgICAgY29tYmluZWQuaGVpZ2h0XHJcbiAgICAgICAgICAgICk7XHJcbiAgICAgICAgICAgIHJldHVybiBjb21iaW5lZDtcclxuICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHByb21pc2UgPSBodG1sMmNhbnZhcyh0aGlzLm1hcC5nZXRDb250YWluZXIoKSwge1xyXG4gICAgICAgICAgdXNlQ09SUzogdHJ1ZVxyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcblxyXG4gICAgICByZXR1cm4gcHJvbWlzZVxyXG4gICAgICAgIC50aGVuKChjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50KSA9PiB7XHJcbiAgICAgICAgICByZXR1cm4gY2FudmFzLnRvRGF0YVVSTChcImltYWdlL3BuZ1wiKTtcclxuICAgICAgICB9KVxyXG4gICAgICAgIC5maW5hbGx5KCgpID0+IHtcclxuICAgICAgICAgIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbC5hZGRUbyh0aGlzLm1hcCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGNhdGNoIChlKSB7XHJcbiAgICAgIHRoaXMuX2F0dHJpYnV0aW9uQ29udHJvbC5hZGRUbyh0aGlzLm1hcCk7XHJcbiAgICAgIHJldHVybiBQcm9taXNlLnJlamVjdChlKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIF9hZGRWZWN0b3JUaWxlSGlnaGxpZ2h0KFxyXG4gICAgaW1hZ2VyeVByb3ZpZGVyOiBNYXBib3hWZWN0b3JUaWxlSW1hZ2VyeVByb3ZpZGVyIHwgUHJvdG9tYXBzSW1hZ2VyeVByb3ZpZGVyLFxyXG4gICAgcmVjdGFuZ2xlOiBSZWN0YW5nbGVcclxuICApOiAoKSA9PiB2b2lkIHtcclxuICAgIGNvbnN0IG1hcCA9IHRoaXMubWFwO1xyXG4gICAgY29uc3Qgb3B0aW9uczogYW55ID0ge1xyXG4gICAgICBvcGFjaXR5OiAxLFxyXG4gICAgICBib3VuZHM6IHJlY3RhbmdsZVRvTGF0TG5nQm91bmRzKHJlY3RhbmdsZSlcclxuICAgIH07XHJcblxyXG4gICAgaWYgKGlzRGVmaW5lZChtYXAub3B0aW9ucy5tYXhab29tKSkge1xyXG4gICAgICBvcHRpb25zLm1heFpvb20gPSBtYXAub3B0aW9ucy5tYXhab29tO1xyXG4gICAgfVxyXG5cclxuICAgIGNvbnN0IGxheWVyID0gbmV3IEltYWdlcnlQcm92aWRlckxlYWZsZXRHcmlkTGF5ZXIoXHJcbiAgICAgIHRoaXMsXHJcbiAgICAgIGltYWdlcnlQcm92aWRlcixcclxuICAgICAgb3B0aW9uc1xyXG4gICAgKTtcclxuICAgIGxheWVyLmFkZFRvKG1hcCk7XHJcbiAgICBsYXllci5icmluZ1RvRnJvbnQoKTtcclxuXHJcbiAgICByZXR1cm4gZnVuY3Rpb24gKCkge1xyXG4gICAgICBtYXAucmVtb3ZlTGF5ZXIobGF5ZXIpO1xyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGlzSW1hZ2VyeUxheWVyKFxyXG4gIHNvbWVMYXllcjogTC5MYXllclxyXG4pOiBzb21lTGF5ZXIgaXMgSW1hZ2VyeVByb3ZpZGVyTGVhZmxldFRpbGVMYXllciB7XHJcbiAgcmV0dXJuIFwiaW1hZ2VyeVByb3ZpZGVyXCIgaW4gc29tZUxheWVyO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpc0RhdGFTb3VyY2Uob2JqZWN0OiBNYXBJdGVtKTogb2JqZWN0IGlzIERhdGFTb3VyY2Uge1xyXG4gIHJldHVybiBcImVudGl0aWVzXCIgaW4gb2JqZWN0O1xyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUNBO0FBU0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUdBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBNURBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQStEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFBQTtBQUVBO0FBNEVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUE1RUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUtBO0FBQUE7QUFFQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFBQTtBQUVBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQU1BO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFnQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUEwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBU0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQTNJQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQXdCQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBSUE7QUFDQTtBQUlBO0FBQUE7QUFBQTtBQUFBO0FBbUdBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFGQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUdBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRkE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFJQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUlBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQUE7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQVFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFBQTtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSEE7QUFBQTtBQUFBO0FBQUE7QUFNQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFJQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQVFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQU9BO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQWhCQTtBQUFBO0FBQUE7QUFvQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBSUE7QUFDQTtBQUNBO0FBRUE7QUFFQTtBQUVBO0FBSUE7QUFDQTtBQUtBO0FBQ0E7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQU9BO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBSUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFHQTtBQUVBO0FBQ0E7QUFHQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBS0E7QUFBQTtBQUFBO0FBTkE7QUFBQTtBQUFBO0FBY0E7QUFOQTtBQVFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUFBO0FBR0E7QUFHQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBR0E7QUFDQTtBQUtBO0FBQ0E7QUFDQTtBQUdBO0FBRUE7QUFFQTtBQU1BO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFJQTtBQUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBSUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUlBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBTEE7QUFBQTtBQUFBO0FBVUE7QUFDQTtBQUlBO0FBT0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBRUE7QUFDQTtBQUNBO0FBSUE7QUFNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFLQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUlBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBRUE7QUFDQTtBQVdBO0FBV0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBRUE7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBTUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBS0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBaCtCQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFpK0JBO0FBR0E7QUFDQTtBQUVBO0FBQ0E7QUFDQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Models/Leaflet.ts\n");

/***/ }),

/***/ "./packages/terriajs/lib/Models/LeafletAttribution.ts":
/*!************************************************************!*\
  !*** ./packages/terriajs/lib/Models/LeafletAttribution.ts ***!
  \************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\n\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n__webpack_require__(/*! core-js/modules/es.symbol.js */ \"./node_modules/core-js/modules/es.symbol.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.description.js */ \"./node_modules/core-js/modules/es.symbol.description.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.iterator.js */ \"./node_modules/core-js/modules/es.symbol.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.symbol.to-primitive.js */ \"./node_modules/core-js/modules/es.symbol.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.array.for-each.js */ \"./node_modules/core-js/modules/es.array.for-each.js\");\n__webpack_require__(/*! core-js/modules/es.array.iterator.js */ \"./node_modules/core-js/modules/es.array.iterator.js\");\n__webpack_require__(/*! core-js/modules/es.array.reduce.js */ \"./node_modules/core-js/modules/es.array.reduce.js\");\n__webpack_require__(/*! core-js/modules/es.array.reverse.js */ \"./node_modules/core-js/modules/es.array.reverse.js\");\n__webpack_require__(/*! core-js/modules/es.array.slice.js */ \"./node_modules/core-js/modules/es.array.slice.js\");\n__webpack_require__(/*! core-js/modules/es.date.to-primitive.js */ \"./node_modules/core-js/modules/es.date.to-primitive.js\");\n__webpack_require__(/*! core-js/modules/es.function.bind.js */ \"./node_modules/core-js/modules/es.function.bind.js\");\n__webpack_require__(/*! core-js/modules/es.number.constructor.js */ \"./node_modules/core-js/modules/es.number.constructor.js\");\n__webpack_require__(/*! core-js/modules/es.object.create.js */ \"./node_modules/core-js/modules/es.object.create.js\");\n__webpack_require__(/*! core-js/modules/es.object.define-property.js */ \"./node_modules/core-js/modules/es.object.define-property.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-own-property-descriptor.js */ \"./node_modules/core-js/modules/es.object.get-own-property-descriptor.js\");\n__webpack_require__(/*! core-js/modules/es.object.get-prototype-of.js */ \"./node_modules/core-js/modules/es.object.get-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.keys.js */ \"./node_modules/core-js/modules/es.object.keys.js\");\n__webpack_require__(/*! core-js/modules/es.object.set-prototype-of.js */ \"./node_modules/core-js/modules/es.object.set-prototype-of.js\");\n__webpack_require__(/*! core-js/modules/es.object.to-string.js */ \"./node_modules/core-js/modules/es.object.to-string.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.construct.js */ \"./node_modules/core-js/modules/es.reflect.construct.js\");\n__webpack_require__(/*! core-js/modules/es.reflect.get.js */ \"./node_modules/core-js/modules/es.reflect.get.js\");\n__webpack_require__(/*! core-js/modules/es.string.iterator.js */ \"./node_modules/core-js/modules/es.string.iterator.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.for-each.js */ \"./node_modules/core-js/modules/web.dom-collections.for-each.js\");\n__webpack_require__(/*! core-js/modules/web.dom-collections.iterator.js */ \"./node_modules/core-js/modules/web.dom-collections.iterator.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LeafletAttribution = void 0;\n__webpack_require__(/*! core-js/modules/es.array.map.js */ \"./node_modules/core-js/modules/es.array.map.js\");\nvar _mobx = __webpack_require__(/*! mobx */ \"./node_modules/mobx/dist/mobx.esm.js\");\nvar _leaflet = _interopRequireDefault(__webpack_require__(/*! leaflet */ \"./node_modules/leaflet/dist/leaflet-src.js\"));\nvar _class, _descriptor;\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { \"default\": obj }; }\nfunction _initializerDefineProperty(target, property, descriptor, context) { if (!descriptor) return; Object.defineProperty(target, property, { enumerable: descriptor.enumerable, configurable: descriptor.configurable, writable: descriptor.writable, value: descriptor.initializer ? descriptor.initializer.call(context) : void 0 }); }\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\nfunction _defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, _toPropertyKey(descriptor.key), descriptor); } }\nfunction _createClass(Constructor, protoProps, staticProps) { if (protoProps) _defineProperties(Constructor.prototype, protoProps); if (staticProps) _defineProperties(Constructor, staticProps); Object.defineProperty(Constructor, \"prototype\", { writable: false }); return Constructor; }\nfunction _callSuper(t, o, e) { return o = _getPrototypeOf(o), _possibleConstructorReturn(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], _getPrototypeOf(t).constructor) : o.apply(t, e)); }\nfunction _possibleConstructorReturn(self, call) { if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) { return call; } else if (call !== void 0) { throw new TypeError(\"Derived constructors may only return object or undefined\"); } return _assertThisInitialized(self); }\nfunction _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function _isNativeReflectConstruct() { return !!t; })(); }\nfunction _assertThisInitialized(self) { if (self === void 0) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return self; }\nfunction _get() { if (typeof Reflect !== \"undefined\" && Reflect.get) { _get = Reflect.get.bind(); } else { _get = function _get(target, property, receiver) { var base = _superPropBase(target, property); if (!base) return; var desc = Object.getOwnPropertyDescriptor(base, property); if (desc.get) { return desc.get.call(arguments.length < 3 ? target : receiver); } return desc.value; }; } return _get.apply(this, arguments); }\nfunction _superPropBase(object, property) { while (!Object.prototype.hasOwnProperty.call(object, property)) { object = _getPrototypeOf(object); if (object === null) break; } return object; }\nfunction _getPrototypeOf(o) { _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf.bind() : function _getPrototypeOf(o) { return o.__proto__ || Object.getPrototypeOf(o); }; return _getPrototypeOf(o); }\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function\"); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, writable: true, configurable: true } }); Object.defineProperty(subClass, \"prototype\", { writable: false }); if (superClass) _setPrototypeOf(subClass, superClass); }\nfunction _setPrototypeOf(o, p) { _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) { o.__proto__ = p; return o; }; return _setPrototypeOf(o, p); }\nfunction _defineProperty(obj, key, value) { key = _toPropertyKey(key); if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : String(i); }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _applyDecoratedDescriptor(target, property, decorators, descriptor, context) { var desc = {}; Object.keys(descriptor).forEach(function (key) { desc[key] = descriptor[key]; }); desc.enumerable = !!desc.enumerable; desc.configurable = !!desc.configurable; if ('value' in desc || desc.initializer) { desc.writable = true; } desc = decorators.slice().reverse().reduce(function (desc, decorator) { return decorator(target, property, desc) || desc; }, desc); if (context && desc.initializer !== void 0) { desc.value = desc.initializer ? desc.initializer.call(context) : void 0; desc.initializer = undefined; } if (desc.initializer === void 0) { Object.defineProperty(target, property, desc); desc = null; } return desc; }\nfunction _initializerWarningHelper(descriptor, context) { throw new Error('Decorating class property failed. Please ensure that ' + 'transform-class-properties is enabled and runs after the decorators transform.'); }\nvar LeafletAttribution = exports.LeafletAttribution = (_class = /*#__PURE__*/function (_L$Control$Attributio) {\n  _inherits(LeafletAttribution, _L$Control$Attributio);\n  function LeafletAttribution(terria) {\n    var _this;\n    _classCallCheck(this, LeafletAttribution);\n    var options = {\n      position: \"bottomleft\"\n    };\n    if (terria.configParameters.leafletAttributionPrefix) {\n      options.prefix = terria.configParameters.leafletAttributionPrefix;\n    }\n    _this = _callSuper(this, LeafletAttribution, [options]);\n    _defineProperty(_assertThisInitialized(_this), \"_attributions\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"map\", void 0);\n    _defineProperty(_assertThisInitialized(_this), \"_container\", void 0);\n    _initializerDefineProperty(_assertThisInitialized(_this), \"dataAttributions\", _descriptor, _assertThisInitialized(_this));\n    (0, _mobx.makeObservable)(_assertThisInitialized(_this));\n    _this._attributions = {};\n    _this.dataAttributions = (0, _mobx.observable)([]);\n    return _this;\n  }\n  _createClass(LeafletAttribution, [{\n    key: \"onAdd\",\n    value: function onAdd(map) {\n      var _this2 = this;\n      map.attributionControl = this;\n      this.map = map;\n      this._container = _leaflet[\"default\"].DomUtil.create(\"div\", \"leaflet-control-attribution\");\n      _leaflet[\"default\"].DomEvent.disableClickPropagation(this._container);\n      map.eachLayer(function (layer) {\n        if (layer.getAttribution) {\n          var att = layer.getAttribution();\n          if (att) _this2.addAttribution(att);\n        }\n      });\n      return this._container;\n    }\n  }, {\n    key: \"onRemove\",\n    value: function onRemove() {\n      this.map = undefined;\n    }\n  }, {\n    key: \"_update\",\n    value: function _update() {\n      if (!this.map) {\n        return;\n      }\n      var attribs = [];\n      var attributions = this._attributions;\n      for (var i in attributions) {\n        if (attributions[i]) {\n          attribs.push(i);\n        }\n      }\n    }\n  }, {\n    key: \"addAttribution\",\n    value: function addAttribution(text) {\n      var _this3 = this;\n      _get(_getPrototypeOf(LeafletAttribution.prototype), \"addAttribution\", this).call(this, text);\n      if (this.map) {\n        (0, _mobx.runInAction)(function () {\n          _this3.dataAttributions.push(text);\n        });\n      }\n      return this;\n    }\n  }, {\n    key: \"removeAttribution\",\n    value: function removeAttribution(text) {\n      var _this4 = this;\n      _get(_getPrototypeOf(LeafletAttribution.prototype), \"removeAttribution\", this).call(this, text);\n      if (this.map) {\n        (0, _mobx.runInAction)(function () {\n          _this4.dataAttributions.remove(text);\n        });\n      }\n      return this;\n    }\n  }, {\n    key: \"attributions\",\n    get: function get() {\n      var attributionsList = [];\n      var attributions = this._attributions;\n      for (var i in attributions) {\n        if (attributions[i]) {\n          attributionsList.push(i);\n        }\n      }\n      return attributionsList;\n    }\n  }, {\n    key: \"prefix\",\n    get: function get() {\n      if (!this.options.prefix) return undefined;\n      return \"\".concat(this.options.prefix);\n    }\n  }]);\n  return LeafletAttribution;\n}(_leaflet[\"default\"].Control.Attribution), (_descriptor = _applyDecoratedDescriptor(_class.prototype, \"dataAttributions\", [_mobx.observable], {\n  configurable: true,\n  enumerable: true,\n  writable: true,\n  initializer: null\n})), _class);//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi9wYWNrYWdlcy90ZXJyaWFqcy9saWIvTW9kZWxzL0xlYWZsZXRBdHRyaWJ1dGlvbi50cy5qcyIsInNvdXJjZXMiOlsid2VicGFjazovLy8uL3BhY2thZ2VzL3RlcnJpYWpzL2xpYi9Nb2RlbHMvTGVhZmxldEF0dHJpYnV0aW9uLnRzPzdmMDEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcclxuICBJT2JzZXJ2YWJsZUFycmF5LFxyXG4gIHJ1bkluQWN0aW9uLFxyXG4gIG9ic2VydmFibGUsXHJcbiAgbWFrZU9ic2VydmFibGVcclxufSBmcm9tIFwibW9ieFwiO1xyXG5pbXBvcnQgTCBmcm9tIFwibGVhZmxldFwiO1xyXG5pbXBvcnQgVGVycmlhIGZyb20gXCIuL1RlcnJpYVwiO1xyXG5cclxuZXhwb3J0IGNsYXNzIExlYWZsZXRBdHRyaWJ1dGlvbiBleHRlbmRzIEwuQ29udHJvbC5BdHRyaWJ1dGlvbiB7XHJcbiAgcHJpdmF0ZSByZWFkb25seSBfYXR0cmlidXRpb25zOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+O1xyXG4gIHByaXZhdGUgbWFwPzogTC5NYXA7XHJcbiAgcHJpdmF0ZSBfY29udGFpbmVyITogSFRNTEVsZW1lbnQ7XHJcbiAgQG9ic2VydmFibGVcclxuICBkYXRhQXR0cmlidXRpb25zOiBJT2JzZXJ2YWJsZUFycmF5PHN0cmluZz47XHJcblxyXG4gIGNvbnN0cnVjdG9yKHRlcnJpYTogVGVycmlhKSB7XHJcbiAgICBjb25zdCBvcHRpb25zOiBMLkNvbnRyb2wuQXR0cmlidXRpb25PcHRpb25zID0ge1xyXG4gICAgICBwb3NpdGlvbjogXCJib3R0b21sZWZ0XCJcclxuICAgIH07XHJcbiAgICBpZiAodGVycmlhLmNvbmZpZ1BhcmFtZXRlcnMubGVhZmxldEF0dHJpYnV0aW9uUHJlZml4KSB7XHJcbiAgICAgIG9wdGlvbnMucHJlZml4ID0gdGVycmlhLmNvbmZpZ1BhcmFtZXRlcnMubGVhZmxldEF0dHJpYnV0aW9uUHJlZml4O1xyXG4gICAgfVxyXG4gICAgc3VwZXIob3B0aW9ucyk7XHJcbiAgICBtYWtlT2JzZXJ2YWJsZSh0aGlzKTtcclxuXHJcbiAgICB0aGlzLl9hdHRyaWJ1dGlvbnMgPSB7fTtcclxuICAgIHRoaXMuZGF0YUF0dHJpYnV0aW9ucyA9IG9ic2VydmFibGUoW10pO1xyXG4gIH1cclxuXHJcbiAgb25BZGQobWFwOiBMLk1hcCkge1xyXG4gICAgbWFwLmF0dHJpYnV0aW9uQ29udHJvbCA9IHRoaXM7XHJcbiAgICB0aGlzLm1hcCA9IG1hcDtcclxuXHJcbiAgICB0aGlzLl9jb250YWluZXIgPSBMLkRvbVV0aWwuY3JlYXRlKFwiZGl2XCIsIFwibGVhZmxldC1jb250cm9sLWF0dHJpYnV0aW9uXCIpO1xyXG4gICAgTC5Eb21FdmVudC5kaXNhYmxlQ2xpY2tQcm9wYWdhdGlvbih0aGlzLl9jb250YWluZXIpO1xyXG5cclxuICAgIG1hcC5lYWNoTGF5ZXIoKGxheWVyKSA9PiB7XHJcbiAgICAgIGlmIChsYXllci5nZXRBdHRyaWJ1dGlvbikge1xyXG4gICAgICAgIGNvbnN0IGF0dCA9IGxheWVyLmdldEF0dHJpYnV0aW9uKCk7XHJcbiAgICAgICAgaWYgKGF0dCkgdGhpcy5hZGRBdHRyaWJ1dGlvbihhdHQpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZXR1cm4gdGhpcy5fY29udGFpbmVyO1xyXG4gIH1cclxuXHJcbiAgb25SZW1vdmUoKSB7XHJcbiAgICB0aGlzLm1hcCA9IHVuZGVmaW5lZDtcclxuICB9XHJcblxyXG4gIF91cGRhdGUoKSB7XHJcbiAgICBpZiAoIXRoaXMubWFwKSB7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBhdHRyaWJzOiBzdHJpbmdbXSA9IFtdO1xyXG4gICAgY29uc3QgYXR0cmlidXRpb25zID0gdGhpcy5fYXR0cmlidXRpb25zO1xyXG4gICAgZm9yIChjb25zdCBpIGluIGF0dHJpYnV0aW9ucykge1xyXG4gICAgICBpZiAoYXR0cmlidXRpb25zW2ldKSB7XHJcbiAgICAgICAgYXR0cmlicy5wdXNoKGkpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG5cclxuICBhZGRBdHRyaWJ1dGlvbih0ZXh0OiBzdHJpbmcpIHtcclxuICAgIHN1cGVyLmFkZEF0dHJpYnV0aW9uKHRleHQpO1xyXG4gICAgaWYgKHRoaXMubWFwKSB7XHJcbiAgICAgIHJ1bkluQWN0aW9uKCgpID0+IHtcclxuICAgICAgICB0aGlzLmRhdGFBdHRyaWJ1dGlvbnMucHVzaCh0ZXh0KTtcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhpcztcclxuICB9XHJcblxyXG4gIHJlbW92ZUF0dHJpYnV0aW9uKHRleHQ6IHN0cmluZykge1xyXG4gICAgc3VwZXIucmVtb3ZlQXR0cmlidXRpb24odGV4dCk7XHJcbiAgICBpZiAodGhpcy5tYXApIHtcclxuICAgICAgcnVuSW5BY3Rpb24oKCkgPT4ge1xyXG4gICAgICAgIHRoaXMuZGF0YUF0dHJpYnV0aW9ucy5yZW1vdmUodGV4dCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoaXM7XHJcbiAgfVxyXG5cclxuICBnZXQgYXR0cmlidXRpb25zKCk6IHN0cmluZ1tdIHtcclxuICAgIGNvbnN0IGF0dHJpYnV0aW9uc0xpc3Q6IHN0cmluZ1tdID0gW107XHJcbiAgICBjb25zdCBhdHRyaWJ1dGlvbnMgPSB0aGlzLl9hdHRyaWJ1dGlvbnM7XHJcbiAgICBmb3IgKGNvbnN0IGkgaW4gYXR0cmlidXRpb25zKSB7XHJcbiAgICAgIGlmIChhdHRyaWJ1dGlvbnNbaV0pIHtcclxuICAgICAgICBhdHRyaWJ1dGlvbnNMaXN0LnB1c2goaSk7XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYXR0cmlidXRpb25zTGlzdDtcclxuICB9XHJcblxyXG4gIGdldCBwcmVmaXgoKTogc3RyaW5nIHwgdW5kZWZpbmVkIHtcclxuICAgIGlmICghdGhpcy5vcHRpb25zLnByZWZpeCkgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgIHJldHVybiBgJHt0aGlzLm9wdGlvbnMucHJlZml4fWA7XHJcbiAgfVxyXG59XHJcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQU1BO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFPQTtBQUFBO0FBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUVBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQTtBQUNBO0FBQUE7QUFBQTtBQUFBO0FBR0E7QUFDQTtBQUFBO0FBQUE7QUFBQTtBQUdBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUFHQTtBQUNBO0FBQ0E7QUFBQTtBQUFBO0FBQUE7QUF2RkE7QUFBQTtBQUFBO0FBQUE7QUFBQSIsInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///./packages/terriajs/lib/Models/LeafletAttribution.ts\n");

/***/ })

}]);